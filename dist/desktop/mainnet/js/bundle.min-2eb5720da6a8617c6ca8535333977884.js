!function(){"use strict";function _get2(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:_get2(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;return void 0!==getter?getter.call(receiver):void 0}var origin,config,Signal,Money,_require5,not,pathEq,factory,controller,BASE_URL,directive,service,_class60,_temp10,ShowHidePassword,Row,CARD_GATEWAYS,PATH,_SEPA_GATEWAYS,SEPA_GATEWAYS,SEPA_COUNTRIES_URL,_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_slicedToArray=function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return function(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_createClass=function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor};function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}("next")})}}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};return Object.keys(descriptor).forEach(function(key){desc[key]=descriptor[key]}),desc.enumerable=!!desc.enumerable,desc.configurable=!!desc.configurable,("value"in desc||desc.initializer)&&(desc.writable=!0),desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc},desc),context&&void 0!==desc.initializer&&(desc.value=desc.initializer?desc.initializer.call(context):void 0,desc.initializer=void 0),void 0===desc.initializer&&(Object.defineProperty(target,property,desc),desc=null),desc}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function wrapControllerParams(controller){var newController=controller;if("function"==typeof controller){var $inject=["$element","$compile","$scope"].concat(_toConsumableArray(controller.$inject||[]));if(3<$inject.length&&!controller.length)throw new Error("Wrong code style!");(newController=function($element,$compile,$scope){for(var _len2=arguments.length,args=Array(3<_len2?_len2-3:0),_key2=3;_key2<_len2;_key2++)args[_key2-3]=arguments[_key2];var _this=this,onError=function(){return $element.addClass("_internal-error"),_this};try{var instance=new(Function.prototype.bind.apply(controller,[null].concat(args))),originalPostLink=instance.$postLink;return $element.addClass($element.prop("tagName").toLowerCase().replace(/^w-/,"")),originalPostLink&&(instance.$postLink=function(){try{for(var _len3=arguments.length,args=Array(_len3),_key3=0;_key3<_len3;_key3++)args[_key3]=arguments[_key3];return originalPostLink.apply(instance,args)}catch(e){return onError()}}),instance}catch(e){return onError()}}).$inject=$inject}return newController}origin=angular.module,angular.module=function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];var name=args[0],module=origin.call.apply(origin,[angular].concat(args));return-1===WavesApp.modules.indexOf(name)&&(WavesApp.modules.push(name),function(module){var origin=module.controller;module.controller=function(name,$ctrl){if("function"!=typeof $ctrl)throw new Error("Wrong code style!");return WavesApp.addController(name,$ctrl),origin.call(this,name,wrapControllerParams($ctrl))}}(module),function(module){var origin=module.component;module.component=function(name,$component){return $component.controller=wrapControllerParams($component.controller),origin.call(this,name,$component)}}(module),function(module){var origin=module.directive;module.directive=function(name,$directive){return $directive.controller=wrapControllerParams($directive.controller),origin.call(this,name,$directive)}}(module)),module},angular.module("app",["ngAnimate","ngMaterial","ui.router","ui.router.state.events","app.templates","app.utils","app.ui","app.welcome","app.signIn","app.create","app.restore","app.saveSeed","app.desktop","app.ledger","app.keeper","app.import","app.wallet","app.dex","app.tokens","app.unavailable","app.stand"]),angular.module("app.create",[]),angular.module("app.desktop",[]),angular.module("app.dex",[]),angular.module("app.import",[]),angular.module("app.keeper",[]),angular.module("app.ledger",[]),angular.module("app.restore",[]),angular.module("app.saveSeed",[]),angular.module("app.sessions",[]),angular.module("app.signIn",[]),angular.module("app.stand",[]),angular.module("app.tokens",[]),angular.module("app.ui",[]),angular.module("app.unavailable",[]),angular.module("app.utils",[]),angular.module("app.wallet",["app.wallet.assets","app.wallet.portfolio","app.wallet.transactions","app.wallet.leasing"]),angular.module("app.welcome",[]),(config=function($urlRouterProvider,$stateProvider,$locationProvider,$compileProvider){var TransportU2F=require("@ledgerhq/hw-transport-u2f"),tsUtils=require("ts-utils"),BigNumber=require("@waves/bignumber").BigNumber,ds=require("data-service"),i18next=require("i18next");return ds.config.setConfig(WavesApp.network),ds.config.set("remappedAssetNames",WavesApp.remappedAssetNames),ds.config.set("oracleTokenomica",WavesApp.oracles.tokenomica),new(function(){function AppConfig(){_classCallCheck(this,AppConfig),this._initUrlResolveMode(),this._initLocalize(),this._initAdapters(),this._initStates(),this._initCompiler()}return _createClass(AppConfig,[{key:"_initAdapters",value:function(){var Transport=window.TransportNodeHid||TransportU2F;ds.signAdapters.adapterList.forEach(function(Adapter){return Adapter.initOptions({networkCode:WavesApp.network.code.charCodeAt(0),openTimeout:WavesApp.sign.openTimeout,listenTimeout:WavesApp.sign.listenTimeout,exchangeTimeout:WavesApp.sign.exchangeTimeout,debug:!WavesApp.isProduction(),transport:Transport&&Transport.default,extension:function(){return"undefined"==typeof Waves?null:Waves}})})}},{key:"_initUrlResolveMode",value:function(){WavesApp.isWeb()&&$locationProvider.html5Mode(!0),$urlRouterProvider.otherwise("/")}},{key:"_initLocalize",value:function(){var BIG_NUMBER_FORMAT={decimalSeparator:".",groupSeparator:",",groupSize:3,secondaryGroupSize:0,fractionGroupSeparator:"Â ",fractionGroupSize:0};i18next.use(i18nextLocizeBackend).init({lng:AppConfig.getUserLang(),debug:!WavesApp.isProduction(),ns:WavesApp.modules.filter(tsUtils.filterList(tsUtils.notContains("app.templates"),tsUtils.notContains("app.keeper"),tsUtils.notContains("app.wallet"),tsUtils.notContains("app.stand"))),fallbackLng:"en",whitelist:Object.keys(WavesApp.localize),defaultNS:"app",useCookie:!1,useLocalStorage:!1,interpolation:{format:function(value,_format){switch(_format){case"money":return value&&value.getTokens().toFixed()||"";case"money-currency":return value?value.getTokens().toFixed()+" "+value.asset.displayName:"";case"money-fee":return value&&value.getTokens().toFixed()+" "+value.asset.displayName||"";case"BigNumber":return value&&value.toFixed()||"";default:throw new Error("Wrong format type!")}}},backend:{loadPath:"/locales/{{lng}}/{{ns}}.json?"+WavesApp.version,referenceLng:"en"}}),i18next.on("initialized",function(){var localeData=WavesApp.getLocaleData().separators;BigNumber.config.set({ROUNDING_MODE:BigNumber.ROUND_MODE.ROUND_DOWN,FORMAT:tsUtils.merge(Object.create(null),BIG_NUMBER_FORMAT,{groupSeparator:localeData.group,decimalSeparator:localeData.decimal})}),WavesApp.isDesktop()&&transfer("setLanguage",i18next.language),i18next.on("languageChanged",function(){WavesApp.isDesktop()&&transfer("setLanguage",i18next.language);var localeData=WavesApp.getLocaleData().separators;BigNumber.config.set({ROUNDING_MODE:BigNumber.ROUND_MODE.ROUND_DOWN,FORMAT:tsUtils.merge(Object.create(null),BIG_NUMBER_FORMAT,{groupSeparator:localeData.group,decimalSeparator:localeData.decimal})})})})}},{key:"_initStates",value:function(){var defaultUrl=AppConfig.getUrlFromState(WavesApp.stateTree.find("welcome"));$urlRouterProvider.when("",defaultUrl),WavesApp.stateTree.toArray().slice(1).forEach(function(item){var abstract=item.get("abstract"),url=AppConfig.getUrlFromState(item),redirectTo=item.get("redirectTo"),reloadOnSearch=item.get("reloadOnSearch"),views=item.get("views").reduce(function(views,viewData){var controller=abstract||viewData.noController?void 0:AppConfig.getCtrlName(item.get("controller")||tsUtils.camelCase(item.id)),template=viewData.template,templateUrl=template?void 0:viewData.templateUrl||AppConfig.getTemplateUrl(WavesApp.stateTree.getPath(item.id));return views[viewData.name]={controller:controller,template:template,templateUrl:templateUrl},views},Object.create(null));$stateProvider.state(WavesApp.stateTree.getPath(item.id).join("."),{abstract:abstract,url:url,redirectTo:redirectTo,views:views,reloadOnSearch:reloadOnSearch})})}},{key:"_initCompiler",value:function(){$compileProvider.commentDirectivesEnabled(!1),$compileProvider.cssClassDirectivesEnabled(!1),$compileProvider.debugInfoEnabled(!WavesApp.isProduction())}}],[{key:"getCtrlName",value:function(name){return name.charAt(0).toUpperCase()+name.substr(1)+"Ctrl as $ctrl"}},{key:"getTemplateUrl",value:function(path){return path.filter(function(id){return!WavesApp.stateTree.find(id).get("abstract")}).reduce(function(result,item,index,array){return item=tsUtils.camelCase(item),index===array.length-1?result+="/modules/"+item+"/templates/"+item+".html":result+="/modules/"+item,result},"").replace(/\/\//g,"/").substr(1)}},{key:"getUserLang",value:function(){var available=Object.keys(WavesApp.localize),langFromStorage=localStorage.getItem("lng");if(-1!==available.indexOf(langFromStorage))return langFromStorage;var cookieLng=Cookies.get("locale"),userLang=navigator.language||navigator.userLanguage;if(-1!==available.indexOf(cookieLng))return cookieLng;if(userLang){if(-1!==available.indexOf(userLang))return userLang;var lng=null;return userLang.split(/\W/).some(function(part){return-1!==available.indexOf(part)?lng=part:-1!==available.indexOf(part.toLowerCase())&&(lng=part.toLowerCase()),!!lng}),lng||"en"}return"en"}},{key:"getUrlFromState",value:function(state){return state.get("abstract")?void 0:state.get("url")||"/"+state.id}}]),AppConfig}())}).$inject=["$urlRouterProvider","$stateProvider","$locationProvider","$compileProvider"],angular.module("app").config(config),function(){var locationHref=location.href,tsUtils=require("ts-utils"),i18next=require("i18next"),ds=require("data-service"),_require2=require("ramda"),propEq=_require2.propEq,where=_require2.where,gte=_require2.gte,lte=_require2.lte,equals=_require2.equals,__=_require2.__,i18nextReady=new Promise(function(resolve){i18next.on("initialized",function handler(data){resolve(data),i18next.off("initialized",handler)})}),PROGRESS_MAP={RUN_SCRIPT:10,APP_RUN:15,LOCALIZE_READY:25,IMAGES_LOADED:50};if(100!==Object.values(PROGRESS_MAP).reduce(function(result,item){return result+item},0))throw new Error("Configure loader progress!");var LOADER={_current:0,_root:document.querySelector(".app-loader"),_element:document.querySelector(".app-loader .progress"),addProgress:function(delta){this._current+=delta,this._current=Math.min(this._current,100),this._element.style.width=this._current+"%",WavesApp.progress=this._current},stop:function(){var _this2=this;return new Promise(function(resolve){var loader=$(_this2._root);loader.fadeOut(1e3,function(){loader.remove(),resolve()})})}};LOADER.addProgress(PROGRESS_MAP.RUN_SCRIPT),WavesApp.state="initApp";var run=function($rootScope,utils,user,$state,$transitions,state,modalManager,storage,notification,decorators,waves,ModalRouter,configService,userNotification){var _dec,_class,phone=WavesApp.device.phone(),tablet=WavesApp.device.tablet(),analytics=require("@waves/event-sender"),isPhone=!!phone,isTablet=!!tablet,isDesktop=!(isPhone||isTablet),isWeb=WavesApp.isWeb();return $rootScope.isDesktop=isDesktop,$rootScope.isNotDesktop=!isDesktop,$rootScope.isPhone=isPhone,$rootScope.isNotPhone=!isPhone,$rootScope.isTablet=isTablet,isPhone?document.body.classList.add("phone"):isTablet?document.body.classList.add("tablet"):isWeb?document.body.classList.add("web"):document.body.classList.add("desktop"),new(_dec=decorators.scope({closeByModal:!1}),_applyDecoratedDescriptor((_class=function(){function AppRun(){_classCallCheck(this,AppRun),this._unavailable=!1;var identityImg=require("identity-img");LOADER.addProgress(PROGRESS_MAP.APP_RUN),this.activeClasses=[],this._modalRouter=new ModalRouter,identityImg.config({rows:8,cells:8}),this._setHandlers(),this._stopLoader(),this._initializeLogin(),this._initializeOutLinks(),WavesApp.isDesktop()&&window.listenMainProcessEvent(function(type,url){var parts=utils.parseElectronUrl(url),path=parts.path.replace(/\/$/,"")||parts.path;path&&("/"===path||WavesApp.stateTree.where({noLogin:!0}).some(function(item){var url=item.get("url")||item.id;return path===url})?location.hash="#!"+path+parts.search:user.onLogin().then(function(){setTimeout(function(){location.hash="#!"+path+parts.search},1e3)}))}),$rootScope.WavesApp=WavesApp}return _createClass(AppRun,[{key:"_initTryDesktop",value:function(){var _this3=this;if(!isDesktop||WavesApp.isDesktop())return Promise.resolve(!0);var url=new URL(locationHref),href=("waves://"+url.pathname+url.search+url.hash).replace("///","//");return storage.load("openClientMode").then(function(clientMode){switch(clientMode){case"desktop":return window.open(href),_this3._runDesktop();case"web":return Promise.resolve(!0);default:return modalManager.showTryDesktopModal().then(function(){return _this3._runDesktop()}).catch(function(){return!0})}})}},{key:"_runDesktop",value:function(){return this._canOpenDesktopPage=!0,$state.go("desktop"),!1}},{key:"_setHandlers",value:function(){var _this4=this;$transitions.onSuccess({},function(transition){_this4._onChangeStateSuccess(transition)}),configService.change.on(this._updateServiceAvailable,this)}},{key:"_updateServiceAvailable",value:function(path){if("SERVICE_TEMPORARILY_UNAVAILABLE"!==path)return null;var unavailable=configService.get("SERVICE_TEMPORARILY_UNAVAILABLE");if(unavailable===this._unavailable)return null;this._unavailable=unavailable,ds.dataManager.setSilentMode(unavailable),unavailable&&!user.address?$state.go("unavailable"):user.logout("welcome")}},{key:"_initializeOutLinks",value:function(){WavesApp.isDesktop()&&$(document).on("click",'[target="_blank"]',function(e){var $link=$(e.currentTarget);e.preventDefault(),openInBrowser($link.attr("href"))})}},{key:"_updateUserNotifications",value:function(){var notifications=configService.get("NOTIFICATIONS")||[],time=ds.utils.normalizeTime(Date.now()),closed=user.getSetting("closedNotification").filter(function(id){return notifications.some(propEq("id",id))});user.setSetting("closedNotification",closed);var notificationsWithDate=notifications.map(function(item){return _extends({},item,{start_date:new Date(item.start_date),end_date:new Date(item.end_date)})});notificationsWithDate.filter(where({start_date:lte(__,time),end_date:gte(__,time),id:function(_id){return!(userNotification.has(_id)||closed.includes(_id))}})).forEach(function(item){var method=["warn","success","error","info"].find(equals(item.type))||"warn",literal="user-notification."+item.id;Object.entries(item.text).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),lang=_ref2[0],message=_ref2[1];i18next.addResource(lang,"app",literal,message)}),userNotification[method](_extends({},item,{body:{literal:literal}})).then(function(){user.setSetting("closedNotification",[item.id].concat(_toConsumableArray(user.getSetting("closedNotification"))))})}),notificationsWithDate.filter(where({end_date:lte(__,time)})).forEach(function(item){return userNotification.remove(item.id)})}},{key:"_listenChangeLanguage",value:function(){i18next.on("languageChanged",this._changeLangHandler)}},{key:"_stopListenChangeLanguage",value:function(){i18next.off("languageChanged",this._changeLangHandler)}},{key:"_changeLangHandler",value:function(){localStorage.setItem("lng",i18next.language)}},{key:"_initializeLogin",value:function(){var _this5=this;this._listenChangeLanguage(),analytics.init(WavesApp.analyticsIframe,{platform:WavesApp.type,networkByte:ds.config.get("code"),userType:"unknown"}),analytics.activate(),this._onInitialTransitions(),user.logoutSignal.on(function(){notification.destroyAll(),userNotification.removeAll(),clearInterval(_this5._notifyTimer)}),user.loginSignal.on(function(){userNotification.destroyAll(),i18nextReady.then(function(){_this5._updateUserNotifications(),clearInterval(_this5._notifyTimer),_this5._notifyTimer=setInterval(function(){return _this5._updateUserNotifications()},1e4)})})}},{key:"_onInitialTransitions",value:function(){var _this6=this,waiting=!1,START_STATES=WavesApp.stateTree.where({noLogin:!0}).map(function(item){return WavesApp.stateTree.getPath(item.id).join(".")}),offInitialTransitions=$transitions.onStart({},function(transition){var toState=transition.to(),fromState=transition.from(),params=transition.params(),tryDesktop=void 0;if(-1===START_STATES.indexOf(toState.name)){if("unavailable"===fromState.name)return $state.target(START_STATES[0]);transition.abort()}return("unavailable"!==toState.name||_this6._unavailable)&&("desktop"!==toState.name||_this6._canOpenDesktopPage)?waiting?null:(tryDesktop="main.dex-demo"===toState.name?Promise.resolve():_this6._initTryDesktop(),waiting=!0,void tryDesktop.then(function(canChangeState){return _this6._login(toState,canChangeState)}).then(function(){waiting=!1,offInitialTransitions(),_this6._stopListenChangeLanguage(),-1===START_STATES.indexOf(toState.name)?$state.go(toState.name,params):$state.go(user.getActiveState("wallet")),i18next.changeLanguage(user.getSetting("lng")),_this6._initializeTermsAccepted().then(function(){_this6._initializeBackupWarning()}).then(function(){_this6._modalRouter.initialize()});var offInnerTransitions=_this6._onInnerTransitions(START_STATES);user.logoutSignal.once(function(){offInnerTransitions(),_this6._onInitialTransitions()})})):$state.target(START_STATES[0])})}},{key:"_onInnerTransitions",value:function(START_STATES){return $transitions.onStart({},function(transition){var toState=transition.to(),custom=transition.options().custom;if(-1!==START_STATES.indexOf(toState.name)&&!custom.logout)return!1;state.signals.changeRouterStateStart.dispatch(transition)})}},{key:"_initializeTermsAccepted",value:function(){return Promise.all([storage.load("needReadNewTerms"),storage.load("termsAccepted")]).then(function(_ref3){var _ref4=_slicedToArray(_ref3,2),needReadNewTerms=_ref4[0],termsAccepted=_ref4[1];return needReadNewTerms?modalManager.showAcceptNewTerms(user):termsAccepted?Promise.resolve():modalManager.showTermsAccept(user)})}},{key:"_initializeBackupWarning",value:function(scope){var _this7=this;if(!user.getSetting("hasBackup")){var id=tsUtils.uniqueId("n"),changeModalsHandler=function(modal){scope.closeByModal=!0,notification.remove(id),scope.closeByModal=!1,modal.catch(function(){return null}).then(function(){user.getSetting("hasBackup")||_this7._initializeBackupWarning()})};modalManager.openModal.once(changeModalsHandler),analytics.send({name:"Create Save Phrase Show",target:"ui"}),notification.error({id:id,ns:"app.utils",title:{literal:"notification.backup.title"},body:{literal:"notification.backup.body"},action:{literal:"notification.backup.action",callback:function(){analytics.send({name:"Create Save Phrase Yes Click",target:"ui"}),modalManager.showSeedBackupModal()}},onClose:function(){if(analytics.send({name:"Create Save Phrase No Click",target:"ui"}),scope.closeByModal||user.getSetting("hasBackup"))return null;modalManager.openModal.off(changeModalsHandler);var stop=$transitions.onSuccess({},function(){stop(),_this7._initializeBackupWarning()})}},-1)}}},{key:"_login",value:function(currentState,canChangeState){var states=WavesApp.stateTree.where({noLogin:!0}).map(function(item){return WavesApp.stateTree.getPath(item.id).join(".")});return canChangeState&&-1===states.indexOf(currentState.name)&&$state.go(states[0]),user.onLogin()}},{key:"_onChangeStateSuccess",value:function(transition){var _this8=this,toState=transition.to(),fromState=transition.from(),from=fromState.name||document.referrer;if(toState.name!==fromState.name){switch(toState.name){case"create":analytics.send({name:"Create New Account Show",params:{from:from}});break;case"import":analytics.send({name:"Import Accounts Show",params:{from:from},target:"ui"});break;case"restore":analytics.send({name:"Import Backup Show",params:{from:from},target:"ui"});break;case"main.wallet.leasing":analytics.send({name:"Leasing Show",params:{from:from},target:"ui"});break;case"main.tokens":analytics.send({name:"Token Generation Show",target:"ui"});break;case"main.wallet.assets":analytics.send({name:"Wallet Assets Show",target:"ui"});break;case"main.wallet.portfolio":analytics.send({name:"Wallet Portfolio Show",target:"ui"});break;case"main.dex":analytics.send({name:"DEX Show",target:"ui"})}this.activeClasses.forEach(function(className){document.body.classList.remove(className)}),this.activeClasses=[],toState.name.split(".").filter(Boolean).forEach(function(className){var name=className.replace(/_/g,"-");document.body.classList.add(name),_this8.activeClasses.push(name)})}user.applyState(toState),state.signals.changeRouterStateSuccess.dispatch(toState)}},{key:"_stopLoader",value:function(){Promise.all([this._getLocalizeReadyPromise(),this._getImagesReadyPromise()]).then(function(){LOADER.stop(),WavesApp.state="appRun"}).catch(function(e){console.error(e),WavesApp.state="loadingError"})}},{key:"_getLocalizeReadyPromise",value:function(){return new Promise(function(resolve){i18next.on("initialized",function(){LOADER.addProgress(PROGRESS_MAP.LOCALIZE_READY),resolve()})})}},{key:"_getImagesReadyPromise",value:function(){return $.ajax({url:"/img/images-list.json?v="+WavesApp.version,dataType:"json"}).then(function(list){return Promise.all(list.map(AppRun.getLoadImagePromise(list.length)))})}}],[{key:"getLoadImagePromise",value:function(length){return function(path){return new Promise(function(resolve){var img=new Image,apply=function(){LOADER.addProgress(PROGRESS_MAP.IMAGES_LOADED/length),resolve()};img.onload=apply,img.onerror=function(){console.warn("Can't load image! \""+path+'"'),apply()},img.src=path})}}},{key:"_getUrlFromState",value:function(state){return WavesApp.stateTree.getPath(state.name.split(".").slice(-1)[0]).filter(function(id){return!WavesApp.stateTree.find(id).get("abstract")}).map(function(id){return WavesApp.stateTree.find(id).get("url")||id}).reduce(function(url,id){return url+"/"+id},"")}}]),AppRun}()).prototype,"_initializeBackupWarning",[_dec],Object.getOwnPropertyDescriptor(_class.prototype,"_initializeBackupWarning"),_class.prototype),_class)};run.$inject=["$rootScope","utils","user","$state","$transitions","state","modalManager","storage","notification","decorators","waves","ModalRouter","configService","userNotification","whatsNew"],angular.module("app").run(run)}(),Signal=require("ts-utils").Signal,Money=require("@waves/data-entities").Money,_require5=require("ramda"),not=_require5.not,pathEq=_require5.pathEq,(factory=function(user,Poll,utils,waves){return new(function(){function BalanceWatcher(){var _this9=this;_classCallCheck(this,BalanceWatcher),this.change=new Signal,this._balance=[],this._poll=null,this.ready=new Promise(function(resolve,reject){_this9._resolve=resolve,_this9._reject=reject}),user.onLogin().then(function(){return _this9._handleLogin()},function(){return _this9._handleLogout()})}return _createClass(BalanceWatcher,[{key:"getBalance",value:function(){return this._getHash()}},{key:"getBalanceByAsset",value:function(asset){var hash=this.getBalance();return hash[asset.id]?hash[asset.id]:new Money(0,asset)}},{key:"getBalanceByAssetList",value:function(assetList){return assetList.map(this.getBalanceByAsset,this)}},{key:"getBalanceByAssetId",value:function(id){return waves.node.assets.getAsset(id).then(this.getBalanceByAsset.bind(this))}},{key:"getFullBalanceByAssetId",value:function(id){var balance=this._balance.find(pathEq(["asset","id"],id));return balance?Promise.resolve(balance):waves.node.assets.getAsset(id).then(function(asset){var empty=new Money(0,asset);return{asset:asset,regular:empty,available:empty,inOrders:empty,leasedOut:empty,leasedIn:empty}})}},{key:"getFullBalanceList",value:function(){return this._balance.map(function(item){return _extends({},item)})}},{key:"_handleLogin",value:function(){this._watch(),user.logoutSignal.once(this._handleLogout,this)}},{key:"_handleLogout",value:function(){this._poll&&this._poll.destroy(),user.loginSignal.once(this._handleLogin,this)}},{key:"_watch",value:function(){var _this10=this;this._poll=new Poll(function(){return BalanceWatcher._getBalanceList()},function(list){return _this10._setBalanceList(list)},1e3),this._poll.ready.then(this._resolve,this._reject)}},{key:"_dispatch",value:function(){this.change.dispatch(this._getHash())}},{key:"_getHash",value:function(){return utils.toHash(this._balance.map(function(item){return item.available}),"asset.id")}},{key:"_setBalanceList",value:function(list){var _this11=this,dispatch=function(){_this11._balance=list,_this11._dispatch()};if(list.length!==this._balance.length)return dispatch(),null;list.length&&list.some(function(item,i){return function(a,b){return not(utils.isEqual(a.available,b.available))}(item,_this11._balance[i])})&&dispatch()}}],[{key:"_getBalanceList",value:function(){return waves.node.assets.userBalances()}}]),BalanceWatcher}())}).$inject=["user","Poll","utils","waves"],angular.module("app").factory("balanceWatcher",factory),function(){var fetch=require("data-service").fetch,_require7=require("ts-utils"),Signal=_require7.Signal,getPaths=_require7.getPaths,_get=_require7.get,clone=_require7.clone,BigNumber=require("@waves/bignumber").BigNumber,factory=function(Base,createPoll){return new(function(){function ConfigService(){_classCallCheck(this,ConfigService);var _this12=_possibleConstructorReturn(this,(ConfigService.__proto__||Object.getPrototypeOf(ConfigService)).call(this));return _this12._config=Object.create(null),_this12._feeConfig=Object.create(null),_this12.change=new Signal,_this12.configReady=createPoll(_this12,_this12._getConfig,_this12._setConfig,3e4),createPoll(_this12,_this12._getFeeConfig,_this12._setFeeConfig,3e4),_this12}return _inherits(ConfigService,Base),_createClass(ConfigService,[{key:"get",value:function(path){return clone(_get(this._config,path))}},{key:"getFeeConfig",value:function(){return clone(this._feeConfig)}},{key:"_getConfig",value:function(){return fetch(WavesApp.network.featuresConfigUrl).then(JSON.parse)}},{key:"_getFeeConfig",value:function(){return fetch(WavesApp.network.feeConfigUrl).then(WavesApp.parseJSON).then(ConfigService._parseFeeConfig)}},{key:"_setFeeConfig",value:function(config){this._feeConfig=config}},{key:"_setConfig",value:function(config){var _this13=this,myConfig=this._config;this._config=config,ConfigService._getDifferencePaths(myConfig,config).forEach(function(path){return _this13.change.dispatch(String(path))})}}],[{key:"_getDifferencePaths",value:function(previous,next){return getPaths(next).filter(function(path){return _get(previous,path)!==_get(next,path)}).map(String)}},{key:"_parseFeeConfig",value:function(data){switch(void 0===data?"undefined":_typeof(data)){case"number":case"string":return new BigNumber(data);case"object":return Object.entries(data).forEach(function(_ref5){var _ref6=_slicedToArray(_ref5,2),key=_ref6[0],value=_ref6[1];data[key]=ConfigService._parseFeeConfig(value)}),data;default:return data}}}]),ConfigService}())};factory.$inject=["Base","createPoll"],angular.module("app").factory("configService",factory)}(),function(){var factory=function(utils){var DefaultSettings=function(){function DefaultSettings(settings){_classCallCheck(this,DefaultSettings),this.settings=settings,this.change=new tsUtils.Signal,this.defaults={advancedMode:!1,network:WavesApp.network,lastOpenVersion:"",whatsNewList:[],closedNotification:[],dontShowSpam:!0,withScam:!1,scamListUrl:WavesApp.network.scamListUrl,tokensNameListUrl:WavesApp.network.tokensNameListUrl,logoutAfterMin:5,encryptionRounds:5e3,savePassword:!0,hasBackup:!0,termsAccepted:!0,tradeWithScriptAssets:!1,needReadNewTerms:!1,lastInterval:WavesApp.dex.defaultResolution,baseAssetId:WavesApp.defaultAssets.USD,oracleWaves:WavesApp.oracles.waves,events:Object.create(null),lng:"en",send:{defaultTab:"singleSend"},orderLimit:.05,pinnedAssetIdList:[WavesApp.defaultAssets.WAVES,WavesApp.defaultAssets.BTC,WavesApp.defaultAssets.ETH,WavesApp.defaultAssets.USD,WavesApp.defaultAssets.EUR,WavesApp.defaultAssets.LTC,WavesApp.defaultAssets.ZEC,WavesApp.defaultAssets.BCH,WavesApp.defaultAssets.BSV,WavesApp.defaultAssets.TRY,WavesApp.defaultAssets.DASH,WavesApp.defaultAssets.XMR,WavesApp.defaultAssets.VST,WavesApp.defaultAssets.ERGO,WavesApp.defaultAssets.BNT],wallet:{activeState:"assets",assets:{chartMode:"month",activeChartAssetId:WavesApp.defaultAssets.WAVES,chartAssetIdList:[WavesApp.defaultAssets.WAVES,WavesApp.defaultAssets.BTC,WavesApp.defaultAssets.ETH]},transactions:{filter:"all"},leasing:{filter:"all"},portfolio:{spam:[],filter:"active"}},dex:{chartCropRate:1.5,assetIdPair:{amount:WavesApp.defaultAssets.WAVES,price:WavesApp.defaultAssets.BTC},createOrder:{expirationName:"30day"},watchlist:{showOnlyFavorite:!1,favourite:[[WavesApp.defaultAssets.WAVES,WavesApp.defaultAssets.BTC]],activeTab:"all"},layout:{watchlist:{collapsed:!1},orderbook:{collapsed:!1},tradevolume:{collapsed:!0}}}}}return _createClass(DefaultSettings,[{key:"get",value:function(path){var setting=tsUtils.get(this.settings,path);return tsUtils.isEmpty(setting)?tsUtils.get(this.defaults,path):setting}},{key:"set",value:function(path,value){if(utils.isEqual(this.get(path),value))return null;utils.isEqual(tsUtils.get(this.defaults,path),value)?tsUtils.unset(this.settings,path):tsUtils.set(this.settings,path,value),this.change.dispatch(path)}},{key:"getSettings",value:function(){return this.settings}}]),DefaultSettings}();return{create:function(settings){return new DefaultSettings(settings)}}};factory.$inject=["utils"],angular.module("app").factory("defaultSettings",factory)}(),function(){var Signal=require("ts-utils").Signal,factory=function(user,Poll,$injector,TxEvent,utils){var EventManager=function(){function EventManager(){var _this14=this;_classCallCheck(this,EventManager),this.ready=null,this.signals={changeBalanceEvent:new Signal},this._poll=null,this._events=Object.create(null),this._waves=null,user.onLogin().then(function(){return _this14._handleLogin()},function(){return _this14._handleLogout()})}return _createClass(EventManager,[{key:"addTx",value:function(tx,moneyList){this._events[tx.id]=new TxEvent(tx.id,moneyList),this._syncEventList(),this._resetPoll()}},{key:"getReservedMoneyList",value:function(){var _this15=this;return Object.keys(this._events).reduce(function(list,eventId){return list.concat(_this15._events[eventId].getReservedMoneyList())},[])}},{key:"_handleLogin",value:function(){this._initialize(),user.logoutSignal.once(this._handleLogout,this)}},{key:"_handleLogout",value:function(){this._poll&&this._poll.destroy(),user.loginSignal.once(this._handleLogin,this)}},{key:"_initialize",value:function(){var _this16=this;this._waves=$injector.get("waves"),this._waves.node.transactions.listUtx().then(function(list){var events=user.getSetting("events"),utxHash=utils.toHash(list,"id");Object.keys(events).forEach(function(id){utxHash[id]||_this16._removeEvent(id,!0)}),list&&list.length&&_this16._resetPoll()})}},{key:"_addEvent",value:function(tx){if(!this._events[tx.id])return this._events[tx.id]=new TxEvent(tx.id,EventManager._getMoneyListData(tx)),this._syncEventList(),!0}},{key:"_removeEvent",value:function(id,force){(this._events[id]||force)&&(delete this._events[id],this._syncEventList(),force||this.signals.changeBalanceEvent.dispatch())}},{key:"_resetPoll",value:function(){var _this17=this;this._poll&&this._poll.destroy(),setTimeout(function(){_this17._poll=new Poll(_this17._waves.node.transactions.listUtx,_this17._addUtxList.bind(_this17),1e3)},1e3)}},{key:"_addUtxList",value:function(list){var _this18=this,dispatch=!1,utxHash=utils.toHash(list,"id");Object.keys(this._events).forEach(function(id){utxHash[id]||(_this18._removeEvent(id),dispatch=!0)}),list.length?(list.forEach(function(tx){_this18._events[tx.id]||(_this18._addEvent(tx),dispatch=!0)}),dispatch&&this.signals.changeBalanceEvent.dispatch()):this._poll&&(this._poll.destroy(),this._poll=null)}},{key:"_syncEventList",value:function(){var result=Object.create(null);Object.keys(this._events).forEach(function(id){result[id]=!0}),user.setSetting("events",result)}}],[{key:"_getMoneyListData",value:function(tx){var moneyList=[tx.fee];return 4===tx.type&&moneyList.push(tx.amount),moneyList}}]),EventManager}();return utils.bind(new EventManager)};factory.$inject=["user","Poll","$injector","TxEvent","utils"],angular.module("app").factory("eventManager",factory)}(),function(){var factory=function(){var AVAILABLE_TAGS=["div","span"],AVAILABLE_URL_PROTOCOLS=["http:","https:","mailto:"],LocaleParser=function(){function LocaleParser(open,close,contentOpen,contentClose,compile){_classCallCheck(this,LocaleParser),this.openChar=open,this.closeChar=close,this.contentOpenChar=contentOpen,this.contentCloseChar=contentClose,this.compile=compile}return _createClass(LocaleParser,[{key:"parse",value:function(text){var _this19=this,openList=[],closeList=[],openContent=[],closeContent=[];text.split("").forEach(function(char,index){switch(char){case _this19.openChar:openList.push(index);break;case _this19.closeChar:closeList.push(index);break;case _this19.contentOpenChar:openContent.push(index);break;case _this19.contentCloseChar:closeContent.push(index)}});var mainIntervals=[],contentIntervals=[];openList.reverse().forEach(function(open){closeList.some(function(close,i){return open<close&&(mainIntervals.push({open:open,close:close}),closeList.splice(i,1),!0)})}),openContent.reverse().forEach(function(open){closeContent.some(function(close,i){return open<close&&(contentIntervals.push({open:open,close:close}),closeContent.splice(i,1),!0)})});var index=0,result="";return mainIntervals.reverse().forEach(function(mainData){contentIntervals.forEach(function(contentData){if(contentData.open===mainData.close+1){var content=text.slice(contentData.open+1,contentData.close),main=text.slice(mainData.open+1,mainData.close);result+=text.slice(index,mainData.open)+_this19.compile({main:main,content:content}),index=contentData.close+1}})}),result+=text.slice(index)}}]),LocaleParser}(),tagParser=new LocaleParser("{","}","[","]",function(_ref7){var main=_ref7.main,content=_ref7.content;try{var firstDotIndex=main.indexOf("."),tagName="";switch(firstDotIndex){case 0:tagName="span";break;case-1:tagName=main;break;default:tagName=main.slice(0,firstDotIndex)}var classes=main.slice(firstDotIndex+1).split(".").join(" ");if(-1===AVAILABLE_TAGS.indexOf(tagName))throw new Error("Locale parser: Wrong tag name! "+tagName);return"<"+tagName+' class="'+classes+'">'+content+"</"+tagName+">"}catch(e){return content}}),linkParser=new LocaleParser("[","]","(",")",function(_ref8){var main=_ref8.main,content=_ref8.content;try{var url=new URL(content);if(-1===AVAILABLE_URL_PROTOCOLS.indexOf(url.protocol))throw new Error("Locale parser: Wrong url protocol! "+url.protocol);return'<a href="'+content+'" target="_blank" rel="noopener noreferrer">'+main+"</a>"}catch(e){return""}});return function(text){return tagParser.parse(linkParser.parse(text))}};factory.$inject=[],angular.module("app").factory("localeParser",factory)}(),function(){var factory=function(utils){return function(){function Queue(options){_classCallCheck(this,Queue),this.signals=utils.liteObject({change:new tsUtils.Signal}),this._queueLimit=options.queueLimit,this._list=[],this._activeList=[],this._queueHash=Object.create(null)}return _createClass(Queue,[{key:"push",value:function(item){if(this._queueHash[item.id])throw new Error("Duplicate queue id!");var handler=this._getEndPromiseHandler(item);item.promise.then(handler,handler),this._queueHash[item.id]=item,this._activeList.length===this._queueLimit?this._list.push(item):(this._activeList.push(item),this._dispatch())}},{key:"remove",value:function(id){if(this._queueHash[id]){var item=this._queueHash[id];return this._getEndPromiseHandler(item)(),item}}},{key:"removeAll",value:function(){var _this20=this;Object.keys(this._queueHash).forEach(function(key){return _this20.remove(key)})}},{key:"destroy",value:function(id){this._queueHash[id]&&(this.remove(id),delete this._queueHash[id])}},{key:"destroyAll",value:function(){var _this21=this;Object.keys(this._queueHash).forEach(function(key){return _this21.destroy(key)})}},{key:"has",value:function(id){return!!this._queueHash[id]}},{key:"getActiveList",value:function(){return this._activeList.slice()}},{key:"_dispatch",value:function(){this.signals.change.dispatch(this.getActiveList())}},{key:"_getEndPromiseHandler",value:function(item){var _this22=this;return this._queueHash[item.id]&&delete this._queueHash[item.id],function(){[_this22._list,_this22._activeList].forEach(function(list,isActiveList){var index=list.indexOf(item);-1!==index&&(list.splice(index,1),isActiveList&&_this22._updateActiveList())})}}},{key:"_updateActiveList",value:function(){if(this._list.length){var item=this._list.shift();this._activeList.push(item)}this._dispatch()}}]),Queue}()};factory.$inject=["utils"],angular.module("app").factory("Queue",factory)}(),function(){var factory=function(user,utils){var tsUtils=require("ts-utils");return new(function(){function SessionBridge(){var _this23=this;_classCallCheck(this,SessionBridge),this._sessionId="s_"+Date.now(),this._key="__sb",this._messageHash=Object.create(null),this.signals=utils.liteObject({changeSessions:new tsUtils.Signal}),this._api=utils.liteObject({getLoginData:function(commandData){return _this23._getLoginData(commandData)},sign:function(commandData){return _this23._sign(commandData)},response:function(commandData){return _this23._onResponse(commandData)}}),this._setHandlers(),user.onLogin().then(function(){return _this23._handleLogin()},function(){return _this23._handleLogout()})}return _createClass(SessionBridge,[{key:"_sessionListKey",get:function(){return this._key+"-sessionList"}}]),_createClass(SessionBridge,[{key:"getSessionsData",value:function(){var _this24=this,userDataHash=this._getOtherSessions().reduce(function(result,sessionId){var userData=_this24._getUserDataBySession(sessionId);return userData?result[userData.address]=userData:_this24._clearCommand(_this24._getSessionDataKey(sessionId)),result},Object.create(null));return Object.values(userDataHash)}},{key:"login",value:function(sessionId){return this._runCommand("getLoginData",sessionId).then(function(response){"success"===response.status&&user.login(response.data)})}},{key:"sign",value:function(type,tx){var master=this._getMasterSessionId(user.address);return this._runCommand("sign",master&&master.id,{type:type,tx:tx})}},{key:"_handleLogin",value:function(){this._addSession(),this._addUserData(),user.logoutSignal.once(this._handleLogout,this)}},{key:"_handleLogout",value:function(){this._destroy(),user.loginSignal.once(this._handleLogin,this)}},{key:"_getLoginData",value:function(request){return this._setResponseSuccess(request,{address:user.address})}},{key:"_sign",value:function(){}},{key:"_setResponseSuccess",value:function(request,body){this._setResponse(request,"success",{data:body})}},{key:"_setResponseError",value:function(request,message){this._setResponse(request,"error",{message:message})}},{key:"_setResponse",value:function(request,status,data){var _this25=this,command=this._getCommandKey(request.referer,"response");this._dispatch(command,{id:request.id,referer:this._sessionId,data:_extends({status:status},data)}),setTimeout(function(){_this25._clearCommand(command)},100)}},{key:"_runCommand",value:function(apiMethod,targetSessionId,data){var _this26=this;return new Promise(function(resolve){var id=tsUtils.uniqueId("cmd__"),params={id:id,data:data,referer:_this26._sessionId},command=_this26._getCommandKey(targetSessionId,apiMethod);_this26._messageHash[id]=function(result){delete _this26._messageHash[id],_this26._clearCommand(command),resolve(result)},_this26._dispatch(command,params),setTimeout(function(){_this26._messageHash[id]&&_this26._messageHash[id]({status:"error",message:new Error("Timeout limit error!")})},1e3)})}},{key:"_dispatch",value:function(storageKey,data){localStorage.setItem(storageKey,JSON.stringify(data))}},{key:"_clearCommand",value:function(storageKey){localStorage.removeItem(storageKey)}},{key:"_onResponse",value:function(commandData){this._messageHash[commandData.id]&&this._messageHash[commandData.id](commandData.data)}},{key:"_setHandlers",value:function(){var _this27=this;window.addEventListener("storage",function(event){return _this27._onStorageEvent(event)},!1),window.addEventListener("unload",function(){return _this27._destroy()},!1)}},{key:"_onStorageEvent",value:function(event){if(event.newValue){var cmd=this._parseCommand(event.key);if(cmd&&cmd in this._api){var commandData=JSON.parse(localStorage.getItem(event.key));try{this._api[cmd](commandData)}catch(e){"response"!==cmd&&this._setResponseError(commandData,e)}}else event.key===this._sessionListKey&&this.signals.changeSessions.dispatch(this.getSessionsData())}}},{key:"_destroy",value:function(){this._removeSession(),this._removeUserData()}},{key:"_addSession",value:function(){var sessions=JSON.parse(localStorage.getItem(this._sessionListKey)||"[]");sessions.push(this._sessionId),localStorage.setItem(this._sessionListKey,JSON.stringify(sessions))}},{key:"_removeSession",value:function(){var sessions=JSON.parse(localStorage.getItem(this._sessionListKey)||"[]"),index=sessions.indexOf(this._sessionId);-1!==index&&(sessions.splice(index,1),localStorage.setItem(this._sessionListKey,JSON.stringify(sessions)))}},{key:"_addUserData",value:function(){localStorage.setItem(this._getSessionDataKey(),JSON.stringify({name:user.name,address:user.address,id:this._sessionId,isMaster:user.isMaster()}))}},{key:"_getMasterSessionId",value:function(address){return tsUtils.find(this.getSessionsData(),{address:address,isMaster:!0})}},{key:"_getAllSessions",value:function(){return JSON.parse(localStorage.getItem(this._sessionListKey)||"[]")}},{key:"_getOtherSessions",value:function(){var _this28=this;return this._getAllSessions().filter(function(sessionId){return sessionId!==_this28._sessionId})}},{key:"_removeUserData",value:function(sessionId){localStorage.removeItem(this._getSessionDataKey(sessionId))}},{key:"_getUserDataBySession",value:function(sessionId){return JSON.parse(localStorage.getItem(this._getSessionDataKey(sessionId)))}},{key:"_getSessionDataKey",value:function(argument_0){var sessionId=0<arguments.length&&void 0!==argument_0?argument_0:this._sessionId;return this._key+"-"+sessionId}},{key:"_getCommandKey",value:function(sessionId,cmd){return this._getSessionDataKey(sessionId)+"-"+cmd+"-cmd"}},{key:"_parseCommand",value:function(localStorageKey){var _localStorageKey$spli=localStorageKey.split("-").slice(1,-1),_localStorageKey$spli2=_slicedToArray(_localStorageKey$spli,2),sessionId=_localStorageKey$spli2[0],cmd=_localStorageKey$spli2[1];return sessionId&&cmd&&sessionId===this._sessionId?cmd:null}}]),SessionBridge}())};factory.$inject=["user","utils"],angular.module("app").factory("sessionBridge",factory)}(),function(){var factory=function(timeLine,$injector){var tsUtils=require("ts-utils");return new(function(){function State(){var _this29=this;_classCallCheck(this,State),this.signals={window:{blur:new tsUtils.Signal,focus:new tsUtils.Signal},sleep:new tsUtils.Signal,wakeUp:new tsUtils.Signal,changeRouterStateSuccess:new tsUtils.Signal,changeRouterStateStart:new tsUtils.Signal},this.lastOpenVersion="",this._timer=null,this._seepStartTime=null,this._maxSleep=null,this.__sleepStep=null,this._block=document.createElement("DIV"),this._handlers=Object.create(null),timeLine.wait(100).then(function(){_this29.user=$injector.get("user"),_this29.user.loginSignal.once(_this29._handleLogin,_this29),_this29.user.logoutSignal.once(_this29._handleLogout,_this29)}),this._initialize()}return _createClass(State,[{key:"_sleepStep",get:function(){return this.__sleepStep},set:function(value){value?this._maxSleep&&this._addBlock():this._removeBlock(),this.__sleepStep=value}}]),_createClass(State,[{key:"_initialize",value:function(){this._addBlockStyles(),this._createHandlers(),this._setHandlers()}},{key:"_handleLogin",value:function(){this._maxSleep=this.user.getSetting("logoutAfterMin"),this.user.changeSetting.on(this._onUserSettingChange,this),this.user.logoutSignal.once(this._handleLogout,this)}},{key:"_handleLogout",value:function(){this._timer&&(timeLine.cancel(this._timer),this._timer=null),this.user.changeSetting.off(this._onUserSettingChange),this.user.loginSignal.once(this._handleLogin,this)}},{key:"_onUserSettingChange",value:function(path){"logoutAfterMin"===path&&(this._maxSleep=this.user.getSetting("logoutAfterMin"))}},{key:"_addBlockStyles",value:function(){this._block.classList.add("sleep-block")}},{key:"_createHandlers",value:function(){var _this30=this;this._handlers.focus=function(){_this30.signals.window.focus.dispatch(),_this30._wakeUp()},this._handlers.blur=function(){_this30.signals.window.blur.dispatch(),_this30._sleep()}}},{key:"_wakeUp",value:function(){this._seepStartTime=null,this._sleepStep=null,this._timer&&(timeLine.cancel(this._timer),this._timer=null),this.signals.wakeUp.dispatch()}},{key:"_removeBlock",value:function(){this._block&&this._block.parentNode===document.body&&document.body.removeChild(this._block)}},{key:"_addBlock",value:function(){this._block&&!this._block.parentNode&&document.body.appendChild(this._block)}},{key:"_sleep",value:function(){var _this31=this;this._timer&&(timeLine.cancel(this._timer),this._timer=null),this._seepStartTime||(this._seepStartTime=Date.now(),this._setSleepStep(0)),this._timer=timeLine.timeout(function(){_this31._timer=null;var time=Date.now()-_this31._seepStartTime,sleepMinutes=Math.floor(time/6e4);_this31._sleep(),_this31._setSleepStep(sleepMinutes)},1e3)}},{key:"_setSleepStep",value:function(step){if(this._sleepStep===step)return null;this._sleepStep=step,this.signals.sleep.dispatch(this._sleepStep)}},{key:"_setHandlers",value:function(){var _this32=this;Object.keys(this._handlers).forEach(function(event){window.addEventListener(event,_this32._handlers[event],!1)})}}]),State}())};factory.$inject=["timeLine","$injector"],angular.module("app").factory("state",factory)}(),function(){var factory=function(state,user,$state){return new(function(){function StateManager(){_classCallCheck(this,StateManager),this.rootStateList=[],this.subStateList=[],state.signals.changeRouterStateSuccess.on(this._currentStateLists,this),this.changeRouteState=state.signals.changeRouterStateSuccess,this._currentStateLists()}return _createClass(StateManager,[{key:"getSrefByState",value:function(state){return WavesApp.stateTree.getPath(state.id).join(".")}},{key:"getStateTree",value:function(argument_0){var fromId=0<arguments.length&&void 0!==argument_0?argument_0:"main";return WavesApp.stateTree.find(fromId).getChildren().filter(function(child){return!0!==child.get("noLogin")}).map(StateManager._remapStateItem)}},{key:"_currentStateLists",value:function(){if(!$state.$current||!$state.$current.name)return!1;var root=WavesApp.stateTree.find("main"),rootPath=WavesApp.stateTree.getPath(root.id).join(".");this.rootStateList=root.getChildren().map(function(item){var path=user.getActiveState(item.id),base=rootPath+"."+item.id;return{path:path,name:item.id,base:base}});var idList=$state.$current.name.split("."),parent=idList[idList.length-2],stateData=WavesApp.stateTree.find(parent);stateData&&!stateData.get("abstract")?this.subStateList=stateData.getChildren().map(function(item){var path=WavesApp.stateTree.getPath(item.id).join(".");return{name:item.id,path:path}}):this.subStateList=[]}}],[{key:"_remapStateItem",value:function(item){var list=item.getChildren().map(StateManager._remapStateItem),result={list:list,isLeaf:0===list.length,id:item.id};return list.length?Object.defineProperty(result,"sref",{get:function(){return user.getActiveState(item.id)}}):result.sref=user.getActiveState(item.id),result}}]),StateManager}())};factory.$inject=["state","user","$state"],angular.module("app").factory("stateManager",factory)}(),function(){var factory=function(){return new(function(){function Themes(){_classCallCheck(this,Themes),this._events={},this.cssRules={},this.currentTheme="default",this.themes=WavesApp.themesConf.themes,this.candleColors={},this._initCssStyleEl(),this.changeTheme(),this._setDefaultCandle(),this.links=[].slice.apply(document.querySelectorAll("[rel=stylesheet]")).filter(function(el){return el.getAttribute("theme")})}return _createClass(Themes,[{key:"getCurrentTheme",value:function(){return this.currentTheme}},{key:"getDefaultTheme",value:function(){return"default"}},{key:"changeTheme",value:function(name){return name=name||"default",this.hasTheme(name)&&name!==this.currentTheme&&(this.currentTheme=name,this._changeTheme(name)),this.currentTheme}},{key:"hasTheme",value:function(name){return this.themes.includes(name)}},{key:"getAllThemes",value:function(){return this.themes}},{key:"getSettings",value:function(theme){return WavesApp.themesConf[theme||this.currentTheme||"default"]||{}}},{key:"getTradingViewConfig",value:function(theme){return this.getSettings(theme).tradingView||{}}},{key:"switchNext",value:function(){var index=this.themes.indexOf(this.currentTheme)+1,newTheme=this.themes[index%this.themes.length];return this.changeTheme(newTheme),this.currentTheme}},{key:"getCandlesColors",value:function(currentTheme){return this.getTradingViewConfig(currentTheme).candles}},{key:"getCurrentCandleSColor",value:function(name){if(name){var _getCandlesColors$nam=this.getCandlesColors()[name];return{up:_getCandlesColors$nam.upColor,down:_getCandlesColors$nam.downColor,volume0:_getCandlesColors$nam.volume0,volume1:_getCandlesColors$nam.volume1}}var _candleColors=this.candleColors,up=_candleColors.up,down=_candleColors.down,volume0=_candleColors.volume0,volume1=_candleColors.volume1;return{up:up=up||this.getCandlesColors().blue.upColor,down:down=down||this.getCandlesColors().blue.downColor,volume0:volume0=volume0||this.getCandlesColors().blue.volume0,volume1:volume1=volume1||this.getCandlesColors().blue.volume1}}},{key:"changeStyleRules",value:function(rules){this.cssRules=_extends({},this.cssRules,rules),this._applyRules()}},{key:"setCandleColors",value:function(up,down){this.candleColors={up:up,down:down},this.changeStyleRules({".candle-up-color-dynamic":{color:up+"!important"},".candle-down-color-dynamic":{color:down+"!important"},".candle-up-bg-color-dynamic":{"background-color":up+"!important"},".candle-down-bg-color-dynamic":{"background-color":down+"!important"}})}},{key:"setCandleColorsByName",value:function(currentTheme,name){var colors=this.getCandlesColors(currentTheme),cfg=colors[name]||colors.blue;cfg&&this.setCandleColors(cfg.upColor,cfg.downColor)}},{key:"_setDefaultCandle",value:function(){var _getCandlesColors$DEF=this.getCandlesColors().blue,upColor=_getCandlesColors$DEF.upColor,downColor=_getCandlesColors$DEF.downColor;this.setCandleColors(upColor,downColor)}},{key:"_changeTheme",value:function(name){this.links.forEach(function(style){style.getAttribute("theme")===name&&(style.disabled=!1,document.head.appendChild(style))})}},{key:"_applyRules",value:function(){var cssText="",parseStyles=function(argument_0){var styles=0<arguments.length&&void 0!==argument_0?argument_0:{},stylesTxt="",_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=Object.entries(styles)[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var _step$value=_slicedToArray(_step.value,2);stylesTxt+="\n"+_step$value[0]+": "+_step$value[1]+";"}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return stylesTxt},_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=Object.entries(this.cssRules)[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var _step2$value=_slicedToArray(_step2.value,2);cssText+=_step2$value[0]+" {"+parseStyles(_step2$value[1])+"\n}\n"}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}this.cssStyleEl.innerHTML=cssText}},{key:"_initCssStyleEl",value:function(){this.cssStyleEl=document.createElement("style"),document.head.appendChild(this.cssStyleEl)}}]),Themes}())};factory.$inject=[],angular.module("app").factory("themes",factory)}(),function(){var equals=require("ramda").equals,_isValidAddress=require("@waves/signature-adapter").isValidAddress,NOT_SYNC_FIELDS=["changeSetting","isAuthorised","extraFee","networkError","changeScript","setScamSignal","scam","loginSignal","logoutSignal","setTokensNameSignal","tokensName"],factory=function(storage,$state,defaultSettings,state,UserRouteState,Poll,timeLine,utils,themes){var tsUtils=require("ts-utils"),ds=require("data-service"),Money=require("@waves/data-entities").Money,analytics=require("@waves/event-sender"),User=function(){function User(){var _this33=this;_classCallCheck(this,User),this.loginSignal=new tsUtils.Signal,this.logoutSignal=new tsUtils.Signal,this.setTokensNameSignal=new tsUtils.Signal,this.tokensName=Object.create(null),this._fieldsForSave=[],this._resetFields(),this._setObserve(),this._settings.change.on(function(){return _this33._onChangeSettings()}),Mousetrap.bind(["ctrl+shift+k"],function(){return _this33.switchNextTheme()})}var _ref10;return _createClass(User,[{key:"changeSetting",get:function(){return this._settings.change}},{key:"isAuthorised",get:function(){return!!this.address}}]),_createClass(User,[{key:"setScam",value:function(hash){equals(hash,this.scam)||(this.scam=hash,this.setScamSignal.dispatch())}},{key:"setTokensNameList",value:function(hash){equals(hash,this.tokensName)||(this.tokensName=hash,this.setTokensNameSignal.dispatch())}},{key:"hasScript",value:function(){return this._hasScript}},{key:"isMaster",value:function(){return!!this._password}},{key:"getSetting",value:function(name){return this._settings.get(name)}},{key:"togglePinAsset",value:function(assetId,state){this.toggleArrayUserSetting("pinnedAssetIdList",assetId,state),this.hasInArrayUserSetting("pinnedAssetIdList",assetId)&&this.toggleSpamAsset(assetId,!1)}},{key:"toggleSpamAsset",value:function(assetId,state){this.toggleArrayUserSetting("wallet.portfolio.spam",assetId,state),this.hasInArrayUserSetting("wallet.portfolio.spam",assetId)&&this.togglePinAsset(assetId,!1)}},{key:"toggleArrayUserSetting",value:function(path,value,state){var list=this.getSetting(path),index=list.indexOf(value);if((state=tsUtils.isEmpty(state)?-1===index:state)&&-1===index){var newList=list.slice();return newList.push(value),this.setSetting(path,newList),null}if(!state&&-1!==index){var _newList=list.slice();return _newList.splice(index,1),this.setSetting(path,_newList),null}}},{key:"hasInArrayUserSetting",value:function(path,value){return this.getSetting(path).includes(value)}},{key:"getSettingByUser",value:function(user,name){return defaultSettings.create(user.settings).get(name)}},{key:"getDefaultUserSettings",value:function(settings){return defaultSettings.create(_extends({},settings))}},{key:"getSettingsByUser",value:function(user){return this.getDefaultUserSettings(user.settings)}},{key:"setSetting",value:function(name,value){this._settings.set(name,value)}},{key:"onLogin",value:function(){var _this34=this;return this.isAuthorised?Promise.resolve():new Promise(function(resolve,reject){_this34.loginSignal.once(resolve),_this34.logoutSignal.once(reject)})}},{key:"initScriptInfoPolling",value:function(){var _this35=this;clearTimeout(this._scriptInfoPollTimeoutId),this._scriptInfoPollTimeoutId=setTimeout(function(){_this35._scriptInfoPoll&&_this35._scriptInfoPoll.destroy(),_this35._scriptInfoPoll=new Poll(function(){return _this35.updateScriptAccountData()},function(){return null},1e4)},3e4)}},{key:"login",value:function(data){var _this36=this;return this.networkError=!1,this._addUserData(data).then(function(){_this36.initScriptInfoPolling(),analytics.send({name:"Sign In Success"})})}},{key:"create",value:function(data,hasBackup,restore){var _this37=this;return this._noSaveToStorage=!data.saveToStorage,data.userType=data.userType||"seed",this._addUserData({id:data.id,api:data.api,address:data.address,password:data.password,name:data.name,userType:data.userType,encryptedSeed:data.encryptedSeed,encryptedPrivateKey:data.encryptedPrivateKey,publicKey:data.publicKey,settings:{termsAccepted:!1,hasBackup:hasBackup,lng:i18next.language,theme:themes.getDefaultTheme(),candle:"blue",dontShowSpam:!0}}).then(function(){_this37.initScriptInfoPolling(),restore?analytics.send({name:"Import Backup Success",params:{userType:data.userType}}):analytics.send({name:"Create Success",params:{hasBackup:hasBackup,userType:data.userType}})})}},{key:"logout",value:function(stateName){if(!this.isAuthorised)return null;ds.app.logOut(),clearTimeout(this._scriptInfoPollTimeoutId),this._scriptInfoPoll&&this._scriptInfoPoll.destroy(),stateName?(this.logoutSignal.dispatch({}),this._resetFields(),this.changeTheme(themes.getDefaultTheme()),$state.go(stateName,void 0,{custom:{logout:!0}})):WavesApp.isDesktop()?transfer("reload"):window.location.reload()}},{key:"getActiveState",value:function(name){var userState=tsUtils.find(this._stateList||[],{name:name});return userState?userState.state:WavesApp.stateTree.getPath(name).join(".")}},{key:"applyState",value:function(state){var _this38=this;this._history.push(state.name),this._history=this._history.slice(-10),this._stateList&&this._stateList.some(function(item){return item.applyState(state,_this38)})}},{key:"getLastState",value:function(){return 1<this._history.length?this._history[this._history.length-2]:"welcome"}},{key:"getUserList",value:function(){return storage.onReady().then(function(){return storage.load("userList")}).then(function(list){return(list=list||[]).sort(function(a,b){return a.lastLogin-b.lastLogin}).reverse(),list})}},{key:"isValidAddress",value:function(address){try{return _isValidAddress(address,WavesApp.network.code.charCodeAt(0))}catch(e){return!1}}},{key:"getFilteredUserList",value:function(){var _this39=this;return this.getUserList().then(function(list){return list.filter(function(user){return _this39.isValidAddress(user.address)})})}},{key:"removeUserByAddress",value:function(removeAddress){return storage.load("userList").then(function(list){return list.filter(function(_ref9){return _ref9.address!==removeAddress})}).then(function(list){return storage.save("userList",list)})}},{key:"getThemeSettings",value:function(){var currentTheme=this.getSetting("theme");return themes.getSettings(currentTheme)}},{key:"changeTheme",value:function(theme){var currentTheme=this.getSetting("theme"),newTheme=themes.changeTheme(theme||this.getSetting("theme"));currentTheme!==newTheme&&this.setSetting("theme",newTheme)}},{key:"changeCandle",value:function(name){var currentTheme=this.getSetting("theme"),current=this.getSetting("candle");themes.setCandleColorsByName(currentTheme,name),name!==current&&this.setSetting("candle",name)}},{key:"switchNextTheme",value:function(){var newTheme=themes.switchNext();this.setSetting("theme",newTheme)}},{key:"updateScriptAccountData",value:(_ref10=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var waves,address,addHasScript,response,_this40=this,item=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return waves=void 0,address=item?item.address:this.address,_context.prev=2,this.networkError=!1,_context.next=6,ds.api.assets.get(WavesApp.defaultAssets.WAVES);case 6:waves=_context.sent,_context.next=13;break;case 9:throw _context.prev=9,_context.t0=_context.catch(2),this.networkError=!0,new Error("Can't get Waves asset");case 13:return addHasScript=function(value){_this40._hasScript!==value&&(_this40._hasScript=value,_this40.changeScript.dispatch())},_context.prev=14,_context.next=17,ds.fetch(ds.config.get("node")+"/addresses/scriptInfo/"+address);case 17:response=_context.sent,this.extraFee=Money.fromCoins(response.extraFee,waves),addHasScript(0!==response.extraFee),_context.next=26;break;case 22:_context.prev=22,_context.t1=_context.catch(14),addHasScript(!!this._hasScript),this.extraFee=this.extraFee||Money.fromCoins(0,waves);case 26:case"end":return _context.stop()}},_callee,this,[[2,9],[14,22]])})),function(){return _ref10.apply(this,arguments)})},{key:"addMatcherSign",value:function(){var _this41=this,promise=utils.signUserOrders({matcherSign:this.matcherSign});return promise.then(function(matcherSign){_this41.matcherSign=matcherSign,ds.app.addMatcherSign(matcherSign.timestamp,matcherSign.signature)}),promise}},{key:"_resetFields",value:function(){this.networkError=!1,this.address=null,this.id=null,this.name=null,this.publicKey=null,this.encryptedSeed=null,this.encryptedPrivateKey=null,this.userType=null,this.settings=Object.create(null),this.lastLogin=Date.now(),this.matcherSign=null,this.extraFee=null,this.changeScript=new tsUtils.Signal,this.setScamSignal=new tsUtils.Signal,this.scam=Object.create(null),this._settings=defaultSettings.create(Object.create(null)),this.__props=Object.create(null),this._password=null,this._changeTimer=null,this._stateList=null,this._history=[],this._hasScript=!1,this._scriptInfoPoll=null,this._scriptInfoPollTimeoutId=null,this._noSaveToStorage=!1}},{key:"_addUserData",value:function(data){var _this42=this;return data.api.getPublicKey().then(function(publicKey){return data.publicKey=publicKey}).then(function(){return _this42._loadUserByAddress(data.address)}).then(function(item){_this42._fieldsForSave.forEach(function(propertyName){null!=data[propertyName]?_this42[propertyName]=data[propertyName]:null!=item[propertyName]&&(_this42[propertyName]=item[propertyName])}),analytics.addDefaultParams({userType:_this42.userType}),_this42.lastLogin=Date.now(),_this42._settings&&_this42._settings.change.off(),_this42._settings=defaultSettings.create(_this42.settings),_this42._settings.change.on(function(){return _this42._onChangeSettings()}),_this42._settings.get("savePassword")&&(_this42._password=data.password);var states=WavesApp.stateTree.find("main").getChildren();return _this42._stateList=states.map(function(baseTree){var id=baseTree.id;return new UserRouteState("main",id,_this42._settings.get(id+".activeState"))}),Object.keys(WavesApp.network).forEach(function(key){ds.config.set(key,_this42._settings.get("network."+key))}),ds.config.set("oracleWaves",_this42.getSetting("oracleWaves")),ds.app.login(data.address,data.api),data.api.onDestroy(function(){_this42.isAuthorised&&_this42.logout("welcome")}),_this42.addMatcherSign().catch(function(){return Promise.resolve()}).then(function(){return _this42.changeTheme(),_this42.changeCandle(),_this42._save()}).then(function(){return _this42._logoutTimer()}).then(function(){return _this42.updateScriptAccountData()}).then(function(){return _this42.loginSignal.dispatch()}).catch(function(e){return ds.app.logOut(),Promise.reject(e)})})}},{key:"_logoutTimer",value:function(){var _this43=this;this.receive(state.signals.sleep,function(min){min>=_this43._settings.get("logoutAfterMin")&&_this43.logout("welcome")})}},{key:"_onChangeSettings",value:function(){this.settings=_extends({},this._settings.getSettings())}},{key:"_onChangePropsForSave",value:function(){var _this44=this;this._changeTimer||(this._changeTimer=timeLine.timeout(function(){_this44._changeTimer=null,_this44._save()},500))}},{key:"_setObserve",value:function(){var _this45=this;this._fieldsForSave=Object.keys(this).filter(function(property){return"_"!==property.charAt(0)&&-1===NOT_SYNC_FIELDS.indexOf(property)}),this._fieldsForSave.forEach(function(key){_this45._observe(key,_this45)})}},{key:"_observe",value:function(key,target){var _this46=this;this.__props[key]=target[key],Object.defineProperty(target,key,{get:function(){return _this46.__props[key]},set:function(value){value!==_this46.__props[key]&&(_this46.__props[key]=value,_this46._onChangePropsForSave())}})}},{key:"_save",value:function(){var _this47=this;return this._noSaveToStorage||!this.address?Promise.resolve():storage.load("userList").then(function(list){list=(list=list||[]).filter(tsUtils.notContains({address:_this47.address}));var props=_this47._fieldsForSave.reduce(function(result,propertyName){var property=_this47[propertyName];return null!=property&&(result[propertyName]=property),result},Object.create(null));return list.push(props),storage.save("userList",list)})}},{key:"_loadUserByAddress",value:function(address){return storage.load("userList").then(function(list){return tsUtils.find(list||[],{address:address})||Object.create(null)})}}]),User}();return User.prototype.receive=tsUtils.Receiver.prototype.receive,User.prototype.receiveOnce=tsUtils.Receiver.prototype.receiveOnce,User.prototype.stopReceive=tsUtils.Receiver.prototype.stopReceive,new User};factory.$inject=["storage","$state","defaultSettings","state","UserRouteState","Poll","timeLine","utils","themes"],angular.module("app").factory("user",factory)}(),function(){var factory=function($q,localeParser){var onLoad=$q(function(resolve){i18next.on("initialized",resolve)}),parse=function(text){return localeParser(function(argument_0){return(0<arguments.length&&void 0!==argument_0?argument_0:"").split("").map(function(char){switch(char.charCodeAt(0)){case 34:return"&quot;";case 38:return"&amp;";case 39:return"&#39;";case 60:return"&lt;";case 62:return"&gt;";default:return char}}).join("")}(text))};return{translate:function(literal,ns,params,skipErrors){var translate=[(ns=ns||"app")+":"+literal];return"app"!==ns&&translate.push("app:"+literal),skipErrors?translate.some(function(key){return i18next.exists(key,params)})?parse(i18next.t(translate,params)):"":parse(i18next.t(translate,_extends({},params,{interpolation:{escapeValue:!1}})))},translateField:function(controller,literalField,translatedField,ns,params){var _this48=this,apply=function(){null!=controller[literalField]&&(controller[translatedField]=_this48.translate(controller[literalField],ns,params))};controller.observe(literalField,apply),i18next.on("languageChanged",apply),controller.signals.destroy.once(function(){i18next.off("languageChanged",apply)}),controller[translatedField]||apply()},getNs:function($element){return $element.closest("[w-i18n-ns]").attr("w-i18n-ns")||""},onLoad:onLoad}};factory.$inject=["$q","localeParser"],angular.module("app").factory("i18n",factory)}(),(controller=function(Base,$scope,$q,$mdDialog,$timeout,user,modalManager,seedService){var analytics=require("@waves/event-sender"),ORDER_LIST=["createAccount","createAccountData","noBackupNoMoney","backupSeed","confirmBackup"],STATE_HASH_CREATE_ACCOUNT=0,STATE_HASH_CREATE_ACCOUNT_DATA=1,STATE_HASH_SHOW_NO_BACKUP_NOW_MONEY=2,STATE_HASH_BACKUP=3,STATE_HASH_CONFIRM_BACKUP=4;return new(function(){function CreateCtrl(){_classCallCheck(this,CreateCtrl);var _this49=_possibleConstructorReturn(this,(CreateCtrl.__proto__||Object.getPrototypeOf(CreateCtrl)).call(this,$scope));return _this49.stepIndex=0,_this49.password="",_this49.name="",_this49.seed="",_this49.address="",_this49.seedList=[],_this49.seedIsValid=!1,_this49.seedConfirmWasFilled=!1,_this49.saveUserData=!0,_this49.resetAddress(),_this49.showTutorialModals(),_this49}return _inherits(CreateCtrl,Base),_createClass(CreateCtrl,[{key:"showTutorialModals",value:function(){return modalManager.showTutorialModals()}},{key:"onSeedConfirmFulfilled",value:function(isValid){this.seedIsValid=isValid,this.seedConfirmWasFilled=!0,this.observeOnce("stepIndex",this.clearSeedConfirm)}},{key:"seedOnTouch",value:function(){this.seedConfirmWasFilled=!1}},{key:"clearSeedConfirm",value:function(){seedService.clear.dispatch(),this.seedIsValid=!1,this.seedConfirmWasFilled=!1}},{key:"setActiveSeed",value:function(item){var old=tsUtils.find(this.seedList,{active:!0});old&&(old.active=!1),item.active=!0,this.seed=item.seed,this.address=item.address}},{key:"getStepUrl",value:function(){return"modules/create/templates/"+ORDER_LIST[this.stepIndex]+".html"}},{key:"create",value:function(){return analytics.send({name:"Create Confirm Phrase Confirm Click"}),this._create(!0)}},{key:"createWithoutBackup",value:function(){return analytics.send({name:"Create Do It Later Click"}),this._create(!1)}},{key:"clickCopySeed",value:function(){analytics.send({name:"Create Backup Phrase Copy Click"})}},{key:"next",value:function(index){var _this50=this;if((index=index||this.stepIndex+1)<0&&(index=this.stepIndex+index),index===STATE_HASH_CREATE_ACCOUNT&&STATE_HASH_CREATE_ACCOUNT<index&&analytics.send({name:"Create New Continue Click",params:{guestMode:!this.saveUserData}}),index===STATE_HASH_CREATE_ACCOUNT_DATA&&analytics.send({name:"Create Protect Your Account Show"}),this.stepIndex===STATE_HASH_CREATE_ACCOUNT_DATA&&index>this.stepIndex&&analytics.send({name:"Create Protect Your Account Continue Click"}),index===STATE_HASH_SHOW_NO_BACKUP_NOW_MONEY&&analytics.send({name:"Create No Backup Show"}),this.stepIndex===STATE_HASH_SHOW_NO_BACKUP_NOW_MONEY&&index>this.stepIndex&&analytics.send({name:"Create Back Up Now Click"}),index===STATE_HASH_BACKUP&&analytics.send({name:"Create Backup Phrase Show"}),this.stepIndex===STATE_HASH_BACKUP&&index>this.stepIndex&&analytics.send({name:"Create Backup Phrase I Written Click"}),index===STATE_HASH_CONFIRM_BACKUP&&analytics.send({name:"Create Confirm Phrase Show"}),ORDER_LIST[index])return this.checkNext().then(function(){(_this50.stepIndex=index)===STATE_HASH_BACKUP&&analytics.send({name:"Create Backup Phrase Show"}),index===STATE_HASH_CONFIRM_BACKUP&&analytics.send({name:"Create Confirm Phrase Show"})});throw new Error("Wrong order list index!")}},{key:"checkNext",value:function(){return"noBackupNoMoney"===ORDER_LIST[this.stepIndex]?(analytics.send({name:"Create Warning Show"}),this.showBackupWarningPopup().then(function(){analytics.send({name:"Create Warning I Understand Click"})})):$q.when()}},{key:"resetAddress",value:function(){for(var list=[],i=0;i<5;i++){var phrase=ds.Seed.create().phrase,seedData=new ds.Seed(phrase,window.WavesApp.network.code);list.push({seed:seedData.phrase,address:seedData.address})}this.setActiveSeed(list[0]),this.seedList=list}},{key:"showBackupWarningPopup",value:function(){return modalManager.showCustomModal({templateUrl:"modules/create/templates/noBackupNoMoney.modal.html",clickOutsideToClose:!1,escapeToClose:!1})}},{key:"_create",value:function(hasBackup){this.saveUserData||(this.password=Date.now().toString());var encryptedSeed=new ds.Seed(this.seed,window.WavesApp.network.code).encrypt(this.password),userSettings=user.getDefaultUserSettings({termsAccepted:!1}),newUser={userType:this.restoreType,address:this.address,name:this.name,password:this.password,id:this.userId,path:this.userPath,settings:userSettings,saveToStorage:this.saveUserData,encryptedSeed:encryptedSeed},api=ds.signature.getDefaultSignatureApi(newUser);return user.create(_extends({},newUser,{settings:userSettings.getSettings(),api:api}),hasBackup)}}]),CreateCtrl}())}).$inject=["Base","$scope","$q","$mdDialog","$timeout","user","modalManager","seedService"],angular.module("app.create").controller("CreateCtrl",controller),function(){var controller=function(modalManager,$state,Base,storage){return new(function(){function DesktopCtrl(){_classCallCheck(this,DesktopCtrl);var _this51=_possibleConstructorReturn(this,(DesktopCtrl.__proto__||Object.getPrototypeOf(DesktopCtrl)).call(this));return _this51.openClientMode=null,storage.load("openClientMode").then(function(mode){_this51.openClientMode=mode}),_this51}return _inherits(DesktopCtrl,Base),_createClass(DesktopCtrl,[{key:"openLinkViaDesktop",get:function(){return"desktop"===this.openClientMode},set:function(value){this.openClientMode=value?"desktop":null,storage.save("openClientMode",this.openClientMode)}}]),_createClass(DesktopCtrl,[{key:"showTutorialModals",value:function(){return modalManager.showTutorialModals()}},{key:"openMainPage",value:function(){return $state.go("welcome")}}]),DesktopCtrl}())};controller.$inject=["modalManager","$state","Base","storage"],angular.module("app.desktop").controller("DesktopCtrl",controller)}(),function(){var ds=require("data-service"),controller=function(Base,$element,$state,$location,user,$scope,createPoll,waves,utils,modalManager){var analytics=require("@waves/event-sender"),ANALYTICS_TABS_NAMES={myOpenOrders:"My Open Orders",myTradeHistory:"My Trade History",tradeHistory:"Trade History",myBalance:"My Balance"};return new(function(){function DexCtrl(){_classCallCheck(this,DexCtrl);var _this52=_possibleConstructorReturn(this,(DexCtrl.__proto__||Object.getPrototypeOf(DexCtrl)).call(this,$scope));_this52.ready=!1,_this52.isLogined=!!user.address,_this52._leftHidden=!1,_this52._rightHidden=!1,_this52._assetIdPair=null,_this52.observe("tab",_this52._onChangeTab),_this52.syncSettings({tab:"dex.layout.bottomleft.tab",_leftHidden:"dex.layout.leftColumnState",_rightHidden:"dex.layout.rightColumnState",_assetIdPair:"dex.assetIdPair"}),_this52.isLogined||(_this52.tab="tradeHistory");return(user.address?user.addMatcherSign():Promise.resolve()).catch(function(){return Promise.resolve()}).then(function(){_this52._initializePair().then(function(){_this52.ready=!0,$scope.$apply()})}),createPoll(_this52,_this52._getLastPrice,"_titleTxt",1e3),_this52.observe("_assetIdPair",_this52._onChangePair),_this52.observe("_titleTxt",_this52._setTitle),_this52.observe(["_leftHidden","_rightHidden"],_this52._onChangeProperty),_this52}var _ref11;return _inherits(DexCtrl,Base),_createClass(DexCtrl,[{key:"$onDestroy",value:function(){_get2(DexCtrl.prototype.__proto__||Object.getPrototypeOf(DexCtrl.prototype),"$onDestroy",this).call(this),window.document.title="Waves DEX"}},{key:"toggleColumn",value:function(column){this["_"+column+"Hidden"]=!this["_"+column+"Hidden"]}},{key:"_onChangePair",value:(_ref11=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var userAssetIdPair,pair;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(userAssetIdPair=user.getSetting("dex.assetIdPair"),utils.isLockedInDex(userAssetIdPair.amount,userAssetIdPair.price))return _context2.abrupt("return",this._showModalAndRedirect(userAssetIdPair.amount,userAssetIdPair.price));_context2.next=3;break;case 3:return _context2.next=5,this._getPair();case 5:pair=_context2.sent,$location.search("assetId2",pair.amountAsset.id),$location.search("assetId1",pair.priceAsset.id);case 8:case"end":return _context2.stop()}},_callee2,this)})),function(){return _ref11.apply(this,arguments)})},{key:"_showModalAndRedirect",value:function(amountAssetId,priceAssetId){var _this53=this;Promise.all([waves.node.assets.getAsset(amountAssetId),waves.node.assets.getAsset(priceAssetId)]).then(function(_ref12){var _ref13=_slicedToArray(_ref12,2),priceAsset=_ref13[0],amountAsset=_ref13[1],amountAssetName=amountAsset.ticker||amountAsset.displayName,priceAssetName=priceAsset.ticker||priceAsset.displayName,unLockedAsset=utils.isLockedInDex(WavesApp.defaultAssets.BTC)?Object.values(WavesApp.defaultAssets).find(function(assetId){return"WAVES"!==assetId&&!utils.isLockedInDex(assetId)}):WavesApp.defaultAssets.BTC;return user.setSetting("dex.assetIdPair",{amount:WavesApp.defaultAssets.WAVES,price:unLockedAsset}),modalManager.showLockPairWarning(amountAssetName,priceAssetName).then(function(){$location.search("assetId2",WavesApp.defaultAssets.WAVES),$location.search("assetId1",unLockedAsset),_this53._initializePair()})})}},{key:"_onChangeTab",value:function(){ANALYTICS_TABS_NAMES[this.tab]&&analytics.send({name:"DEX "+ANALYTICS_TABS_NAMES[this.tab]+" Show",target:"ui"})}},{key:"_getLastPrice",value:function(){return this._getPair().then(function(pair){var pairText="| "+pair.amountAsset.displayName+"/"+pair.priceAsset.displayName;return waves.matcher.getLastPrice(pair).then(function(data){return(data.price.getTokens().isNaN()?"-":data.price.toFormat())+" "+pairText},function(){return"- "+pairText})})}},{key:"_initializePair",value:function(){var _this54=this;return new Promise(function(resolve){setTimeout(function(){var urlPair=_this54._getPairFromState();if(urlPair)return _this54._getPair(urlPair).catch(function(){return _this54._getPair({amount:WavesApp.defaultAssets.WAVES,price:WavesApp.defaultAssets.BTC})}).then(function(_ref14){var amountAsset=_ref14.amountAsset,priceAsset=_ref14.priceAsset,activeTab=user.getSetting("dex.watchlist.activeTab");"all"!==activeTab&&activeTab!==amountAsset.id&&activeTab!==priceAsset.id&&user.setSetting("dex.watchlist.activeTab","all"),_this54._assetIdPair={amount:amountAsset.id,price:priceAsset.id}}).then(resolve);_this54._onChangePair(),resolve()},200)})}},{key:"_getPair",value:function(argument_0){var pair=0<arguments.length&&void 0!==argument_0?argument_0:this._assetIdPair;return pair?ds.api.pairs.get(pair.amount,pair.price):ds.api.pairs.get(WavesApp.defaultAssets.WAVES,WavesApp.defaultAssets.BTC)}},{key:"_getPairFromState",value:function(){return $state.params.assetId1&&$state.params.assetId2?{amount:$state.params.assetId1,price:$state.params.assetId2}:null}},{key:"_onChangeProperty",value:function(){var $graphWrapper=$element.find(".graph-wrapper");$graphWrapper.hide(),setTimeout(function(){return $graphWrapper.show()},100)}},{key:"_setTitle",value:function(){window.document.title=this._titleTxt}}]),DexCtrl}())};controller.$inject=["Base","$element","$state","$location","user","$scope","createPoll","waves","utils","modalManager"],angular.module("app.dex").controller("DexCtrl",controller)}(),function(){var controller=function(Base,$scope,user){return new(function(){function ImportCtrl(){return _classCallCheck(this,ImportCtrl),_possibleConstructorReturn(this,(ImportCtrl.__proto__||Object.getPrototypeOf(ImportCtrl)).call(this,$scope))}return _inherits(ImportCtrl,Base),_createClass(ImportCtrl,[{key:"backState",value:function(){return user.getLastState()}}]),ImportCtrl}())};controller.$inject=["Base","$scope","user"],angular.module("app.import").controller("ImportCtrl",controller)}(),function(){var config=require("data-service").config,_require14=require("ramda"),flatten=_require14.flatten,pipe=_require14.pipe,prop=_require14.prop,map=_require14.map,factory=function(utils,timeLine,symbolInfoService,waves,matcher){return new(function(){function CandlesService(){_classCallCheck(this,CandlesService),this._lastTime=0,this._subscriber=null,this.onLoadError=angular.noop}return _createClass(CandlesService,[{key:"onReady",value:function(callback){setTimeout(function(){return callback({supported_resolutions:WavesApp.dex.resolutions,supports_time:!0,supports_marks:!1,supports_timescale_marks:!1})},0)}},{key:"resolveSymbol",value:function(symbolName,resolve,reject){var _this56=this;symbolName.match(/^DEX:/)||symbolInfoService.get(symbolName).then(resolve).catch(function(){_this56.onLoadError(),reject()})}},{key:"getBars",value:function(symbolInfo,resolution,from,to,onHistoryCallback,onErrorCallback){var _this57=this;from=CandlesService.convertToMilliseconds(from),to=CandlesService.convertToMilliseconds(to);CandlesService._getAndHandleCandles(symbolInfo,from,to,resolution,function(candles){candles.length?(_this57._updateLastTime(candles),onHistoryCallback(candles)):onHistoryCallback([],{noData:!0})},onErrorCallback)}},{key:"subscribeBars",value:function(symbolInfo,resolution,onRealtimeCallback,subscriberUID,onResetCacheNeededCallback){var _this58=this;this._subscriber=subscriberUID;var to=Date.now(),from=this._lastTime,handleCandles=function(candles){_this58._subscriber===subscriberUID&&(_this58.subscribeBars(symbolInfo,resolution,onRealtimeCallback,subscriberUID,onResetCacheNeededCallback),candles.length&&(_this58._updateLastTime(candles),candles.forEach(onRealtimeCallback)))};timeLine.timeout(function(){CandlesService._getAndHandleCandles(symbolInfo,from,to,resolution,handleCandles)},800)}},{key:"unsubscribeBars",value:function(){this._subscriber=null}},{key:"_updateLastTime",value:function(candles){var lastTime=candles[candles.length-1].time;if(this._lastTime&&this._lastTime>=lastTime)return!1;this._lastTime=lastTime}}],[{key:"_getAndHandleCandles",value:function(symbolInfo,from,to,resolution,handleCandles,argument_5){var handleError=5<arguments.length&&void 0!==argument_5?argument_5:angular.noop;CandlesService._getCandles(symbolInfo,from,to,resolution).then(handleCandles).catch(handleError)}},{key:"_getCandles",value:function(symbolInfo,from,to,interval){from=from||to;var amountId=symbolInfo._wavesData.amountAsset.id,priceId=symbolInfo._wavesData.priceAsset.id,_utils$getValidCandle=utils.getValidCandleOptions(from,to,interval),options=_utils$getValidCandle.options,candleConfig=_utils$getValidCandle.config,promises=options.map(function(option){return config.getDataService().getCandles(amountId,priceId,_extends({matcher:matcher.currentMatcherAddress},option))}),convertBigNumber=function(num){return num.isNaN()?null:Number(num.toFixed())},candles=Promise.all(promises).then(pipe(map(prop("data")),flatten)).then(function(list){return list.map(function(candle){return{txsCount:candle.txsCount||0,high:convertBigNumber(candle.high),low:convertBigNumber(candle.low),close:convertBigNumber(candle.close),open:convertBigNumber(candle.open),volume:convertBigNumber(candle.volume),time:new Date(candle.time).getTime()}})}),lastTrade=ds.api.pairs.get(amountId,priceId).then(function(pair){return waves.matcher.getLastPrice(pair).catch(function(){return null})});return Promise.all([candles,lastTrade]).then(function(_ref15){var _ref16=_slicedToArray(_ref15,2),candles=_ref16[0],lastTrade=_ref16[1];return 1===candles.length&&lastTrade?candles[candles.length-1].close=Number(lastTrade.price.toTokens()):candles=candleConfig.converter(candles),candles.filter(function(candle){return null!=candle.open})}).catch(function(){return utils.wait(5e3).then(function(){return[]})})}},{key:"convertToMilliseconds",value:function(seconds){return Number(seconds)?1e3*seconds:Date.now()}}]),CandlesService}())};factory.$inject=["utils","timeLine","symbolInfoService","waves","matcher"],angular.module("app.dex").factory("candlesService",factory)}(),function(){var tsUtils=require("ts-utils"),factory=function(Base){return new(function(){function DexDataService(){_classCallCheck(this,DexDataService);var _this59=_possibleConstructorReturn(this,(DexDataService.__proto__||Object.getPrototypeOf(DexDataService)).call(this));return _this59.chooseOrderBook=new tsUtils.Signal,_this59.showSpread=new tsUtils.Signal,_this59.createOrder=new tsUtils.Signal,_this59}return _inherits(DexDataService,Base),DexDataService}())};factory.$inject=["Base"],angular.module("app.dex").factory("dexDataService",factory)}(),function(){var DEFAULT_SYMBOL_INFO={session:"24x7",exchange:"DEX",listed_exchange:"DEX",timezone:"Europe/London",minmov:1,has_intraday:!0,supported_resolutions:WavesApp.dex.resolutions,has_seconds:!1,has_daily:!1,has_weekly_and_monthly:!1,has_empty_bars:!0,force_session_rebuild:!1,has_no_volume:!1,data_status:"pulsed"},factory=function(waves,decorators){var _dec2,_class9;return new(_dec2=decorators.cachable(1440),_applyDecoratedDescriptor((_class9=function(){function SymbolInfoService(){_classCallCheck(this,SymbolInfoService)}return _createClass(SymbolInfoService,[{key:"get",value:function(symbolName){var _symbolName$split=symbolName.split("/"),_symbolName$split2=_slicedToArray(_symbolName$split,2),partOne=_symbolName$split2[0],partTwo=_symbolName$split2[1];return partOne&&partTwo?this._createSymbolInfo(partOne,partTwo):Promise.reject()}},{key:"_createSymbolInfo",value:function(assetOneId,assetTwoId){return ds.api.pairs.get(assetOneId,assetTwoId).then(function(pair){var amount=pair.amountAsset,price=pair.priceAsset;return Promise.all([waves.node.assets.getAsset(amount.id),waves.node.assets.getAsset(price.id)]).then(function(_ref17){var _ref18=_slicedToArray(_ref17,2),amountInfo=_ref18[0],priceInfo=_ref18[1],amountName=amountInfo.ticker?amountInfo.ticker:amountInfo.name,priceName=priceInfo.ticker?priceInfo.ticker:priceInfo.name,ticker=amountInfo.id+"/"+priceInfo.id,symbolName=amountName+"/"+priceName;return _extends({},DEFAULT_SYMBOL_INFO,{pricescale:Math.pow(10,price.precision),volume_precision:amount.precision,description:symbolName,name:symbolName,ticker:ticker,_wavesData:{amountAsset:amountInfo,priceAsset:priceInfo}})})})}}]),SymbolInfoService}()).prototype,"_createSymbolInfo",[_dec2],Object.getOwnPropertyDescriptor(_class9.prototype,"_createSymbolInfo"),_class9.prototype),_class9)};factory.$inject=["waves","decorators"],angular.module("app.dex").factory("symbolInfoService",factory)}(),function(){var controller=function(Base,$scope,user,utils){var signatureAdapter=require("@waves/signature-adapter");return new(function(){function KeeperCtrl(){_classCallCheck(this,KeeperCtrl);var _this60=_possibleConstructorReturn(this,(KeeperCtrl.__proto__||Object.getPrototypeOf(KeeperCtrl)).call(this,$scope));return _this60.isInit=!1,_this60.noKeeper=!1,_this60.noKeeperPermission=!1,_this60.noKeeperAccounts=!1,_this60.incorrectKeeperNetwork=!1,_this60.lockedKeeper=!1,_this60.adapter=signatureAdapter.WavesKeeperAdapter,_this60.loading=!1,_this60.error=!1,_this60.selectedUser=Object.create(null),_this60.saveUserData=!0,_this60.name="",_this60.isPriorityUserTypeExists=!1,_this60.userExisted=Object.create(null),_this60._usersInStorage=[],_this60._type="wavesKeeper",_this60._priorityMap=utils.getImportPriorityMap(),_this60._onUpdateAdapter=function(state){return _this60.onUpdateState(state)},_this60.observe("selectedUser",_this60._onSelectUser),_this60.adapter.onUpdate(_this60._onUpdateAdapter),user.getFilteredUserList().then(function(users){_this60._usersInStorage=users}),_this60.getUsers(),_this60}return _inherits(KeeperCtrl,Base),_createClass(KeeperCtrl,[{key:"$onDestroy",value:function(){_get2(KeeperCtrl.prototype.__proto__||Object.getPrototypeOf(KeeperCtrl.prototype),"$onDestroy",this).call(this),this.adapter.offUpdate(this._onUpdateAdapter)}},{key:"isAvilableAdapter",value:function(){return this.adapter.isAvailable()}},{key:"onError",value:function(error){switch(error.code){case 0:this.noKeeper=!0;break;case 1:this.noKeeperPermission=!0;break;case 2:this.noKeeperAccounts=!0;break;case 3:this.incorrectKeeperNetwork=!0;break;case"locked":this.lockedKeeper=!0}this.error=!0}},{key:"onUpdateState",value:function(){var _this61=this;this.loading||(clearTimeout(this._time),this._time=setTimeout(function(){return _this61.getUsers()},500))}},{key:"getUsers",value:function(){var _this62=this;this.loading=!0,this.error=!1,this.noKeeper=!1,this.noKeeperPermission=!1,this.noKeeperAccounts=!1,this.incorrectKeeperNetwork=!1,this.lockedKeeper=!1,this.isAvilableAdapter().then(function(){return _this62.adapter.getUserList()}).then(function(_ref19){var user=_slicedToArray(_ref19,1)[0];if(!user)return Promise.reject({code:"locked"});_this62.selectedUser=user,_this62.receive(utils.observe(_this62.selectedUser,"name"),_this62._onChangeName,_this62),delete _this62.selectedUser.type}).catch(function(e){return _this62.onError(e)}).finally(function(){_this62.isInit=!0,_this62.loading=!1,$scope.$apply(),_this62._onSelectUser()})}},{key:"login",value:function(){var _this63=this,userSettings=user.getDefaultUserSettings({termsAccepted:!1}),newUser=_extends({},this.selectedUser,{userType:this.adapter.type,settings:userSettings,saveToStorage:this.saveUserData}),api=ds.signature.getDefaultSignatureApi(newUser);return user.create(_extends({},newUser,{settings:userSettings.getSettings(),api:api}),!0,!0).catch(function(){_this63.error=!0,$scope.$digest()})}},{key:"_onSelectUser",value:function(){this._onChangeAddress(),this._onChangeName()}},{key:"_onChangeAddress",value:function(){var _this64=this;this.userExisted=this._usersInStorage.find(function(user){return user.address===_this64.selectedUser.address})||null,this.isPriorityUserTypeExists=!!this.userExisted&&this._priorityMap[this._type]<=this._priorityMap[this.userExisted.userType]}},{key:"_onChangeName",value:function(){var _this65=this,isUnique=this._usersInStorage.some(function(user){return user.name===_this65.selectedUser.name&&user.address!==_this65.selectedUser.address});this.importForm&&this.importForm.userName.$setValidity("isUnique",!isUnique)}}]),KeeperCtrl}())};controller.$inject=["Base","$scope","user","utils"],angular.module("app.keeper").controller("KeeperCtrl",controller)}(),function(){var signatureAdapter=require("@waves/signature-adapter"),controller=function(Base,$scope,user,modalManager,utils){return new(function(){function LedgerCtrl(){_classCallCheck(this,LedgerCtrl);var _this66=_possibleConstructorReturn(this,(LedgerCtrl.__proto__||Object.getPrototypeOf(LedgerCtrl)).call(this,$scope));return _this66.adapter=signatureAdapter.LedgerAdapter,_this66.loading=!1,_this66.error=!1,_this66.users=[],_this66.visibleUsers=[],_this66.selectedUser=null,_this66.currentStep=0,_this66.isInit=!1,_this66.disabledLogin=!0,_this66.disabledRight=!0,_this66.disabledLeft=!0,_this66.selectDefault=!1,_this66.saveUserData=!0,_this66.name="",_this66._runLedgerCommand="",_this66._usersInStorage=[],_this66.isPriorityUserTypeExists=!1,_this66._type="ledger",_this66.userExisted=Object.create(null),_this66._priorityMap=utils.getImportPriorityMap(),user.getFilteredUserList().then(function(users){_this66._usersInStorage=users}),_this66.observe("selectDefault",_this66._onChangeSelectDefault),_this66.getUsers(5),_this66.observe("selectedUser",_this66._onSelectUser),_this66.observe("name",_this66._onChangeName),_this66}return _inherits(LedgerCtrl,Base),_createClass(LedgerCtrl,[{key:"getUsers",value:function(count){var _this67=this;this._runLedgerCommand="getUsers",this.loading=!0,this.error=!1;var start=this.users.length,countUsers=(count||5)-1,promise=utils.timeoutPromise(this.adapter.getUserList(start,countUsers),25e3),modalPromise=this.isInit?Promise.resolve():modalManager.showLoginByDevice(promise,this.adapter.type);Promise.all([promise,modalPromise]).then(function(_ref21){var users=_slicedToArray(_ref21,1)[0];_this67.isInit=!0,_this67.users=[].concat(_toConsumableArray(_this67.users),_toConsumableArray(users)),_this67.loading=!1,_this67.error=!1,_this67.showVisibleUsers(),_this67.selectUser(),$scope.$digest()}).catch(function(){var error=_extends({},0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},{count:count});throw _this67.loading=!1,_this67.error=error,$scope.$digest(),error})}},{key:"retryGetUsers",value:function(){this[this._runLedgerCommand](this.error&&this.error.count)}},{key:"selectUser",value:function(user){if(this.selectDefault)return null;user||this.selectedUser||!this.users.length?user&&(this.selectedUser=user):this.selectedUser=this.users[0],this._calculateDisabled()}},{key:"stepLeft",value:function(){this.selectDefault||this.disabledLeft||(this.currentStep--,this.currentStep=0<=this.currentStep?this.currentStep:0,this.showVisibleUsers(),this._calculateDisabled())}},{key:"stepRight",value:function(){if(!this.selectDefault&&!this.disabledRight)if(this.users.length<=this.currentStep+5){if(this.loading)return;this.currentStep++,this.getUsers(),this._calculateDisabled()}else this.currentStep++,this.showVisibleUsers(),this._calculateDisabled()}},{key:"showVisibleUsers",value:function(){this.visibleUsers=this.users.slice(this.currentStep,this.currentStep+5)}},{key:"login",value:function(){var _this68=this;this._runLedgerCommand="login";var userSettings=user.getDefaultUserSettings({termsAccepted:!1}),newUser=_extends({},this.selectedUser,{userType:this.adapter.type,name:this.name,settings:userSettings,saveToStorage:this.saveUserData});this._calculateDisabled(!0);var api=ds.signature.getDefaultSignatureApi(newUser);return user.create(_extends({},newUser,{settings:userSettings.getSettings(),api:api}),!0,!0).catch(function(){_this68.error=!0,$scope.$digest()})}},{key:"isUserDisable",value:function(index){return 0!==index&&this.selectDefault}},{key:"_calculateDisabled",value:function(disable){this.disabledLogin=disable||this.loading||!this.selectedUser,this.disabledRight=disable||this.selectDefault||this.loading,this.disabledLeft=disable||this.selectDefault||this.loading||0===this.currentStep}},{key:"_onChangeSelectDefault",value:function(){this.selectDefault&&(this.currentStep=0,this.selectedUser=this.users[0]),this._calculateDisabled(),this.showVisibleUsers()}},{key:"_onSelectUser",value:function(){var _this69=this;this.userExisted=this._usersInStorage.find(function(user){return user.address===_this69.selectedUser.address})||null,this.isPriorityUserTypeExists=!!this.userExisted&&this._priorityMap[this._type]<=this._priorityMap[this.userExisted.userType]}},{key:"_onChangeName",value:function(){var _this70=this,isUnique=this._usersInStorage.some(function(user){return user.name===_this70.name&&user.address!==_this70.selectedUser.address});this.importForm.userName.$setValidity("isUnique",!isUnique)}}]),LedgerCtrl}())};controller.$inject=["Base","$scope","user","modalManager","utils"],angular.module("app.ledger").controller("LedgerCtrl",controller)}(),function(){var analytics=require("@waves/event-sender"),_require15=require("@waves/waves-transactions"),validators=_require15.validators,libs=_require15.libs,isPublicKey=validators.isPublicKey,_libs$crypto=libs.crypto,address=_libs$crypto.address,publicKey=_libs$crypto.publicKey,TABS={seed:"seed",key:"key"},controller=function(Base,$scope,user,utils,modalManager){return new(function(){function RestoreCtrl(){_classCallCheck(this,RestoreCtrl);var _this71=_possibleConstructorReturn(this,(RestoreCtrl.__proto__||Object.getPrototypeOf(RestoreCtrl)).call(this,$scope));return $scope.TABS=TABS,_this71.seedForm=null,_this71.keyForm=null,_this71.seed="",_this71.key="",_this71.address="",_this71.name="",_this71.password="",_this71.saveUserData=!0,_this71.activeStep=0,_this71.tabs=Object.values(TABS),_this71.activeTab=TABS.seed,_this71.isPriorityUserTypeExists=!1,_this71.userExisted=Object.create(null),_this71._usersInStorage=[],_this71._priorityMap=utils.getImportPriorityMap(),user.getFilteredUserList().then(function(users){_this71._usersInStorage=users}),_this71.observe("seed",_this71._onChangeSeed),_this71.observeOnce("seedForm",function(){_this71.receive(utils.observe(_this71.seedForm,"$valid"),function(){_this71.activeTab===TABS.seed&&_this71._onChangeSeed()})}),_this71.observe("address",_this71._onChangeAddress),_this71.observe("key",_this71._onChangeKey),_this71.observeOnce("keyForm",function(){_this71.receive(utils.observe(_this71.keyForm,"$valid"),function(){_this71.activeTab===TABS.key&&_this71._onChangeKey()})}),_this71.observe("activeTab",_this71._onChangeActiveTab),_this71}return _inherits(RestoreCtrl,Base),_createClass(RestoreCtrl,[{key:"showTutorialModals",value:function(){return modalManager.showTutorialModals()}},{key:"restore",value:function(){this.saveUserData?analytics.send({name:"Import Backup Protect Your Account Continue Click",target:"ui"}):this.password=Date.now().toString();var _getEncryptedAndType2=this._getEncryptedAndType(),encrypted=_getEncryptedAndType2.encrypted,type=_getEncryptedAndType2.type,userSettings=user.getDefaultUserSettings({termsAccepted:!1}),newUser=_extends({userType:type,address:this.address,name:this.name,password:this.password,id:this.userId,path:this.userPath,settings:userSettings,saveToStorage:this.saveUserData},encrypted),api=ds.signature.getDefaultSignatureApi(newUser);return user.create(_extends({},newUser,{settings:userSettings.getSettings(),api:api}),!0,!0)}},{key:"resetNameAndPassword",value:function(){this.name="",this.password=""}},{key:"nextStep",value:function(){if(analytics.send({name:"Import Backup Continue Click",params:{guestMode:!this.saveUserData},target:"ui"}),!this.saveUserData)return this.restore();this.activeStep++,analytics.send({name:"Import Backup Protect Your Account Show",target:"ui"})}},{key:"importAccounts",value:function(){return modalManager.showImportAccountsModal()}},{key:"setActiveTab",value:function(tab){this.activeTab=tab}},{key:"_onChangeSeed",value:function(){this.seedForm.$valid?this.address=new ds.Seed(this.seed,window.WavesApp.network.code).address:this.address=""}},{key:"_onChangeAddress",value:function(){var _this72=this;this.userExisted=this._usersInStorage.find(function(user){return user.address===_this72.address})||null,this.isPriorityUserTypeExists=!!this.userExisted&&this._priorityMap[this.activeTab]<=this._priorityMap[this.userExisted.userType]}},{key:"_onChangeKey",value:function(){if(this.keyForm.$valid&&isPublicKey(this.key)){var pubKey=publicKey({privateKey:this.key});this.address=address({publicKey:pubKey},window.WavesApp.network.code)}else this.address=""}},{key:"_onChangeActiveTab",value:function(){var tab=this.activeTab[0].toUpperCase()+this.activeTab.substring(1);this["_onChange"+tab]()}},{key:"_getEncryptedAndType",value:function(){switch(this.activeTab){case TABS.key:return{encrypted:{encryptedPrivateKey:new ds.Seed(this.key,window.WavesApp.network.code).encrypt(this.password)},type:"privateKey"};default:return{encrypted:{encryptedSeed:new ds.Seed(this.seed,window.WavesApp.network.code).encrypt(this.password)},type:"seed"}}}}]),RestoreCtrl}())};controller.$inject=["Base","$scope","user","utils","modalManager"],angular.module("app.restore").controller("RestoreCtrl",controller)}(),function(){var controller=function(Base,$scope,$state,user,modalManager,utils){var ds=require("data-service"),PATH="modules/saveSeed/templates";return new(function(){function SaveSeedCtrl(){_classCallCheck(this,SaveSeedCtrl);var _this73=_possibleConstructorReturn(this,(SaveSeedCtrl.__proto__||Object.getPrototypeOf(SaveSeedCtrl)).call(this,$scope));return _this73.networkError=!1,_this73.password="",_this73.loginForm=null,_this73.activeUserAddress=null,_this73.needPassword=!0,_this73._activeUserIndex=null,_this73.isVisibleSeed=!1,_this73.observe("activeUserAddress",_this73._calculateActiveIndex),_this73.observe("password",_this73._updatePassword),_this73._initUserList(),_this73}return _inherits(SaveSeedCtrl,Base),_createClass(SaveSeedCtrl,[{key:"user",get:function(){return this.userList[this._activeUserIndex]}},{key:"encryptedSeed",get:function(){return this.user.encryptedSeed}}]),_createClass(SaveSeedCtrl,[{key:"_updatePassword",value:function(){this.password&&(this.showPasswordError=!1,this.networkError=!1)}},{key:"showSeed",value:function(){var _this74=this;try{this.networkError=!1,this.showPasswordError=!1;var userSettings=user.getSettingsByUser(this.user),activeUser=_extends({},this.user,{password:this.password,settings:userSettings}),api=ds.signature.getDefaultSignatureApi(activeUser),adapterAvailablePromise=api.isAvailable(!0);return(this._isSeedAdapter(api)||this._isPrivateKey(api)?adapterAvailablePromise.then(function(){return api.getAddress()}).then(function(address){return address===activeUser.address||Promise.reject("Wrong address!")}):modalManager.showLoginByDevice(adapterAvailablePromise,api.type)).then(function(){_this74.isVisibleSeed=!0,ds.app.login(activeUser.address,api),ds.signature.getSignatureApi().getSeed().then(function(seed){_this74.seed=seed})},function(){if(!_this74._isSeedAdapter(api)){var errorData={error:"load-user-error",userType:api.type,address:activeUser.address};return modalManager.showSignDeviceError(errorData).catch(function(){return Promise.resolve()})}_this74._showPasswordError()})}catch(e){this._showPasswordError()}}},{key:"backToUsersList",value:function(){this.password="",this.isVisibleSeed=!1,ds.app.logOut()}},{key:"clickCopySeed",value:function(){analytics.send({name:"Migration Import Continue Click",target:"ui"})}},{key:"_isSeedAdapter",value:function(api){return api.type&&"seed"===api.type}},{key:"_isPrivateKey",value:function(api){return api.type&&"privateKey"===api.type}},{key:"_showPasswordError",value:function(){this.password="",this.showPasswordError=!0,this.networkError=this.user.networkError}},{key:"_initUserList",value:function(){var _this75=this;user.getFilteredUserList().then(function(list){_this75.userList=list,_this75.pendingRestore=!1,_this75._updateActiveUserAddress(),utils.postDigest($scope).then(function(){$scope.$apply()})})}},{key:"_updateActiveUserAddress",value:function(){this.userList.length?(this.activeUserAddress=this.userList[0].address,this.needPassword=!this.userList[0].userType||"seed"===this.userList[0].userType||"privateKey"===this.userList[0].userType):(this.activeUserAddress=null,this.needPassword=!0),this._updatePageUrl()}},{key:"_updatePageUrl",value:function(){this.userList.length?this.pageUrl=PATH+"/saveSeedHasUsers.html":this.pageUrl=PATH+"/saveSeedNoUsers.html"}},{key:"_calculateActiveIndex",value:function(){var activeAddress=this.activeUserAddress,index=null;if(!activeAddress)return null;this.userList.some(function(_ref23,i){return _ref23.address===activeAddress&&(index=i,!0)}),this._activeUserIndex=index,this.needPassword=!this.userList[index].userType||"seed"===this.userList[index].userType||"privateKey"===this.userList[index].userType}}]),SaveSeedCtrl}())};controller.$inject=["Base","$scope","$state","user","modalManager","utils"],angular.module("app.saveSeed").controller("SaveSeedCtrl",controller)}(),function(){var controller=function(Base,$scope,sessionBridge){return new(function(){function SessionsCtrl(){_classCallCheck(this,SessionsCtrl);var _this76=_possibleConstructorReturn(this,(SessionsCtrl.__proto__||Object.getPrototypeOf(SessionsCtrl)).call(this,$scope));return _this76.sessions=sessionBridge.getSessionsData(),_this76.receive(sessionBridge.signals.changeSessions,function(sessions){_this76.sessions=sessions,$scope.$digest()}),_this76}return _inherits(SessionsCtrl,Base),_createClass(SessionsCtrl,[{key:"chooseSession",value:function(session){sessionBridge.login(session.id)}}]),SessionsCtrl}())};controller.$inject=["Base","$scope","sessionBridge"],angular.module("app.sessions").controller("SessionsCtrl",controller)}(),function(){var controller=function(Base,$scope,$state,user,modalManager,appUtils){var ds=require("data-service"),analytics=require("@waves/event-sender"),PATH="modules/signIn/templates";return new(function(){function SignInCtrl(){_classCallCheck(this,SignInCtrl);var _this77=_possibleConstructorReturn(this,(SignInCtrl.__proto__||Object.getPrototypeOf(SignInCtrl)).call(this,$scope));return _this77.networkError=!1,_this77.password="",_this77.loginForm=null,_this77.activeUserAddress=null,_this77.needPassword=!0,_this77._activeUserIndex=null,_this77.observe("activeUserAddress",_this77._calculateActiveIndex),_this77.observe("password",_this77._updatePassword),analytics.send({name:"Onboarding Sign In Show",target:"ui",params:{from:"sign-in"}}),_this77._initUserList(),_this77}return _inherits(SignInCtrl,Base),_createClass(SignInCtrl,[{key:"user",get:function(){return this.userList[this._activeUserIndex]}},{key:"encryptedSeed",get:function(){return this.user.encryptedSeed}}]),_createClass(SignInCtrl,[{key:"showTutorialModals",value:function(){return modalManager.showTutorialModals()}},{key:"_updatePassword",value:function(){this.password&&(this.showPasswordError=!1,this.networkError=!1)}},{key:"login",value:function(){var _this78=this;try{this.networkError=!1,this.showPasswordError=!1;var userSettings=user.getSettingsByUser(this.user),activeUser=_extends({},this.user,{password:this.password,settings:userSettings}),api=ds.signature.getDefaultSignatureApi(activeUser),adapterAvailablePromise=api.isAvailable(!0);return(this._isSeedAdapter(api)||this._isPrivateKeyAdapter(api)?adapterAvailablePromise.then(function(){return api.getAddress()}).then(function(address){return address===activeUser.address||Promise.reject("Wrong address!")}):modalManager.showLoginByDevice(adapterAvailablePromise,api.type)).then(function(){return user.login({api:api,userType:api.type,password:_this78.password,address:activeUser.address})},function(){if(!_this78._isSeedAdapter(api)&&!_this78._isPrivateKeyAdapter(api)){var errorData={error:"load-user-error",userType:api.type,address:activeUser.address};return modalManager.showSignDeviceError(errorData).catch(function(){return Promise.resolve()})}_this78._showPasswordError()})}catch(e){this._showPasswordError()}}},{key:"removeUser",value:function(address){var _this79=this,user=this.userList.find(function(user){return user.address===address});modalManager.showConfirmDeleteUser(user).then(function(){return _this79._deleteUser(address)}).then(function(){_this79.userList.length||$state.go("welcome")})}},{key:"_isSeedAdapter",value:function(api){return api.type&&"seed"===api.type}},{key:"_isPrivateKeyAdapter",value:function(api){return api.type&&"privateKey"===api.type}},{key:"_showPasswordError",value:function(){this.password="",this.showPasswordError=!0,this.networkError=this.user.networkError}},{key:"_deleteUser",value:function(address){var _this80=this;return user.removeUserByAddress(address).then(function(){_this80.userList=_this80.userList.filter(function(user){return user.address!==address}),_this80._updateActiveUserAddress(),appUtils.safeApply($scope)})}},{key:"_initUserList",value:function(){var _this81=this;user.getFilteredUserList().then(function(list){_this81.userList=list,_this81.pendingRestore=!1,_this81._updateActiveUserAddress(),appUtils.safeApply($scope)})}},{key:"_updateActiveUserAddress",value:function(){this.userList.length?(this.activeUserAddress=this.userList[0].address,this.needPassword=!this.userList[0].userType||"seed"===this.userList[0].userType||"privateKey"===this.userList[0].userType):(this.activeUserAddress=null,this.needPassword=!0),this._updatePageUrl()}},{key:"_updatePageUrl",value:function(){this.userList.length?this.pageUrl=PATH+"/signInHasUsers.html":this.pageUrl=PATH+"/signInNoUsers.html"}},{key:"_calculateActiveIndex",value:function(){var activeAddress=this.activeUserAddress,index=null;if(!activeAddress)return null;this.userList.some(function(_ref24,i){return _ref24.address===activeAddress&&(index=i,!0)}),this._activeUserIndex=index,this.needPassword=!this.userList[index].userType||"seed"===this.userList[index].userType||"privateKey"===this.userList[index].userType}}]),SignInCtrl}())};controller.$inject=["Base","$scope","$state","user","modalManager","utils"],angular.module("app.signIn").controller("SignInCtrl",controller)}(),function(){var controller=function(Base,$scope,userNotification,notification){return new(function(){function StandCtrl(){_classCallCheck(this,StandCtrl);var _this82=_possibleConstructorReturn(this,(StandCtrl.__proto__||Object.getPrototypeOf(StandCtrl)).call(this,$scope));_this82.tab="info",_this82.qrData="Keep on waving, we`ll take care of the bad guys",_this82.info=_this82.dataCopy="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",_this82.invalid=!0,_this82.warning=!0,_this82.success=!0,_this82.error=!0,_this82.active=!0,_this82.inactive=!0,_this82.seedConfirmWasFilled=!1,_this82.seedIsValid=!1,_this82.seed="merry evil keep lost fox tech absent trololo both field get input div cosmic";!function loop(index){userNotification.info({body:{literal:index+1}}).then(function(){return loop(index+1)})}(0);!function loop2(index){userNotification.error({body:{literal:index+1}}).then(function(){return loop2(index+1)})}(0);!function loop3(index){userNotification.success({body:{literal:index+1}}).then(function(){return loop3(index+1)})}(0);!function loop4(index){userNotification.warn({body:{literal:index+1}}).then(function(){return loop4(index+1)})}(0);!function loop0(index){notification.info({title:{literal:"Title info"},body:{literal:"Text body info"}}).then(function(){return loop0(index+1)})}(0);return function loop5(index){notification.error({title:{literal:"Title error"},body:{literal:"Text body error"}}).then(function(){return loop5(index+1)})}(0),_this82}return _inherits(StandCtrl,Base),StandCtrl}())};controller.$inject=["Base","$scope","userNotification","notification"],angular.module("app.stand").controller("StandCtrl",controller)}(),function(){var controller=function(Base,$scope,modalManager,waves,balanceWatcher,user,utils,PromiseControl){var _require16=require("@waves/signature-adapter"),SIGN_TYPE=_require16.SIGN_TYPE,WAVES_ID=_require16.WAVES_ID,BigNumber=require("@waves/bignumber").BigNumber,ds=require("data-service"),$=require("jquery");return new(function(){function TokensCtrl(){_classCallCheck(this,TokensCtrl);var _this83=_possibleConstructorReturn(this,(TokensCtrl.__proto__||Object.getPrototypeOf(TokensCtrl)).call(this,$scope));return _this83.focusName=!1,_this83._findNamePC=null,_this83.agreeConditions=!1,_this83.nameWarning=!1,_this83.createForm=null,_this83.assetId="",_this83.name="",_this83.description="",_this83.issue=!0,_this83.count=null,_this83.precision=0,_this83.maxCoinsCount=WavesApp.maxCoinsCount,_this83.invalid=!1,_this83.script="",_this83.isValidScript=!0,_this83.scriptPending=!1,_this83.fee=null,_this83.hasAssetScript=!1,_this83.signable=null,_this83._scriptValidationXHR=null,_this83.isNFT=!1,_this83.receive(balanceWatcher.change,_this83._onChangeBalance,_this83),_this83.observe("precision",_this83._onChangePrecision),_this83.observe("script",_this83._onChangeScript),_this83.observe(["name","count","script","precision","description","issue","hasAssetScript","fee"],_this83.createSignable),_this83.observe(["count","precision","issue"],_this83._setIsNFT),_this83._getFee(),_this83.observe("isNFT",_this83._getFee),_this83.observeOnce("createForm",function(){_this83.receive(utils.observe(_this83.createForm,"$valid"),_this83.createSignable,_this83)}),_this83}return _inherits(TokensCtrl,Base),_createClass(TokensCtrl,[{key:"onNameFocus",value:function(focus){this.focusName=!!focus}},{key:"generate",value:function(signable){var _this84=this;return modalManager.showConfirmTx(signable).then(function(){return _this84._reset()})}},{key:"sendAnalytics",value:function(){analytics.send({name:"Token Generation Info Show",target:"ui"})}},{key:"getSignable",value:function(){return this.signable}},{key:"createSignable",value:function(){var _this85=this;if(this._verifyName().then(function(res){_this85.nameWarning=res,$scope.$apply()}),!this.name||!this.createForm||!this.createForm.$valid)return this.assetId="",null;var precision=Number(this.precision.toString()),quantity=(this.count||new BigNumber(0)).mul(Math.pow(10,precision)),script=this.hasAssetScript&&this.script?"base64:"+this.script:"",tx=waves.node.transactions.createTransaction({type:SIGN_TYPE.ISSUE,name:this.name,description:this.description,reissuable:this.issue,quantity:quantity,precision:precision,script:script,fee:this.fee});this.signable=ds.signature.getSignatureApi().makeSignable({type:tx.type,data:tx}),this.signable.getId().then(function(id){_this85.assetId=id,utils.safeApply($scope)})}},{key:"_verifyName",value:function(){var _this86=this;return null!=this._findNamePC&&this._findNamePC.abort(),this._findNamePC=new PromiseControl(utils.wait(1e3)),this._findNamePC.then(function(){return utils.assetNameWarning(_this86.name)})}},{key:"_onChangeScript",value:function(){var _this87=this;this._scriptValidationXHR&&(this._scriptValidationXHR.abort(),this.scriptPending=!1);var script=this.script.replace("base64:","");if(!script)return this.isValidScript=!0,this.scriptPending=!1,null;this.isValidScript=!0,this.scriptPending=!0,this._scriptValidationXHR=$.ajax({method:"POST",url:user.getSetting("network.node")+"/utils/script/estimate",data:script}),this._scriptValidationXHR.then(function(){_this87.isValidScript=!0}).catch(function(){_this87.isValidScript=!1}).always(function(){_this87.scriptPending=!1,$scope.$apply()})}},{key:"_onChangePrecision",value:function(_ref25){var value=_ref25.value;value&&value<=8&&(this.maxCoinsCount=WavesApp.maxCoinsCount.div(Math.pow(10,Number(value))))}},{key:"_onChangeBalance",value:function(){this._balance=balanceWatcher.getBalance()[WAVES_ID],this.invalid=!this.fee||!this._balance||this._balance.getTokens().lt(this.fee.getTokens()),$scope.$apply()}},{key:"_reset",value:function(){this.name="",this.description="",this.issue=!0,this.count=new BigNumber(0),this.precision=0,this.maxCoinsCount=WavesApp.maxCoinsCount,this.script="",this.hasAssetScript=!1,this.createForm.$setPristine(),this.createForm.$setUntouched(),$scope.$apply()}},{key:"_setIsNFT",value:function(){var count=this.count,precision=this.precision,issue=this.issue,nftCount=count&&count.eq(1),nftPrecision=0===precision;this.isNFT=!issue&&nftCount&&nftPrecision}},{key:"_getFee",value:function(){var _this88=this;waves.node.getFee({type:SIGN_TYPE.ISSUE,reissue:this.issue,precision:this.precision,quantity:this.count}).then(function(money){_this88.fee=money,_this88._onChangeBalance(),$scope.$apply()})}}]),TokensCtrl}())};controller.$inject=["Base","$scope","modalManager","waves","balanceWatcher","user","utils","PromiseControl"],angular.module("app.tokens").controller("TokensCtrl",controller)}(),function(){var factory=function($q){return new(function(){function CarouselManager(){_classCallCheck(this,CarouselManager),this.slidersHash=Object.create(null),this.promiseHash=Object.create(null),this.defersHash=Object.create(null)}return _createClass(CarouselManager,[{key:"registerSlider",value:function(id,slider){this.slidersHash[id]=slider,this.defersHash[id]&&(this.defersHash[id].resolve(slider),delete this.promiseHash[id]),this.promiseHash[id]&&delete this.promiseHash[id]}},{key:"removeSlider",value:function(id){this.slidersHash[id]&&delete this.slidersHash[id],this.promiseHash[id]&&delete this.promiseHash[id],this.defersHash[id]&&delete this.defersHash[id]}},{key:"getSlider",value:function(id){if(this.slidersHash[id])return $q.when(this.slidersHash[id]);if(this.promiseHash[id])return this.promiseHash[id];var defer=$q.defer();return this.promiseHash[id]=defer.promise,this.defersHash[id]=defer,this.promiseHash[id]}}]),CarouselManager}())};factory.$inject=["$q"],angular.module("app.ui").factory("carouselManager",factory)}(),function(){var _ANALYTICS_TX_NAMES,ds=require("data-service"),Asset=require("@waves/data-entities").Asset,SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,analytics=require("@waves/event-sender"),NO_EXPORT_TYPES=[SIGN_TYPE.MASS_TRANSFER,SIGN_TYPE.CREATE_ORDER,SIGN_TYPE.DATA,SIGN_TYPE.SCRIPT_INVOCATION],ANALYTICS_TX_NAMES=(_defineProperty(_ANALYTICS_TX_NAMES={},SIGN_TYPE.CREATE_ORDER,"Create order"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.ISSUE,"Token Generation"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.TRANSFER,"Transfer"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.REISSUE,"Reissue Token"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.BURN,"Burn Token"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.EXCHANGE,"Exchange"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.LEASE,"Leasing"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.CANCEL_LEASING,"Leasing cancel"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.CREATE_ALIAS,"Create Alias"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.MASS_TRANSFER,"Mass Transfer"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.DATA,"Data"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.SET_SCRIPT,"Set Script"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.SPONSORSHIP,"Sponsorship"),_defineProperty(_ANALYTICS_TX_NAMES,SIGN_TYPE.SET_ASSET_SCRIPT,"Set Asset Script"),_ANALYTICS_TX_NAMES),factory=function(Base,waves,utils,$mdDialog,modalManager){return function(){function ConfirmTxService($scope){_classCallCheck(this,ConfirmTxService);var _this89=_possibleConstructorReturn(this,(ConfirmTxService.__proto__||Object.getPrototypeOf(ConfirmTxService)).call(this,$scope));return _this89.onTxSent=null,_this89.step=0,_this89.txId="",_this89.signable=null,_this89.advancedMode=!1,_this89.activeTab="details",_this89.canCreateLink=!1,_this89.exportLink=WavesApp.origin,_this89.errorType=null,_this89.errorMessage=null,_this89.errorParams=Object.create(null),_this89.isTransaction=!1,_this89.__$scope=null,_this89.__$scope=$scope,_this89.syncSettings({advancedMode:"advancedMode"}),_this89.observe("signable",_this89.onChangeSignable),_this89}return _inherits(ConfirmTxService,Base),_createClass(ConfirmTxService,[{key:"sendTransaction",value:function(){var _this90=this,method=ConfirmTxService._getSendMethod(this.signable.type);return this.signable.getDataForApi().then(method).then(function(data){return analytics.send(_this90.getAnalytics(data,!0)),data},function(error){return analytics.send(_this90.getAnalytics(_this90.signable.getTxData(),!1)),Promise.reject(error)})}},{key:"getEventName",value:function(data){return data.type?data.type in ANALYTICS_TX_NAMES?ANALYTICS_TX_NAMES[data.type]:"Unknown":ANALYTICS_TX_NAMES[SIGN_TYPE.CREATE_ORDER]}},{key:"getAnalytics",value:function(data,success){var NAME=this.getEventName(data);return{name:success?NAME+" Transaction Success":NAME+" Transaction Error",params:{type:data.type}}}},{key:"confirm",value:function(){var _this91=this;return this.sendTransaction().then(function(tx){ConfirmTxService._isIssueTx(tx)&&_this91._saveIssueAsset(tx),_this91.step++,_this91.onTxSent({id:tx.id}),_this91.__$scope.$apply()}).catch(function(e){e.error&&utils.checkIsScriptError(e.error)?(_this91.errorType=e.error,_this91.errorParams=e.params):_this91.errorMessage=e.message,_this91.__$scope.$apply()})}},{key:"showTxInfo",value:function(){this.signable.getId().then(function(id){$mdDialog.hide(),setTimeout(function(){modalManager.showTransactionInfo(id)},1e3)})}},{key:"_saveIssueAsset",value:function(tx){waves.node.height().then(function(height){ds.assetStorage.save(tx.id,new Asset(_extends({},tx,{ticker:null,precision:tx.decimals,hasScript:!(!tx.script||!tx.script.replace("base64:","")),height:height})))})}},{key:"initExportLink",value:function(){var _this92=this,type=this.signable.type;this.signable.getDataForApi().then(function(data){_this92.exportLink=WavesApp.origin+"/#tx"+utils.createQS(data),_this92.canCreateLink=!NO_EXPORT_TYPES.includes(type)&&_this92.exportLink.length<=WavesApp.MAX_URL_LENGTH,_this92.__$scope.$apply()})}},{key:"onChangeSignable",value:function(){var _this93=this;this.signable?(this.isTransaction=this.signable.type<100,this.advancedMode&&this.signable.hasMySignature().then(function(state){state&&_this93.initExportLink()}),this.tx=waves.node.transactions.createTransaction(this.signable.getTxData()),this.signable.getId().then(function(id){_this93.txId=id,_this93.__$scope.$digest()})):(this.txId="",this.tx=null)}}],[{key:"_isIssueTx",value:function(tx){return tx.type===SIGN_TYPE.ISSUE}},{key:"_getSendMethod",value:function(type){switch(type){case SIGN_TYPE.CREATE_ORDER:return ds.createOrder;case SIGN_TYPE.CANCEL_ORDER:return ds.cancelOrder;default:return ds.broadcast}}},{key:"toBigNumber",value:function(amount){return amount&&amount.getTokens().toFixed()||void 0}}]),ConfirmTxService}()};factory.$inject=["Base","waves","utils","$mdDialog","modalManager"],angular.module("app.ui").factory("ConfirmTxService",factory)}(),function(){var factory=function(configService){var Signal=require("ts-utils").Signal;return new(function(){function PermissionManager(){_classCallCheck(this,PermissionManager),this.change=new Signal,this._permissions=Object.create(null),this._permissions=configService.get("PERMISSIONS")||Object.create(null),configService.change.on(this._onChangeConfig,this)}return _createClass(PermissionManager,[{key:"isPermitted",value:function(name){var permission=this._permissions[name];return null==permission||permission}},{key:"_onChangeConfig",value:function(path){if(!path.includes("PERMISSIONS"))return null;var permissions=configService.get("PERMISSIONS")||Object.create(null);this._permissions=PermissionManager._parsePermissions(permissions),this.change.dispatch()}}],[{key:"_parsePermissions",value:function(raw){return Object.keys(raw).reduce(function(acc,key){return"boolean"==typeof raw[key]?acc[key]=raw[key]:raw[key]instanceof Array&&raw[key].forEach(function(item){acc[key+"."+item]=!0}),acc},{})}}]),PermissionManager}())};factory.$inject=["configService"],angular.module("app.ui").factory("permissionManager",factory)}(),function(){var factory=function(Base,user,utils){return new(function(){function UserNameService(base){_classCallCheck(this,UserNameService);var _this94=_possibleConstructorReturn(this,(UserNameService.__proto__||Object.getPrototypeOf(UserNameService)).call(this,base));return _this94.MAX_USER_NAME_LENGTH=24,user.loginSignal.on(function(){_this94.name=user.name,_this94.address=user.address}),user.logoutSignal.on(function(){_this94.name="",_this94.address=""}),_this94.receive(utils.observe(user,"name"),function(){this.name=user.name},_this94),_this94}return _inherits(UserNameService,Base),_createClass(UserNameService,[{key:"save",value:function(){var _this95=this;return this.isUniqueName().then(function(isUniqueName){isUniqueName&&_this95._isNameLengthValid()?user.name=_this95.name:_this95.name=user.name})}},{key:"setName",value:function(name){this.name=name}},{key:"isUniqueName",value:function(){var _this96=this;return this._getUserList().then(function(list){var isUnique=list.filter(function(user){return user.address!==_this96.address}).every(function(user){return user.name!==_this96.name});return!_this96.name||isUnique})}},{key:"_isNameLengthValid",value:function(){return!this.name||this.name.length<=this.MAX_USER_NAME_LENGTH}},{key:"_getUserList",value:function(){return user.getFilteredUserList()}}]),UserNameService}())};factory.$inject=["Base","user","utils"],angular.module("app.ui").factory("userNameService",factory)}(),function(){var controller=function(Base){return new(function(){function UnavailableCtrl(){return _classCallCheck(this,UnavailableCtrl),_possibleConstructorReturn(this,(UnavailableCtrl.__proto__||Object.getPrototypeOf(UnavailableCtrl)).apply(this,arguments))}return _inherits(UnavailableCtrl,Base),UnavailableCtrl}())};controller.$inject=["Base"],angular.module("app.unavailable").controller("UnavailableCtrl",controller)}(),angular.module("app.wallet").controller("WalletHeaderCtrl",function(){}),function(){var factory=function(user,decorators,waves){return new(function(){function BaseAssetService(){_classCallCheck(this,BaseAssetService)}return _createClass(BaseAssetService,[{key:"getBaseAssetId",value:function(){return user.getSetting("baseAssetId")}},{key:"getBaseAsset",value:function(){return waves.node.assets.getAsset(user.getSetting("baseAssetId"))}},{key:"convertToBaseAsset",value:function(money){return this.getBaseAsset().then(function(baseAsset){return waves.utils.getRateApi(money.asset.id,baseAsset.id).then(function(api){return api.exchange(money.getTokens())}).then(function(balance){return ds.moneyFromTokens(balance,baseAsset)})})}}]),BaseAssetService}())};factory.$inject=["user","decorators","waves"],angular.module("app.utils").factory("baseAssetService",factory)}(),function(){var factory=function(utils){var tsUtils=require("ts-utils"),ComponentList=function(){function ComponentList(components){_classCallCheck(this,ComponentList),this._hash=Object.create(null),this.signals=utils.liteObject({add:new tsUtils.Signal,remove:new tsUtils.Signal}),this.components=[],components&&components.length&&this.add(components)}return _createClass(ComponentList,[{key:"length",get:function(){return this.components.length}}]),_createClass(ComponentList,[{key:"add",value:function(components){utils.toArray(components).forEach(this._add,this)}},{key:"remove",value:function(components){utils.toArray(components).forEach(this._remove,this)}},{key:"push",value:function(){for(var _len4=arguments.length,components=Array(_len4),_key4=0;_key4<_len4;_key4++)components[_key4]=arguments[_key4];this.add(components)}},{key:"forEach",value:function(cb,context){this.components.forEach(cb,context)}},{key:"map",value:function(cb,context){return this.components.map(cb,context)}},{key:"filter",value:function(cb,context){return new ComponentList(this.components.filter(cb,context))}},{key:"where",value:function(props){var keys=Object.keys(props);return new ComponentList(this.components.filter(function(item){return keys.every(function(key){return utils.isEqual(props[key],item[key])})}))}},{key:"some",value:function(cb,context){return"function"==typeof cb?this.components.some(cb,context):this.components.some(tsUtils.contains(cb))}},{key:"every",value:function(cb,context){return"function"==typeof cb?this.components.every(cb,context):this.components.every(tsUtils.contains(cb))}},{key:"get",value:function(index){return this.components[index]}},{key:"first",value:function(){return this.components[0]}},{key:"last",value:function(){return this.components[this.components.length-1]}},{key:"index",value:function(id,field){return this.components.indexOf(tsUtils.find(this.components,_defineProperty({},field,id)))}},{key:"_add",value:function(component){var _this98=this;this.receiveOnce(component.signals.destroy,function(){return _this98.remove(component)}),this._hash[component.cid]=component,this.components.push(component),this.signals.add.dispatch(component)}},{key:"_remove",value:function(component){delete this._hash[component.cid];var index=this.components.indexOf(component);-1!==index&&(this.components.splice(index,1),this.signals.remove.dispatch(component))}}]),ComponentList}();return ComponentList.prototype.receive=tsUtils.Receiver.prototype.receive,ComponentList.prototype.receiveOnce=tsUtils.Receiver.prototype.receiveOnce,ComponentList.prototype.stopReceive=tsUtils.Receiver.prototype.stopReceive,ComponentList};factory.$inject=["utils"],angular.module("app.utils").factory("ComponentList",factory)}(),function(){var factory=function(){var Ease={linear:function(t){return t},get:function(amount){return amount<-1&&(amount=-1),1<amount&&(amount=1),function(t){return 0===amount?t:amount<0?t*(t*-amount+1+amount):t*((2-t)*amount+(1-amount))}},getPowIn:function(pow){return function(t){return Math.pow(t,pow)}},getPowOut:function(pow){return function(t){return 1-Math.pow(1-t,pow)}},getPowInOut:function(pow){return function(t){return(t*=2)<1?.5*Math.pow(t,pow):1-.5*Math.abs(Math.pow(2-t,pow))}},sineIn:function(t){return 1-Math.cos(t*Math.PI/2)},sineOut:function(t){return Math.sin(t*Math.PI/2)},sineInOut:function(t){return-.5*(Math.cos(Math.PI*t)-1)},getBackIn:function(amount){return function(t){return t*t*((amount+1)*t-amount)}},getBackOut:function(amount){return function(t){return--t*t*((amount+1)*t+amount)+1}},getBackInOut:function(amount){return amount*=1.525,function(t){return(t*=2)<1?t*t*((amount+1)*t-amount)*.5:.5*((t-=2)*t*((amount+1)*t+amount)+2)}},circIn:function(t){return-(Math.sqrt(1-t*t)-1)},circOut:function(t){return Math.sqrt(1- --t*t)},circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},bounceIn:function(t){return 1-Ease.bounceOut(1-t)},bounceOut:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},bounceInOut:function(t){return t<.5?.5*Ease.bounceIn(2*t):.5*Ease.bounceOut(2*t-1)+.5},getElasticIn:function(amplitude,period){var pi2=2*Math.PI;return function(t){if(0==t||1==t)return t;var s=period/pi2*Math.asin(1/amplitude);return-amplitude*Math.pow(2,10*(t-=1))*Math.sin((t-s)*pi2/period)}},getElasticOut:function(amplitude,period){var pi2=2*Math.PI;return function(t){if(0==t||1==t)return t;var s=period/pi2*Math.asin(1/amplitude);return amplitude*Math.pow(2,-10*t)*Math.sin((t-s)*pi2/period)+1}},getElasticInOut:function(amplitude,period){var pi2=2*Math.PI;return function(t){var s=period/pi2*Math.asin(1/amplitude);return(t*=2)<1?amplitude*Math.pow(2,10*(t-=1))*Math.sin((t-s)*pi2/period)*-.5:amplitude*Math.pow(2,-10*(t-=1))*Math.sin((t-s)*pi2/period)*.5+1}}};return Ease.backOut=Ease.getBackOut(1.7),Ease.backIn=Ease.getBackIn(1.7),Ease.backInOut=Ease.getBackInOut(1.7),Ease.elasticIn=Ease.getElasticIn(1,.3),Ease.elasticInOut=Ease.getElasticInOut(1,.3*1.5),Ease.elasticOut=Ease.getElasticOut(1,.3),Ease.quadIn=Ease.getPowIn(2),Ease.quadOut=Ease.getPowOut(2),Ease.quadInOut=Ease.getPowInOut(2),Ease.cubicIn=Ease.getPowIn(3),Ease.cubicOut=Ease.getPowOut(3),Ease.cubicInOut=Ease.getPowInOut(3),Ease.quartIn=Ease.getPowIn(4),Ease.quartOut=Ease.getPowOut(4),Ease.quartInOut=Ease.getPowInOut(4),Ease.quintIn=Ease.getPowIn(5),Ease.quintOut=Ease.getPowOut(5),Ease.quintInOut=Ease.getPowInOut(5),Ease};factory.$inject=[],angular.module("app.utils").factory("ease",factory)}(),BASE_URL=WavesApp.network.explorer,angular.module("app.utils").factory("explorerLinks",function(){return new(function(){function ExplorerLinks(){_classCallCheck(this,ExplorerLinks)}return _createClass(ExplorerLinks,[{key:"getTxLink",value:function(transactionId){return BASE_URL+"/tx/"+transactionId}}]),ExplorerLinks}())}),function(){var RESOLUTIONS_FULL_HD={width:1920,height:1080},RESOLUTIONS_HD={width:1280,height:720},RESOLUTIONS_VGA={width:640,height:480},RESOLUTIONS_QVGA={width:320,height:240},factory=function($q){var MediaStream=function(){function MediaStream(stream){_classCallCheck(this,MediaStream),this.stream=stream}return _createClass(MediaStream,[{key:"stop",value:function(){this.stream.getTracks()[0].stop()}}]),MediaStream}();function getConstraints(deviceList,resolution){var constraints={video:{width:{exact:resolution.width},height:{exact:resolution.height}}};if(navigator.mediaDevices.getSupportedConstraints().facingMode)constraints.video.facingMode="environment";else{var deviceInfo=function(devices){var facingBackCamera=devices.find(function(device){return device.label.includes("back")});if(!facingBackCamera){var videoInputDevices=devices.filter(function(device){return"videoinput"===device.kind});facingBackCamera=videoInputDevices[videoInputDevices.length-1]}return facingBackCamera||null}(deviceList);constraints.video.deviceId={exact:deviceInfo.deviceId}}return constraints}return{create:function(){return $q(function(resolve,reject){if(!navigator.mediaDevices)return reject(new Error("navigator.mediaDevices is undefined"));navigator.mediaDevices.enumerateDevices().then(function(deviceList){var mediaDevices=navigator.mediaDevices,checkResolution=function(res){return mediaDevices.getUserMedia(getConstraints(deviceList,res)).catch(function(){return mediaDevices.getUserMedia(getConstraints(deviceList,function(resolution){return{width:resolution.height,height:resolution.width}}(res)))})};return checkResolution(RESOLUTIONS_FULL_HD).catch(function(){return checkResolution(RESOLUTIONS_HD)}).catch(function(){return checkResolution(RESOLUTIONS_VGA)}).catch(function(){return checkResolution(RESOLUTIONS_QVGA)})}).then(function(stream){resolve(new MediaStream(stream))},reject)})}}};factory.$inject=["$q"],angular.module("app.utils").factory("mediaStream",factory)}(),angular.module("app.utils").factory("migration",function(){var migration={migrateFrom:function(version,versionList){return versionList.filter(migration.getCurrentVersionFilter(version)).sort(migration._comparator)},sort:function(versionList){return versionList.slice().sort(migration._comparator)},lt:function(v1,v2){return migration._comparator(v1,v2)<0},lte:function(v1,v2){return migration._comparator(v1,v2)<=0},gt:function(v1,v2){return 0<migration._comparator(v1,v2)},gte:function(v1,v2){return 0<=migration._comparator(v1,v2)},getCurrentVersionFilter:function(lastVersion){return function(version){return migration.gt(version,lastVersion)&&migration.lte(version,WavesApp.version)}},_comparator:function(v1,v2){var v1Beta=v1.includes("beta"),v2Beta=v2.includes("beta");if(v1Beta&&!v2Beta)return-1;if(!v1Beta&&v2Beta)return 1;v1=migration._parse(v1),v2=migration._parse(v2);for(var i=0;i<v1.length;i++){var part1=v1[i],part2=v2[i]||0;if(part1<part2)return-1;if(part2<part1)return 1}return 0},_parse:function(version){return version.replace(/[^0-9.]/g,"").split(".").map(Number)}};return migration}),function(){var factory=function(){var tsUtils=require("ts-utils"),Moment=function(){function Moment(date,pattern){_classCallCheck(this,Moment),this._date=Moment._parse(date,pattern),this._formatter=tsUtils.date(pattern||"DD.MM.YYYY")}return _createClass(Moment,[{key:"applyPattern",value:function(pattern){pattern&&(this._formatter=tsUtils.date(pattern))}},{key:"add",value:function(){return this._getBinded("_add")}},{key:"startOf",value:function(){return this._getBinded("_startOf")}},{key:"format",value:function(pattern){return tsUtils.date(pattern)(this._date)}},{key:"clone",value:function(pattern){return new Moment(this._date,pattern)}},{key:"valueOf",value:function(){return this._date.valueOf()}},{key:"toString",value:function(){return this._formatter(this._date)}},{key:"toJSON",value:function(){return this.toString()}},{key:"getDate",value:function(){return this._date}},{key:"_getBinded",value:function(key){var _this99=this,result=Object.create(null);return Object.keys(this[key]).forEach(function(name){result[name]=_this99[key][name].bind(_this99)}),result}},{key:"_getParts",value:function(){return[this._date.getFullYear(),this._date.getMonth(),this._date.getDate(),this._date.getHours(),this._date.getMinutes(),this._date.getSeconds(),this._date.getMilliseconds()]}}],[{key:"_parse",value:function(date,pattern){if(tsUtils.isEmpty(date))return new Date;if(date instanceof Date)return date;switch(void 0===date?"undefined":_typeof(date)){case"string":return Moment._parseString(date,pattern);case"number":return new Date(date);default:throw new Error("Can' parse date!")}}},{key:"_parseString",value:function(date,pattern){if(!pattern)throw new Error("Can't parse date from string without pattern!");var parsedParts=[],parts=date.match(/\d+/g);return pattern.match(Moment._parseReg).forEach(function(patternPart,index){Moment._patterns[patternPart](parsedParts,parts[index])}),new(Function.prototype.bind.apply(Date,[null].concat(parsedParts)))}}]),Moment}();Moment._patterns=Object.create(null);var PATTERNS=["YYYY","YY","MM","M","DD","D","hh","h","mm","m","ss","s"];Moment._parseReg=new RegExp(PATTERNS.join("|"),"g");for(var loop=function(pattern,index){switch(pattern){case"YYYY":Moment._patterns[pattern]=function(result,part){result[index]=Number(part)};break;case"YY":Moment._patterns[pattern]=function(result,part){var year=Number(part);result[index]=40<year?year+1900:year+2e3};break;case"MM":case"M":Moment._patterns[pattern]=function(result,part){result[index]=Number(part)-1};break;default:Moment._patterns[pattern]=function(result,part){result[index]=Number(part)}}},i=0,k=0;i<PATTERNS.length;i+=2){for(var j=0;j<2;j++){loop(PATTERNS[i+j],k)}k++}return Moment.prototype._add=Object.create(null),Moment.prototype._startOf=Object.create(null),["year","month","day","hour","minute","second"].forEach(function(name,index){Moment.prototype._add[name]=function(count){var params=this._getParts();return params[index]+=count,this._date=new(Function.prototype.bind.apply(Date,[null].concat(_toConsumableArray(params)))),this},Moment.prototype._startOf[name]=function(){var params=this._getParts().slice(index);return this._date=new(Function.prototype.bind.apply(Date,[null].concat(_toConsumableArray(params)))),this}}),Moment.prototype._add.week=function(count){var params=this._getParts();return params[2]+=Math.round(7*count),this._date=new(Function.prototype.bind.apply(Date,[null].concat(_toConsumableArray(params)))),this},Moment};factory.$inject=[],angular.module("app.utils").factory("Moment",factory)}(),function(){var factory=function(state,PromiseControl,timeLine,utils,$q){var tsUtils=require("ts-utils"),Poll=function(){function Poll(getData,applyData,time,errorRequestTime){_classCallCheck(this,Poll),this.id=tsUtils.uniqueId("poll"),this.signals={destroy:new tsUtils.Signal},this._errorRequestTime=errorRequestTime||1e3,this._ready=$q.defer(),this._removed=!1,this._originTime=time,this._sleepStep=null,this._getData=getData,this._applyData=applyData,this._paused=!1,this._timer=null,this._promise=null,this._pausePromise=null,this._initialize()}return _createClass(Poll,[{key:"ready",get:function(){return this._ready.promise}},{key:"_time",get:function(){return this._sleepStep?this._originTime*this._sleepStep:this._originTime}},{key:"_promise",get:function(){return this.__promise},set:function(promise){this.__promise&&this.__promise.drop(),this.__promise=promise}}]),_createClass(Poll,[{key:"pause",value:function(promise){var _this100=this;if(this._paused=!0,this._stopTimers(),this._pausePromise){this._pausePromise.drop();var pausePromise=utils.resolve(this._pausePromise.promise()).then(function(){return promise});this._pausePromise=new PromiseControl(pausePromise)}else this._pausePromise=new PromiseControl(promise);this._pausePromise.always(function(){_this100._pausePromise=null,_this100.play()})}},{key:"stop",value:function(){this._paused=!0,this._stopTimers()}},{key:"play",value:function(){this._paused=!1,this._pausePromise&&(this._pausePromise.drop(),this._pausePromise=null),this._run()}},{key:"destroy",value:function(){this._removed=!0,this._stopTimers(),this.stopReceive(),this.signals.destroy.dispatch()}},{key:"restart",value:function(){return this._stopTimers(),this._run()}},{key:"_initialize",value:function(){this._setHandlers(),this._run()}},{key:"_sleep",value:function(step){this._sleepStep=step+2}},{key:"_wakeUp",value:function(){this._sleepStep=null}},{key:"_setHandlers",value:function(){this.receive(state.signals.sleep,this._sleep,this),this.receive(state.signals.wakeUp,this._wakeUp,this)}},{key:"_stopTimers",value:function(){timeLine.cancel(this._timer),this._promise=null}},{key:"_run",value:function(){var _this101=this;return new Promise(function(resolve){if(_this101._removed)return null;if(_this101._paused)return null;var result=_this101._getData();Poll._isPromise(result)?(_this101._promise=new PromiseControl(result),_this101._promise.then(function(data){_this101._addTimeout(),_this101._applyData(data),_this101._ready.resolve(),resolve()},function(){_this101._timer=timeLine.timeout(function(){return _this101._run()},_this101._errorRequestTime)})):(_this101._applyData(result),_this101._addTimeout(),resolve())})}},{key:"_addTimeout",value:function(){var _this102=this;this._timer=timeLine.timeout(function(){return _this102._run()},this._time)}}],[{key:"_isPromise",value:function(data){return data&&data.then&&"function"==typeof data.then}}]),Poll}();return Poll.prototype.receive=tsUtils.Receiver.prototype.receive,Poll.prototype.receiveOnce=tsUtils.Receiver.prototype.receiveOnce,Poll.prototype.stopReceive=tsUtils.Receiver.prototype.stopReceive,Poll};factory.$inject=["state","PromiseControl","timeLine","utils","$q"],angular.module("app.utils").factory("Poll",factory)}(),function(){var factory=function(Poll,eventManager){return function(){function PollCache(_ref26){var _this103=this,getData=_ref26.getData,timeout=_ref26.timeout,isBalance=_ref26.isBalance;_classCallCheck(this,PollCache),this._ready=!1,this._data=null,this._isBalance=isBalance,this._poll=new Poll(function(){return getData().then(function(data){return _this103._isError=!1,data}).catch(function(e){return _this103._isError=!0,e})},this._applyData.bind(this),timeout||5e3),this._isError=!1,this._readyDfr=$.Deferred(),this._isBalance&&(this._changeBalanceHandler=function(){_this103._poll.restart()},eventManager.signals.changeBalanceEvent.on(this._changeBalanceHandler))}return _createClass(PollCache,[{key:"destroy",value:function(){this._isBalance&&eventManager.signals.changeBalanceEvent.off(this._changeBalanceHandler),this._poll.destroy()}},{key:"get",value:function(){return this._ready?this._isError?Promise.reject(this.data):Promise.resolve(this.data):this._readyDfr.promise()}},{key:"_applyData",value:function(data){this._ready||(this._readyDfr.resolve(data),this._ready=!0,this._readyDfr=null),this.data=data}}]),PollCache}()};factory.$inject=["Poll","eventManager"],angular.module("app.ui").factory("PollCache",factory)}(),function(){var factory=function(){return function(){function PromiseControl(promise){_classCallCheck(this,PromiseControl),this.id=null,this._resolveCallbacks=[],this._rejectCallbacks=[],this._data=null,this._state=null,this._dropped=!1,(this._promise=promise).then(this._getPromiseCallback(!0),this._getPromiseCallback(!1))}return _createClass(PromiseControl,[{key:"promise",value:function(){return this._promise}},{key:"abort",value:function(error){this._getPromiseCallback(!1)(error)}},{key:"then",value:function(resolve,reject){var _this104=this;return new PromiseControl(new Promise(function(res,rej){_this104._resolveCallbacks.push(function(data){var result=resolve?resolve(data):data;PromiseControl.isPromise(result)?result.then(res,rej):res(result)}),_this104._rejectCallbacks.push(function(data){var result=reject?reject(data):data;PromiseControl.isPromise(result)?result.then(res,rej):rej(result)})}))}},{key:"always",value:function(cb){return this.then(cb,cb),this}},{key:"catch",value:function(callback){return this.then(null,callback)}},{key:"drop",value:function(){this._removeHandlers(),this._dropped=!0}},{key:"_getPromiseCallback",value:function(state){var _this105=this;return function(data){null===_this105._state&&(_this105._data=data,_this105._state=state,_this105._run())}}},{key:"_run",value:function(){var _this106=this;if(this._dropped||null===this._state)return null;var list=(this._state?this._resolveCallbacks:this._rejectCallbacks).slice();this._removeHandlers(),list.forEach(function(cb){return cb(_this106._data)})}},{key:"_removeHandlers",value:function(){this._rejectCallbacks=[],this._rejectCallbacks=[]}}],[{key:"isPromise",value:function(some){return some&&some.then&&"function"==typeof some.then}}]),PromiseControl}()};factory.$inject=[],angular.module("app.utils").factory("PromiseControl",factory)}(),function(){var factory=function(){return new(function(){function ReadFile(){_classCallCheck(this,ReadFile)}return _createClass(ReadFile,[{key:"read",value:function(fileBlob){var deferred=$.Deferred(),reader=new FileReader;return reader.addEventListener("error",function(error){deferred.reject(error)}),reader.addEventListener("progress",function(event){var percentLoaded=Math.min(Math.round(event.loaded/event.total*100),100);deferred.notify(percentLoaded)}),reader.addEventListener("abort",function(event){deferred.reject(event)}),reader.addEventListener("load",function(event){deferred.resolve(event.currentTarget.result)},!1),reader.readAsBinaryString(fileBlob),deferred.promise()}}]),ReadFile}())};factory.$inject=[],angular.module("app.utils").factory("readFile",factory)}(),function(){var factory=function(utils){var _class17,_temp,each=require("ts-utils").each;return _temp=_class17=function(){function Router(){_classCallCheck(this,Router),this._routesHash=Object.create(null)}return _createClass(Router,[{key:"apply",value:function(fullUrl){var _this107=this,_fullUrl$split=fullUrl.split("?"),_fullUrl$split2=_slicedToArray(_fullUrl$split,2),url=_fullUrl$split2[0],searchStr=_fullUrl$split2[1],search=utils.parseSearchParams(searchStr),parts=url.split("/"),urls=Object.keys(this._routesHash).sort(function(a,b){var reg=/:/g;return(a.match(reg)||{length:0}).length-(b.match(reg)||{length:0}).length}).map(function(url){return url.split("/")}).filter(function(routeParts){return routeParts.length===parts.length}),listener=null,params=null;return urls.some(function(routeParts){var urlParams=Object.create(null),valid=routeParts.every(function(part,i){return":"===part.charAt(0)?(urlParams[part.substr(1)]=parts[i],!0):part===parts[i]});return valid&&(params=urlParams,listener=_this107._routesHash[routeParts.join("/")]),valid}),listener?listener(params,search):null}},{key:"registerRoute",value:function(route,listener){this._routesHash[route]=listener}},{key:"registerRouteHash",value:function(hash){var _this108=this;each(hash,function(listener,url){_this108.registerRoute(url,listener)})}}]),Router}(),_class17.ROUTES={SEND:"/send",SEND_ASSET:"/send/:assetId",ASSET_INFO:"/asset/:assetId",ACCOUNT:"/account",GATEWAY_AUTH:"/gateway/auth",ANY_TX:"/tx"},_temp};factory.$inject=["utils"],angular.module("app.utils").factory("Router",factory)}(),function(){var factory=function($q,utils,migration,state,storageSelect){var usedStorage=storageSelect(),MIGRATION_MAP={"1.0.41":function(storage){return addNewGateway(storage,WavesApp.defaultAssets.BSV)},"1.2.1":function(storage){return function(storage){return storage.load("userList").then(function(){if((0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).some(function(user){return void 0===(user.settings||Object.create(null)).termsAccepted}))return storage.save("needReadNewTerms",!0)})}(storage)},"1.3.19":function(storage){return function(storage){return storage.load("userList").then(function(){var usersInStorage=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],users=usersInStorage.reduce(function(acc,user){var otherUsers=acc.filter(function(item){return item!==user});return user.name||(user.name="Account"),[].concat(_toConsumableArray(otherUsers),[_extends({},user,{name:function(arr,userName){var counter=1,num=function getNum(name){return arr.some(function(user){return user.name===name})?getNum(userName+" "+ ++counter):counter}(userName);return 1<num?userName+" "+num:userName}(otherUsers,user.name)})])},usersInStorage);return storage.save("userList",users).then(function(){return storage})})}(storage).then(function(data){return addNewGateway(data,WavesApp.defaultAssets.BNT)})}};function addNewGateway(storage,gateway){return storage.load("userList").then(function(){var users=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return users.forEach(function(user){var idList=(user.settings||Object.create(null)).pinnedAssetIdList;idList&&!idList.includes(gateway)&&idList.push(gateway)}),storage.save("userList",users)})}return new(function(){function Storage(){var _this109=this;_classCallCheck(this,Storage),usedStorage.init(),this._isNewDefer=$q.defer(),this.load("lastVersion").then(function(version){if(_this109.save("lastVersion",WavesApp.version),state.lastOpenVersion=version){var versions=migration.migrateFrom(version,Object.keys(MIGRATION_MAP));return utils.chainCall(versions.map(function(version){return MIGRATION_MAP[version].bind(null,_this109)})).then(function(){_this109._isNewDefer.resolve(version)})}return _this109._isNewDefer.resolve(version),Promise.resolve()})}return _createClass(Storage,[{key:"onReady",value:function(){return this._isNewDefer.promise}},{key:"save",value:function(key,value){return utils.when(usedStorage.write(key,value))}},{key:"load",value:function(key){return utils.when(usedStorage.read(key))}},{key:"clear",value:function(){return utils.when(usedStorage.clear())}}]),Storage}())};factory.$inject=["$q","utils","migration","state","storageSelect"],angular.module("app.utils").factory("storage",factory)}(),function(){var factory=function(){var StyleManager=function(){function StyleManager(root){_classCallCheck(this,StyleManager),this.root=root,this.stylesHash=Object.create(null)}return _createClass(StyleManager,[{key:"addStyle",value:function(path,style){this.removeStyle(path);var content="."+this.root+" "+path+" { "+this._parseStyle(style)+" }",styleTag=document.createElement("style");styleTag.innerText=content,styleTag.id=path,document.head.appendChild(styleTag),this.stylesHash[path]=styleTag}},{key:"removeStyle",value:function(path){this.hasStyle(path)&&document.head.removeChild(this.stylesHash[path])}},{key:"realStyleTransaction",value:function(path,cb){var element=this.stylesHash[path];element?(document.head.removeChild(element),cb(),document.head.appendChild(element)):cb()}},{key:"destroy",value:function(){Object.keys(this.stylesHash).forEach(this.removeStyle,this)}},{key:"hasStyle",value:function(path){return!!this.stylesHash[path]}},{key:"_parseStyle",value:function(style){var template="";return tsUtils.each(style,function(value,key){template+=(key+": "+value+";").replace(";;",";")}),template}}]),StyleManager}();return window.StyleManager=StyleManager};factory.$inject=[],angular.module("app.utils").factory("StyleManager",factory)}(),function(){var factory=function(PromiseControl){var tsUtils=require("ts-utils"),TimerList=function(){function TimerList(){_classCallCheck(this,TimerList),this.list=[]}return _createClass(TimerList,[{key:"add",value:function(item){this.list.push(item),this.list.sort(TimerList.comparator)}},{key:"remove",value:function(id){id="string"==typeof id?id:id.id;for(var i=this.list.length;i--;)if(this.list[i].id===id){this.list.splice(i,1);break}}}],[{key:"comparator",value:function(a,b){return b.start+b.timeout-(a.start+a.timeout)}}]),TimerList}();return new(function(){function TimeLine(){_classCallCheck(this,TimeLine),this._listeners=new TimerList,this._timer=null}return _createClass(TimeLine,[{key:"timeout",value:function(callback,_timeout){var start=Date.now(),id=tsUtils.uniqueId("timeLineItem"),defer=$.Deferred(),promise=new PromiseControl(defer.promise());return promise.id=id,promise.start=start,promise.time=_timeout,this._listeners.add({handler:callback,timeout:_timeout,start:start,id:id,defer:defer}),1===this._listeners.list.length&&this._addTimeout(),promise}},{key:"wait",value:function(timeout){return this.timeout(null,timeout)}},{key:"cancel",value:function(promise){if(!promise)return null;promise.drop(),this._listeners.remove(promise.id)}},{key:"_run",value:function(){if(!this._listeners.list.length)return null;for(var now=Date.now(),i=this._listeners.list.length-1;0<=i;i--){var item=this._listeners.list[i];if(item){if(!(now-item.start>=item.timeout))break;try{item.handler&&item.handler(),item.defer.resolve()}catch(e){}this._listeners.remove(item)}}this._listeners.list.length&&this._addTimeout()}},{key:"_addTimeout",value:function(){var _this110=this;this._timer&&clearTimeout(this._timer),this._timer=setTimeout(function(){_this110._timer=null,_this110._run()},200)}}]),TimeLine}())};factory.$inject=["PromiseControl"],angular.module("app.utils").factory("timeLine",factory)}(),function(){var factory=function(){return function(){function UserRouteState(base,name,child){_classCallCheck(this,UserRouteState),this.base=base,this.name=name,this.child=child}return _createClass(UserRouteState,[{key:"state",get:function(){var base=this.base+"."+this.name;return this.child?base+"."+this.child:base}}]),_createClass(UserRouteState,[{key:"applyState",value:function(state,user){return!!this._hitTest(state.name)&&(this.child=state.name.split(".")[2],user.setSetting(this.name+".activeState",this.child),!0)}},{key:"_hitTest",value:function(stateName){var _stateName$split=stateName.split("."),_stateName$split2=_slicedToArray(_stateName$split,2),base=_stateName$split2[0],name=_stateName$split2[1];return base===this.base&&name===this.name}}]),UserRouteState}()};factory.$inject=[],angular.module("app.utils").factory("UserRouteState",factory)}(),function(){var tsUtils=require("ts-utils"),factory=function(timeLine){return{readonly:function(target,key,descriptor){var origin=descriptor.value;descriptor.value=function(){for(var _len5=arguments.length,args=Array(_len5),_key5=0;_key5<_len5;_key5++)args[_key5]=arguments[_key5];var result=origin.call.apply(origin,[this].concat(args));return tsUtils.getPaths(result).forEach(function(path){Object.freeze(tsUtils.get(result,path))}),result}},scope:function(defaults){return function(target,key,descriptor){var cache=defaults||Object.create(null),origin=descriptor.value;descriptor.value=function(){for(var _len6=arguments.length,args=Array(_len6),_key6=0;_key6<_len6;_key6++)args[_key6]=arguments[_key6];return args.push(cache),origin.call.apply(origin,[this].concat(args))}}},async:function(timeout){var addTimeout=void 0,dropTimeout=void 0;return dropTimeout=timeout?(addTimeout=function(cb){return setTimeout(cb,timeout)},clearTimeout):(addTimeout=requestAnimationFrame,cancelAnimationFrame),function(target,key,descriptor){var origin=descriptor.value;descriptor.value=function(){for(var _this111=this,_len7=arguments.length,args=Array(_len7),_key7=0;_key7<_len7;_key7++)args[_key7]=arguments[_key7];this["__"+key+"_timer"]&&dropTimeout(this["__"+key+"_timer"]),this["__"+key+"_timer"]=addTimeout(function(){_this111["__"+key+"_timer"]=null,origin.call.apply(origin,[_this111].concat(args))})}}},cachable:function(time,toString){return function(target,key,descriptor){var origin=descriptor.value,cache=Object.create(null),timeout=1e3*time;descriptor.value=0<time?function(){for(var _len8=arguments.length,args=Array(_len8),_key8=0;_key8<_len8;_key8++)args[_key8]=arguments[_key8];var key=toString?toString(args):stringify(args);return cache[key]||(cache[key]=Object.create(null),cache[key].value=origin.call.apply(origin,[this].concat(args)),cache[key].value&&cache[key].value.then&&"function"==typeof cache[key].value.then?cache[key].value.then(function(){cache[key].timer=timeLine.timeout(function(){delete cache[key]},timeout)},function(){timeLine.cancel(cache[key].timer),delete cache[key]}):cache[key].timer=timeLine.timeout(function(){delete cache[key]},timeout)),cache[key].value}:function(){for(var _len9=arguments.length,args=Array(_len9),_key9=0;_key9<_len9;_key9++)args[_key9]=arguments[_key9];var key=toString?toString(args):stringify(args);return cache[key]||(cache[key]=origin.call.apply(origin,[this].concat(args))),cache[key]}}}}};function stringify(some){try{return JSON.stringify(some)}catch(e){return String(some)}}factory.$inject=["timeLine"],angular.module("app.utils").factory("decorators",factory)}(),function(){var factory=function(waves){var _VALIDATOR,VALIDATOR=(_defineProperty(_VALIDATOR={},WavesApp.defaultAssets.BTC,/^([13][a-km-zA-HJ-NP-Z1-9]{25,34}|(bc1)[a-z0-9]{25,90})$/),_defineProperty(_VALIDATOR,WavesApp.defaultAssets.ETH,/^0x[0-9a-f]{40}$/i),_defineProperty(_VALIDATOR,WavesApp.defaultAssets.LTC,/^[LM3][a-km-zA-HJ-NP-Z1-9]{26,33}$/),_defineProperty(_VALIDATOR,WavesApp.defaultAssets.ZEC,/^t[0-9a-z]{34}$/i),_defineProperty(_VALIDATOR,WavesApp.defaultAssets.BCH,/^([13][a-km-zA-HJ-NP-Z1-9]{25,34}|[qp][a-zA-Z0-9]{41})$/),_defineProperty(_VALIDATOR,WavesApp.defaultAssets.BSV,/^([13][a-km-zA-HJ-NP-Z1-9]{25,34}|[qp][a-zA-Z0-9]{41})$/),_defineProperty(_VALIDATOR,WavesApp.defaultAssets.DASH,/^X[a-km-zA-HJ-NP-Z1-9]{25,34}$/),_defineProperty(_VALIDATOR,WavesApp.defaultAssets.XMR,/^([a-km-zA-HJ-NP-Z1-9]{95}|[a-km-zA-HJ-NP-Z1-9]{106})$/),_defineProperty(_VALIDATOR,WavesApp.defaultAssets.VST,function(address){return waves.node.isValidAddressWithNetworkByte(address,WavesApp.network.VSTNetworkByte)}),_defineProperty(_VALIDATOR,WavesApp.defaultAssets.ERGO,/^9[a-km-zA-HJ-NP-Z1-9]{5,}$/),_defineProperty(_VALIDATOR,WavesApp.defaultAssets.BNT,/^0x[0-9a-f]{40}$/i),_VALIDATOR);return Object.keys(VALIDATOR).reduce(function(result,key){return result[key]={isValidAddress:function(string){return"function"==typeof VALIDATOR[key]?VALIDATOR[key](string):VALIDATOR[key].test(string)}},result},Object.create(null))};factory.$inject=["waves"],angular.module("app.utils").factory("outerBlockchains",factory)}(),function(){var _Object$assign,_require22=require("ts-utils"),isEmpty=_require22.isEmpty,getPaths=_require22.getPaths,get=_require22.get,Signal=_require22.Signal,tsApiValidator=require("ts-api-validator"),_require23=require("ramda"),splitEvery=_require23.splitEvery,pipe=_require23.pipe,path=_require23.path,map=_require23.map,ifElse=_require23.ifElse,concat=_require23.concat,defaultTo=_require23.defaultTo,identity=_require23.identity,isNil=_require23.isNil,propEq=_require23.propEq,_require24=require("@waves/waves-browser-bus"),WindowAdapter=_require24.WindowAdapter,Bus=_require24.Bus,_libs$crypto2=require("@waves/waves-transactions").libs.crypto,base58Decode=_libs$crypto2.base58Decode,base58Encode=_libs$crypto2.base58Encode,stringToBytes=_libs$crypto2.stringToBytes,bytesToString=_libs$crypto2.bytesToString,ds=require("data-service"),SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,Money=require("@waves/data-entities").Money,STATUS_LIST=require("@waves/oracle-data").STATUS_LIST,BigNumber=require("@waves/bignumber").BigNumber,GOOD_COLORS_LIST=["#39a12c","#6a737b","#e49616","#008ca7","#ff5b38","#ff6a00","#c74124","#00a78e","#b01e53","#e0c61b","#5a81ea","#72b7d2","#a5b5c3","#81c926","#86a3bd","#c1d82f","#5c84a8","#267e1b","#fbb034","#ff846a","#47c1ff","#00a0af","#85d7c6","#8a7967","#26c1c9","#72d28b","#5B1909","#264764","#270774","#8763DE","#F04085","#1E6AFD","#FF1E43","#D3002D","#967400","#264163"],DEFAULT_ASSET_ICONS_MAP=Object.assign(Object.create(null),(_defineProperty(_Object$assign={},WavesApp.defaultAssets.WAVES,"/img/assets/waves.svg"),_defineProperty(_Object$assign,WavesApp.defaultAssets.BTC,"/img/assets/bitcoin.svg"),_defineProperty(_Object$assign,WavesApp.defaultAssets.ETH,"/img/assets/ethereum.svg"),_defineProperty(_Object$assign,WavesApp.defaultAssets.LTC,"/img/assets/ltc.svg"),_defineProperty(_Object$assign,WavesApp.defaultAssets.ZEC,"/img/assets/zec.svg"),_defineProperty(_Object$assign,WavesApp.defaultAssets.EUR,"/img/assets/euro.svg"),_defineProperty(_Object$assign,WavesApp.defaultAssets.USD,"/img/assets/usd.svg"),_defineProperty(_Object$assign,WavesApp.defaultAssets.DASH,"/img/assets/dash.svg"),_defineProperty(_Object$assign,WavesApp.defaultAssets.BCH,"/img/assets/bitcoin-cash.svg"),_defineProperty(_Object$assign,WavesApp.defaultAssets.BSV,"/img/assets/bitcoin-cash-sv.svg"),_defineProperty(_Object$assign,WavesApp.defaultAssets.TRY,"/img/assets/try.svg"),_defineProperty(_Object$assign,WavesApp.defaultAssets.XMR,"/img/assets/xmr.svg"),_defineProperty(_Object$assign,WavesApp.defaultAssets.VST,"/img/assets/vostok.svg"),_defineProperty(_Object$assign,WavesApp.defaultAssets.ERGO,"/img/assets/ergo.svg"),_defineProperty(_Object$assign,WavesApp.defaultAssets.BNT,"/img/assets/bnt.svg"),_defineProperty(_Object$assign,WavesApp.otherAssetsWithIcons.EFYT,"/img/assets/efyt.svg"),_defineProperty(_Object$assign,WavesApp.otherAssetsWithIcons.WNET,"/img/assets/wnet.svg"),_Object$assign)),nullOrCb=function(name,cb){return function(val1,val2){var v1=val1[name],v2=val2[name];return v1===v2&&null==v1?null:cb(v1,v2)}},valOrNullOpen=function(v1,v2){return null==v1?v2:v1},valOrNullClose=function(v1,v2){return valOrNullOpen(v2,v1)},joinCandles=function(_ref27){var _ref28=_slicedToArray(_ref27,2),c1=_ref28[0],_ref28$=_ref28[1],c2=void 0===_ref28$?c1:_ref28$;return{txsCount:c1.txsCount+c2.txsCount,high:function(name){return nullOrCb(name,function(v1,v2){return Math.max(v1||0,v2||0)})}("high")(c1,c2),low:function(name){return nullOrCb(name,function(v1,v2){return null==v1?v2:null==v2?v1:Math.min(v1,v2)})}("low")(c1,c2),close:nullOrCb("close",valOrNullClose)(c1,c2),open:nullOrCb("open",valOrNullOpen)(c1,c2),volume:function(name){return nullOrCb(name,function(v1,v2){return null==v1?v2:null==v2?v1:v1+v2})}("volume")(c1,c2),time:c1.time}},INTERVAL_PRESETS={"1m":6e4,"5m":3e5,"15m":9e5,"30m":18e5,"1h":36e5,"3h":108e5,"6h":216e5,"12h":432e5,"1d":864e5},INTERVAL_MAP={1:{interval:INTERVAL_PRESETS["1m"],intervalName:"1m",converter:function(el){return el}},5:{interval:INTERVAL_PRESETS["5m"],intervalName:"5m",converter:function(el){return el}},15:{interval:INTERVAL_PRESETS["15m"],intervalName:"15m",converter:function(el){return el}},30:{interval:INTERVAL_PRESETS["30m"],intervalName:"30m",converter:function(el){return el}},60:{interval:INTERVAL_PRESETS["1h"],intervalName:"1h",converter:function(el){return el}},120:{interval:INTERVAL_PRESETS["1h"],intervalName:"1h",converter:function(candles){return splitEvery(2,candles).map(joinCandles)}},180:{interval:INTERVAL_PRESETS["3h"],intervalName:"3h",converter:function(el){return el}},240:{interval:INTERVAL_PRESETS["1h"],intervalName:"1h",converter:pipe(splitEvery(2),map(joinCandles),splitEvery(2),map(joinCandles))},360:{interval:INTERVAL_PRESETS["6h"],intervalName:"6h",converter:function(el){return el}},720:{interval:INTERVAL_PRESETS["12h"],intervalName:"12h",converter:function(el){return el}},1440:{interval:INTERVAL_PRESETS["1d"],intervalName:"1d",converter:function(el){return el}}},IMPORT_PRIORITY_MAP={seed:0,key:0,wavesKeeper:1,ledger:2},BigNumberPart=function(){function BigNumberPart(){return _classCallCheck(this,BigNumberPart),_possibleConstructorReturn(this,(BigNumberPart.__proto__||Object.getPrototypeOf(BigNumberPart)).apply(this,arguments))}return _inherits(BigNumberPart,tsApiValidator.BasePart),_createClass(BigNumberPart,[{key:"getValue",value:function(data){switch(void 0===data?"undefined":_typeof(data)){case"string":case"number":return new BigNumber(data);default:return null}}}]),BigNumberPart}(),factory=function($q,Moment,$injector){var base58ToBytes=base58Decode,bytesToBase58=base58Encode,utils={apiValidatorParts:{BigNumberPart:BigNumberPart},getAssetLogo:function(assetId){return DEFAULT_ASSET_ICONS_MAP[assetId]},getAssetLogoBackground:function(assetId){var sum=assetId.split("").map(function(char){return char.charCodeAt(0)}).reduce(function(acc,code){return acc+code},0);return GOOD_COLORS_LIST[sum%GOOD_COLORS_LIST.length]},getImportPriorityMap:function(){return IMPORT_PRIORITY_MAP},base58ToBytes:pipe(defaultTo(""),base58ToBytes),base58ToString:pipe(defaultTo(""),base58ToBytes,bytesToString),stringToBytes:pipe(defaultTo(""),stringToBytes),stringToBase58:pipe(defaultTo(""),String,stringToBytes,bytesToBase58),bytesToBase58:pipe(defaultTo(new Uint8Array([])),bytesToBase58),bytesToString:pipe(defaultTo(new Uint8Array([])),bytesToString),bytesToSafeString:ifElse(pipe(identity,bytesToString,isNil),pipe(identity,bytesToBase58,concat("base58:")),pipe(identity,bytesToString)),removeUrlProtocol:function(url){return url.replace(/.+?(:\/\/)/,"")},getUrlForRoute:function(url){url=decodeURI(url||location.href);return pipe(utils.removeUrlProtocol,function(url){return url.includes("#")?url.slice(url.indexOf("#")).replace("#","/"):""})(url)},getRouterParams:function(url){var Router=$injector.get("Router"),router=new Router;return Object.keys(Router.ROUTES).forEach(function(name){var handler=function(name){return function(){var params=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Object.create(null),search=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Object.create(null),url=Router.ROUTES[name];return{name:name,url:url,data:_extends({},params,search)}}}(name);router.registerRoute(Router.ROUTES[name],handler)}),router.apply(url)},createQS:function(obj){var createKeyValue=function(key,v){return key+"="+function(v){switch(!0){case v instanceof Date:return v.getTime();default:return encodeURIComponent(v)}}(v)},qs=Object.entries(obj).filter(function(_ref29){var _ref30=_slicedToArray(_ref29,2);_ref30[0];return void 0!==_ref30[1]}).map(function(_ref31){var _ref32=_slicedToArray(_ref31,2),key=_ref32[0],value=_ref32[1];return Array.isArray(value)?function(key,values){return values.map(function(v){return createKeyValue(key+"[]",v)}).join("&")}(key,value):createKeyValue(key,value)}).join("&");return""===qs?qs:"?"+qs},observe:function(target,keys,options){return function(target,keys,options){var observer=function(target){if(!target.__){var observer=Object.create(null);Object.defineProperty(target,"__",{writable:!1,configurable:!1,enumerable:!1,value:observer})}return target.__}(target);return options=options||Object.create(null),utils.toArray(keys).forEach(function(key){if(observer[key])return null;var item=Object.create(null);item.signal=new Signal,item.timer=null,item.value=target[key];var originalDescriptor=function(target,key){var descriptor=Object.getOwnPropertyDescriptor(target,key);if(descriptor)return descriptor;if(target.constructor&&target.constructor!==Object.constructor&&target.constructor.prototype)return Object.getOwnPropertyDescriptor(target.constructor.prototype,key);return null}(target,key);if(observer[key]=item,originalDescriptor&&originalDescriptor.get){var descriptor={enumerable:originalDescriptor.enumerable,get:originalDescriptor.get};originalDescriptor.set?descriptor.set=function(value){var prev=originalDescriptor.get.call(target);isNotEqualValue(prev,value)&&(originalDescriptor.set.call(target,value),observer[key].signal.dispatch({value:value,prev:prev}))}:descriptor.set=function(){throw new Error("Original descriptor has't set property!")},Object.defineProperty(target,key,descriptor)}else Object.defineProperty(target,key,{enumerable:!0,get:function(){return observer[key].value},set:function(value){value=options.set?options.set(value):value;var prev=observer[key].value;isNotEqualValue(prev,value)&&(observer[key].value=value,observer[key].signal.dispatch({value:value,prev:prev}))}})}),function(observer,keys){{if(Array.isArray(keys)){var event=keys.sort(utils.comparators.asc).join(",");return observer.__events||(observer.__events=Object.create(null)),observer.__events[event]||(observer.__events[event]=new Signal,keys.forEach(function(key){observer[key].signal.on(function(){observer.__events[event].dispatch()})})),observer.__events[event]}return observer[keys].signal}}(observer,keys)}(target,keys,options)},getPublicKeysFromScript:function(script){return(script.match(/ByteVector\(\d+\sbytes,\s(.[^)]+)/g)||[]).map(function(res){return res.replace(/ByteVector\(\d+\sbytes,\s0x/,"")}).map(function(key){return splitEvery(2,key).map(function(byte16){return parseInt(byte16,16)})}).map(base58Encode)},debounce:function(callback,timeout){var control={queued:!1,args:null};return function(){for(var _this113=this,_len10=arguments.length,args=Array(_len10),_key10=0;_key10<_len10;_key10++)args[_key10]=arguments[_key10];control.args=args,control.queued||setTimeout(function(){control.queued=!1,callback.call.apply(callback,[_this113].concat(_toConsumableArray(control.args)))},timeout),control.queued=!0}},timeoutPromise:function(promise,timeout){var timer=void 0,timeoutPromise=new Promise(function(_,reject){timer=setTimeout(function(){reject(new Error("Timeout error!"))},timeout)});return promise.finally(function(){clearTimeout(timer)}),Promise.race([promise,timeoutPromise])},parseElectronUrl:function(url){var _url$split=url.split("#"),_url$split2=_slicedToArray(_url$split,2),pathAndSearch=_url$split2[0],hash=_url$split2[1],_pathAndSearch$split=pathAndSearch.split("?"),_pathAndSearch$split2=_slicedToArray(_pathAndSearch$split,2);return{path:_pathAndSearch$split2[0],search:"?"+(_pathAndSearch$split2[1]||""),hash:"#"+(hash||"")}},redirect:function(url){WavesApp.isDesktop()?window.openInBrowser(url):location.href=url},parseSearchParams:function(argument_0){var search=0<arguments.length&&void 0!==argument_0?argument_0:"",hashes=search.slice(search.indexOf("?")+1).split("&").filter(Boolean),params=Object.create(null),normalizeValue=function(value){if("null"===value)return null;var num=Number(value);return String(num)===value?num:value};return hashes.forEach(function(hash){var _hash$split=hash.split("="),_hash$split2=_slicedToArray(_hash$split,2),key=_hash$split2[0],val=_hash$split2[1];key.includes("[]")?function(name,value){var key=name.replace("[]","");params[key]||(params[key]=[]),params[key].push(normalizeValue(decodeURIComponent(value)))}(key,val):function(name,value){params[name]=null==value||normalizeValue(decodeURIComponent(value))}(key,val)}),params},debounceRequestAnimationFrame:function(callback){var control={queued:!1,args:null};return function(){for(var _this114=this,_len11=arguments.length,args=Array(_len11),_key11=0;_key11<_len11;_key11++)args[_key11]=arguments[_key11];control.args=args,control.queued||requestAnimationFrame(function(){control.queued=!1,callback.call.apply(callback,[_this114].concat(_toConsumableArray(control.args)))}),control.queued=!0}},animate:function($element,properties,options){return new Promise(function(resolve){if((options=options||Object.create(null)).complete){var origin=options.complete;options.complete=function(){resolve(),origin()}}else options.complete=resolve;$element.stop(!0,!0).animate(properties,options)})},animateTransform:function($element,to){var prefixis=["","-ms-","-moz-","-o-","-webkit-"];return $q(function(resolve){var from_x=0,from_y=0;$element.stop(!0,!0).animate({},{progress:function(tween,_progress){var x=(to.x-from_x)*_progress+from_x,y=(to.y-from_y)*_progress+from_y;prefixis.forEach(function(prefix){$element.css(prefix+"transform","translate("+x+"px, "+y+"px)")})},complete:resolve,duration:300})})},animateByClass:function($element,className,state,stopProperty){return $q(function(resolve){var element=$element.get(0),eventList=["transitionend","oTransitionEnd","otransitionend","webkitTransitionEnd"];if(element.classList.contains(className)===state)return resolve(),null;function handler(e){e.currentTarget!==element||stopProperty&&e.propertyName!==stopProperty||(resolve(),eventList.forEach(function(eventName){element.removeEventListener(eventName,handler,!1)}))}eventList.forEach(function(eventName){element.addEventListener(eventName,handler,!1)}),$element.toggleClass(className,state)})},safeApply:function($scope){var phase=$scope.$root.$$phase;"$apply"!==phase&&"$digest"!==phase&&$scope.$apply()},postDigest:function($scope){return new Promise(function(resolve){$scope.$parent.$$postDigest(resolve)})},when:function(data){return this.isPromise(data)?data:Promise.resolve(data)},isPromise:function(data){return data&&data.then&&"function"==typeof data.then},whenAll:function(promises){return utils.when(Promise.all(promises))},getMoneyWithoutFee:function(money,fee){return fee&&money.asset.id===fee.asset.id?money.sub(fee):money},isEqual:function(a,b){var typeA=void 0===a?"undefined":_typeof(a);if(typeA!==(void 0===b?"undefined":_typeof(b)))return!1;if("object"!==typeA)return a===b;if(a instanceof Money&&b instanceof Money)return a.asset.id===b.asset.id&&a.eq(b);if(a instanceof BigNumber&&b instanceof BigNumber)return a.eq(b);var pathsA=getPaths(a),pathsB=getPaths(b);return pathsA.length===pathsB.length&&pathsA.every(function(path,index){return get(a,path)===get(b,path)&&String(path)===String(pathsB[index])})},bind:function(target,keys){if(null==keys)if(0===(keys=Object.keys(target).filter(function(name){return"function"==typeof target[name]})).length){var proto=Object.getPrototypeOf(target);keys=Object.getOwnPropertyNames(proto).filter(function(method){return"_"!==method.charAt(0)&&"constructor"!==method})}else keys=keys.filter(function(key){return"function"==typeof target[key]});else keys=Array.isArray(keys)?keys:[keys];return keys.forEach(function(key){target[key]=target[key].bind(target)}),target},resolve:function(promiseLike){var getCallback=function(state,resolve){return function(data){return resolve({state:state,data:data})}};return new Promise(function(resolve){promiseLike.then(getCallback(!0,resolve),getCallback(!1,resolve))})},moment:function(date,pattern){return date instanceof Moment?date.clone(pattern):new Moment(date,pattern)},loadImage:function(url){return new Promise(function(resolve,reject){var img=new Image;img.onload=resolve,img.onerror=reject,img.src=url})},getNiceNumber:function(num,precision){switch(void 0===num?"undefined":_typeof(num)){case"string":case"number":return new BigNumber(num,10).toFormat(precision&&Number(precision));case"object":if(null!=num)return num.toFormat(precision&&Number(precision));throw new Error("Wrong format!");default:throw new Error("Wrong format!")}},parseNiceNumber:function(data){if(data instanceof BigNumber)return data;var num=new BigNumber(String(data).replace(",","").replace(/\s/g,"")||0,10);return num.isNaN()?new BigNumber(0):num},loadOrTimeout:function(target,timeout){return new Promise(function(resolve,reject){target.addEventListener("load",resolve,!1),target.addEventListener("error",reject,!1),setTimeout(function(){reject(new Error("Timeout limit error!"))},timeout)})},importUsersByWindow:function(win,origin,timeout){return new Promise(function(resolve,reject){WindowAdapter.createSimpleWindowAdapter(win,{origins:[origin]}).then(function(adapter){var bus=new Bus(adapter);bus.once("ready",function(){bus.request("getLocalStorageData",null,timeout).then(utils.onExportUsers(origin,resolve)).catch(reject)}),bus.request("getLocalStorageData",null,timeout).then(utils.onExportUsers(origin,resolve)).catch(reject)})})},importAccountByIframe:function(origin,timeout){var iframe=document.createElement("iframe"),remove=function(){iframe.parentNode&&document.body.removeChild(iframe)};iframe.src=origin+"/export.html";var result=utils.loadOrTimeout(iframe,timeout).then(function(){return utils.importUsersByWindow(iframe,origin,timeout)}).then(function(data){return remove(),Promise.resolve(data)}).catch(function(error){return remove(),Promise.reject(error)});return iframe.style.opacity="0",iframe.style.position="absolute",iframe.style.left="0",iframe.style.top="0",document.body.appendChild(iframe),result},importAccountByTab:function(origin,timeout){var left="left="+Math.floor(screen.width-50),right="top="+Math.floor(screen.height-50),closed=!1,win=window.open(origin+"/export.html","export","width=100,height=100,"+left+","+top+","+right+",no,no,no,no,no,no"),close=function(d){return closed||(win.close(),closed=!0),d};return utils.importUsersByWindow(win,origin,timeout).then(close).catch(function(e){return close(),Promise.reject(e)})},onExportUsers:function(origin,resolve){return function(response){response||resolve([]),resolve(response)}},openDex:function(asset1,asset2,argument_2){var dex=2<arguments.length&&void 0!==argument_2?argument_2:"dex",$state=$injector.get("$state");if(asset1&&asset2)return asset1===asset2?utils.openDex(asset1):(setTimeout(function(){$state.go("main."+dex,{assetId1:asset1,assetId2:asset2})},50),null);asset2=asset1===WavesApp.defaultAssets.WAVES?WavesApp.defaultAssets.BTC:WavesApp.defaultAssets.WAVES,setTimeout(function(){$state.go("main."+dex,{assetId1:asset1,assetId2:asset2})},50)},getValidCandleOptions:function(from,to,argument_2){var interval=2<arguments.length&&void 0!==argument_2?argument_2:60;from=6e4*Math.floor(from/6e4),to=6e4*Math.ceil(to/6e4);var config=INTERVAL_MAP[interval],options={timeStart:from instanceof Date?from.getTime():from,timeEnd:to instanceof Date?to.getTime():to,interval:interval};options.timeEnd-options.timeStart<config.interval&&(options.timeStart=options.timeEnd-config.interval);for(var intervals=[],newInterval={timeStart:options.timeStart,interval:config.intervalName};newInterval.timeStart<=options.timeEnd;)newInterval.timeEnd=Math.min(options.timeEnd,newInterval.timeStart+1440*config.interval),intervals.push(_extends({},newInterval)),newInterval.timeStart=newInterval.timeEnd+config.interval;return{options:intervals,config:config}},getMaxInterval:function(from,to,argument_2){var amount=2<arguments.length&&void 0!==argument_2?argument_2:100,delta=to-from,findDif=function(interval){return Math.abs(delta/interval-amount)},intObj=Object.values(INTERVAL_MAP).reduce(function(prev,cur){return findDif(cur.interval)<findDif(prev.interval)?cur:prev});return Object.keys(INTERVAL_MAP).find(function(key){return INTERVAL_MAP[key].interval===intObj.interval})},getNiceNumberTemplate:function(num,precision,shortMode){var bigNum=this.parseNiceNumber(num),formatted=this.getNiceNumber(bigNum,precision),minValue="number"==typeof shortMode?shortMode:1e4;if(("number"==typeof shortMode||shortMode)&&bigNum.gte(minValue))return this.getNiceBigNumberTemplate(bigNum);var separatorDecimal=WavesApp.getLocaleData().separators.decimal,_formatted$split=formatted.split(separatorDecimal),_formatted$split2=_slicedToArray(_formatted$split,2),int=_formatted$split2[0],decimal=_formatted$split2[1];return decimal?'<span class="int">'+int+'</span><span class="decimal">'+function(decimal,separator){var mute=[];decimal.split("").reverse().some(function(char){return"0"!==char||(mute.push(0),!1)});var end=decimal.length-mute.length;if(end)return""+separator+decimal.substr(0,end)+'<span class="decimal-muted">'+mute.join("")+"</span>";return'<span class="decimal-muted">'+separator+mute.join("")+"</span>"}(decimal,separatorDecimal)+"</span>":'<span class="int">'+int+"</span>"},getNiceBigNumberTemplate:function(bigNum){var i18n=$injector.get("i18n"),stringNum=void 0,postfix=void 0;return postfix=bigNum.gte(1e6)?(stringNum=bigNum.div(1e6).toFormat(1),i18n.translate("number.short.million")):(stringNum=bigNum.div(1e3).toFormat(1),i18n.translate("number.short.thousand")),""+stringNum+postfix},getDataFromOracles:function(assetId){var user=$injector.get("user"),dataOracle=ds.dataManager.getOraclesAssetData(assetId),isGateway=3===path(["status"],dataOracle),isTokenomica=path(["status"],dataOracle)===STATUS_LIST.VERIFIED&&"Tokenomica"===path(["provider"],dataOracle),isVerified=path(["status"],dataOracle)===STATUS_LIST.VERIFIED&&"Tokenomica"!==path(["provider"],dataOracle),isSuspicious=user.scam[assetId],isGatewaySoon=4===path(["status"],dataOracle),hasLabel=isVerified||isGateway||isSuspicious||isTokenomica||isGatewaySoon,ticker=path(["ticker"],dataOracle),link=path(["link"],dataOracle),email=path(["email"],dataOracle),logo=path(["logo"],dataOracle);return{isVerified:isVerified,isGateway:isGateway,isTokenomica:isTokenomica,isSuspicious:isSuspicious,isGatewaySoon:isGatewaySoon,hasLabel:hasLabel,ticker:ticker,link:link,email:email,provider:isVerified||isTokenomica&&path(["provider"],dataOracle)||null,description:path(["description","en"],dataOracle),logo:logo}},toArray:function(some){return Array.isArray(some)?some:[some]},toHash:function(list,key){return list.reduce(function(result,item){return result[get(item,key)]=item,result},Object.create(null))},groupMoney:function(moneyList){return moneyList.filter(Boolean).reduce(function(result,money){return result[money.asset.id]?result[money.asset.id]=result[money.asset.id].add(money):result[money.asset.id]=money,result},Object.create(null))},wait:function(time){return $q(function(resolve){time?setTimeout(resolve,time):requestAnimationFrame(resolve)})},addUniqueToArray:function(list,array){list.forEach(function(item){-1===array.indexOf(item)&&array.push(item)})},parseAngularParam:function(attribute,$scope,destroy){var exp=function(value){if(!value)return!1;var openIndex=value.indexOf("{{"),closeIndex=value.indexOf("}}");return-1!==openIndex&&-1!==closeIndex&&openIndex<closeIndex}(attribute)&&attribute,change=new Signal,result=utils.liteObject({attribute:attribute,exp:exp,change:change,value:null});if(exp)if(-1!==exp.indexOf("::"))result.value=$scope.$eval(exp.replace("::","").replace(/{{(.*)?(}})/,"$1"));else{var stop=$scope.$watch(exp,function(value){result.value=value,change.dispatch(value)});destroy.once(function(){stop()})}else result.value=attribute;return result},liteObject:function(props){var result=Object.create(null);return Object.assign(result,props),result},filterOrderBookByCharCropRate:function(data){var _getOrderBookRangeByC=this.getOrderBookRangeByCropRate(data),min=_getOrderBookRangeByC.min,max=_getOrderBookRangeByC.max;return min&&max?{asks:data.asks.filter(function(ask){return new BigNumber(ask.price).lte(max)}),bids:data.bids.filter(function(bid){return new BigNumber(bid.price).gte(min)})}:{bids:[],asks:[]}},cache:function(storage,fetch,toId,time,fromList){return function(data){var list=utils.toArray(data),toRequest=[],promiseList=[];list.forEach(function(item){var id=toId(item);storage[id]?promiseList.push(storage[id].then(fromList(item))):toRequest.push(item)});var promise=void 0;return toRequest.length?(promise=fetch(toRequest),toRequest.forEach(function(item){var id=toId(item);storage[id]=promise,setTimeout(function(){delete storage[id]},time)}),Promise.all([promise].concat(promiseList)).then(function(){for(var _len12=arguments.length,list=Array(_len12),_key12=0;_key12<_len12;_key12++)list[_key12]=arguments[_key12];return list.reduce(function(acc,i){return acc.concat.apply(acc,_toConsumableArray(i))},[])})):Promise.all(promiseList)}},parseError:function(error){try{return"string"==typeof error?JSON.parse(error).message:error}catch(e){return error}},getOrderBookRangeByCropRate:function(data){if(!(data.asks&&data.asks.length&&data.bids&&data.bids.length))return{min:null,max:null};var spreadPrice=new BigNumber(data.asks[0].price).add(data.bids[0].price).div(2),delta=spreadPrice.mul(data.chartCropRate).div(2),max=spreadPrice.add(delta);return{min:BigNumber.max(0,spreadPrice.sub(delta)),max:max}},chainCall:function(functionList){return new Promise(function(resolve,reject){var callList=functionList.slice().reverse();!function apply(){if(callList.length){var result=callList.pop()();result&&result.then&&"function"==typeof result.then?result.then(apply,reject):apply()}else resolve()}()})},getEventInfo:function(event){return"changedTouches"in event.originalEvent?_extends({},event,{pageX:event.changedTouches[0].pageX,pageY:event.changedTouches[0].pageY,screenX:event.changedTouches[0].screenX,screenY:event.changedTouches[0].screenY,clientX:event.changedTouches[0].clientX,clientY:event.changedTouches[0].clientY}):_extends({},event,{pageX:event.pageX,pageY:event.pageY,screenX:event.screenX,screenY:event.screenY,clientX:event.clientX,clientY:event.clientY})},comparators:{asc:function(a,b){return null==a?null==b?0:-1:null==b?1:b<a?1:a===b?0:-1},desc:function(a,b){return null==a?null==b?0:1:null==b?-1:b<a?-1:a===b?0:1},bigNumber:{asc:function(a,b){return a.gt(b)?1:a.eq(b)?0:-1},desc:function(a,b){return a.gt(b)?-1:a.eq(b)?0:1}},money:{asc:function(a,b){return utils.comparators.bigNumber.asc(a.getTokens(),b.getTokens())},desc:function(a,b){return utils.comparators.bigNumber.desc(a.getTokens(),b.getTokens())}},smart:{asc:function(a,b){return a instanceof Money&&b instanceof Money?utils.comparators.money.asc(a,b):a instanceof BigNumber&&b instanceof BigNumber?utils.comparators.bigNumber.asc(a,b):utils.comparators.asc(a,b)},desc:function(a,b){return a instanceof Money&&b instanceof Money?utils.comparators.money.desc(a,b):a instanceof BigNumber&&b instanceof BigNumber?utils.comparators.bigNumber.desc(a,b):utils.comparators.desc(a,b)}},process:function(processor){return{asc:function(a,b){return utils.comparators.asc(processor(a),processor(b))},desc:function(a,b){return utils.comparators.desc(processor(a),processor(b))},bigNumber:{asc:function(a,b){return utils.comparators.bigNumber.asc(processor(a),processor(b))},desc:function(a,b){return utils.comparators.bigNumber.desc(processor(a),processor(b))}},money:{asc:function(a,b){return utils.comparators.money.asc(processor(a),processor(b))},desc:function(a,b){return utils.comparators.money.desc(processor(a),processor(b))}},smart:{asc:function(a,b){return utils.comparators.smart.asc(processor(a),processor(b))},desc:function(a,b){return utils.comparators.smart.desc(processor(a),processor(b))}}}}},remapOldClientAccounts:function(account){return{name:account.name,address:account.address,encryptedSeed:account.cipher,settings:{encryptionRounds:1e3}}},getExchangeTotalPrice:function(amount,price){var amountTokens=amount.getTokens(),priceTokens=price.getTokens(),precision=price.asset.precision;return amountTokens.mul(priceTokens).toFormat(precision)},getExchangeFee:function(tx){return tx.exchangeType===WavesApp.TRANSACTION_TYPES.EXTENDED.EXCHANGE_BUY?tx.buyMatcherFee:tx.sellMatcherFee},getTransactionTypeName:function(tx){var TYPES=WavesApp.TRANSACTION_TYPES.EXTENDED,SPONSOR_START=TYPES.SPONSORSHIP_START,SPONSOR_STOP=TYPES.SPONSORSHIP_STOP;switch(tx.type){case SIGN_TYPE.TRANSFER:return function(tx){var meIsSender=isEmpty(tx.senderPublicKey)||utils.isMyPublicKey(tx.senderPublicKey),meIsRecipient=utils.isMyAddressOrAlias(tx.recipient),TYPES=WavesApp.TRANSACTION_TYPES.EXTENDED;return meIsSender||meIsRecipient?meIsSender&&meIsRecipient?TYPES.CIRCULAR:meIsSender?TYPES.SEND:TYPES.RECEIVE:TYPES.SPONSORSHIP_FEE}(tx);case SIGN_TYPE.MASS_TRANSFER:return utils.isMyPublicKey(tx.senderPublicKey)?TYPES.MASS_SEND:TYPES.MASS_RECEIVE;case SIGN_TYPE.EXCHANGE:return utils.typOfExchange(tx);case SIGN_TYPE.LEASE:return utils.isMyPublicKey(tx.senderPublicKey)?TYPES.LEASE_OUT:TYPES.LEASE_IN;case SIGN_TYPE.CANCEL_LEASING:return TYPES.CANCEL_LEASING;case SIGN_TYPE.CREATE_ALIAS:return TYPES.CREATE_ALIAS;case SIGN_TYPE.ISSUE:return TYPES.ISSUE;case SIGN_TYPE.REISSUE:return TYPES.REISSUE;case SIGN_TYPE.BURN:return TYPES.BURN;case SIGN_TYPE.DATA:return function(tx){var _WavesApp$TRANSACTION=WavesApp.TRANSACTION_TYPES.EXTENDED,DATA=_WavesApp$TRANSACTION.DATA,DATA_VOTE=_WavesApp$TRANSACTION.DATA_VOTE,keyRating=(Array.isArray(tx.data)?tx.data:tx.data.data).find(propEq("key","tokenRating"));return keyRating&&"tokenRating"===keyRating.value?DATA_VOTE:DATA}(tx);case SIGN_TYPE.SET_SCRIPT:return(tx.script||"").replace("base64:","")?TYPES.SET_SCRIPT:TYPES.SCRIPT_CANCEL;case SIGN_TYPE.SPONSORSHIP:return tx.minSponsoredAssetFee.getCoins().gt(0)?SPONSOR_START:SPONSOR_STOP;case SIGN_TYPE.SET_ASSET_SCRIPT:return TYPES.SET_ASSET_SCRIPT;case SIGN_TYPE.SCRIPT_INVOCATION:return TYPES.SCRIPT_INVOCATION;default:return TYPES.UNKNOWN}},typOfExchange:function(_ref33){var exchangeType=_ref33.exchangeType,TYPES=WavesApp.TRANSACTION_TYPES.EXTENDED;return"buy"===exchangeType?TYPES.EXCHANGE_BUY:TYPES.EXCHANGE_SELL},isMyPublicKey:function(publicKey){var user=$injector.get("user");return!publicKey||user.publicKey===publicKey},isMyAddressOrAlias:function(addressOrAlias){var user=$injector.get("user"),aliasList=ds.dataManager.getLastAliases();return addressOrAlias===user.address||aliasList.includes(addressOrAlias)},isNotEqualValue:isNotEqualValue,checkIsScriptError:function(error){return 7==(error>>8&4095)},createOrder:function(data){var _this115=this,timestamp=ds.utils.normalizeTime(Date.now()),notification=$injector.get("notification"),modalManager=$injector.get("modalManager"),isAdvancedMode=$injector.get("user").getSetting("advancedMode"),version=data.matcherFee.asset.id&&"WAVES"!==data.matcherFee.asset.id?3:2,signableData={type:SIGN_TYPE.CREATE_ORDER,data:_extends({},data,{version:version,timestamp:timestamp})};return utils.createSignable(signableData).then(function(signable){return utils.signMatcher(signable).then(function(signable){return signable.getDataForApi()}).then(ds.createOrder).catch(function(data){var isScriptError=_this115.checkIsScriptError(data.error);return isAdvancedMode&&isScriptError?modalManager.showConfirmTx(signable,!1).then(ds.createOrder,function(){return null}):Promise.reject(_extends({},data,{isScriptError:isScriptError}))})}).catch(function(data){return data&&data.error&&data.isScriptError?notification.error({ns:"app.dex",title:{literal:"directives.createOrder.notifications.error.title"},body:{literal:"directives.createOrder.notifications.error."+data.error,params:data.params?data.params:{}}},-1):notification.error({ns:"app.dex",title:{literal:"directives.createOrder.notifications.error.title"},body:{literal:data&&data.message||data}},-1),Promise.reject(data)})},createSignable:function(data){try{return Promise.resolve(ds.signature.getSignatureApi().makeSignable(data))}catch(e){return Promise.reject(e)}},signUserOrders:function(data){try{var dayForwardTime=ds.app.getTimeStamp(1,"day"),lastSignedTs=path(["matcherSign","timestamp"],data);if(!(!lastSignedTs||lastSignedTs-dayForwardTime<0))return Promise.resolve(data.matcherSign);var timestamp=ds.app.getTimeStamp(WavesApp.matcherSignInterval.count,WavesApp.matcherSignInterval.timeType),signable=ds.signature.getSignatureApi().makeSignable({type:SIGN_TYPE.MATCHER_ORDERS,data:{timestamp:timestamp}});return utils.signMatcher(signable).then(function(signable){return signable.getSignature()}).then(function(signature){return{signature:signature,timestamp:timestamp}})}catch(e){return Promise.reject(e)}},assetNameWarning:function(name){var user=$injector.get("user");if(!(name=(name||"").toLowerCase().trim()))return Promise.resolve(!1);if(name&&Object.keys(user.tokensName).some(function(item){return name===item.toLowerCase()}))return Promise.resolve(!0);var api=user.getSetting("api")||WavesApp.network.api;return ds.fetch(api+"/v0/assets?search="+encodeURIComponent(name)).then(function(_ref34){return _ref34.data.some(function(_ref35){var data=_ref35.data;return(data.name||"").toLowerCase()===name||(data.ticker||"").toLowerCase()===name})}).catch(function(){return!1})},signMatcher:function(signable){var user=$injector.get("user"),modalManager=$injector.get("modalManager");if("seed"===user.userType||"privateKey"===user.userType)return signable.addMyProof().then(function(){return signable});var errorParams={error:"sign-error",userType:user.userType};return function signByDeviceLoop(){return modalManager.showSignByDevice(signable).catch(function(){return modalManager.showSignDeviceError(errorParams).then(signByDeviceLoop)}).catch(function(){return Promise.reject({message:"Your sign is not confirmed!"})})}()},isLockedInDex:function(assetId1,argument_1){var assetId2=1<arguments.length&&void 0!==argument_1?argument_1:null,lockedAssetsIndDex=$injector.get("configService").get("SETTINGS.DEX.LOCKED_PAIRS")||[];return lockedAssetsIndDex.includes(assetId1)||lockedAssetsIndDex.includes(assetId2)}};function isNotEqualValue(oldValue,newValue){return(void 0===oldValue?"undefined":_typeof(oldValue))!==(void 0===newValue?"undefined":_typeof(newValue))||(oldValue instanceof Money&&newValue instanceof Money?oldValue.asset.id!==newValue.asset.id||oldValue.toTokens()!==newValue.toTokens():oldValue instanceof BigNumber&&newValue instanceof BigNumber?!oldValue.eq(newValue):Array.isArray(oldValue)&&Array.isArray(newValue)?oldValue.length!==newValue.length||oldValue.some(function(item,i){return isNotEqualValue(item,newValue[i])}):oldValue!==newValue)}return utils};factory.$inject=["$q","Moment","$injector"],angular.module("app.utils").factory("utils",factory)}(),function(){var factory=function(notification,user,migration,utils){var MIGRATION_LIST=["1.0.0","1.0.3","1.0.5","1.0.6","1.0.7","1.0.8","1.0.10","1.0.14","1.0.15","1.0.18","1.0.21","1.0.22","1.0.25","1.0.27","1.0.28","1.0.29","1.0.30","1.0.32","1.0.33","1.0.36","1.0.37","1.0.40","1.0.41","1.0.42","1.1.0","1.2.0","1.2.1","1.2.2","1.2.3","1.2.6","1.2.8","1.3.0","1.3.2","1.3.5","1.3.7","1.3.9","1.3.18","1.3.19"];function removeVersion(version){var versions=user.getSetting("whatsNewList").slice(),index=versions.indexOf(version);-1!==index&&(versions.splice(index,1),user.setSetting("whatsNewList",versions))}function handleLogin(){var notShownUpdates=user.getSetting("whatsNewList").filter(function(version){return!migration.gt(version,WavesApp.version)||(removeVersion(version),!1)}),lastOpenVersion=user.getSetting("lastOpenVersion"),newVersionList=migration.migrateFrom(lastOpenVersion||WavesApp.version,MIGRATION_LIST);migration.sort(function(list1,list2){var hash=Object.create(null);return list1.concat(list2).forEach(function(version){hash[version]=!0}),Object.keys(hash)}(newVersionList,notShownUpdates)).forEach(function(version){notification.info({ns:"app.utils",title:{literal:"utils.whatsNew.title",params:{version:version}},body:{literal:"utils.whatsNew.body."+version.replace(/\./g,"_")},onClose:function(){removeVersion(version)}},-1)}),function(version){var versions=user.getSetting("whatsNewList").slice();utils.toArray(version).forEach(function(version){versions.push(version)}),user.setSetting("whatsNewList",versions)}(newVersionList),user.setSetting("lastOpenVersion",WavesApp.version)}return user.onLogin().then(function(){handleLogin(),user.loginSignal.on(handleLogin)}),Object.create(null)};factory.$inject=["notification","user","migration","utils"],angular.module("app.utils").factory("whatsNew",factory)}(),function(){var factory=function($mdDialog,utils,decorators,$templateRequest,$rootScope,$injector,state,storage,user){var tsUtils=require("ts-utils"),ds=require("data-service"),Money=require("@waves/data-entities").Money,SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,analytics=require("@waves/event-sender"),DEFAULT_OPTIONS={clickOutsideToClose:!0,escapeToClose:!0,autoWrap:!1,multiple:!0,skipHide:!0,controllerAs:"$ctrl",ns:"app.utils"},DEFAULT_TEMPLATES_URLS_HEADER="modules/utils/modals/templates/header.modal.html",ModalManager=function(){function ModalManager(){_classCallCheck(this,ModalManager),this.openModal=new tsUtils.Signal,this._counter=0,state.signals.changeRouterStateStart.on(this.closeModals,this),user.logoutSignal.on(this.closeModals,this)}return _createClass(ModalManager,[{key:"showScriptModal",value:function(){return this._getModal({id:"script-modal",contentUrl:"modules/utils/modals/script/script.html",controller:"ScriptModalCtrl",title:"modal.script.setScript"})}},{key:"showTryDesktopModal",value:function(){return analytics.send({name:"Onboarding Platform Popup Show",target:"ui"}),this._getModal({id:"try-desktop",title:"",contentUrl:"modules/utils/modals/tryDesktop/tryDesktop.html",controller:"TryDesktopCtrl",clickOutsideToClose:!1,escapeToClose:!1,mod:"try-desktop-modal"})}},{key:"showPairingWithMobile",value:function(){return this._getModal({id:"pairing-with-mobile",title:"",contentUrl:"modules/utils/modals/pairingWithMobile/pairingWithMobile.html",controller:"PairingWithMobileCtrl",mod:"pairing-with-mobile"})}},{key:"showSignByDevice",value:function(signable){return this._getModal({id:"sign-by-device",contentUrl:"modules/utils/modals/signByDevice/signByDevice.html",controller:"SignByDeviceCtrl",locals:{signable:signable},clickOutsideToClose:!1,escapeToClose:!1})}},{key:"showConfirmOrder",value:function(options){return this._getModal({id:"confirm-correct-order",contentUrl:"modules/utils/modals/confirmOrder/confirmOrder.html",controller:"ConfirmOrderCtrl",locals:options})}},{key:"showLoginByDevice",value:function(promise,type){return this._getModal({id:"login-by-device",contentUrl:"modules/utils/modals/loginByDevice/loginByDevice.html",controller:"LoginByDeviceCtrl",locals:function(){return{promise:promise,type:type}},clickOutsideToClose:!1,escapeToClose:!1})}},{key:"showSignDeviceError",value:function(locals){return this._getModal({id:"error-sign-device",contentUrl:"modules/utils/modals/signDeviceError/signDeviceError.html",controller:"SignDeviceError",locals:_extends({},locals),clickOutsideToClose:!1,escapeToClose:!1})}},{key:"showGatewaySign",value:function(search){return this._getModal({id:"gateway-sign-in",title:"{{$ctrl.titleLiteral}}",contentUrl:"modules/utils/modals/gateway/gatewaySign.html",controller:"GatewaySignCtrl",locals:{search:search},clickOutsideToClose:!1,escapeToClose:!1})}},{key:"showPinAsset",value:function(){return this._getModal({id:"pin-asset",title:"modal.pinAsset.title",templateUrl:"modules/utils/modals/pinAsset/pinAsset.html",controller:"PinAssetCtrl",mod:"pin-asset-modal"})}},{key:"showAssetInfo",value:function(asset){return this._getModal({id:"asset-info",title:"modal.assetInfo.title",contentUrl:"modules/utils/modals/assetInfo/assetInfo.html",locals:asset,controller:"AssetInfoCtrl",mod:"m-dialog m-dialog_asset-info"})}},{key:"showSettings",value:function(){return this._getModal({id:"user-settings",ns:"app.utils",title:"modal.settings.title",contentUrl:"modules/utils/modals/settings/settings.html",controller:"SettingsCtrl",mod:"settings-modal"})}},{key:"showTermsAccept",value:function(){var user=$injector.get("user");return analytics.send({name:"Create Done Show",params:{hasBackup:user.getSetting("hasBackup")}}),this._getModal({id:"terms-accept",templateUrl:"modules/utils/modals/termsAccept/terms-accept.html",controller:"TermsAcceptCtrl",clickOutsideToClose:!1,escapeToClose:!1}).then(function(){analytics.send({name:"Create Done Confirm and Begin Click"}),storage.save("needReadNewTerms",!1),storage.save("termsAccepted",!0)})}},{key:"showAcceptNewTerms",value:function(){return this._getModal({id:"accept-new-terms",templateUrl:"modules/utils/modals/acceptNewTerms/accept-new-terms.html",controller:"AcceptNewTermsCtrl",clickOutsideToClose:!1,escapeToClose:!1}).then(function(){storage.save("needReadNewTerms",!1),storage.save("termsAccepted",!0)})}},{key:"showTutorialModals",value:function(){return this._getModal({id:"tutorial-modals",templateUrl:"modules/utils/modals/tutorialModals/tutorialModals.html",controller:"TutorialModalsCtrl"})}},{key:"showSeedBackupModal",value:function(){var _this116=this;return ds.signature.getSignatureApi().getSeed().then(function(phrase){var seed=new ds.Seed(phrase,window.WavesApp.network.code);return _this116._getModal({id:"seed-backup",title:"modal.backup.title.{{$ctrl.titleLiteral}}",contentUrl:"modules/utils/modals/seedBackup/seedBackupModals.html",controller:"SeedBackupModalsCtrl",locals:{seed:seed}})})}},{key:"showConfirmDeleteUser",value:function(user){return this._getModal({id:"delete-user-confirm",templateUrl:"modules/utils/modals/confirmDeleteUser/confirmDeleteUser.modal.html",controller:"confirmDeleteUserCtrl",locals:{user:user}})}},{key:"showDexScriptedPair",value:function(assets){return this._getModal({id:"dex-scripted-pair",templateUrl:"modules/utils/modals/dexScriptedPair/dexScriptedPair.html",controller:"DexScriptedPairCtrl",locals:{assets:assets}})}},{key:"showAccountChangeName",value:function(){return this._getModal({id:"changeName",templateUrl:"modules/utils/modals/changeName/changeName.html",controller:"ChangeNameCtrl"})}},{key:"showAccountAddress",value:function(){return this._getModal({id:"addressInfo",templateUrl:"modules/utils/modals/addressInfo/addressInfo.html",controller:"AddressInfoCtrl"})}},{key:"showAccountInfo",value:function(){var user=$injector.get("user");return this._getModal({id:"account-info",controller:"AccountInfoCtrl",title:"modal.account.title",titleParams:{name:user.name||$injector.get("i18n").translate("modal.account.title_default_name","app.utils")},contentUrl:"modules/utils/modals/accountInfo/account-info.modal.html",mod:"account-info"})}},{key:"showSendAsset",value:function(data){return data=data||Object.create(null),this._getModal({id:"send-asset",controller:"AssetSendCtrl",templateUrl:"modules/utils/modals/sendAsset/send.modal.html",mod:"modal-send",locals:{assetId:data.assetId,canChooseAsset:!data.assetId,mode:data.mode,amount:data.amount,recipient:data.recipient,strict:data.strict,referrer:data.referrer,attachment:data.attachment}})}},{key:"showReceiveModal",value:function(asset){return this._getModal({id:"receive-popup",locals:{asset:asset},templateUrl:"modules/utils/modals/receive/Receive.html",controller:"ReceiveCtrl"})}},{key:"showDepositAsset",value:function(user,asset){return this._getModal({id:"deposit-asset",locals:{address:user.address,asset:asset},title:"modal.deposit.title",titleParams:{assetName:asset.name},contentUrl:"modules/utils/modals/depositAsset/deposit-asset.modal.html",controller:"DepositAsset",mod:"modal-deposit-asset"})}},{key:"showSepaAsset",value:function(user,asset){return this._getModal({id:"sepa-asset",locals:{address:user.address,asset:asset},title:"modal.sepa.title",titleParams:{assetName:asset.name},contentUrl:"modules/utils/modals/sepaAsset/sepa-asset.modal.html",controller:"SepaAsset",mod:"modal-sepa-asset"})}},{key:"showTransactionInfo",value:function(transactionId){return this._getModal({id:"transaction-info",ns:"app.ui",controller:"TransactionInfoCtrl",templateUrl:"modules/utils/modals/transactionInfo/transaction-info.modal.html",mod:"transaction-info",locals:{transactionId:transactionId}})}},{key:"showAnyTx",value:function(tx,analyticsText){return this._getModal({id:"any-tx-modal",controller:"AnyTxModalCtrl",contentUrl:"modules/utils/modals/anyTxModal/any-tx-modal.html",title:"modals.anyTx.title",locals:{tx:tx,analyticsText:analyticsText}})}},{key:"showStartLeasing",value:function(){return this._getModal({id:"start-leasing",ns:"app.utils",controller:"StartLeasingCtrl",titleContent:"{{$ctrl.title}}",mod:"start-leasing",contentUrl:"modules/utils/modals/startLeasing/startLeasing.html"})}},{key:"showConfirmTx",value:function(signable,analyticsText){return this._getModal({id:"confirm-tx",mod:"confirm-tx",ns:"app.ui",locals:{signable:signable,analyticsText:analyticsText},controller:"ConfirmTxCtrl",contentUrl:"modules/utils/modals/confirmTx/confirmTx.modal.html"})}},{key:"showBurnModal",value:function(assetId){var _this117=this;return $injector.get("waves").node.assets.balance(assetId).then(function(_ref36){var available=_ref36.available;return _this117._getModal({id:"token-burn",mod:"change-token",locals:{money:available,txType:"burn"},titleContent:'<span w-i18n="modal.token.burn.title" params="{name: $ctrl.asset.name}"></span>',contentUrl:"modules/utils/modals/changeToken/change-token-modal.html",controller:"TokenChangeModalCtrl"})})}},{key:"showReissueModal",value:function(assetId){var _this118=this;return $injector.get("waves").node.assets.balance(assetId).then(function(_ref37){var available=_ref37.available;return _this118._getModal({id:"token-burn",mod:"change-token",locals:{money:available,txType:"reissue"},titleContent:'<span w-i18n="modal.token.reissue.title" params="{name: $ctrl.asset.name}"></span>',contentUrl:"modules/utils/modals/changeToken/change-token-modal.html",controller:"TokenChangeModalCtrl"})})}},{key:"showSponsorshipModal",value:function(assetId,isEdit){var _this119=this,title=isEdit?"modal.sponsorship_edit.title":"modal.sponsorship.title";return ds.api.assets.get(assetId).then(function(asset){return _this119._getModal({id:"sponsorship",mod:"sponsorship",locals:{asset:asset,assetId:assetId,isCreateSponsored:!isEdit},titleContent:'<span w-i18n="'+title+'"></span>',controller:"SponsoredModalCtrl",contentUrl:"modules/utils/modals/sponsored/sponsored.html"})})}},{key:"showSetAssetScriptModal",value:function(assetId){return this._getModal({id:"setAssetScript",mod:"setAssetScript",locals:assetId,titleContent:'<span w-i18n="modal.setAssetScript.title"></span>',controller:"SetAssetScriptModalCtrl",contentUrl:"modules/utils/modals/setAssetScript/setAssetScript.html"})}},{key:"showSponsorshipStopModal",value:function(assetId){var _this120=this,waves=$injector.get("waves");return Promise.all([ds.api.assets.get(assetId),waves.node.getFee({type:SIGN_TYPE.SPONSORSHIP})]).then(function(_ref38){var _ref39=_slicedToArray(_ref38,2),asset=_ref39[0],fee=_ref39[1],money=new Money(0,asset),tx=waves.node.transactions.createTransaction({type:SIGN_TYPE.SPONSORSHIP,assetId:assetId,asset:asset,minSponsoredAssetFee:money,fee:fee}),signable=ds.signature.getSignatureApi().makeSignable({type:tx.type,data:tx});return _this120.showConfirmTx(signable)})}},{key:"showImportAccountsModal",value:function(){return this._getModal({id:"import-accounts",mod:"import-accounts",controller:"ImportAccountsCtrl",contentUrl:"modules/utils/modals/importAccounts/importAccounts.html"})}},{key:"showConfirmLogout",value:function(){return this._getModal({id:"logout-modal",contentUrl:"modules/utils/modals/confirmLogout/confirmLogout.modal.html",title:""})}},{key:"showLockPairWarning",value:function(amountTicker,priceTicker){return this._getModal({id:"logout-modal",controller:"LockPairWarningCtrl",contentUrl:"modules/utils/modals/lockPairWarning/lockPairWarning.modal.html",locals:{amountTicker:amountTicker,priceTicker:priceTicker}})}},{key:"showDialogModal",value:function(options){var ns=options.ns||DEFAULT_OPTIONS.ns;options.message.ns=options.message.ns||ns,options.buttons.forEach(function(button){button.text.ns=button.text.ns||ns});var controller=function($scope,$mdDialog){Object.assign($scope,options),this.applyClick=function(button){var method=button.success?"hide":"cancel";button.click&&button.click(),$mdDialog[method](button.data)}};return controller.$inject=["$scope","$mdDialog"],this._getModal(tsUtils.merge({},DEFAULT_OPTIONS,options,{contentUrl:"modules/utils/modals/templates/dialog-content.html",controller:controller}))}},{key:"showCustomModal",value:function(options){return this._getModal(tsUtils.merge({},DEFAULT_OPTIONS,options))}},{key:"closeModals",value:function(){for(var counter=this._counter,i=0;i<counter;i++)$mdDialog.cancel()}},{key:"_getUser",value:function(){return $injector.get("user")}},{key:"_getModal",value:function(options){var _this121=this,target=_extends({},DEFAULT_OPTIONS,options);return target.locals&&(target.bindToController=!0),ModalManager._getTemplate(target).then(function(template){var _ModalManager$_getCon=ModalManager._getController(options),controller=_ModalManager$_getCon.controller,controllerAs=_ModalManager$_getCon.controllerAs,changeCounter=function(){_this121._counter--,options.id};target.controller=controller,target.controllerAs=controllerAs,target.template=template,_this121._counter++;var modal=$mdDialog.show(target);return options.id,modal.then(changeCounter,changeCounter),_this121.openModal.dispatch(modal),modal})}}],[{key:"_getTemplate",value:function(options){return options.template?Promise.resolve(options.template):options.templateUrl?ModalManager._loadTemplate(options.templateUrl):ModalManager._createTemplate(options)}},{key:"_getController",value:function(options){if(!options.controller)return{controller:ModalManager._wrapController(function(){return{}}),controllerAs:null};var controller=null,controllerAs=void 0;if("function"==typeof options.controller)controller=ModalManager._wrapController(options.controller);else{var parts=options.controller.split(" as ");controller=ModalManager._wrapController(WavesApp.getController(parts[0])),controllerAs=parts[1]}return{controller:controller,controllerAs:controllerAs=controllerAs||DEFAULT_OPTIONS.controllerAs}}},{key:"_wrapController",value:function(controller){var $ctrl=function($element,$mdDialog){$element.on("click","[w-modal-close]",function(){$mdDialog.cancel()}),$element.on("click","[w-modal-hide]",function(){$mdDialog.hide()});for(var _len13=arguments.length,args=Array(2<_len13?_len13-2:0),_key13=2;_key13<_len13;_key13++)args[_key13-2]=arguments[_key13];return controller.call.apply(controller,[this].concat(args))};return $ctrl.$inject=["$element","$mdDialog"].concat(_toConsumableArray(controller.$inject||[])),$ctrl}},{key:"_createTemplate",value:function(options){return Promise.all([ModalManager._getHeader(options).then(ModalManager._wrapTemplate("md-toolbar")),ModalManager._getContent(options).then(ModalManager._wrapTemplate("md-dialog-content")),ModalManager._getFooter(options)]).then(function(templateParts){var mod=options.mod,ns=options.ns,content=templateParts.filter(Boolean).join("");return ModalManager._getWrapTemplate({ns:ns,mod:mod,content:content})})}},{key:"_getHeader",value:function(options){if(options.title){var title='<div class="headline-2" params=\''+(options.titleParams?JSON.stringify(options.titleParams):"")+"' w-i18n=\""+options.title+'"></div>';return ModalManager._loadTemplate(DEFAULT_TEMPLATES_URLS_HEADER).then(function(template){return template.replace("{{title}}",title)})}return options.titleContent||options.titleContentUrl?Promise.all([ModalManager._getTemplateOption(options,"titleContent"),ModalManager._loadTemplate(DEFAULT_TEMPLATES_URLS_HEADER)]).then(function(_ref40){var _ref41=_slicedToArray(_ref40,2),titleContent=_ref41[0];return _ref41[1].replace("{{title}}",titleContent)}):ModalManager._getTemplateOption(options,"header")}},{key:"_getContent",value:function(options){return ModalManager._getTemplateOption(options,"content")}},{key:"_getFooter",value:function(options){return ModalManager._getTemplateOption(options,"footer")}},{key:"_getTemplateOption",value:function(options,name){return options[name]?Promise.resolve(options[name]):options[name+"Url"]?ModalManager._loadTemplate(options[name+"Url"]):Promise.resolve(null)}},{key:"_wrapTemplate",value:function(tagName){return function(template){return template=template&&"<"+tagName+">"+template+"</"+tagName+">"}}},{key:"_getWrapTemplate",value:function(_ref42){var ns=_ref42.ns,mod=_ref42.mod;return"<md-dialog "+(ns?'w-i18n-ns="'+ns+'"':"")+" "+(mod?'class="'+mod+'"':"")+' aria-label="modal">'+_ref42.content+"</md-dialog>"}},{key:"_loadTemplate",value:function(url){return $templateRequest(url)}}]),ModalManager}();return utils.bind(new ModalManager)};factory.$inject=["$mdDialog","utils","decorators","$templateRequest","$rootScope","$injector","state","storage","user"],angular.module("app.utils").factory("modalManager",factory)}(),function(){var factory=function(user,modalManager,waves,Router,utils){return function(){function ModalRouter(){var _this122=this;_classCallCheck(this,ModalRouter),this._sleep=!1,this._firstUrl=ModalRouter._getUrlData(),this._router=new Router,this._router.registerRouteHash(this._wrapClose(this._getRoutes())),WavesApp.isDesktop()&&window.listenMainProcessEvent(function(eventType,urlString){user.onLogin().then(function(){var hash=utils.parseElectronUrl(urlString).hash;hash&&_this122._apply(ModalRouter._getUrlData(hash.replace("#","")))})})}return _createClass(ModalRouter,[{key:"initialize",value:function(){var _this123=this;window.addEventListener("hashchange",function(){_this123._sleep||_this123._apply(ModalRouter._getUrlData())},!1),waves.node.assets.userBalances().then(function(){_this123._apply(_this123._firstUrl)})}},{key:"_apply",value:function(url){return this._router.apply(url)}},{key:"_getRoutes",value:function(){var _ref45;return _defineProperty(_ref45={},Router.ROUTES.SEND,function(){return modalManager.showSendAsset()}),_defineProperty(_ref45,Router.ROUTES.SEND_ASSET,function(_ref43,search){var assetId=_ref43.assetId;return modalManager.showSendAsset(_extends({},search,{assetId:assetId}))}),_defineProperty(_ref45,Router.ROUTES.ASSET_INFO,function(_ref44){var assetId=_ref44.assetId;return waves.node.assets.getAsset(assetId).then(function(asset){return modalManager.showAssetInfo(asset)})}),_defineProperty(_ref45,Router.ROUTES.ACCOUNT,function(){return modalManager.showAccountInfo()}),_defineProperty(_ref45,Router.ROUTES.GATEWAY_AUTH,function(params,search){return modalManager.showGatewaySign(search)}),_defineProperty(_ref45,Router.ROUTES.ANY_TX,function(params,search){return modalManager.showAnyTx(search)}),_ref45}},{key:"_wrapClose",value:function(hash){var _this124=this;return Object.keys(hash).forEach(function(key){var handler=hash[key];hash[key]=function(){for(var _len14=arguments.length,args=Array(_len14),_key14=0;_key14<_len14;_key14++)args[_key14]=arguments[_key14];return _this124._sleep=!0,user.onLogin().then(function(){var result=handler.apply(void 0,args);if(!result||!result.then||"function"!=typeof result.then)throw new Error("Modal result must be a promise!");var cb=function(){_this124._sleep=!1,location.hash=""};return result.then(cb,cb),result})}}),hash}}],[{key:"_getUrlData",value:function(fromUrl){return"/"+decodeURIComponent(fromUrl||ModalRouter._getLocation())}},{key:"_getLocation",value:function(){if(WavesApp.isDesktop()){var lastIndex=location.hash.lastIndexOf("#");return location.hash.indexOf("#")<lastIndex?location.hash.slice(lastIndex+1):""}return location.hash.replace("#","")}}]),ModalRouter}()};factory.$inject=["user","modalManager","waves","Router","utils"],angular.module("app.ui").factory("ModalRouter",factory)}(),function(){var controller=function(Base,$scope,$state,user,modalManager,utils,waves,$element,ChartFactory,storage,matcher){var ds=require("data-service"),Money=require("@waves/data-entities").Money,_require33=require("ramda"),flatten=_require33.flatten,uniqBy=_require33.uniqBy,BigNumber=require("@waves/bignumber").BigNumber,WCT_ID="T"===WavesApp.network.code?WavesApp.defaultAssets.TRY:"DHgwrRvVyqJsepd32YbBqUeDH4GJ1N984X8QoekjgH8J",PAIRS_IN_SLIDER=[{amount:WavesApp.defaultAssets.VST,price:"WAVES"},{amount:WavesApp.defaultAssets.BTC,price:"WAVES"},{amount:WCT_ID,price:"WAVES"},{amount:WavesApp.defaultAssets.DASH,price:WavesApp.defaultAssets.BTC},{amount:WavesApp.defaultAssets.ETH,price:WavesApp.defaultAssets.BTC},{amount:WavesApp.defaultAssets.BCH,price:WavesApp.defaultAssets.BTC},{amount:WavesApp.defaultAssets.ETH,price:"WAVES"},{amount:"WAVES",price:WavesApp.defaultAssets.USD},{amount:WavesApp.defaultAssets.ZEC,price:"WAVES"},{amount:WavesApp.defaultAssets.XMR,price:WavesApp.defaultAssets.BTC}],chartOptions={red:{axisX:"timestamp",axisY:"rate",view:{rate:{lineColor:"#ef4829",fillColor:"#FFF",gradientColor:["#FEEFEC","#FFF"],lineWidth:4}}},blue:{axisX:"timestamp",axisY:"rate",view:{rate:{lineColor:"#1f5af6",fillColor:"#FFF",gradientColor:["#EAF0FE","#FFF"],lineWidth:4}}}};return new(function(){function WelcomeCtrl(){_classCallCheck(this,WelcomeCtrl);var _this125=_possibleConstructorReturn(this,(WelcomeCtrl.__proto__||Object.getPrototypeOf(WelcomeCtrl)).call(this,$scope));return _this125.pairsInfoList=[],_this125.hasUsers=!1,_this125._initDeviceTypes(),_this125.isWeb?storage.load("accountImportComplete").then(function(complete){complete?_this125._initUserList():_this125._loadUserListFromOldOrigin()}):_this125._initUserList(),_this125._initPairs(),_this125._initDeviceTypes(),_this125.isDesktop&&_this125.observeOnce("userList",function(){_this125.userList.length&&$state.go("signIn")}),_this125}return _inherits(WelcomeCtrl,Base),_createClass(WelcomeCtrl,[{key:"_addScrollHandler",value:function(){var scrolledView=$element.find(".scrolled-view"),header=$element.find("w-main-header");scrolledView.on("scroll",function(){header.toggleClass("fixed",60<scrolledView.scrollTop()),header.toggleClass("unfixed",scrolledView.scrollTop()<=60)})}},{key:"showTutorialModals",value:function(){return modalManager.showTutorialModals()}},{key:"goToDexDemo",value:function(pairAssets){utils.openDex(pairAssets.assetId1,pairAssets.assetId2,"dex-demo")}},{key:"_initPairs",value:function(){var _this126=this,FAKE_RATE_HISTORY=[{rate:new BigNumber(0),timestamp:ds.utils.normalizeTime(Date.now())}],startDate=utils.moment().add().day(-7);Promise.all(PAIRS_IN_SLIDER.map(function(pair){return ds.api.pairs.get(pair.amount,pair.price)})).then(function(pairs){return Promise.all(pairs.map(function(pair){return ds.api.pairs.info(matcher.currentMatcherAddress,[pair])}))}).then(function(infoList){var flattenInfoList=flatten(infoList);Promise.all(PAIRS_IN_SLIDER.map(function(_ref46){var amount=_ref46.amount,price=_ref46.price;return waves.utils.getRateHistory(amount,price,startDate)}).map(function(promise){return promise.catch(function(){return FAKE_RATE_HISTORY})})).then(function(rateHistory){_this126.pairsInfoList=rateHistory.map(WelcomeCtrl._fillValues(flattenInfoList))}).then(function(){utils.safeApply($scope),_this126._insertCharts(),_this126._addScrollHandler()})})}},{key:"_insertCharts",value:function(){var _this127=this,marketRows=$element.find(".table-markets .row-content");PAIRS_IN_SLIDER.forEach(function(pair,i){var options=_this127.pairsInfoList[i].change24.gt(0)?chartOptions.blue:chartOptions.red,chartData={rate:_this127.pairsInfoList[i].rateHistory};new ChartFactory(marketRows.eq(i).find(".graph"),options,chartData)})}},{key:"_initUserList",value:function(){var _this128=this;user.getFilteredUserList().then(function(list){_this128.userList=list,_this128.hasUsers=_this128.userList&&0<_this128.userList.length,_this128.pendingRestore=!1,utils.postDigest($scope).then(function(){$scope.$apply()})})}},{key:"_initDeviceTypes",value:function(){this.isDesktop=WavesApp.isDesktop(),this.isWeb=WavesApp.isWeb()}},{key:"_loadUserListFromOldOrigin",value:function(){var _this129=this;this.pendingRestore=!0,utils.importAccountByIframe("https://client.wavesplatform.com",5e3).then(function(userList){user.getFilteredUserList().then(function(list){_this129.pendingRestore=!1,_this129.userList=uniqBy(function(user){return user.name},userList.concat(list)||list),storage.save("accountImportComplete",!0),storage.save("userList",_this129.userList),utils.postDigest($scope).then(function(){$scope.$apply()})})}).catch(function(){storage.save("accountImportComplete",!0),_this129._initUserList()})}}],[{key:"_fillValues",value:function(infoList){return function(rateHistory,i){var info=infoList[i],volume=info.volume||new Money(0,info.priceAsset);return _extends({},info,{ticker:info.ticker||info.displayName,change24:info.change24||new BigNumber(0),high:info.high||new Money(0,info.priceAsset),lastPrice:info.lastPrice||new Money(0,info.priceAsset),low:info.low||new Money(0,info.priceAsset),volume:volume,rateHistory:rateHistory,volumeBigNum:volume.getTokens()})}}}]),WelcomeCtrl}())};controller.$inject=["Base","$scope","$state","user","modalManager","utils","waves","$element","ChartFactory","storage","matcher"],angular.module("app.welcome").controller("WelcomeCtrl",controller)}(),angular.module("app").component("wComponentError",{templateUrl:"modules/app/directives/componentError/componentError.html"}),function(){var controller=function(Base,$element,$injector){return new(function(){function ContainerAlertNotification(){_classCallCheck(this,ContainerAlertNotification);var _this130=_possibleConstructorReturn(this,(ContainerAlertNotification.__proto__||Object.getPrototypeOf(ContainerAlertNotification)).call(this));return _this130.type=null,_this130}return _inherits(ContainerAlertNotification,Base),_createClass(ContainerAlertNotification,[{key:"$postLink",value:function(){if(!this.type)throw new Error("Can't find type!");var notification=$injector.get(this.type);this.receive(notification.changeSignal,this._onChangeNotifications,this),this._onChangeNotifications(notification.getActiveNotificationsList())}},{key:"_onChangeNotifications",value:function(list){$element.children().detach().end().append(list.map(function(_ref47){return _ref47.$element}))}}]),ContainerAlertNotification}())};controller.$inject=["Base","$element","$injector"],angular.module("app").component("wContainerAlertNotification",{bindings:{type:"@"},transclude:!1,controller:controller})}(),(directive=function(Base,i18n,utils){return{scope:!1,restrict:"A",link:function($scope,$element,$attrs){return new(function(){function I18n(){_classCallCheck(this,I18n);var _this131=_possibleConstructorReturn(this,(I18n.__proto__||Object.getPrototypeOf(I18n)).call(this,$scope));if(_this131._forStop=[],_this131._watchers=Object.create(null),_this131._literalTemplate=I18n._getLiteralTemplate(),_this131._parts=I18n._getParts(_this131._literalTemplate),_this131._handler=utils.debounce(_this131._getHandler()),_this131._addWatchers(),_this131.listenEventEmitter(i18next,"languageChanged",_this131._handler),$attrs.params&&!$attrs.params.includes("::")){var stop=$scope.$watch($attrs.params,_this131._handler);_this131._forStop.push(stop)}return _this131._handler(),_this131}return _inherits(I18n,Base),_createClass(I18n,[{key:"$onDestroy",value:function(){_get2(I18n.prototype.__proto__||Object.getPrototypeOf(I18n.prototype),"$onDestroy",this).call(this),this._forStop.forEach(function(cb){return cb()}),this._forStop=[]}},{key:"_getHandler",value:function(){var _this132=this,ns=this._getNs();return function(){var skipErrors="skipErrors"in $attrs,defaultValue=function(text){return text.split("").map(function(char){switch(char.charCodeAt(0)){case 34:return"&quot;";case 38:return"&amp;";case 39:return"&#39;";case 60:return"&lt;";case 62:return"&gt;";default:return char}}).join("")}($attrs.defaultValue||""),params=$attrs.params&&$scope.$eval($attrs.params)||void 0,result=i18n.translate(_this132._compile(_this132._literalTemplate),ns,params,skipErrors);$element.html(result||(defaultValue||result))}}},{key:"_getNs",value:function(){return $attrs.wI18nNs?$attrs.wI18nNs:i18n.getNs($element)}},{key:"_compile",value:function(literal){return this._parts&&this._parts.forEach(function(_ref48){var part=_ref48.part,evalTpl=_ref48.evalTpl;literal=literal.replace(part,$scope.$eval(evalTpl))}),literal}},{key:"_addWatchers",value:function(){var _this133=this;if(!this._parts)return null;this._parts.forEach(function(_ref49){var part=_ref49.part,needWatch=_ref49.needWatch,evalTpl=_ref49.evalTpl;needWatch&&!_this133._watchers[part]&&(_this133._forStop.push($scope.$watch(evalTpl,_this133._handler)),_this133._watchers[part]=!0)})}}],[{key:"_getLiteralTemplate",value:function(){return String($element.attr("w-i18n")).trim()}},{key:"_getParts",value:function(template){var parts=template.match(/{{.*?(}})/g);return parts?parts.map(function(part){return{part:part,evalTpl:part.replace("{{","").replace("}}","").replace("::",""),needWatch:-1===part.indexOf("::")}}):null}}]),I18n}())},transclude:!0,template:function($element){if("W-I18N"===$element.get(0).tagName)return"<span ng-transclude></span>"}}}).$inject=["Base","i18n","utils"],angular.module("app").directive("wI18n",directive),function(){var controller=function($element,$attrs,i18n,$scope,Base,utils){return new(function(){function I18nAttr(){_classCallCheck(this,I18nAttr);var _this134=_possibleConstructorReturn(this,(I18nAttr.__proto__||Object.getPrototypeOf(I18nAttr)).call(this,$scope));return _this134._forStop=[],_this134._watchers=Object.create(null),_this134._toTranslate=$attrs.wI18nAttr.split(","),_this134._literalTemplatesHash=_this134._toTranslate.reduce(function(acc,attrName){return acc[attrName]=$element.attr(attrName).trim(),acc},Object.create(null)),_this134._partsHash=_this134._toTranslate.reduce(function(acc,attrName){return acc[attrName]=I18nAttr._getParts($attrs[attrName]),acc},Object.create(null)),_this134._handler=utils.debounce(_this134._getHandler()),_this134.listenEventEmitter(i18next,"languageChanged",_this134._handler),_this134._addWatchers(),_this134._handler(),_this134}return _inherits(I18nAttr,Base),_createClass(I18nAttr,[{key:"$onDestroy",value:function(){_get2(I18nAttr.prototype.__proto__||Object.getPrototypeOf(I18nAttr.prototype),"$onDestroy",this).call(this),this._forStop.forEach(function(cb){return cb()}),this._forStop=[]}},{key:"_getHandler",value:function(){var _this135=this,ns=this._getNs();return function(){_this135._toTranslate.forEach(function(attrName){var params=$attrs.params&&$scope.$eval($attrs.attrParams)||void 0,value=i18n.translate(_this135._compile(attrName),ns,params,!1);$element.attr(attrName,value)})}}},{key:"_compile",value:function(attrName){var template=this._literalTemplatesHash[attrName],parts=this._partsHash[attrName],literal=template;return parts&&parts.forEach(function(_ref50){var part=_ref50.part,evalTpl=_ref50.evalTpl;literal=literal.replace(part,$scope.$eval(evalTpl))}),literal}},{key:"_getNs",value:function(){return $attrs.wI18nNs?$attrs.wI18nNs:i18n.getNs($element)}},{key:"_addWatchers",value:function(){var _this136=this;Object.values(this._partsHash).forEach(function(parts){(parts||[]).forEach(function(_ref51){var part=_ref51.part,needWatch=_ref51.needWatch,evalTpl=_ref51.evalTpl;needWatch&&!_this136._watchers[part]&&(_this136._forStop.push($scope.$watch(evalTpl,_this136._handler)),_this136._watchers[part]=!0)})})}}],[{key:"_getParts",value:function(template){var parts=template.match(/{{.*?(}})/g);return parts?parts.map(function(part){return{part:part,evalTpl:part.replace("{{","").replace("}}","").replace("::",""),needWatch:-1===part.indexOf("::")}}):null}}]),I18nAttr}())};controller.$inject=["$element","$attrs","i18n","$scope","Base","utils"],angular.module("app").directive("wI18nAttr",function(){return{scope:!1,restrict:"A",controller:controller}})}(),function(){var factory=function(){return function(){function TxEvent(id,moneyList){_classCallCheck(this,TxEvent),this.id=id,this.moneyList=moneyList}return _createClass(TxEvent,[{key:"getReservedMoneyList",value:function(){return this.moneyList}}]),TxEvent}()};factory.$inject=[],angular.module("app").factory("TxEvent",factory)}(),function(){var factory=function($compile,$q,$rootScope,timeLine,Queue,$templateRequest,utils){var tsUtils=require("ts-utils");return function(){function BaseNotificationManager(options){_classCallCheck(this,BaseNotificationManager),this._queue=new Queue({queueLimit:options.queueLimit}),this._options=options,this.changeSignal=new tsUtils.Signal,this._setHandlers()}return _createClass(BaseNotificationManager,[{key:"remove",value:function(id){var item=this._queue.remove(id);item&&item.destroy&&item.destroy()}},{key:"removeAll",value:function(){this._queue.removeAll()}},{key:"destroyAll",value:function(){this._queue.destroyAll()}},{key:"has",value:function(id){return this._queue.has(id)}},{key:"info",value:function(notificationObj,delay){return this._push("info",notificationObj,delay)}},{key:"success",value:function(notificationObj,delay){return this._push("success",notificationObj,delay)}},{key:"warn",value:function(notificationObj,delay){return this._push("warn",notificationObj,delay)}},{key:"error",value:function(notificationObj,delay){return this._push("error",notificationObj,delay)}},{key:"getActiveNotificationsList",value:function(){return this._queue.getActiveList()}},{key:"_setHandlers",value:function(){this._queue.signals.change.on(this._run,this)}},{key:"_push",value:function(type,notificationObj,argument_2){var delay=2<arguments.length&&void 0!==argument_2?argument_2:this._options.defaultDelay,defer=$q.defer(),promise=defer.promise;notificationObj.id=notificationObj.id||tsUtils.uniqueId("n");var notification=utils.liteObject({id:notificationObj.id,defer:defer,promise:promise,notificationObj:notificationObj,delay:delay,type:type,$element:null,destroy:null});return this._queue.push(notification),promise}},{key:"_createElement",value:function($scope){return BaseNotificationManager._loadTemplate(this._options.templateUrl).then(function(html){return $compile(html)($scope)})}},{key:"_run",value:function(list){var _this137=this,promises=list.filter(function(item){return!item.$element}).map(function(item){var $scope=$rootScope.$new(!0);return $scope.$on("$destroy",item.defer.resolve),Object.assign($scope,item.notificationObj),$scope.type=item.type,item.destroy=function(){$scope.$destroy(),item.notificationObj.onClose&&item.notificationObj.onClose()},_this137._createElement($scope).then(function($element){(item.$element=$element).on("click","[w-notification-close]",function(){item.destroy()}),$element.on("click","[w-notification-action]",function(){item.notificationObj.action.callback(item)}),item.notificationObj.action&&$element.on("click",".js-notification-action",function(){item.notificationObj.action(item)}),0<item.delay&&timeLine.timeout(item.destroy,item.delay)})});Promise.all(promises).then(function(){return _this137._dispatch()})}},{key:"_dispatch",value:function(){this.changeSignal.dispatch(this.getActiveNotificationsList())}}],[{key:"_loadTemplate",value:function(url){return $templateRequest(url)}}]),BaseNotificationManager}()};factory.$inject=["$compile","$q","$rootScope","timeLine","Queue","$templateRequest","utils"],angular.module("app").factory("BaseNotificationManager",factory)}(),function(){var factory=function(BaseNotificationManager){return new BaseNotificationManager({templateUrl:"modules/app/services/notification/templates/notification.html",queueLimit:5,defaultDelay:3e3})};factory.$inject=["BaseNotificationManager"],angular.module("app").factory("notification",factory)}(),function(){var factory=function(BaseNotificationManager){return new BaseNotificationManager({templateUrl:"modules/app/services/notification/templates/user-notification.html",queueLimit:1,defaultDelay:-1})};factory.$inject=["BaseNotificationManager"],angular.module("app").factory("userNotification",factory)}(),function(){var factory=function(node,matcher,wavesUtils,utils){return utils.bind(new function Waves(){_classCallCheck(this,Waves),this.node=node,this.matcher=matcher,this.utils=wavesUtils})};factory.$inject=["node","matcher","wavesUtils","utils"],angular.module("app").factory("waves",factory)}(),function(){var factory=function(assets,utils,decorators,transactions,matcher){var _dec3,_dec4,_dec5,_dec6,_dec7,_class19,ds=require("data-service"),entities=require("@waves/data-entities"),BigNumber=require("@waves/bignumber").BigNumber,_require36=require("ramda"),flatten=_require36.flatten,pipe=_require36.pipe,map=_require36.map,where=_require36.where,prop=_require36.prop,gte=_require36.gte,allPass=_require36.allPass,lte=_require36.lte,filter=_require36.filter,length=_require36.length,equals=_require36.equals,__=_require36.__;return new(_dec3=decorators.cachable(5),_dec4=decorators.cachable(350),_dec5=decorators.cachable(60),_dec6=decorators.cachable(60),_dec7=decorators.cachable(60),_applyDecoratedDescriptor((_class19=function(){function WavesUtils(){_classCallCheck(this,WavesUtils)}return _createClass(WavesUtils,[{key:"searchAsset",value:function(userInput){return ds.fetch(WavesApp.network.api+"/assets/search/"+userInput)}},{key:"getRate",value:function(assetFrom,assetTo,date){var WavesId=WavesApp.defaultAssets.WAVES,from=WavesUtils.toId(assetFrom),to=WavesUtils.toId(assetTo);return from===to?Promise.resolve(new BigNumber(1)):date?void 0:from===WavesId||to===WavesId?this._getRate(from,to):utils.whenAll([this._getRate(from,WavesId),this._getRate(to,WavesId)]).then(function(_ref52){var _ref53=_slicedToArray(_ref52,2),rateFrom=_ref53[0],rateTo=_ref53[1];return rateTo.eq(0)?rateTo:rateFrom.div(rateTo)})}},{key:"getRateApi",value:function(assetFrom,assetTo){var _this138=this;return utils.whenAll([assets.getAsset(WavesUtils.toId(assetFrom)),assets.getAsset(WavesUtils.toId(assetTo)),this.getRate(assetFrom,assetTo)]).then(function(_ref54){var _ref55=_slicedToArray(_ref54,3),from=_ref55[0],to=_ref55[1],rate=_ref55[2];return _this138._generateRateApi(from,to,rate)})}},{key:"getRateHistory",value:function(assetFrom,assetTo,from,to){var idFrom=WavesUtils.toId(assetFrom),idTo=WavesUtils.toId(assetTo),wavesId=WavesApp.defaultAssets.WAVES;return to=to||Date.now(),idFrom===idTo?Promise.resolve([]):idFrom===wavesId||idTo===wavesId?this._getRateHistory(idFrom,idTo,utils.moment(from),utils.moment(to)):Promise.all([this._getRateHistory(idFrom,wavesId,utils.moment(from),utils.moment(to)),this._getRateHistory(idTo,wavesId,utils.moment(from),utils.moment(to))]).then(function(_ref56){var _ref57=_slicedToArray(_ref56,2),from=_ref57[0],to=_ref57[1],hash=to.reduce(function(result,item){return result[item.timestamp.valueOf()]=item,result},Object.create(null));return from.reduce(function(result,item){return hash[item.timestamp.valueOf()]&&(item.rate=item.rate.div(hash[item.timestamp.valueOf()].rate),result.push(item)),result},[])})}},{key:"getChange",value:function(assetFrom,assetTo){var idFrom=WavesUtils.toId(assetFrom),idTo=WavesUtils.toId(assetTo);return idFrom===idTo?Promise.resolve(new BigNumber(0)):this._getChange(idFrom,idTo)}},{key:"getVolume",value:function(pair){return this._getVolume(pair,matcher.currentMatcherAddress)}},{key:"_getVolume",value:function(pair,currentMatcherAddress){return ds.api.pairs.info(currentMatcherAddress,[pair]).then(function(data){var _data$filter=data.filter(Boolean),_data$filter2$=_slicedToArray(_data$filter,1)[0],pair=void 0===_data$filter2$?{}:_data$filter2$;return pair&&String(pair.volume)||"0"})}},{key:"_getChange",value:function(from,to){return ds.api.pairs.get(from,to).then(function(pair){return ds.api.pairs.info(matcher.currentMatcherAddress,[pair]).then(function(_ref58){var data=_slicedToArray(_ref58,1)[0];if(!data||"error"===data.status)return 0;var open=data.firstPrice||new entities.Money(0,pair.priceAsset),close=data.lastPrice||new entities.Money(0,pair.priceAsset),change24=Number(function(open,close){return open.eq(0)?new BigNumber(0):close.sub(open).div(open).mul(100).roundTo(2)}(open.getTokens(),close.getTokens()).toFixed());return pair.amountAsset.id===from?change24:-change24})}).catch(function(){return 0})}},{key:"_getRate",value:function(fromId,toId){var currentRate=function(trades){return trades&&trades.length?function(trades){return trades.reduce(function(result,item){return result.add(new BigNumber(item.price.getTokens()))},new BigNumber(0)).div(trades.length)}(trades):new BigNumber(0)};return ds.api.pairs.get(fromId,toId).then(function(pair){return transactions.getExchangeTxList({limit:5,amountAsset:pair.amountAsset,priceAsset:pair.priceAsset}).then(currentRate).then(function(rate){return fromId!==pair.priceAsset.id?rate:rate.eq(0)?rate:new BigNumber(1).div(rate)}).catch(function(){return new BigNumber(0)})})}},{key:"_getRateHistory",value:function(fromId,toId,from,to){var formattedFrom=from.getDate().getTime(),formattedTo=to.getDate().getTime();return ds.api.pairs.get(fromId,toId).then(function(pair){var amountId=pair.amountAsset.id,priceId=pair.priceAsset.id,dataService=ds.config.getDataService(),int=utils.getMaxInterval(formattedFrom,formattedTo),promises=utils.getValidCandleOptions(formattedFrom,formattedTo,int).options.map(function(option){return dataService.getCandles(amountId,priceId,option)});return Promise.all(promises).then(pipe(map(prop("data")),flatten)).then(map(function(item){return{close:item.close,timestamp:new Date(item.time).getTime()}})).then(filter(where({close:function(_close){return _close.gt(0)},timestamp:allPass([gte(__,formattedFrom),lte(__,formattedTo)])}))).then(function(list){return equals(length(list),0)?Promise.reject(new Error("Nor found by pair "+pair)):list}).then(map(function(_ref60){var timestamp=_ref60.timestamp,close=_ref60.close;return{timestamp:new Date(timestamp),rate:fromId!==pair.priceAsset.id?close:new BigNumber(1).div(close)}}))})}},{key:"_generateRateApi",value:function(from,to,rate){return{exchange:function(balance){return balance.mul(rate.toFixed(8)).roundTo(to.precision)},exchangeReverse:function(balance){return(rate?balance.div(rate):new BigNumber(0)).roundTo(from.precision)},rate:rate}}}],[{key:"toId",value:function(asset){return"string"==typeof asset?asset:asset.id}}]),WavesUtils}()).prototype,"searchAsset",[_dec3],Object.getOwnPropertyDescriptor(_class19.prototype,"searchAsset"),_class19.prototype),_applyDecoratedDescriptor(_class19.prototype,"getRate",[_dec4],Object.getOwnPropertyDescriptor(_class19.prototype,"getRate"),_class19.prototype),_applyDecoratedDescriptor(_class19.prototype,"getRateHistory",[_dec5],Object.getOwnPropertyDescriptor(_class19.prototype,"getRateHistory"),_class19.prototype),_applyDecoratedDescriptor(_class19.prototype,"getChange",[_dec6],Object.getOwnPropertyDescriptor(_class19.prototype,"getChange"),_class19.prototype),_applyDecoratedDescriptor(_class19.prototype,"_getVolume",[_dec7],Object.getOwnPropertyDescriptor(_class19.prototype,"_getVolume"),_class19.prototype),_class19)};factory.$inject=["assets","utils","decorators","transactions","matcher"],angular.module("app").factory("wavesUtils",factory)}(),function(){var factory=function(Base,$q){return function(){function SeedBase($container){_classCallCheck(this,SeedBase);var _this139=_possibleConstructorReturn(this,(SeedBase.__proto__||Object.getPrototypeOf(SeedBase)).call(this));return _this139.$root=$container,_this139.seed=null,_this139.parts=null,_this139}return _inherits(SeedBase,Base),_createClass(SeedBase,[{key:"$postLink",value:function(){if(!this.seed)throw new Error("Has no seed!");this.parts=this.seed.split(/\s/)}},{key:"animate",value:function($element,properties,options){return $q(function(resolve){if((options=options||{duration:100}).duration||(options.duration=100),options.complete){var origin=options.complete;options.complete=function(){resolve(),origin()}}else options.complete=resolve;$element.stop(!0,!0).animate(properties,options)})}},{key:"createClone",value:function($forClone){var $clone=$forClone.clone().removeClass("write").removeClass("full").removeClass("moved").addClass("read"),offset=$forClone.offset();return this.$root.append($clone),$clone.addClass("clone"),$clone.css({position:"absolute",margin:"0"}),$clone.offset(offset),$forClone.addClass("moved"),$clone}},{key:"animateOut",value:function($element){return this.animate($element,{opacity:0},{progress:function(tween,_progress2){$element.css("transform","scale("+(1-_progress2)+")")}})}},{key:"animateIn",value:function($element){return $element.css("opacity",0),this.animate($element,{opacity:1},{progress:function(tween,_progress3){$element.css("transform","scale("+_progress3+")")}})}}]),SeedBase}()};factory.$inject=["Base","$q"],angular.module("app.create").factory("SeedBase",factory)}(),function(){var AVAILABLE_TYPES=["read","random"],controller=function(SeedBase,seedService,$element){return new(function(){function Seed(){_classCallCheck(this,Seed);var _this140=_possibleConstructorReturn(this,(Seed.__proto__||Object.getPrototypeOf(Seed)).call(this,$element));return _this140.type=null,_this140}return _inherits(Seed,SeedBase),_createClass(Seed,[{key:"$postLink",value:function(){if(_get2(Seed.prototype.__proto__||Object.getPrototypeOf(Seed.prototype),"$postLink",this).call(this),!AVAILABLE_TYPES.includes(this.type))throw new Error("Wrong type!");this._initialize()}},{key:"_initialize",value:function(){"random"===this.type&&(this._mixSeed(),this.receive(seedService.revert,this._revert,this))}},{key:"_revert",value:function(index){var $target=$element.find(".seed-item").eq(index),$clone=this.createClone($target);this.animateIn($clone).then(function(){$target.removeClass("moved"),$clone.remove()})}},{key:"_onClick",value:function(e,index){var $target=$(e.target);if($target.hasClass("moved"))return null;var word=$target.text().trim(),$clone=this.createClone($target);this.animateOut($clone).then(function(){$clone.remove(),seedService.pick.dispatch({index:index,word:word})})}},{key:"_mixSeed",value:function(){for(var i=0;i<100;i++)this.parts.sort(function(){var num=Math.random();return num<.33?-1:.66<num?1:0})}}]),Seed}())};controller.$inject=["SeedBase","seedService","$element"],angular.module("app.create").component("wSeedRead",{bindings:{type:"@",seed:"@"},controller:controller,templateUrl:"modules/create/directives/seed/seed.html"})}(),function(){var factory=function(){return{revert:new tsUtils.Signal,pick:new tsUtils.Signal,clear:new tsUtils.Signal}};factory.$inject=[],angular.module("app.create").factory("seedService",factory)}(),function(){var controller=function(SeedBase,$element,seedService,$scope,createPromise){var tsUtils=require("ts-utils");return new(function(){function SeedWrite(){_classCallCheck(this,SeedWrite);var _this141=_possibleConstructorReturn(this,(SeedWrite.__proto__||Object.getPrototypeOf(SeedWrite)).call(this,$element));return _this141.onFulfilled=null,_this141.onTouch=null,_this141._$container=null,_this141._children=[],_this141._containerWidth=null,_this141}return _inherits(SeedWrite,SeedBase),_createClass(SeedWrite,[{key:"$postLink",value:function(){_get2(SeedWrite.prototype.__proto__||Object.getPrototypeOf(SeedWrite.prototype),"$postLink",this).call(this),this._$container=$element.find(".seed-container"),this._containerWidth=this._$container.width(),this.receive(seedService.pick,this._show,this),this.receive(seedService.clear,this._clear,this)}},{key:"_clear",value:function(){this._children.forEach(this._removePart,this)}},{key:"_removePart",value:function(child){var _this142=this;createPromise(this,this.animateOut(child.$element)).then(function(){seedService.revert.dispatch(child.randomIndex);var filter=tsUtils.notContains(_this142._getChildByElement(child.$element));_this142._children=_this142._children.filter(filter),child.$element.remove(),_this142._resetPositions()})}},{key:"_resetPositions",value:function(){var _this143=this,currentLine=SeedWrite._getPropertyGetter(this._$container,"padding-top")(),currentWidth=0,lines={};this._children.forEach(function(child){currentWidth+child.width<_this143._containerWidth?currentWidth+=child.width:(currentWidth=child.width,currentLine+=child.height),lines[currentLine]||(lines[currentLine]=[]),lines[currentLine].push(child)}),Object.keys(lines).forEach(function(lineName){var line=lines[lineName],width=_this143._getLineWidth(line),left=(_this143._$container.outerWidth()-width)/2;line.forEach(function(child){var itemLeft=left;child.line?child.line!==Number(lineName)?_this143.animateOut(child.$element).then(function(){child.$element.css({left:itemLeft,top:child.line}),_this143.animateIn(child.$element)}):_this143.animate(child.$element,{left:left,top:child.line}):(child.$element.css({left:itemLeft,top:Number(lineName)}),_this143.animateIn(child.$element)),child.line=Number(lineName),left+=child.width})})}},{key:"_show",value:function(_ref61){var _this144=this,index=_ref61.index,word=_ref61.word,$element=$('<span class="seed-item ghost">'+word+"</span>");this._$container.append($element);var child=this._createChild({index:index,word:word,$element:$element});if(this._children.push(child),$element.removeClass("ghost"),this._resetPositions(),$element.on("click",function(){_this144._removePart(child),_this144.onTouch(),$scope.$digest()}),this.onFulfilled&&this._children.length===this.parts.length){var isValid=this._children.map(function(child){return child.word}).join(" ")===this.seed;this.onFulfilled({isValid:isValid}),isValid&&this._$container.children().each(function(i,element){$(element).off("click"),_this144._$container.addClass("seed-confirmed")})}else this.onTouch()}},{key:"_createChild",value:function(_ref62){var index=_ref62.index,word=_ref62.word,$element=_ref62.$element,margin=SeedWrite._getPropertyGetter($element,"margin-left")(),child={randomIndex:index,word:word,width:$element.outerWidth()+2*margin,height:$element.outerHeight()+2*margin,$element:$element,line:null};return[{name:"left",get:SeedWrite._getPropertyGetter($element,"left")},{name:"top",get:SeedWrite._getPropertyGetter($element,"top")}].forEach(function(item){Object.defineProperty(child,item.name,{get:item.get})}),child}},{key:"_getLineWidth",value:function(line){return line.reduce(function(result,child){return result+child.width},0)}},{key:"_getChildByElement",value:function($element){return tsUtils.find(this._children,function(child){return child.$element.get(0)===$element.get(0)})}}],[{key:"_getPropertyGetter",value:function($element,property){return function(){return parseInt($element.css(property),10)}}}]),SeedWrite}())};controller.$inject=["SeedBase","$element","seedService","$scope","createPromise"],angular.module("app.create").component("wSeedWrite",{bindings:{seed:"@",onFulfilled:"&",onTouch:"&"},template:'<div class="seed-container"></div>',transclude:!1,controller:controller})}(),function(){var controller=function(Base,waves,user,utils,createPoll,$scope,$element,notification,dexDataService,ease,$state,modalManager,balanceWatcher,transactions){var _require37=require("ramda"),without=_require37.without,keys=_require37.keys,last=_require37.last,Money=require("@waves/data-entities").Money,BigNumber=require("@waves/bignumber").BigNumber,ds=require("data-service"),analytics=require("@waves/event-sender");return new(function(){function CreateOrder(){_classCallCheck(this,CreateOrder);var _this145=_possibleConstructorReturn(this,(CreateOrder.__proto__||Object.getPrototypeOf(CreateOrder)).call(this));_this145.maxAmountBalance=null,_this145.canBuyOrder=!0,_this145.amountBalance=null,_this145.priceBalance=null,_this145.type="buy",_this145.maxPriceBalance=null,_this145.total=null,_this145.amount=null,_this145.price=null,_this145.loadingError=!1,_this145.idDemo=!user.address,_this145.ERROR_DISPLAY_INTERVAL=3,_this145._assetIdPair=null,_this145.analyticsPair=null,_this145.lastTradePrice=null,_this145.changedInputName=[],_this145._silenceNow=!1,_this145._userList=[],_this145.expirationValues=[{name:"5min",value:function(){return utils.moment().add().minute(5).getDate().getTime()}},{name:"30min",value:function(){return utils.moment().add().minute(30).getDate().getTime()}},{name:"1hour",value:function(){return utils.moment().add().hour(1).getDate().getTime()}},{name:"1day",value:function(){return utils.moment().add().day(1).getDate().getTime()}},{name:"1week",value:function(){return utils.moment().add().week(1).getDate().getTime()}},{name:"30day",value:function(){return utils.moment().add().day(29).getDate().getTime()}}],_this145.maxAmount=null,_this145.feeList=[],_this145.matcherSettings={},_this145.feePoll=null,_this145.observe(["type","amount","price","amountBalance","fee"],_this145._currentMaxAmount),_this145.receive(dexDataService.chooseOrderBook,function(_ref63){var type=_ref63.type,price=_ref63.price,amount=_ref63.amount;switch(_this145.expand(type),type){case"buy":_this145._onClickBuyOrder(price,amount);break;case"sell":_this145._onClickSellOrder(price,amount);break;default:throw new Error("Wrong order type!")}$scope.$digest()}),_this145.syncSettings({_assetIdPair:"dex.assetIdPair",expiration:"dex.createOrder.expirationName"}),_this145.analyticsPair=_this145._assetIdPair.amount+" / "+_this145._assetIdPair.price;var lastTraderPoll=void 0,spreadPoll=createPoll(_this145,_this145._getData,_this145._setData,1e3);_this145.receive(balanceWatcher.change,function(){_this145._updateBalances(),"dynamic"===_this145.matcherSettings.mode&&_this145._updateFeeList()},_this145),_this145._updateBalances();var lastTradePromise=new Promise(function(resolve){balanceWatcher.ready.then(function(){lastTraderPoll=createPoll(_this145,_this145._getLastPrice,"lastTradePrice",1e3),resolve()})});return Promise.all([ds.api.pairs.get(_this145._assetIdPair.amount,_this145._assetIdPair.price),lastTradePromise,spreadPoll.ready]).then(function(_ref64){var pair=_slicedToArray(_ref64,1)[0];_this145.amount=new Money(0,pair.amountAsset),_this145.lastTradePrice&&_this145.lastTradePrice.getTokens().gt(0)?_this145.price=_this145.lastTradePrice:_this145.price=_this145._getCurrentPrice()}),_this145.observe(["amountBalance","type","fee","priceBalance"],_this145._updateMaxAmountOrPriceBalance),_this145.observe("_assetIdPair",function(){_this145.amount=null,_this145.price=null,_this145.total=null,_this145.bid=null,_this145.ask=null,_this145._updateBalances(),spreadPoll.restart();var form=_this145.order;form.$setUntouched(),form.$setPristine(),lastTraderPoll&&lastTraderPoll.restart(),_this145.isLockedPair=utils.isLockedInDex(_this145._assetIdPair.amount,_this145._assetIdPair.price),_this145.analyticsPair=_this145._assetIdPair.amount+" / "+_this145._assetIdPair.price,_this145.observeOnce(["bid","ask"],utils.debounce(function(){_this145.type&&(_this145.amount=_this145.amountBalance.cloneWithTokens("0"),_this145.price=_this145._getCurrentPrice(),_this145.total=_this145.priceBalance.cloneWithTokens("0"),$scope.$apply())})),_this145._setMatcherSettings()}),_this145.observe(["priceBalance","total","maxPriceBalance"],_this145._setIfCanBuyOrder),_this145.observe("amount",function(){return!_this145._silenceNow&&_this145._updateField({amount:_this145.amount})}),_this145.observe("price",function(){return!_this145._silenceNow&&_this145._updateField({price:_this145.price})}),_this145.observe("total",function(){return!_this145._silenceNow&&_this145._updateField({total:_this145.total})}),$element.on("mousedown touchstart",".body",function(e){e.stopPropagation()}),user.getFilteredUserList().then(function(list){_this145._userList=list}),_this145._setMatcherSettings(),_this145.observe("matcherSettings",function(){"dynamic"===_this145.matcherSettings.feeMode?(_this145._updateFeeList(),_this145.feePoll||(_this145.feePoll=createPoll(_this145,_this145._getFeeRates,_this145._updateFeeList,2e4))):(_this145.fee=_this145.matcherSettings.fee,_this145.feeList=[],_this145.feePoll&&(_this145.feePoll.destroy(),_this145.feePoll=null)),$scope.$apply()}),_this145}return _inherits(CreateOrder,Base),_createClass(CreateOrder,[{key:"priceDisplayName",get:function(){return this.priceBalance&&this.priceBalance.asset.displayName||""}},{key:"amountDisplayName",get:function(){return this.amountBalance&&this.amountBalance.asset.displayName||""}},{key:"loaded",get:function(){return this.amountBalance&&this.priceBalance&&this.fee}}]),_createClass(CreateOrder,[{key:"isActiveBalanceButton",value:function(factor){var amount=this.amount;return!(!amount||amount.getTokens().eq(0))&&this.maxAmount.cloneWithTokens(this.maxAmount.getTokens().mul(factor)).eq(amount)}},{key:"setAmountByBalance",value:function(factor){var amount=this.maxAmount.cloneWithTokens(this.maxAmount.getTokens().mul(factor));return this._updateField({amount:amount}),Promise.resolve()}},{key:"hasBalance",value:function(){return!this.maxAmount.getTokens().isZero()}},{key:"expand",value:function(type){this.type=type,this.price&&!this.price.getTokens().eq("0")||(this.price=this._getCurrentPrice()),$element.parent().parent().parent().parent().parent().addClass("expanded")}},{key:"closeCreateOrder",value:function(){$element.parent().parent().parent().parent().parent().removeClass("expanded")}},{key:"isAmountInvalid",value:function(){return this.isDirtyAndInvalid(this.order.amount)}},{key:"isPriceInvalid",value:function(){return this.isDirtyAndInvalid(this.order.price)}},{key:"isTotalInvalid",value:function(){return this.isDirtyAndInvalid(this.order.total)}},{key:"isDirtyAndInvalid",value:function(field){return field.$touched&&field.$invalid}},{key:"setMaxAmount",value:function(){var amount=this.maxAmount;this._updateField({amount:amount})}},{key:"setMaxPrice",value:function(){var amount=this.maxAmount,total=this.priceBalance.cloneWithTokens(this.price.getTokens().mul(amount.getTokens())),price=this.price;this._updateField({amount:amount,total:total,price:price})}},{key:"setBidPrice",value:function(){var price=this.priceBalance.cloneWithTokens(String(this.bid.price));this._updateField({price:price})}},{key:"setAskPrice",value:function(){var price=this.priceBalance.cloneWithTokens(String(this.ask.price));this._updateField({price:price})}},{key:"setLastPrice",value:function(){var price=this.lastTradePrice;this._updateField({price:price})}},{key:"setChangedInput",value:function(field){if(last(this.changedInputName)===field)return null;2===this.changedInputName.length&&this.changedInputName.shift(),this.changedInputName.push(field)}},{key:"createOrder",value:function($event){var _this146=this;if(this.idDemo)return this._showDemoModal();var form=this.order;$event.preventDefault();var notify=$element.find(".js-order-notification");return notify.removeClass("success").removeClass("error"),ds.fetch(ds.config.get("matcher")).then(function(matcherPublicKey){form.$setUntouched(),$scope.$apply();var data={orderType:_this146.type,price:_this146.price,amount:_this146.amount,matcherFee:_this146.fee,matcherPublicKey:matcherPublicKey};_this146._checkScriptAssets().then(function(){return _this146._checkOrder(data)}).then(function(){return _this146._sendOrder(data)}).then(function(data){if(!data)return null;notify.addClass("success"),_this146.createOrderFailed=!1,analytics.send({name:"DEX "+_this146.type+" Order Transaction Success",params:_this146.analyticsPair}),dexDataService.createOrder.dispatch(),CreateOrder._animateNotification(notify)}).catch(function(){_this146.createOrderFailed=!0,notify.addClass("error"),analytics.send({name:"DEX "+_this146.type+" Order Transaction Error",params:_this146.analyticsPair}),$scope.$apply(),CreateOrder._animateNotification(notify)})})}},{key:"_sendOrder",value:function(data){var _this147=this,expiration=ds.utils.normalizeTime(this.expirationValues.find(function(el){return el.name===_this147.expiration}).value()),clone=_extends({},data,{expiration:expiration});return utils.createOrder(clone)}},{key:"_checkScriptAssets",value:function(){if(user.getSetting("tradeWithScriptAssets"))return Promise.resolve();var scriptAssets=[this.amountBalance.asset,this.priceBalance.asset].filter(function(asset){return asset.hasScript});return 0<scriptAssets.length?modalManager.showDexScriptedPair(scriptAssets):Promise.resolve()}},{key:"_checkOrder",value:function(orderData){var isBuy="buy"===orderData.orderType,limit=1+(isBuy?1:-1)*(Number(user.getSetting("orderLimit"))||0),price=new BigNumber(isBuy?this.ask.price:this.bid.price).mul(limit),orderPrice=orderData.price.getTokens();return price.isNaN()||price.eq(0)?Promise.resolve():(isBuy?orderPrice.sub(price):price.sub(orderPrice)).isNegative()?Promise.resolve():modalManager.showConfirmOrder(_extends({},orderData,{orderLimit:100*Number(user.getSetting("orderLimit"))})).catch(function(){throw new Error("You have cancelled the creation of this order")})}},{key:"_showDemoModal",value:function(){var _this148=this;return modalManager.showDialogModal({iconClass:"open-main-dex-account-info",message:{literal:"modal.createOrder.message"},buttons:[{success:!1,classes:"big",text:{literal:"modal.createOrder.cancel"},click:function(){return $state.go("create")}},{success:!0,classes:"big submit",text:{literal:"modal.createOrder.ok"},click:function(){return $state.go(0<_this148._userList.length?"signIn":"welcome")}}]}).catch(function(){return null}).then(function(){var form=_this148.order;_this148.amount=null,form.$setUntouched(),form.$setPristine()})}},{key:"_onClickBuyOrder",value:function(priceStr,amountStr){this.changedInputName=["price"];var price=this.priceBalance.cloneWithTokens(priceStr),maxAmount=this.amountBalance.cloneWithTokens(this.priceBalance.getTokens().div(priceStr)),amount=Money.min(this.amountBalance.cloneWithTokens(amountStr),maxAmount);this._updateField({amount:amount,price:price})}},{key:"_onClickSellOrder",value:function(priceStr,amountStr){this.changedInputName=["price"];var price=this.priceBalance.cloneWithTokens(priceStr),amountMoney=this.amountBalance.cloneWithTokens(amountStr),amount=Money.min(amountMoney,this.maxAmount);this._updateField({amount:amount,price:price})}},{key:"_getMaxAmountForSell",value:function(){var fee=this.fee;return this.amountBalance.safeSub(fee).toNonNegative()}},{key:"_getMaxAmountForBuy",value:function(){var fee=this.fee;return fee&&this.price&&!this.price.getTokens().eq(0)?this.amountBalance.cloneWithTokens(this.priceBalance.safeSub(fee).toNonNegative().getTokens().div(this.price.getTokens()).roundTo(this.amountBalance.asset.precision)):this.amountBalance.cloneWithTokens("0")}},{key:"_currentMaxAmount",value:function(){"buy"===this.type?this.maxAmount=this._getMaxAmountForBuy():this.maxAmount=this._getMaxAmountForSell()}},{key:"_getLastPrice",value:function(){var _this149=this;return transactions.getExchangeTxList({amountAsset:this._assetIdPair.amount,priceAsset:this._assetIdPair.price,limit:1}).then(function(_ref66){var tx=_slicedToArray(_ref66,1)[0];return tx&&tx.price||null}).catch(function(){return _this149.loadingError=!1})}},{key:"_updateMaxAmountOrPriceBalance",value:function(){if(!this.amountBalance||!this.fee||!this.priceBalance)return null;"sell"===this.type?(this.maxAmountBalance=this._getMaxAmountForSell(),this.maxPriceBalance=null):(this.maxAmountBalance=null,this.maxPriceBalance=this.priceBalance.safeSub(this.fee).toNonNegative())}},{key:"_getCurrentPrice",value:function(){switch(this.type){case"sell":return this.priceBalance.cloneWithTokens(String(this.bid&&this.bid.price||0));case"buy":return this.priceBalance.cloneWithTokens(String(this.ask&&this.ask.price||0));default:throw new Error("Wrong type")}}},{key:"_updateBalances",value:function(){var _this150=this;return this.idDemo?ds.api.pairs.get(this._assetIdPair.amount,this._assetIdPair.price).then(function(pair){_this150.amountBalance=Money.fromTokens(10,pair.amountAsset),_this150.priceBalance=Money.fromTokens(10,pair.priceAsset),utils.safeApply($scope)}):ds.api.pairs.get(this._assetIdPair.amount,this._assetIdPair.price).then(function(pair){_this150.amountBalance=balanceWatcher.getBalanceByAsset(pair.amountAsset),_this150.priceBalance=balanceWatcher.getBalanceByAsset(pair.priceAsset),utils.safeApply($scope)})}},{key:"_updateField",value:function(newState){var _this151=this;this.loaded&&this._setSilence(function(){_this151._applyState(newState);var changingValues=without(keys(newState),["price","total","amount"]),changingValue=void 0;changingValue=1===changingValues.length?changingValues[0]:(0===_this151.changedInputName.length&&_this151.changedInputName.push("price"),changingValues.some(function(el){return el===last(_this151.changedInputName)})?changingValues.find(function(el){return el!==last(_this151.changedInputName)}):without(_this151.changedInputName,changingValues)[0]),_this151._calculateField(changingValue),_this151._setIfCanBuyOrder()})}},{key:"_applyState",value:function(newState){var _this152=this;keys(newState).forEach(function(key){_this152[key]=newState[key]}),this.order.$setDirty()}},{key:"_setSilence",value:function(cb){this._silenceNow=!0,cb(),this._silenceNow=!1}},{key:"_calculateField",value:function(fieldName){switch(fieldName){case"total":this._calculateTotal();break;case"price":this._calculatePrice();break;case"amount":this._calculateAmount()}}},{key:"_calculateTotal",value:function(){if(!this.price||!this.amount)return null;var price=this._validPrice(),amount=this._validAmount();this._setDirtyField("total",this.priceBalance.cloneWithTokens(price.mul(amount))),this._silenceNow=!0}},{key:"_calculatePrice",value:function(){if(!this.total||!this.amount)return null;var total=this._validTotal(),amount=this._validAmount();this._setDirtyField("price",this.priceBalance.cloneWithTokens(total.div(amount))),this._silenceNow=!0}},{key:"_calculateAmount",value:function(){if(!this.total||!this.price)return null;var total=this._validTotal(),price=this._validPrice();this._setDirtyField("amount",this.amountBalance.cloneWithTokens(total.div(price))),this._silenceNow=!0}},{key:"_validTotal",value:function(){return""===this.order.total.$viewValue?this.priceBalance.cloneWithTokens("0").getTokens():this.total.getTokens()}},{key:"_validPrice",value:function(){return""===this.order.price.$viewValue?this.amountBalance.cloneWithTokens("0").getTokens():this.price.getTokens()}},{key:"_validAmount",value:function(){return""===this.order.amount.$viewValue?this.amountBalance.cloneWithTokens("0").getTokens():this.amount.getTokens()}},{key:"_setIfCanBuyOrder",value:function(){"buy"===this.type&&this.total&&this.priceBalance&&this.total.asset.id===this.priceBalance.asset.id?this.maxPriceBalance&&(this.canBuyOrder=this.total.lte(this.maxPriceBalance)&&this.maxPriceBalance.getTokens().gt(0)):this.canBuyOrder=!0}},{key:"_getData",value:function(){var _this153=this;return this.loadingError=!1,waves.matcher.getOrderBook(this._assetIdPair.amount,this._assetIdPair.price).then(function(_ref68){var bids=_ref68.bids,asks=_ref68.asks,spread=_ref68.spread;return{lastAsk:_slicedToArray(asks,1)[0],firstBid:_slicedToArray(bids,1)[0],spread:spread}}).catch(function(){return _this153.loadingError=!0})}},{key:"_setData",value:function(_ref69){var lastAsk=_ref69.lastAsk,firstBid=_ref69.firstBid;this.bid=firstBid||{price:0},this.ask=lastAsk||{price:0};var sell=Number(this.bid.price),buy=Number(this.ask.price);this.spreadPercent=buy?(100*(buy-sell)/buy||0).toFixed(2):"0.00",$scope.$digest()}},{key:"_setDirtyField",value:function(field,value){if(value.getTokens().isNaN()||!value.getTokens().isFinite())return null;this[field]=value,this.order.$setDirty()}},{key:"_updateFeeList",value:function(){var _this154=this;return this._getFeeRates().then(function(list){var assetsId=_this154._getOrderedCustomFeeAssetsList(list);Promise.all(assetsId.map(function(id){return balanceWatcher.getBalanceByAssetId(id)})).then(function(balances){var basedCustomFee=_this154.matcherSettings.basedCustomFee,feeList=balances.map(function(balance){var id=balance.asset.id,rate=new BigNumber(list[id]);return balance.cloneWithCoins(rate.mul(basedCustomFee[id]))}),filteredFeeList=feeList.filter(function(fee,i){return fee.lte(balances[i])});filteredFeeList.length?1===filteredFeeList.length?(_this154.fee=filteredFeeList[0],_this154.feeList=[]):(_this154.fee=filteredFeeList[0],_this154.feeList=filteredFeeList):(_this154.fee=feeList[0],_this154.feeList=[])})}).catch(function(){_this154.feeList=[]})}},{key:"_getFeeRates",value:function(){return waves.matcher.getFeeRates()}},{key:"_setMatcherSettings",value:function(){var _this155=this;return Promise.all([ds.api.pairs.get(this._assetIdPair.amount,this._assetIdPair.price),ds.fetch(ds.config.get("matcher"))]).then(function(_ref70){var _ref71=_slicedToArray(_ref70,2),pair=_ref71[0],matcherPublicKey=_ref71[1];waves.matcher.getCreateOrderSettings(pair,matcherPublicKey).then(function(data){_this155.matcherSettings=data})})}},{key:"_getOrderedCustomFeeAssetsList",value:function(list){var currentFeeAsset=this.fee&&this.fee.asset.id||WavesApp.defaultAssets.WAVES,_Object$keys$reduce=Object.keys(list).reduce(function(acc,id){return id===currentFeeAsset?acc.currentFee.push(id):acc.otherFee.push(id),acc},{currentFee:[],otherFee:[]}),currentFee=_Object$keys$reduce.currentFee,otherFee=_Object$keys$reduce.otherFee;return[].concat(_toConsumableArray(currentFee),_toConsumableArray(otherFee))}}],[{key:"_animateNotification",value:function($element){return utils.animate($element,{t:100},{duration:1200,step:function(tween){var progress=ease.bounceOut(tween/100);$element.css("transform","translate(0, "+(100*progress-100)+"%)")}}).then(function(){return utils.wait(700)}).then(function(){return utils.animate($element,{t:0},{duration:500,step:function(tween){var progress=ease.linear(tween/100);$element.css("transform","translate(0, "+-100*(1-progress)+"%)")}})})}}]),CreateOrder}())};controller.$inject=["Base","waves","user","utils","createPoll","$scope","$element","notification","dexDataService","ease","$state","modalManager","balanceWatcher","transactions"],angular.module("app.dex").component("wCreateOrder",{bindings:{},templateUrl:"modules/dex/directives/createOrder/createOrder.html",transclude:!1,controller:controller})}(),function(){var DISABLED_FEATURES=["header_screenshot","header_symbol_search","symbol_search_hot_key","display_market_status","control_bar","timeframes_toolbar","volume_force_overlay","header_compare"];function getOverrides(candleUpColor,candleDownColor){return{"mainSeriesProperties.candleStyle.upColor":candleUpColor,"mainSeriesProperties.candleStyle.downColor":candleDownColor,"mainSeriesProperties.candleStyle.drawBorder":!1,"mainSeriesProperties.hollowCandleStyle.upColor":candleUpColor,"mainSeriesProperties.hollowCandleStyle.downColor":candleDownColor,"mainSeriesProperties.hollowCandleStyle.drawBorder":!1,"mainSeriesProperties.barStyle.upColor":candleUpColor,"mainSeriesProperties.barStyle.downColor":candleDownColor,"mainSeriesProperties.haStyle.upColor":candleUpColor,"mainSeriesProperties.haStyle.downColor":candleDownColor,"mainSeriesProperties.haStyle.drawBorder":!1,"mainSeriesProperties.lineStyle.color":candleUpColor,"mainSeriesProperties.areaStyle.color1":candleUpColor,"mainSeriesProperties.areaStyle.color2":candleUpColor,"mainSeriesProperties.areaStyle.linecolor":candleUpColor,volumePaneSize:"medium"}}function getStudiesOverrides(_ref72){return{"volume.volume.color.0":_ref72.volume0,"volume.volume.color.1":_ref72.volume1}}function controller(Base,candlesService,$scope,themes,user){return new(function(){function DexCandleChart(){_classCallCheck(this,DexCandleChart);var _this156=_possibleConstructorReturn(this,(DexCandleChart.__proto__||Object.getPrototypeOf(DexCandleChart)).call(this));return _this156.elementId="tradingview"+counter++,_this156.notLoaded=!1,_this156._chart=null,_this156._chartReady=!1,_this156._assetIdPairWasChanged=!1,_this156._changeTheme=!0,_this156._assetIdPair=null,_this156.loadingTradingView=!0,_this156.theme=user.getSetting("theme"),_this156.candle=user.getSetting("candle"),_this156.observe("_assetIdPair",_this156._onChangeAssetPair),_this156.observe("theme",function(){_this156._changeTheme=!0,_this156._resetTradingView()}),_this156.observe("candle",_this156._refreshTradingView),_this156.syncSettings({_assetIdPair:"dex.assetIdPair"}),_this156.syncSettings({theme:"theme"}),_this156.syncSettings({candle:"candle"}),_this156}return _inherits(DexCandleChart,Base),_createClass(DexCandleChart,[{key:"$postLink",value:function(){var _this157=this;controller.load().then(function(){_this157._createTradingView(),_this157.listenEventEmitter(i18next,"languageChanged",_this157._changeLangHandler.bind(_this157))},function(){console.warn("Error 403!"),_this157.notLoaded=!0}).then(function(){$scope.$apply()})}},{key:"$onDestroy",value:function(){_get2(DexCandleChart.prototype.__proto__||Object.getPrototypeOf(DexCandleChart.prototype),"$onDestroy",this).call(this),this._removeTradingView()}},{key:"_onChangeAssetPair",value:function(){this._chartReady?this._setChartPair():this._assetIdPairWasChanged=!0}},{key:"_resetTradingView",value:function(){try{return this._removeTradingView()._createTradingView()}catch(e){}}},{key:"_removeTradingView",value:function(){candlesService.unsubscribeBars();try{this._chart&&this._chart.remove()}catch(e){}return this._chart=null,this}},{key:"_refreshTradingView",value:function(){if(!this._chart)return null;var _themes$getCurrentCan=themes.getCurrentCandleSColor(this.candle),up=_themes$getCurrentCan.up,down=_themes$getCurrentCan.down,volume0=_themes$getCurrentCan.volume0,volume1=_themes$getCurrentCan.volume1,overrides=getOverrides(up,down),studiesOverrides=getStudiesOverrides({volume0:volume0,volume1:volume1});this._chart.applyOverrides(overrides),this._chart.applyStudiesOverrides(studiesOverrides)}},{key:"_createTradingView",value:function(){var _this158=this;this.loadingTradingView=!0;var _themes$getCurrentCan2=themes.getCurrentCandleSColor(this.candle),up=_themes$getCurrentCan2.up,down=_themes$getCurrentCan2.down,volume0=_themes$getCurrentCan2.volume0,volume1=_themes$getCurrentCan2.volume1,themeConf=themes.getTradingViewConfig(this.theme),overrides=_extends({},getOverrides(up,down),themeConf.OVERRIDES),studies_overrides=_extends({},getStudiesOverrides({volume0:volume0,volume1:volume1}),themeConf.STUDIES_OVERRIDES),toolbar_bg=themeConf.toolbarBg,custom_css_url=themeConf.customCssUrl;return this._chart=new TradingView.widget({locale:DexCandleChart._remapLanguageCode(i18next.language),symbol:this._assetIdPair.amount+"/"+this._assetIdPair.price,interval:user.getSetting("lastInterval"),container_id:this.elementId,datafeed:candlesService,library_path:"trading-view/",autosize:!0,toolbar_bg:toolbar_bg,disabled_features:DISABLED_FEATURES,overrides:overrides,studies_overrides:studies_overrides,custom_css_url:custom_css_url,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone}),this._chart.onChartReady(function(){_this158._changeTheme&&(_this158._chart.applyOverrides(overrides),_this158._chart.applyStudiesOverrides(studies_overrides)),_this158._changeTheme=!1,_this158.loadingTradingView=!1,_this158._assetIdPairWasChanged&&(_this158._setChartPair(),_this158._assetIdPairWasChanged=!1,_this158._chartReady=!0),_this158._chart.subscribe("onIntervalChange",function(e){user.setSetting("lastInterval",e)})}),this._chart.options.datafeed.onLoadError=function(){_this158.notLoaded=!0},this}},{key:"_setChartPair",value:function(){var _this159=this;this._chart.symbolInterval(function(_ref73){var interval=_ref73.interval;_this159._chart.setSymbol(_this159._assetIdPair.amount+"/"+_this159._assetIdPair.price,interval)})}},{key:"_changeLangHandler",value:function(){return this._resetTradingView()}}],[{key:"_remapLanguageCode",value:function(code){switch(code){case"hi_IN":case"id":return"en";case"zh_CN":return"zh";case"pt_BR":return"pt";default:return code}}}]),DexCandleChart}())}var counter=0;controller.$inject=["Base","candlesService","$scope","themes","user"],controller.load=function(){var script=document.createElement("script");script.src="/trading-view/charting_library.min.js";var promise=new Promise(function(resolve,reject){script.onload=resolve,script.onerror=reject,document.head.appendChild(script)});return controller.load=function(){return promise},promise},angular.module("app.dex").component("wDexCandleChart",{bindings:{},templateUrl:"modules/dex/directives/dexCandleChart/dex-candle-chart.html",transclude:!1,controller:controller})}(),function(){var controller=function(Base,$element,utils,i18n,dexDataService){var analytics=require("@waves/event-sender");return new(function(){function DexBlock(){_classCallCheck(this,DexBlock);var _this160=_possibleConstructorReturn(this,(DexBlock.__proto__||Object.getPrototypeOf(DexBlock)).call(this));return _this160.search="",_this160.titleLiteral=null,_this160.collapsed=!1,_this160.focused=!1,_this160.block=null,_this160._parent=null,i18n.translateField(_this160,"titleLiteral","title","app.dex"),_this160}return _inherits(DexBlock,Base),_createClass(DexBlock,[{key:"scrollToSpread",value:function(){dexDataService.showSpread.dispatch()}},{key:"$postLink",value:function(){this.syncSettings({collapsed:"dex.layout."+this.block+".collapsed"}),this._parent.collapseBlock(this.block,this.collapsed),this._parent.registerItem($element,this)}},{key:"toggleCollapse",value:function(){var _this161=this,collapsed=this.collapsed;collapsed?(this.collapsed=!collapsed,utils.wait(100).then(function(){analytics.send({name:_this161.analyticsText+" Show",target:"ui"}),_this161._parent.collapseBlock(_this161.block,_this161.collapsed)})):(this._parent.collapseBlock(this.block,!this.collapsed),utils.wait(300).then(function(){analytics.send({name:_this161.analyticsText+" Hide",target:"ui"}),_this161.collapsed=!collapsed}))}}]),DexBlock}())};controller.$inject=["Base","$element","utils","i18n","dexDataService"],angular.module("app.dex").component("wDexBlock",{require:{_parent:"^wLayout"},bindings:{titleLiteral:"@titleName",block:"@",hasSearch:"@",canCollapse:"@",analyticsText:"<",isActiveScroll:"<"},templateUrl:"modules/dex/directives/dexBlock/dexBlock.html",transclude:!0,controller:controller})}(),function(){var SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,_require41=require("ramda"),filter=_require41.filter,whereEq=_require41.whereEq,uniqBy=_require41.uniqBy,prop=_require41.prop,where=_require41.where,gt=_require41.gt,pick=_require41.pick,__=_require41.__,map=_require41.map,ds=require("data-service"),BigNumber=require("@waves/bignumber").BigNumber,Money=require("@waves/data-entities").Money,controller=function(Base,waves,user,createPoll,notification,utils,$scope,dexDataService,modalManager,permissionManager,ease,$element,transactions){return new(function(){function DexMyOrders(){_classCallCheck(this,DexMyOrders);var _this162=_possibleConstructorReturn(this,(DexMyOrders.__proto__||Object.getPrototypeOf(DexMyOrders)).call(this));return _this162._matcherPublicKeyPromise=ds.fetch(user.getSetting("network.matcher")),_this162.orders=[],_this162.isDemo=!user.address,_this162.pending=!!user.address,_this162.loadingError=!1,_this162.showAnimations=!1,_this162.isActiveOrders=!1,_this162.userList=[],_this162.syncSettings({_assetIdPair:"dex.assetIdPair",_matcherUrl:"network.matcher"}),_this162.observe("_matcherUrl",function(){_this162._matcherPublicKeyPromise=ds.fetch(user.getSetting("network.matcher"))}),user.getFilteredUserList().then(function(list){_this162.userList=list}),_this162}return _inherits(DexMyOrders,Base),_createClass(DexMyOrders,[{key:"$postLink",value:function(){var _this163=this;if(this.headers=[{id:"pair",valuePath:"item.pair",search:!0,placeholder:"directives.filter"},{id:"type",title:{literal:"directives.myOrders.type"},valuePath:"item.type",sort:!0},{id:"time",title:{literal:"directives.myOrders.time"},valuePath:"item.timestamp",sort:!0,sortActive:!0,isAsc:!1},{id:"amount",title:{literal:"directives.myOrders.amount"},valuePath:"item.amount",sort:!0},{id:"price",title:{literal:"directives.myOrders.price"},valuePath:"item.price",sort:!0},{id:"average",title:{literal:"directives.myOrders.average"},valuePath:"item.average",sort:!0},{id:"total",title:{literal:"directives.myOrders.total"},valuePath:"item.total",sort:!0},{id:"filled",title:{literal:"directives.myOrders.filled"},valuePath:"item.filledTotal",sort:!0},{id:"fee",title:{literal:"directives.myOrders.tableTitle.fee"},valuePath:"item.userFee",sort:!0},{id:"status",title:{literal:"directives.myOrders.status"},valuePath:"item.progress",sort:!0},this.isActiveOrders&&{id:"controls",templatePath:"modules/dex/directives/dexMyOrders/header-control-cell.html",scopeData:{cancelAllOrdersClick:function(){_this163.cancelAllOrders()},$ctrl:this}}||null].filter(Boolean),!this.isDemo){var poll=createPoll(this,this._getAllOrders,this._setOrders,1e3);poll.ready.then(function(){_this163.pending=!1}),this.receive(dexDataService.createOrder,function(){return poll.restart()}),this.poll=poll}}},{key:"setPair",value:function(order){if(this.isLockedPair(order.assetPair.amountAsset.id,order.assetPair.priceAsset.id))return null;user.setSetting("dex.assetIdPair",{amount:order.assetPair.amountAsset.id,price:order.assetPair.priceAsset.id})}},{key:"cancelAllOrders",value:function(){var _this164=this;if(!permissionManager.isPermitted("CAN_CANCEL_ORDER")){var $notify=$element.find(".js-order-notification");return DexMyOrders._animateNotification($notify),null}ds.cancelAllOrders({sender:user.publicKey,timestamp:user.matcherSign.timestamp,signature:user.matcherSign.signature}).then(function(){notification.info({ns:"app.dex",title:{literal:"directives.myOrders.notifications.canceledAll"}}),_this164.poll&&_this164.poll.restart()}).catch(function(e){var error=utils.parseError(e);notification.error({ns:"app.dex",title:{literal:"directives.myOrders.notifications.somethingWentWrong"},body:{literal:error&&error.message||error}})})}},{key:"round",value:function(data){return Math.round(Number(data))}},{key:"isSelected",value:function(order){return this._assetIdPair.amount===order.amount.asset.id&&this._assetIdPair.price===order.price.asset.id}},{key:"isLockedPair",value:function(amountAssetId,priceAssetId){return utils.isLockedInDex(amountAssetId,priceAssetId)}},{key:"dropOrderGetSignData",value:function(order){var data={id:order.id},signable=ds.signature.getSignatureApi().makeSignable({type:SIGN_TYPE.CANCEL_ORDER,data:data});return utils.signMatcher(signable).then(function(signable){return signable.getDataForApi()})}},{key:"dropOrder",value:function(order){var _this165=this;if(!permissionManager.isPermitted("CAN_CANCEL_ORDER")){var $notify=$element.find(".js-order-notification");return DexMyOrders._animateNotification($notify),null}var dataPromise=this.dropOrderGetSignData(order),classNameToOrder=function(className,argument_1){var isRemove=1<arguments.length&&void 0!==argument_1&&argument_1,$row=$element.find(".order_"+order.id).closest(".order-row");isRemove?$row.removeClass(className):$row.addClass(className)};classNameToOrder("pre-leave"),dataPromise.then(function(signedTxData){return ds.cancelOrder(signedTxData,order.amount.asset.id,order.price.asset.id)}).then(function(){classNameToOrder("force-leave"),_this165.orders.find(whereEq({id:order.id})).state="Canceled",notification.info({ns:"app.dex",title:{literal:"directives.myOrders.notifications.isCanceled"}}),_this165.poll&&_this165.poll.restart()}).catch(function(e){classNameToOrder("pre-leave",!0);var error=utils.parseError(e);notification.error({ns:"app.dex",title:{literal:"directives.myOrders.notifications.somethingWentWrong"},body:{literal:error&&error.message||error}})})}},{key:"_setOrders",value:function(orders){var needApply=!1;orders.forEach(function(order){var isNew=DexMyOrders._isNewOrder(order.timestamp.getTime());needApply=needApply||isNew!==order.isNew,order.isNew=isNew}),needApply&&$scope.$apply(),this.orders=orders,this.showAnimations=!0}},{key:"_getAllOrders",value:function(){var _this166=this;return waves.matcher.getOrders({isActive:this.isActiveOrders}).then(filter(whereEq({isActive:this.isActiveOrders}))).then(map(function(order){return _extends({},order,{isCancelled:"Cancelled"===order.status})})).then(function(orders){return _this166._isEqualOrders(orders)&&_this166._isAllPartialFilledOrdersHasTransactions()?_this166.orders:_this166._matcherPublicKeyPromise.then(function(matcherPublicKey){return Promise.all(orders.map(DexMyOrders._remapOrders(matcherPublicKey)))}).then(function(result){var lastOrder=result.slice().reverse().find(where({progress:gt(__,0)}));return(lastOrder?DexMyOrders._loadTransactions(lastOrder.timestamp.getTime()):Promise.resolve([])).then(function(txList){var hash=DexMyOrders._getTransactionsByOrderIdHash(txList);return _this166.loadingError=!1,result.map(function(order){return hash[order.id]||(hash[order.id]=[]),order.exchange=hash[order.id],order.average=DexMyOrders._getAveragePriceByExchange(order,order.exchange),order.filledTotal=order.price.cloneWithTokens(order.average.getTokens().mul(order.filled.getTokens())),order})}).catch(function(){return result})})}).catch(function(){return _this166.loadingError=!0,[]})}},{key:"_isEqualOrders",value:function(newOrders){return this.orders.length===newOrders.length&&this.orders.every(function(item,i){return whereEq(pick(["id","progress"],item),newOrders[i])})}},{key:"_isAllPartialFilledOrdersHasTransactions",value:function(){var minTimestamp=DexMyOrders._getMinTimestamp(),exchangeCount=0;return this.orders.filter(where({progress:gt(__,0),timestamp:gt(__,minTimestamp)})).every(function(order){return exchangeCount+=order.exchange.length,order.exchange.length&&order.filled.eq(order.exchange.map(function(tx){return tx.amount}).reduce(function(acc,amount){return acc.add(amount)}))||2e3<=exchangeCount})}}],[{key:"_getAveragePriceByExchange",value:function(order,exchangeList){if(!exchangeList.length)return order.price;var sum=exchangeList.map(function(tx){return{amount:tx.amount.getTokens(),total:tx.total.getTokens()}}).reduce(function(acc,item){return{amount:acc.amount.add(item.amount),total:acc.total.add(item.total)}},{amount:new BigNumber(0),total:new BigNumber(0)});return order.price.cloneWithTokens(sum.total.div(sum.amount))}},{key:"_animateNotification",value:function($element){return utils.animate($element,{t:100},{duration:1200,step:function(tween){var progress=ease.bounceOut(tween/100);$element.css("transform","translate(0, "+(100*progress-100)+"%)")}}).then(function(){return utils.wait(700)}).then(function(){return utils.animate($element,{t:0},{duration:500,step:function(tween){var progress=ease.linear(tween/100);$element.css("transform","translate(0, "+-100*(1-progress)+"%)")}})})}},{key:"_getTransactionsByOrderIdHash",value:function(txList){var uniqueList=uniqBy(prop("id"),txList),transactionsByOrderHash=Object.create(null);return uniqueList.forEach(function(tx){["order1","order2"].forEach(function(orderFieldName){transactionsByOrderHash[tx[orderFieldName].id]||(transactionsByOrderHash[tx[orderFieldName].id]=[]),transactionsByOrderHash[tx[orderFieldName].id].push(DexMyOrders._remapTx(tx))})}),transactionsByOrderHash}},{key:"_remapTx",value:function(tx){var userFee=[tx.order1,tx.order2].reduce(function(acc,order){return acc[order.orderType]=function(tx,order){return"sell"===order.orderType?tx.sellMatcherFee:tx.buyMatcherFee}(tx,order),acc},Object.create(null));return _extends({},tx,{userFee:userFee})}},{key:"_remapOrders",value:function(matcherPublicKey){return function(order){var assetPair=order.assetPair,pair=assetPair.amountAsset.displayName+" / "+assetPair.priceAsset.displayName,isNew=DexMyOrders._isNewOrder(order.timestamp.getTime()),percent=new BigNumber(100*order.progress).toFixed(2),feeAsset=order.feeAsset||order.matcherFeeAssetId||"WAVES",matcherFee=order.fee||order.matcherFee;return matcherFee?matcherFee instanceof Money?Promise.resolve(_extends({},order,{isNew:isNew,percent:percent,pair:pair,fee:matcherFee})):ds.api.assets.get(feeAsset).then(function(asset){var fee=new Money(matcherFee,asset);return _extends({},order,{isNew:isNew,percent:percent,pair:pair,fee:fee})}):waves.matcher.getCreateOrderFee(_extends({},order,{matcherPublicKey:matcherPublicKey})).then(function(fee){return _extends({},order,{isNew:isNew,percent:percent,pair:pair,fee:fee})})}}},{key:"_isNewOrder",value:function(timestamp){return ds.utils.normalizeTime(Date.now())<timestamp+8e3}},{key:"_loadTransactions",value:function(lastTime){var minTime=DexMyOrders._getMinTimestamp();return transactions.getExchangeTxList({sender:user.address,timeStart:ds.utils.normalizeTime(minTime<lastTime?lastTime:minTime)},{getAll:!0,limit:2e3})}},{key:"_getMinTimestamp",value:function(){var today=new Date;return new Date(today.getFullYear(),today.getMonth()-2,today.getDate(),today.getHours(),today.getMinutes()).getTime()}}]),DexMyOrders}())};controller.$inject=["Base","waves","user","createPoll","notification","utils","$scope","dexDataService","modalManager","permissionManager","ease","$element","transactions"],angular.module("app.dex").component("wDexMyOrders",{bindings:{isActiveOrders:"<"},templateUrl:"modules/dex/directives/dexMyOrders/myOrders.html",controller:controller})}(),function(){var TRADING_ASSETS=WavesApp.tradingPairs,DROP_DOWN_ORDER_LIST=["ETH","BCH","LTC","USD","EUR","BSV"],DROP_DOWN_LIST=[];DROP_DOWN_ORDER_LIST.forEach(function(name){DROP_DOWN_LIST.push({name:name,id:WavesApp.defaultAssets[name]})}),Object.keys(WavesApp.defaultAssets).forEach(function(name){DROP_DOWN_ORDER_LIST.includes(name)||"WAVES"===name||"BTC"===name||DROP_DOWN_LIST.push({name:name,id:WavesApp.defaultAssets[name]})});function controller(Base,$scope,utils,waves,stService,PromiseControl,createPoll,$element,modalManager,configService,matcher){var _require44=require("ramda"),equals=_require44.equals,uniq=_require44.uniq,not=_require44.not,find=_require44.find,propEq=_require44.propEq,filter=_require44.filter,whereEq=_require44.whereEq,uniqBy=_require44.uniqBy,prop=_require44.prop,path=_require44.path,flatten=_require44.flatten,splitEvery=_require44.splitEvery,ds=require("data-service"),BigNumber=require("@waves/bignumber").BigNumber;return $scope.WavesApp=WavesApp,new(function(){function WatchList(){_classCallCheck(this,WatchList);var _this167=_possibleConstructorReturn(this,(WatchList.__proto__||Object.getPrototypeOf(WatchList)).call(this,$scope));return _this167.pending=!1,_this167.loadingError=!1,_this167.dropDownId=null,_this167.dropDown=DROP_DOWN_LIST,_this167.isActiveSelect=!1,_this167.searchRequest=null,_this167.tabs=[{name:"directives.watchlist.all",value:"all"},{name:"WAVES",value:WavesApp.defaultAssets.WAVES},{name:"BTC",value:WavesApp.defaultAssets.BTC}],_this167.search="",_this167.searchInProgress=!1,_this167.activeTab="all",_this167.showOnlyFavorite=!1,_this167.pairDataList=null,_this167._isSelfSetPair=!1,_this167._searchAssets=[],_this167._searchAssetsHash=Object.create(null),_this167._favourite=[],_this167._favoriteHash=Object.create(null),_this167._lockedPairs=[],_this167._cache=utils.cache(controller.storage,WatchList._loadDataByPairs,WatchList._getKeyByPair,3e4,function(pair){return function(list){return list.find(function(p){return equals(p.pairIdList.slice().sort(),pair.slice().sort())})}}),_this167.headers=[{id:"favourite",templatePath:"modules/dex/directives/dexWatchlist/FavouritesColumnHeader.html",scopeData:{toggleOnlyFavourite:function(){_this167.showOnlyFavorite=!_this167.showOnlyFavorite,WatchList._renderSmartTable()},$ctrl:_this167}},{id:"pair",title:{literal:"directives.watchlist.pair"},sort:_this167._getComparatorByPath("pairNames")},{id:"price",title:{literal:"directives.watchlist.price"},sort:_this167._getComparatorByPath("lastPrice")},{id:"change",title:{literal:"directives.watchlist.chg"},sort:_this167._getComparatorByPath("change24")},{id:"volume",title:{literal:"directives.watchlist.volume"},sortActive:!0,isAsc:!1,sort:_this167._getComparatorByPath("volume")},{id:"info"}],_this167.tableOptions={filter:_this167._getTableFilter()},_this167}return _inherits(WatchList,Base),_createClass(WatchList,[{key:"$postLink",value:function(){var _this168=this;this.observe("dropDownId",this._onChangeDropDown),this.observe("_favourite",this._updateFavoriteHash),this.observe("_searchAssets",this._updateSearchAssetHash),this.observe("search",this._onChangeSearch),this.syncSettings({activeTab:"dex.watchlist.activeTab",showOnlyFavorite:"dex.watchlist.showOnlyFavorite",_favourite:"dex.watchlist.favourite",_assetIdPair:"dex.assetIdPair"}),this._initializeActiveTab(),this.observe("_assetIdPair",this._onChangeChosenPair),this.observe("activeTab",this._onChangeActiveTab),stService.draw.once(WatchList._onRenderTable),this.pending=!0,this._poll=createPoll(this,this._getPairData,"pairDataList",3e4,{$scope:$scope}),this._poll.ready.then(function(){_this168.pending=!1})}},{key:"showAssetInfo",value:function(event,asset){return event.preventDefault(),event.stopPropagation(),modalManager.showAssetInfo(asset)}},{key:"isChosen",value:function(pairData){return this._assetIdPair.amount===pairData.amountAsset.id&&this._assetIdPair.price===pairData.priceAsset.id}},{key:"isLockedPair",value:function(amountAssetId,priceAssetId){return utils.isLockedInDex(amountAssetId,priceAssetId)}},{key:"choosePair",value:function(pairData){var pair={amount:pairData.amountAsset.id,price:pairData.priceAsset.id};if(this.isLockedPair(pair.amount,pair.price))return null;this._isSelfSetPair=!0,this._assetIdPair=pair,this._isSelfSetPair=!1}},{key:"chooseTrading",value:function(){this.isActiveSelect=!1,this.activeTab="trading"}},{key:"chooseSelect",value:function(){this.isActiveSelect=!0,this.activeTab=this.dropDownId}},{key:"chooseTab",value:function(id){this.isActiveSelect=!1,this.activeTab=id}},{key:"toggleFavourite",value:function($event,pair){$event.stopPropagation();var key=WatchList._getKeyByPair(pair.pairIdList),favorite=this._favourite.slice();if(this._favoriteHash[key]){this._favourite=favorite.filter(function(p){return not(function(p){return equals(p,pair.pairIdList)||equals(p,pair.pairIdList.reverse())}(p))})}else favorite.push(pair.pairIdList),this._favourite=uniq(favorite);WatchList._renderSmartTable()}},{key:"isFavourite",value:function(pair){return!!this._favoriteHash[WatchList._getKeyByPair(pair.pairIdList)]}},{key:"_isActiveTrading",value:function(){return"trading"===this.activeTab}},{key:"_initializeActiveTab",value:function(){find(propEq("value",this.activeTab),this.tabs)||this._isActiveTrading()||(this.isActiveSelect=!0,this.dropDownId=this.activeTab)}},{key:"_onChangeChosenPair",value:function(){var _this169=this,pair=this._assetIdPair,id=[pair.amount,pair.price].sort().join();!this._favoriteHash[id]&&this.showOnlyFavorite&&(this.showOnlyFavorite=!1),find(propEq("id",id),this.pairDataList)?WatchList._renderSmartTable():this._cache([id.split(",")]).then(function(_ref74){var item=_slicedToArray(_ref74,1)[0];_this169.pairDataList.push(item),WatchList._renderSmartTable()}),this._isSelfSetPair||(this.activeTab="all",stService.draw.once(WatchList._onRenderTable))}},{key:"_onChangeDropDown",value:function(){this.isActiveSelect&&(this.activeTab=this.dropDownId)}},{key:"_getPairData",value:function(){var _this170=this,pairs=this._getPairList();return Promise.all([this._getTabRate(),this._cache(pairs)]).then(function(_ref76){var _ref77=_slicedToArray(_ref76,2),rate=_ref77[0],pairs=_ref77[1];return _this170.loadingError=!1,pairs.map(WatchList._addRateForPair(rate))}).catch(function(){_this170.loadingError=!0})}},{key:"_getTabRate",value:function(){var _this171=this,activeTab=this.activeTab;return this._isActiveTrading()?Promise.resolve(new BigNumber(1)):waves.node.assets.getAsset("all"===activeTab?WavesApp.defaultAssets.WAVES:activeTab).then(function(asset){return _this171.volumeAsset=asset,"all"===activeTab?Promise.resolve(new BigNumber(1)):waves.utils.getRate(WavesApp.defaultAssets.WAVES,activeTab)})}},{key:"_getTableFilter",value:function(){var _this172=this;return function(list){return""!==_this172.search?list.filter(function(item){return _this172._filterDataItemByTab(item)&&_this172._filterDataItemByQuery(item)}):list.filter(function(item){return _this172._filterDataItemByTab(item)})}}},{key:"_filterDataItemByTab",value:function(item){if(this._isActiveTrading())return!0;var canShow=!this.showOnlyFavorite||this.isFavourite(item);return"all"===this.activeTab?canShow:canShow&&(item.amountAsset.id===this.activeTab||item.priceAsset.id===this.activeTab)}},{key:"_filterDataItemByQuery",value:function(item){var query=this.search,searchPair=[{success:!1,names:[item.amountAsset.name.toLowerCase(),item.amountAsset.ticker&&item.amountAsset.ticker.toLowerCase()||null].filter(Boolean)},{success:!1,names:[item.priceAsset.name.toLowerCase(),item.priceAsset.ticker&&item.priceAsset.ticker.toLowerCase()||null].filter(Boolean)}];return function search(query){var queryList=query.split("/").map(function(q){return q.trim()});if(1===queryList.length){var q=query.toLowerCase();return WatchList._isId(query)?item.pairIdList.includes(query):filter(whereEq({success:!1}),searchPair).some(function(searchItem){return searchItem.success=searchItem.names.some(function(n){return 0===n.indexOf(q)}),searchItem.success})}if(queryList[0]&&""===queryList[1]){var _q=queryList[0].toLowerCase();return WatchList._isId(queryList[0])?item.pairIdList.includes(queryList[0]):searchPair.some(function(searchItem){return searchItem.success||(searchItem.success=searchItem.names.some(function(n){return n===_q})),searchItem.success})}return!queryList[0]&&queryList[1]?search(query.replace("/","")):search(queryList[0].trim())&&search(queryList[1].trim())}(query.trim())}},{key:"_onChangeSearch",value:function(){var _this173=this;this.searchRequest&&(this.searchRequest.drop(),this.searchInProgress=!1,this.pending=!1,this.searchRequest=null);var query=this.search;this._searchAssets=[];var queryParts=query.split("/").slice(0,2).map(function(q){return q.replace(/[:()^]/g,"").trim()}).filter(Boolean);if(!queryParts.length)return WatchList._renderSmartTable(),null;this.searchInProgress=!0,this.pending=!0,this.loadingError=!1,this.searchRequest=new PromiseControl(Promise.all(queryParts.map(waves.node.assets.search))).then(function(_ref78){var _ref79=_slicedToArray(_ref78,2),_ref79$=_ref79[0],d1=void 0===_ref79$?[]:_ref79$,_ref79$2=_ref79[1],d2=void 0===_ref79$2?[]:_ref79$2;return _this173._searchAssets=uniqBy(prop("id"),d1.concat(d2)),_this173._poll.restart().then(function(){_this173.searchInProgress=!1,_this173.pending=!1,_this173.searchRequest=null,_this173.showOnlyFavorite=!1,$scope.$apply()})}).catch(function(){_this173.searchInProgress=!1,_this173.pending=!1,_this173.searchRequest=null,$scope.$apply()})}},{key:"_updateFavoriteHash",value:function(){this._favoriteHash=this._favourite.reduce(function(acc,pair){return acc[WatchList._getKeyByPair(pair)]=pair,acc},Object.create(null))}},{key:"_updateSearchAssetHash",value:function(){this._searchAssetsHash=this._searchAssets.reduce(function(acc,asset){return acc[asset.id]=asset,acc},Object.create(null))}},{key:"_onChangeActiveTab",value:function(){var _this174=this;this.pending=!0,this.loadingError=!1,this._poll.restart().then(function(){_this174.pending=!1,$scope.$apply()})}},{key:"_getTradingPairList",value:function(){return WatchList._uniqPairs(WatchList._getAllCombinations(TRADING_ASSETS))}},{key:"_getPairList",value:function(){if(this._isActiveTrading())return this._getTradingPairList();var defaultAssets=configService.get("SETTINGS.DEX.WATCH_LIST_PAIRS")||[],favorite=(this._favourite||[]).map(function(p){return p.sort()}),chosen=[this._assetIdPair.amount,this._assetIdPair.price].sort(),searchIdList=Object.keys(this._searchAssetsHash),assetsIds=Object.values(WavesApp.defaultAssets),idList=uniq(assetsIds.concat(searchIdList,defaultAssets)),other=WatchList._getAllCombinations(idList);return WatchList._uniqPairs(favorite.concat(other,[chosen]))}},{key:"_getComparatorByPath",value:function(dataPath){var _this175=this;return function(list,isAsc){var method=isAsc?"asc":"desc",favorite=[],other=[],comparator=utils.comparators.process(path(dataPath.split("."))).smart[method];return list.forEach(function(item){_this175.isFavourite(item)?favorite.push(item):other.push(item)}),favorite.sort(comparator),other.sort(comparator),favorite.concat(other)}}}],[{key:"_addRateForPair",value:function(rate){return function(pair){if(!pair.volume)return pair;var currentVolume=pair.volume.getTokens().mul(rate).roundTo(3,BigNumber.ROUND_MODE.ROUND_HALF_UP);return _extends({},pair,{currentVolume:currentVolume})}}},{key:"_renderSmartTable",value:function(){stService.render("watchlist")}},{key:"_onRenderTable",value:function(name){if("watchlist"!==name)return null;setTimeout(function(){var $chosen=$element.find(".chosen");if(!$chosen.length)return null;var $body=$element.find(".smart-table__tbody"),scroll=$body.scrollTop(),top=$chosen.offset().top-$body.offset().top+scroll-$body.height()/2+$chosen.height()/2;$element.find(".smart-table__tbody").animate({scrollTop:top},300)},300)}},{key:"_isId",value:function(query){return 16<WatchList._getBytes(query)||"WAVES"===query}},{key:"_getBytes",value:function(str){return new Blob([str],{type:"text/plain"}).size}},{key:"_getAssetsFromPairs",value:function(pairs){return pairs.reduce(function(acc,item){return["amountAsset","priceAsset"].forEach(function(propertyName){acc.hash[item.pair[propertyName].id]||(acc.assets.push(item.pair[propertyName]),acc.hash[item.pair[propertyName].id]=!0)}),acc},{assets:[],hash:{}}).assets}},{key:"_getKeyByPair",value:function(pair){return pair.sort().join()}},{key:"_loadDataByPairs",value:function(pairs){var ids=flatten(pairs);return ds.api.assets.get(ids).then(function(){var promiseList=pairs.filter(function(p){return 2===p.length}).map(function(_ref80){var _ref81=_slicedToArray(_ref80,2),assetId1=_ref81[0],assetId2=_ref81[1];return ds.api.pairs.get(assetId1,assetId2)});return Promise.all(promiseList)}).then(function(pairs){var promiseList=splitEvery(20,pairs).map(function(pairs){return ds.api.pairs.info(matcher.currentMatcherAddress,pairs).then(function(infoList){return infoList.map(function(data,i){return _extends({},data,{pairNames:pairs[i].amountAsset.displayName+" / "+pairs[i].priceAsset.displayName,pairIdList:[pairs[i].amountAsset.id,pairs[i].priceAsset.id]})})}).catch(function(){return pairs.map(WatchList._getEmptyPairData)})});return Promise.all(promiseList)}).then(flatten)}},{key:"_getEmptyPairData",value:function(pair){return{amountAsset:pair.amountAsset,priceAsset:pair.priceAsset,pairNames:pair.amountAsset.displayName+" / "+pair.priceAsset.displayName,pairIdList:[pair.amountAsset.id,pair.priceAsset.id],id:[pair.amountAsset.id,pair.priceAsset.id].sort().join(),lastPrice:null,firstPrice:null,volume:null,change24:null}}},{key:"_getAllCombinations",value:function(assetIdList){var pairs=[];return assetIdList.forEach(function(assetId,index){assetIdList.slice(index+1).forEach(function(anotherAssetId){pairs.push([assetId,anotherAssetId].sort(utils.comparators.asc))})}),pairs}},{key:"_uniqPairs",value:function(pairs){return Object.values(pairs.reduce(function(acc,pair){return acc[pair.join(",")]=pair,acc},{}))}}]),WatchList}())}controller.storage=Object.create(null),controller.$inject=["Base","$scope","utils","waves","stService","PromiseControl","createPoll","$element","modalManager","configService","matcher"],angular.module("app.dex").component("wDexWatchlist",{templateUrl:"modules/dex/directives/dexWatchlist/DexWatchlist.html",controller:controller})}(),angular.module("app.dex").component("wDexLayoutSideBarToggle",{bindings:{handleClick:"&",side:"@"},templateUrl:"modules/dex/directives/layout/DexLayoutSideBarToggle.html",controller:function(){return new(function(){function Controller(){_classCallCheck(this,Controller),this.handleClick=angular.noop,this.isHovered=!1}return _createClass(Controller,[{key:"setHovered",value:function(){this.isHovered=!0}},{key:"setNotHovered",value:function(){this.isHovered=!1}}]),Controller}())}}),function(){var controller=function(Base,$q,$element,utils,$rootScope,visibleService,decorators){var _dec8,_class23;return new(_dec8=decorators.async(300),_applyDecoratedDescriptor((_class23=function(){function Layout(){_classCallCheck(this,Layout);var _this176=_possibleConstructorReturn(this,(Layout.__proto__||Object.getPrototypeOf(Layout)).call(this));return _this176._ready=$q.defer(),_this176._dom=null,_this176._children={watchlist:null,candlechart:null,orderbook:null,tradehistory:null,createorder:null,tradevolume:null},_this176._node=null,_this176._watchlistCollapsed=null,_this176._orderbookCollapsed=null,_this176.isPhone=$rootScope.isPhone,_this176.isTablet=$rootScope.isTablet,_this176.isDesktop=$rootScope.isDesktop,_this176.isNotPhone=$rootScope.isNotPhone,_this176.isNotDesktop=$rootScope.isNotDesktop,_this176.syncSettings({_watchlistCollapsed:"dex.layout.watchlist.collapsed",_orderbookCollapsed:"dex.layout.orderbook.collapsed"}),_this176.observe(["_watchlistCollapsed","_orderbookCollapsed"],_this176._onChangeCollapsed),_this176}return _inherits(Layout,Base),_createClass(Layout,[{key:"$postLink",value:function(){this._node=$element.find(".dex-layout"),this._dom={watchlist:Layout._getColumn("watchlist"),candlechart:Layout._getColumn("candlechart"),orderbook:Layout._getColumn("orderbook"),tradehistory:Layout._getColumn("tradehistory"),createorder:Layout._getColumn("createorder"),tradevolume:Layout._getColumn("tradevolume")};var watchlistCollapsed=this._watchlistCollapsed,orderbookCollapsed=this._orderbookCollapsed,base="dex-layout";this._node.get(0).className="dex-layout",this._node.toggleClass(base+"_watchlist-collapsed",watchlistCollapsed),this._node.toggleClass(base+"_orderbook-collapsed",orderbookCollapsed),this._dom.watchlist.$slider.toggleClass(base+"__sidebar-toggle-open",!watchlistCollapsed),this._dom.orderbook.$slider.toggleClass(base+"__sidebar-toggle-open",!orderbookCollapsed),this._ready.resolve()}},{key:"registerItem",value:function($element,item){var _this177=this,block=item.block;if(!block)throw new Error("Wrong item address!");this._ready.promise.then(function(){if(_this177._children[block])throw new Error("Duplicate child block!");_this177._children[block]=item,_this177._dom[block].$container.append($element)})}},{key:"closeCreateOrder",value:function($event){angular.element($event.delegateTarget).parent().removeClass("expanded")}},{key:"collapseBlock",value:function(block,collapsed){this._node.toggleClass("dex-layout_"+block+"-collapsed",collapsed)}},{key:"toggleColumn",value:function(column){switch(column){case"watchlist":this._watchlistCollapsed=!this._watchlistCollapsed;break;case"orderbook":this._orderbookCollapsed=!this._orderbookCollapsed;break;default:throw new Error("Wrong column name!")}}},{key:"updateVisible",value:function(){visibleService.updateSort()}},{key:"_onChangeCollapsed",value:function(){var _this178=this,watchlist=this._watchlistCollapsed,orderbook=this._orderbookCollapsed,base="dex-layout";utils.animateByClass(this._dom.candlechart.$wrapper,"ghost",!0,"opacity").then(function(){_this178._dom.candlechart.$wrapper.hide(),_this178._dom.watchlist.$slider.toggleClass(base+"__sidebar-toggle-open",!watchlist),_this178._dom.orderbook.$slider.toggleClass(base+"__sidebar-toggle-open",!orderbook);var endCollapseAnimations=utils.whenAll([utils.animateByClass(_this178._node,base+"_watchlist-collapsed",watchlist,"transform"),utils.animateByClass(_this178._node,base+"_orderbook-collapsed",orderbook,"transform")]),notWorking=new Promise(function(resolve,reject){setTimeout(reject,3e3)});return Promise.race([endCollapseAnimations,notWorking]).catch(function(){console.warn("Not working css animation end event!")})}).then(function(){return _this178._dom.candlechart.$wrapper.show(),utils.wait(0)}).then(function(){utils.animateByClass(_this178._dom.candlechart.$wrapper,"ghost",!1,"opacity")})}}],[{key:"_getColumn",value:function(type){var $container=$element.find('[data-block="'+type+'"]'),$wrapper=$container.parent(),$slider=$wrapper.find("[data-slider]");return{$wrapper:$wrapper,$container:$container,$slider:$slider}}}]),Layout}()).prototype,"updateVisible",[_dec8],Object.getOwnPropertyDescriptor(_class23.prototype,"updateVisible"),_class23.prototype),_class23)};controller.$inject=["Base","$q","$element","utils","$rootScope","visibleService","decorators"],angular.module("app.dex").component("wLayout",{scope:!1,bindings:{},templateUrl:"modules/dex/directives/layout/layout.html",transclude:!0,controller:controller})}(),function(){var controller=function(Base,$scope,user,modalManager,balanceWatcher,utils,stService,visibleService){return new(function(){function MyBalance(){_classCallCheck(this,MyBalance);var _this179=_possibleConstructorReturn(this,(MyBalance.__proto__||Object.getPrototypeOf(MyBalance)).call(this));return _this179.balanceList=[],_this179.isDemo=!user.address,_this179.pending=!!user.address,_this179.headers=[{id:"asset",search:function(key,value,list){var serchValue=(key[value]||"").trim(),serachTxt=serchValue.toLowerCase();return serachTxt?list.filter(function(item){return item.asset.id===serchValue||((item.asset.ticker||"")+(item.asset.name||"")).toLowerCase().includes(serachTxt)}):list},sort:!0,placeholder:"directives.filter",valuePath:"item.asset.displayName"},{id:"assetId",sort:!1,title:{literal:"directives.balance.assetId"},valuePath:"item.assetId"},{id:"available",sort:!0,title:{literal:"directives.balance.available"},valuePath:"item.available"},{id:"inOrders",sort:!0,title:{literal:"directives.balance.inOrdersFull"},valuePath:"item.inOrders"},{id:"total",sort:!0,title:{literal:"directives.balance.total"},valuePath:"item.regular"}],_this179.userList=[],_this179.syncSettings({_assetIdPair:"dex.assetIdPair"}),_this179.isDemo||(_this179.balanceList=MyBalance._getBalanceList(),_this179.receive(balanceWatcher.change,_this179._onChangeBalance,_this179),_this179.pending=!0,utils.when(balanceWatcher.ready).then(function(){_this179.pending=!1})),user.getFilteredUserList().then(function(list){_this179.userList=list}),_this179.receive(stService.draw,_this179._updateVisible,_this179),_this179}return _inherits(MyBalance,Base),_createClass(MyBalance,[{key:"showAssetInfo",value:function(asset){return modalManager.showAssetInfo(asset)}},{key:"isSelected",value:function(asset){return this._assetIdPair.amount===asset.id||this._assetIdPair.price===asset.id}},{key:"isLockedPair",value:function(assetID){return utils.isLockedInDex(assetID)}},{key:"setPair",value:function(assetId){if(this.isLockedPair(assetId))return null;var wavesId=WavesApp.defaultAssets.WAVES,btcId=WavesApp.defaultAssets.BTC,assetId2=assetId===wavesId?btcId:wavesId;ds.api.pairs.get(assetId,assetId2).then(function(pair){user.setSetting("dex.assetIdPair",{amount:pair.amountAsset.id,price:pair.priceAsset.id})})}},{key:"_updateVisible",value:function(name){"balanceList"===name&&visibleService.updateSort()}},{key:"_onChangeBalance",value:function(){this.balanceList=MyBalance._getBalanceList(),$scope.$apply()}}],[{key:"_getBalanceList",value:function(){return balanceWatcher.getFullBalanceList().filter(MyBalance._isNotScam())}},{key:"_isNotScam",value:function(){var spamHash=(user.getSetting("wallet.portfolio.spam")||[]).reduce(function(r,id){return r[id]=!0,r},Object.create(null));return function(item){return!user.scam[item.asset.id]&&!spamHash[item.asset.id]}}}]),MyBalance}())};controller.$inject=["Base","$scope","user","modalManager","balanceWatcher","utils","stService","visibleService"],angular.module("app.dex").component("wDexMyBalance",{bindings:{},templateUrl:"modules/dex/directives/myBalance/myBalance.html",transclude:!1,controller:controller})}(),function(){var controller=function(Base,createPoll,$element,waves,dexDataService,utils,$scope,i18n,OrderList,transactions){var SECTIONS_ASKS=".table__asks",SECTIONS_INFO=".table__info",SECTIONS_BIDS=".table__bids",SECTIONS_SCROLLBOX="w-scroll-box",SECTIONS_LAST_PRICE=".table__last-price",SECTIONS_SPREAD=".spread",CLASSES_SELL="sell",CLASSES_BUY="buy",ds=require("data-service"),BigNumber=require("@waves/bignumber").BigNumber,AssetPair=require("@waves/data-entities").AssetPair;return new(function(){function OrderBook(){_classCallCheck(this,OrderBook);var _this180=_possibleConstructorReturn(this,(OrderBook.__proto__||Object.getPrototypeOf(OrderBook)).call(this));return _this180.orders=null,_this180.amountAsset=null,_this180.priceAsset=null,_this180.pending=!0,_this180.hasOrderBook=!1,_this180.loadingError=!1,_this180._assetIdPair=null,_this180._lastResponse=null,_this180._showSpread=!0,_this180._noRender=!1,_this180._orderBookCropRate=null,_this180._dom=null,_this180.isScrolled=!1,_this180.receive(dexDataService.showSpread,function(){_this180._dom.$box.stop().animate({scrollTop:_this180._getSpreadScrollPosition()},300)}),_this180.syncSettings({_assetIdPair:"dex.assetIdPair",_orderBookCropRate:"dex.chartCropRate"}),_this180.observe(["hasOrderBook"],_this180._onChangeVisibleElements),_this180._onChangeVisibleElements(),_this180._updateAssetData(),_this180}return _inherits(OrderBook,Base),_createClass(OrderBook,[{key:"$postLink",value:function(){var _this181=this;this._dom=Object.create(null),Object.defineProperties(this._dom,{$box:{get:function(){return $element.find(SECTIONS_SCROLLBOX)}},$bids:{get:function(){return _this181._dom.$box.find(SECTIONS_BIDS)}},$asks:{get:function(){return _this181._dom.$box.find(SECTIONS_ASKS)}},$info:{get:function(){return _this181._dom.$box.find(SECTIONS_INFO)}},$lastPrice:{get:function(){return _this181._dom.$info.find(SECTIONS_LAST_PRICE)}},$spread:{get:function(){return _this181._dom.$info.find(SECTIONS_SPREAD)}}}),this._dom.$box.on("scroll",function(){var scrollPos=_this181._dom.$box[0].scrollTop,spreadPos=_this181._getSpreadScrollPosition();_this181.isScrolled=2<=Math.abs(scrollPos-spreadPos)});var poll=createPoll(this,this._getOrders,this._setOrders,1e3,{$scope:$scope});this.observe("_assetIdPair",function(){_this181._showSpread=!0,_this181.pending=!0,_this181.hasOrderBook=!1,_this181.loadingError=!1,_this181._updateAssetData(),poll.restart()}),$element.on("mousedown touchstart","w-scroll-box w-row",function(){_this181._noRender=!0}),$element.on("mouseup touchend","w-scroll-box w-row",function(){_this181._noRender=!1,_this181._lastResponse&&(_this181._render(_this181._lastResponse),_this181._lastResponse=null)}),this._asks=new OrderList({node:this._dom.$asks.get(0),fillColor:"rgba(229,73,77,0.1)"}),this._bids=new OrderList({node:this._dom.$bids.get(0),fillColor:"rgba(90,129,234,0.1)"}),this.signals.destroy.once(function(){_this181._asks.$onDestroy(),_this181._bids.$onDestroy()})}},{key:"nothingFound",value:function(){return!(this.hasOrderBook||this.pending||this.loadingError)}},{key:"_updateAssetData",value:function(){var _this182=this;ds.api.assets.get([this._assetIdPair.price,this._assetIdPair.amount]).then(function(_ref82){var _ref83=_slicedToArray(_ref82,2),priceAsset=_ref83[0],amountAsset=_ref83[1];_this182.priceAsset=priceAsset,_this182.amountAsset=amountAsset,_this182.pair=new AssetPair(amountAsset,priceAsset)})}},{key:"_getOrders",value:function(){var _this183=this,amountAsset=this._assetIdPair.amount,priceAsset=this._assetIdPair.price;return Promise.all([waves.matcher.getOrderBook(amountAsset,priceAsset),waves.matcher.getOrders().catch(function(){return null}),ds.api.pairs.get(amountAsset,priceAsset).then(waves.matcher.getLastPrice).catch(function(){return null}).then(function(lastPrice){return lastPrice.price.getTokens().isNaN()?transactions.getExchangeTxList({amountAsset:amountAsset,priceAsset:priceAsset,limit:1}).then(function(_ref84){var tx=_slicedToArray(_ref84,1)[0];return{price:tx.price,lastSide:tx.exchangeType}}).catch(function(){return null}):lastPrice}).then(function(lastPrice){return lastPrice}).catch(function(){return null})]).then(function(_ref86){var _ref87=_slicedToArray(_ref86,3),orderbook=_ref87[0],orders=_ref87[1],lastPrice=_ref87[2];return _this183.loadingError=!1,_this183._remapOrderBook(orderbook,orders,lastPrice)}).catch(function(){_this183.loadingError=!0,_this183.hasOrderBook=!1,$scope.$digest()})}},{key:"_onChangeVisibleElements",value:function(){$element.toggleClass("has-order-book",this.hasOrderBook)}},{key:"_setOrders",value:function(data){this.pending=!1,this._render(data)}},{key:"_remapOrderBook",value:function(orderbook,argument_1,argument_2){var orders=1<arguments.length&&void 0!==argument_1?argument_1:[],lastPrice=argument_2,dataBids=orderbook.bids.slice(0,OrderList.ROWS_COUNT),dataAsks=orderbook.asks.slice(0,OrderList.ROWS_COUNT),crop=utils.getOrderBookRangeByCropRate({bids:dataBids,asks:dataAsks,chartCropRate:this._orderBookCropRate}),priceHash=orders.reduce(function(result,item){return item.isActive&&item.amount.asset.id===orderbook.pair.amountAsset.id&&item.price.asset.id===orderbook.pair.priceAsset.id&&(result[item.price.getTokens().toFixed(item.price.asset.precision)]=!0),result},Object.create(null)),lastTrade=lastPrice,bids=OrderBook._sumAllOrders(dataBids,"sell"),asks=OrderBook._sumAllOrders(dataAsks,"buy").reverse();return{bids:bids,maxAmount:OrderBook._getMaxAmount(bids,asks,crop),priceHash:priceHash,crop:crop,lastTrade:lastTrade,spread:orderbook.spread&&orderbook.spread.percent,asks:asks}}},{key:"_render",value:function(data){if(!data)return null;if(this._noRender)return this._lastResponse=data,null;if(this.hasOrderBook=Boolean(data.bids.length||data.asks.length),data.lastTrade){var isBuy="buy"===data.lastTrade.lastSide,isSell="sell"===data.lastTrade.lastSide;this._dom.$lastPrice.toggleClass(CLASSES_BUY,isBuy).toggleClass(CLASSES_SELL,isSell).text(data.lastTrade.price.toFormat())}else this._dom.$lastPrice.removeClass(CLASSES_BUY).removeClass(CLASSES_SELL).text(0);this._dom.$spread.text(data.spread&&data.lastTrade?data.spread.toFixed(2):"");var list,count,pair=new AssetPair(this.amountAsset,this.priceAsset),length=OrderList.ROWS_COUNT;this._asks.render((list=data.asks,count=length-list.length,new Array(count).fill(null).concat(list)),data.crop,data.priceHash,data.maxAmount,pair),this._bids.render(data.bids,data.crop,data.priceHash,data.maxAmount,pair),this._showSpread&&(this._showSpread=!1,this._dom.$box.get(0).scrollTop=this._getSpreadScrollPosition())}},{key:"_getSpreadScrollPosition",value:function(){var box=this._dom.$box.get(0),info=this._dom.$info.get(0);return info.offsetTop-box.offsetTop-box.clientHeight/2+info.clientHeight/2}}],[{key:"_sumAllOrders",value:function(list,type){var total=new BigNumber(0),amountTotal=new BigNumber(0);return list.map(function(item){return total=total.add(item.total),amountTotal=amountTotal.add(item.amount),{type:type,amount:new BigNumber(item.amount),price:new BigNumber(item.price),total:total,totalAmount:amountTotal}})}},{key:"_getMaxAmount",value:function(bids,asks,crop){var croppedBids=OrderBook._cropFilterOrders(bids,crop),croppedAsks=OrderBook._cropFilterOrders(asks,crop),orders=[].concat(_toConsumableArray(croppedBids),_toConsumableArray(croppedAsks)).sort(function(a,b){return a.amount.gt(b.amount)?1:-1});if(orders.length){return orders[Math.floor(.9*orders.length)].amount}return new BigNumber(0)}},{key:"_cropFilterOrders",value:function(list,crop){return list.filter(function(o){return o.price.gte(crop.min)&&o.price.lte(crop.max)})}}]),OrderBook}())};controller.$inject=["Base","createPoll","$element","waves","dexDataService","utils","$scope","i18n","OrderList","transactions"],angular.module("app.dex").component("wDexOrderBook",{templateUrl:"modules/dex/directives/orderBook/orderBook.html",bindings:{isScrolled:"="},controller:controller})}(),(service=function(Base,OrderListItem){var _class25,_temp2,SCALE=devicePixelRatio||1;return _temp2=_class25=function(){function OrderList(params){_classCallCheck(this,OrderList);var _this184=_possibleConstructorReturn(this,(OrderList.__proto__||Object.getPrototypeOf(OrderList)).call(this));return _this184._rows=[],_this184._root=null,_this184._fillColor=params.fillColor,_this184._createCanvas(params.node),_this184._createLines(params.node),_this184}return _inherits(OrderList,Base),_createClass(OrderList,[{key:"render",value:function(data,crop,priceHash,maxAmount,pair){var widthList=[];this._rows.forEach(function(row,index){var item=data[index];row.render(item,crop,priceHash,pair),widthList[index]=item&&item.amount.div(maxAmount).mul(100).toFixed(2)}),this._drawCanvas(widthList)}},{key:"$onDestroy",value:function(){_get2(OrderList.prototype.__proto__||Object.getPrototypeOf(OrderList.prototype),"$onDestroy",this).call(this),this._rows.forEach(function(row){row.$onDestroy()})}},{key:"_createLines",value:function(node){for(var i=0;i<OrderList.ROWS_COUNT;i++)this._rows.push(new OrderListItem(node))}},{key:"_createCanvas",value:function(node){this._canvas=document.createElement("canvas"),this._canvas.style.position="absolute",this._canvas.style.left="0",this._canvas.style.top="0",this._ctx=this._canvas.getContext("2d"),node.style.position="relative",node.appendChild(this._canvas)}},{key:"_getLineHeight",value:function(){var height=this._rows[0].getHeight();return height&&(this._getLineHeight=function(){return height}),height}},{key:"_drawCanvas",value:function(widthList){var _this185=this;this._initSize();var height=this._getLineHeight(),rate=this._canvas.width/100;if(this._clearCanvas(),!height)return null;this._ctx.fillStyle=this._fillColor,widthList.forEach(function(width,index){_this185._ctx.fillRect(0,index*height*SCALE,width*rate,height*SCALE)}),this._ctx.stroke()}},{key:"_clearCanvas",value:function(){this._canvas.width=this._canvas.width}},{key:"_initSize",value:function(){var width=this._canvas.parentElement.clientWidth,height=this._canvas.parentElement.clientHeight;this._canvas.width=width*SCALE,this._canvas.height=height*SCALE,this._canvas.style.width=width+"px",this._canvas.style.height=height+"px",width&&height&&(this._initSize=function(){})}}]),OrderList}(),_class25.ROWS_COUNT=80,_temp2}).$inject=["Base","OrderListItem"],angular.module("app.dex").service("OrderList",service),function(){var service=function(Base,utils,i18n,dexDataService){return function(){function OrderListItem(parent){_classCallCheck(this,OrderListItem);var _this186=_possibleConstructorReturn(this,(OrderListItem.__proto__||Object.getPrototypeOf(OrderListItem)).call(this));return _this186._data=null,_this186._root=OrderListItem._createElement("w-row","table__row"),_this186._parent=parent,_this186._parent.appendChild(_this186._root),_this186._createDom(),_this186._setHandlers(),_this186._draw(),_this186}return _inherits(OrderListItem,Base),_createClass(OrderListItem,[{key:"getData",value:function(){return this._data}},{key:"render",value:function(data,crop,priceHash,pair){if(OrderListItem._isEqual(this._data,data))return null;this._pair=pair,this._data=data,this._draw(crop,priceHash,pair)}},{key:"getHeight",value:function(){return this._root.clientHeight}},{key:"_draw",value:function(crop,priceHash,pair){if(this._data){this._amountNode.innerHTML=utils.getNiceNumberTemplate(this._data.amount,pair.amountAsset.precision,!0),this._priceNode.innerHTML=utils.getNiceNumberTemplate(this._data.price,pair.priceAsset.precision,1e5),this._totalNode.innerHTML=utils.getNiceNumberTemplate(this._data.total,pair.priceAsset.precision,!0);var hasOrder=!!priceHash[this._data.price.toFixed(pair.priceAsset.precision)],inRange=this._data.price.gte(crop.min)&&this._data.price.lte(crop.max);this._tooltip.classList.toggle("active",!0),this._root.classList.toggle("active",hasOrder),this._root.classList.toggle("no-market-price",!inRange)}else this._amountNode.innerText="â",this._priceNode.innerText="â",this._totalNode.innerText="â",this._tooltip.classList.toggle("active",!1),this._root.classList.toggle("active",!1),this._root.classList.toggle("no-market-price",!1);this._root.classList.toggle("isEmpty",!this._data)}},{key:"_setHandlers",value:function(){var _this187=this;this.listenEventEmitter(this._root,"mouseenter",function(){_this187._onHoverIn()},Base.DOM_EVENTS_METHODS),this.listenEventEmitter(this._root,"click",function(){OrderListItem._onClickRow(_this187)},Base.DOM_EVENTS_METHODS)}},{key:"_onHoverIn",value:function(){if(!this._pair||!this._data)return null;var sellTooltip=i18n.translate("orderbook.ask.tooltipText","app.dex",{amountAsset:this._pair.amountAsset.displayName,priceAsset:this._pair.priceAsset.displayName,price:this._data.price.toFormat(this._pair.priceAsset.precision)}),buyTooltip=i18n.translate("orderbook.bid.tooltipText","app.dex",{amountAsset:this._pair.amountAsset.displayName,priceAsset:this._pair.priceAsset.displayName,price:this._data.price.toFormat(this._pair.priceAsset.precision)});this._tooltipSell.innerText=sellTooltip,this._tooltipBuy.innerText=buyTooltip}},{key:"_createDom",value:function(){this._root.appendChild(OrderListItem._createElement("div","table__row-wrap",[this._tooltip=OrderListItem._createElement("div","tooltip-dex",[this._tooltipSell=OrderListItem._createElement("span","tooltip-ask"),this._tooltipBuy=OrderListItem._createElement("span","tooltip-bid")]),OrderListItem._createElement("w-cell","table__cell cell-0",[this._amountNode=OrderListItem._createElement("div","table__cell-wrap")]),OrderListItem._createElement("w-cell","table__cell cell-1",[this._priceNode=OrderListItem._createElement("div","table__cell-wrap")]),OrderListItem._createElement("w-cell","table__cell cell-2",[this._totalNode=OrderListItem._createElement("div","table__cell-wrap")])]))}}],[{key:"_isEqual",value:function(a,b){return!a&&!b||a&&b&&Object.entries(a).every(function(_ref88){var _ref89=_slicedToArray(_ref88,2),key=_ref89[0],value=_ref89[1];return utils.isEqual(value,b[key])})}},{key:"_createElement",value:function(tagName,className,children){var element=document.createElement(tagName);return className.split(" ").forEach(function(name){element.classList.add(name)}),children&&children.length&&children.forEach(function(child){element.appendChild(child)}),element}},{key:"_onClickRow",value:function(item){var order=item.getData();if(!order)return null;dexDataService.chooseOrderBook.dispatch({amount:order.totalAmount.toFixed(2),price:order.price.toFixed(),type:order.type})}}]),OrderListItem}()};service.$inject=["Base","utils","i18n","dexDataService"],angular.module("app.dex").service("OrderListItem",service)}(),function(){var ORDERS_TYPES_asks="asks",ORDERS_TYPES_bids="bids",ORDER_LIST_STUB=[{amount:0,price:0}],THRESHOLD_VALUES={asks:2,bids:2},COLORS={default:{lineColor:{asks:"#e5494d",bids:"#1f5af6"},fillColor:{asks:"#ffe4e4",bids:"#eaf0fe"}},black:{lineColor:{asks:"#e5494d",bids:"#5a81ea"},fillColor:{asks:"rgba(229, 73, 77, 0.15)",bids:"rgba(90, 129, 234, 0.15)"}}},Signal=require("ts-utils").Signal,BigNumber=require("@waves/bignumber").BigNumber,controller=function(Base,utils,waves,createPoll,$scope,user){return new(function(){function TradeGraph(){_classCallCheck(this,TradeGraph);var _this188=_possibleConstructorReturn(this,(TradeGraph.__proto__||Object.getPrototypeOf(TradeGraph)).call(this));return _this188.loadingError=!1,_this188._assetIdPair=null,_this188._chartCropRate=null,_this188._setDataSignal=new Signal,_this188.canShowGraph=!1,_this188.pending=!0,_this188.options={axisX:"price",axisY:"amount",marginBottom:0,hasDates:!1,checkWidth:!0,view:{asks:{lineColor:COLORS.default.lineColor.asks,fillColor:COLORS.default.fillColor.asks,lineWidth:4},bids:{lineColor:COLORS.default.lineColor.bids,fillColor:COLORS.default.fillColor.bids,lineWidth:4}}},_this188.chartPlateOptions={},_this188.theme="default",_this188.data={asks:ORDER_LIST_STUB,bids:ORDER_LIST_STUB},_this188.syncSettings({_assetIdPair:"dex.assetIdPair",_chartCropRate:"dex.chartCropRate",theme:"theme"}),_this188.observe(["_assetIdPair","_chartCropRate"],_this188._onChangeAssets),_this188._poll=createPoll(_this188,_this188._getOrderBook,_this188._setOrderBook,1e3,{$scope:$scope}),_this188._resetPending(),_this188.theme=user.getSetting("theme"),_this188._setChartPlateOptions(),_this188._setChartOptionsView(),_this188.observe("theme",_this188._onThemeChange),_this188}return _inherits(TradeGraph,Base),_createClass(TradeGraph,[{key:"onMouse",value:function(chartData){var id=chartData.id,_chartData$point=chartData.point,xValue=_chartData$point.xValue,yValue=_chartData$point.yValue;this.chartEvent=_extends({},chartData,{id:""+id[0].toUpperCase()+id.substring(1),amount:new BigNumber(yValue).toFormat(),price:new BigNumber(xValue).toFormat()})}},{key:"_onChangeAssets",value:function(noRestart){noRestart||(this._poll.restart(),this._resetPending())}},{key:"_resetPending",value:function(){var _this189=this;this.pending=!0,this.receiveOnce(this._setDataSignal,function(){_this189.pending=!1})}},{key:"_getOrderBook",value:function(){var _this190=this;return waves.matcher.getOrderBook(this._assetIdPair.amount,this._assetIdPair.price).then(function(orderBook){return _this190._cutOffOutlyingOrdersIfNecessary(orderBook)}).then(TradeGraph._buildCumulativeOrderBook).then(function(data){return _this190.loadingError=!1,data}).catch(function(){_this190.loadingError=!0,_this190.pending=!1,$scope.$apply()})}},{key:"_setOrderBook",value:function(orderBook){this._updateGraphAccordingToOrderBook(orderBook),this.data={asks:orderBook.asks,bids:orderBook.bids},this._setDataSignal.dispatch(),$scope.$digest()}},{key:"_cutOffOutlyingOrdersIfNecessary",value:function(orderBook){if(TradeGraph._isLackOfAsks(orderBook)||TradeGraph._isLackOfBids(orderBook))return orderBook;var filteredOrderBook=utils.filterOrderBookByCharCropRate({chartCropRate:this._chartCropRate,asks:orderBook.asks,bids:orderBook.bids});return TradeGraph._areEitherAsksOrBids(filteredOrderBook)?filteredOrderBook:orderBook}},{key:"_updateGraphAccordingToOrderBook",value:function(orderBook){return this.canShowGraph=!!TradeGraph._areEitherAsksOrBids(orderBook),orderBook}},{key:"_setChartOptionsView",value:function(){this.options=_extends({},this.options,{view:this._getViewOptions()})}},{key:"_getViewOptions",value:function(){switch(this.theme){case"black":return{asks:{lineColor:COLORS[this.theme].lineColor.asks,fillColor:COLORS[this.theme].fillColor.asks,lineWidth:2},bids:{lineColor:COLORS[this.theme].lineColor.bids,fillColor:COLORS[this.theme].fillColor.bids,lineWidth:2}};default:return{asks:{lineColor:COLORS.default.lineColor.asks,fillColor:COLORS.default.fillColor.asks,lineWidth:4},bids:{lineColor:COLORS.default.lineColor.bids,fillColor:COLORS.default.fillColor.bids,lineWidth:4}}}}},{key:"_setChartPlateOptions",value:function(){switch(this.theme){case"black":this.chartPlateOptions=_extends({},this.chartPlateOptions,{markerColors:COLORS[this.theme].lineColor});break;default:this.chartPlateOptions=_extends({},this.chartPlateOptions,{markerColors:COLORS.default.lineColor})}}},{key:"_onThemeChange",value:function(){var _this191=this;utils.wait(1e3).then(function(){_this191._setChartOptionsView(),_this191._setChartPlateOptions()})}}],[{key:"_areEitherAsksOrBids",value:function(orderBook){return TradeGraph._areEnoughAsks(orderBook)||TradeGraph._areEnoughBids(orderBook)}},{key:"_areEnoughAsks",value:function(orderBook){return!TradeGraph._isLackOfAsks(orderBook)}},{key:"_areEnoughBids",value:function(orderBook){return!TradeGraph._isLackOfBids(orderBook)}},{key:"_isLackOfAsks",value:function(orderBook){return TradeGraph._isLackOf(orderBook,ORDERS_TYPES_asks)}},{key:"_isLackOfBids",value:function(orderBook){return TradeGraph._isLackOf(orderBook,ORDERS_TYPES_bids)}},{key:"_isLackOf",value:function(orderBook,ordersType){return orderBook[ordersType].length<THRESHOLD_VALUES[ordersType]}},{key:"_buildCumulativeOrderBook",value:function(_ref90){var asks=_ref90.asks,bids=_ref90.bids;return{asks:TradeGraph._buildCumulativeOrderList(asks),bids:TradeGraph._buildCumulativeOrderList(bids)}}},{key:"_buildCumulativeOrderList",value:function(list){var _this192=this,amount=new BigNumber(0);return list.reduce(function(result,item){return amount=amount.add(new BigNumber(item.amount)),result.push({amount:Number(amount.toFixed(_this192._chartCropRate)),price:Number(item.price)}),result},[])}}]),TradeGraph}())};controller.$inject=["Base","utils","waves","createPoll","$scope","user"],angular.module("app.dex").component("wDexTradeGraph",{templateUrl:"modules/dex/directives/tradeGraph/tradeGraph.html",controller:controller})}(),function(){var _require50=require("ramda"),propEq=_require50.propEq,uniqBy=_require50.uniqBy,map=_require50.map,pipe=_require50.pipe,prop=_require50.prop,find=_require50.find,controller=function(Base,$scope,createPoll,user,utils,transactions){var PAIR_COLUMN_DATA={id:"pair",valuePath:"item.pair",search:!0,placeholder:"directives.filter"},FEE_COLUMN_DATA={id:"fee",title:{literal:"directives.tradeHistory.tableTitle.fee"},valuePath:"item.userFee",sort:!0},HEADER_COLUMNS=[{id:"type",title:{literal:"directives.tradeHistory.tableTitle.type"},valuePath:"item.exchangeType",sort:!0},{id:"time",title:{literal:"directives.tradeHistory.tableTitle.date"},valuePath:"item.timestamp",sort:!0,sortActive:!0,isAsc:!1},{id:"price",title:{literal:"directives.tradeHistory.tableTitle.price"},valuePath:"item.price",sort:!0},{id:"amount",title:{literal:"directives.tradeHistory.tableTitle.size"},valuePath:"item.amount",sort:!0},{id:"total",title:{literal:"directives.tradeHistory.tableTitle.total"},valuePath:"item.total",sort:!0}];return new(function(){function TradeHistory(){_classCallCheck(this,TradeHistory);var _this193=_possibleConstructorReturn(this,(TradeHistory.__proto__||Object.getPrototypeOf(TradeHistory)).call(this));return _this193.userList=[],_this193._assetIdPair=null,_this193.isMy=!1,_this193.history=[],_this193.remapTransactions=TradeHistory._remapTxList(),_this193.pending=!0,_this193.isDemo=!1,_this193.headers=[],_this193.syncSettings({_assetIdPair:"dex.assetIdPair"}),user.getFilteredUserList().then(function(list){_this193.userList=list}),_this193}return _inherits(TradeHistory,Base),_createClass(TradeHistory,[{key:"$postLink",value:function(){this.headers=this.isMy?[PAIR_COLUMN_DATA].concat(HEADER_COLUMNS,FEE_COLUMN_DATA):HEADER_COLUMNS,this.isDemo=this.isMy&&!user.address,this._initializePoll(),this.observe("_assetIdPair",this._onChangeAssets)}},{key:"isSelected",value:function(tx){return this._assetIdPair.amount===tx.amount.asset.id&&this._assetIdPair.price===tx.price.asset.id}},{key:"setPair",value:function(tx){if(this.isLockedPair(tx))return null;user.setSetting("dex.assetIdPair",{amount:tx.amount.asset.id,price:tx.price.asset.id})}},{key:"isLockedPair",value:function(tx){return utils.isLockedInDex(tx.amount.asset.id,tx.price.asset.id)}},{key:"_initializePoll",value:function(){var _this194=this;if(this.isMy&&this.isDemo)return null;this.poll=createPoll(this,this._getTradeHistory,this._setTradeHistory,1e3),this.poll.ready.then(function(){_this194.pending=!1})}},{key:"_onChangeAssets",value:function(){var _this195=this;this.isMy||(this.pending=!0,this.history=[],this.poll.restart().then(function(){_this195.pending=!1}))}},{key:"_getTradeHistory",value:function(){return transactions.getExchangeTxList(this._getTransactionsFilter()).then(this.remapTransactions)}},{key:"_setTradeHistory",value:function(history){var _this196=this;if(this.history.length===history.length&&this.history.every(function(item,i){return propEq("id",item,_this196.history[i])}))return null;this.history=history,$scope.$apply()}},{key:"_getTransactionsFilter",value:function(){return this.isMy?{sender:user.address}:{amountAsset:this._assetIdPair.amount,priceAsset:this._assetIdPair.price}}}],[{key:"_remapTxList",value:function(){var filter=uniqBy(prop("id")),mapFunc=map(TradeHistory._remapTx);return pipe(filter,mapFunc)}},{key:"_remapTx",value:function(tx){var pair=function(tx){return tx.amount.asset.displayName}(tx)+" / "+function(tx){return tx.price.asset.displayName}(tx),userFee=pipe(find(function(order){return order.orderType===tx.exchangeType}),function(order){return"sell"===order.orderType?tx.sellMatcherFee:tx.buyMatcherFee})([tx.order1,tx.order2]);return _extends({},tx,{pair:pair,userFee:userFee})}}]),TradeHistory}())};controller.$inject=["Base","$scope","createPoll","user","utils","transactions"],angular.module("app.dex").component("wDexTradeHistory",{bindings:{isMy:"<"},templateUrl:"modules/dex/directives/tradeHistory/tradeHistory.html",controller:controller})}(),function(){var controller=function(Base,$element){return new(function(){function Delegate(){_classCallCheck(this,Delegate);var _this197=_possibleConstructorReturn(this,(Delegate.__proto__||Object.getPrototypeOf(Delegate)).call(this));return _this197.event=null,_this197.selector=null,_this197.handler=null,_this197.observe(["event","selector","handler"],_this197._onChangeParams),_this197}return _inherits(Delegate,Base),_createClass(Delegate,[{key:"_onChangeParams",value:function(){var _this198=this;if($element.off(),!this.selector||!this.handler)return null;$element.on(this.event||"click",this.selector,function(e){_this198.handler({$event:e})})}}]),Delegate}())};controller.$inject=["Base","$element"],angular.module("app.ui").component("wDelegate",{bindings:{event:"<",selector:"<",handler:"&"},template:"<ng-transclude></ng-transclude>",transclude:!0,controller:controller})}(),function(){var analytics=require("@waves/event-sender"),directive=function(Base){return{priority:1e5,scope:{eventTarget:"<",event:"<",eventParams:"<"},restrict:"AE",controller:function($scope,$element){return new(function(){function Analytics(){return _classCallCheck(this,Analytics),_possibleConstructorReturn(this,(Analytics.__proto__||Object.getPrototypeOf(Analytics)).apply(this,arguments))}return _inherits(Analytics,Base),_createClass(Analytics,[{key:"$postLink",value:function(){this.handler=function(){if(!$scope.event)return null;analytics.send({name:$scope.event,target:$scope.eventTarget,params:$scope.eventParams})},this.listenEventEmitter($element,"click",this.handler)}}]),Analytics}())}}};directive.$inject=["Base"],angular.module("app.utils").directive("wAnalytics",directive)}(),function(){var BigNumber=require("@waves/bignumber").BigNumber,AVAILABLE_VALIDATORS=["gt","gte","lt","lte","length","integer","precision","byteLt","byteLte","byteGt","byteGte","number","asset","compare","alias","address","wavesAddress","outerBlockchains","anyAddress","pattern","custom"],PATTERNS={get NUMBER(){return"\\d*\\"+WavesApp.getLocaleData().separators.decimal+"?\\d*"},INTEGER:"\\d*"},directive=function(utils,validateService,decorators,$rootScope,$compile,Base){return{require:"ngModel",priority:1e4,compile:function($input,$attrs){return"INPUT"!==$input.get(0).tagName&&"TEXTAREA"!==$input.get(0).tagName?null:function($scope,$input,$compiledAttrs,$ngModel){var _dec9,_class30;return new(_dec9=decorators.async(),_applyDecoratedDescriptor((_class30=function(){function Validate(){_classCallCheck(this,Validate);var _this200=_possibleConstructorReturn(this,(Validate.__proto__||Object.getPrototypeOf(Validate)).call(this,$scope));return _this200._validators=Object.create(null),_this200._validatorsReady=new tsUtils.Signal,_this200._ready=!1,_this200._validatorsReady.once(function(){_this200._ready=!0}),_this200._createValidatorList(),$scope.$watch($attrs.ngModel,function(){return _this200._validate()}),_this200}return _inherits(Validate,Base),_createClass(Validate,[{key:"_addInputPattern",value:function(pattern){var _this201=this;return new Promise(function(resolve){var create=function(){var patternName=Validate._getAttrName("pattern");$attrs[patternName]||($attrs[patternName]=pattern,resolve(_this201._createValidator("pattern")))};_this201._ready?create():_this201.receiveOnce(_this201._validatorsReady,create)})}},{key:"_applyValidators",value:function(validators){validators.forEach(function(_ref91){var name=_ref91.name,result=(0,_ref91.handler)($ngModel.$modelValue,$ngModel.$viewValue);switch(void 0===result?"undefined":_typeof(result)){case"boolean":$ngModel.$setValidity(name,result);break;case"object":if(!result||"function"!=typeof result.then)throw new Error("Wrong validation result!");$ngModel.$setValidity("pending-"+name,!1);var onEnd=function(){$ngModel.$setValidity("pending-"+name,!0),$scope.$apply()};utils.when(result).then(function(){$ngModel.$setValidity(name,!0),onEnd()},function(){$ngModel.$setValidity(name,!1),onEnd()});break;default:throw new Error("Wrong validation result!")}})}},{key:"_validate",value:function(){var _this202=this;this._applyValidators(Object.keys(this._validators).map(function(name){return _this202._validators[name]})),$scope.$apply()}},{key:"_validateByName",value:function(targetName){this._applyValidators([this._validators[targetName]].filter(Boolean))}},{key:"_createValidatorList",value:function(){var _this203=this;AVAILABLE_VALIDATORS.filter(Validate._hasValidator).forEach(function(name){_this203._createValidator(name)}),this._validatorsReady.dispatch()}},{key:"_createValidator",value:function(name){if(this._validators[name])throw new Error("Duplicate validator! "+name);switch(name){case"asset":this._validators[name]=this._createAssetValidator(name);break;case"compare":this._validators[name]=this._createCompareValidator(name);break;case"custom":this._validators[name]=this._createCustomValidator(name);break;case"number":this._validators[name]=this._createBigNumberValidator(name);break;case"alias":case"address":case"wavesAddress":this._validators[name]=this._createAddressValidator(name);break;case"integer":this._validators[name]=this._createIntegerValidator(name);break;case"anyAddress":this._validators[name]=this._createAnyAddressValidator(name);break;case"outerBlockchains":this._validators[name]=this._createOuterBlockchainsValidator(name);break;case"pattern":this._validators[name]=this._createPatternValidator(name);break;case"byteLt":case"byteLte":this._validators[name]=this._createByteValidator(name);break;default:this._validators[name]=this._createSimpleValidator(name)}return this._validators[name].parser&&$ngModel.$parsers.unshift(this._validators[name].parser),this._validators[name].formatter&&$ngModel.$formatters.push(this._validators[name].formatter),this._validators[name]}},{key:"_createCustomValidator",value:function(name){var validator={name:name,value:null,handler:function(){return null==validator.value||("function"==typeof validator.value?validator.value():!!validator.value)}};return this._listenValidatorChanges(name,validator),validator}},{key:"_createIntegerValidator",value:function(name){return this._addInputPattern(PATTERNS.INTEGER),{name:name,value:null,handler:function(modelValue){try{var num=Validate._toBigNumber(modelValue);return!modelValue||num.roundTo(0).eq(Validate._toBigNumber(modelValue))}catch(e){return!1}}}}},{key:"_createOuterBlockchainsValidator",value:function(name){var value=null,validator={name:name,value:null,handler:function(address){return validateService.outerBlockchains(address,validator.value)}};return Object.defineProperty(validator,"value",{get:function(){return value},set:function(data){value=Validate._toAssetId(data)}}),this._listenValidatorChanges(name,validator),validator}},{key:"_createAnyAddressValidator",value:function(name){var value=null,validator={name:name,value:null,handler:function(address){return validateService.anyAddress(address,validator.value)}};return Object.defineProperty(validator,"value",{get:function(){return value},set:function(data){value=Validate._toAssetId(data)}}),this._listenValidatorChanges(name,validator),validator}},{key:"_createCompareValidator",value:function(name){var _this204=this,value=null,validator={name:name,value:null,$compare:null,$compareHandler:function(){_this204._validateByName(name),$scope.$apply()},handler:function(value){return value===validator.$compare.val()},destroy:function(){this.$compare.off("input",this.$compareHandler)}};return Object.defineProperty(validator,"value",{get:function(){return value},set:function(val){utils.isNotEqualValue(value,val)&&(validator.$compare&&validator.$compare.off("input",validator.$compareHandler),validator.$compare=$input.closest("form").find('input[name="'+val+'"]'),validator.$compare.on("input",validator.$compareHandler),value=val)}}),this._listenValidatorChanges(name,validator),validator}},{key:"_createPatternValidator",value:function(name){var value=void 0,parserWorkedBeforeInputEvent=!1;function getCorrespondingToPatternPartOf(value){var inputWithoutGroup=Validate._replaceGroupSeparator(value);return(validator.value.exec(inputWithoutGroup)||[])[0]||""}var validator={name:name,value:null,handler:function(){return!0},parser:function(value){var correspondingToPatternPartOfInput=getCorrespondingToPatternPartOf(value);return correspondingToPatternPartOfInput!==value&&Validate._replaceInputValue(correspondingToPatternPartOfInput),parserWorkedBeforeInputEvent=!0,correspondingToPatternPartOfInput}};return Object.defineProperty(validator,"value",{get:function(){return value},set:function(val){value=new RegExp(val)}}),$input.on("input",function(){parserWorkedBeforeInputEvent?parserWorkedBeforeInputEvent=!1:Validate._replaceInputValue(getCorrespondingToPatternPartOf($input.val()))}),this._listenValidatorChanges(name,validator),validator}},{key:"_createAssetValidator",value:function(name){var _this205=this,precisionValidator=this._createValidator("precision");this._addInputPattern(PATTERNS.NUMBER).then(function(validator){_this205.listenEventEmitter(i18next,"languageChanged",function(){validator.value=PATTERNS.NUMBER})});var value=null,validator={name:name,money:null,value:null,apply:function(){precisionValidator.value=validator.money.asset.precision,_this205._validateByName(name),_this205._validateByName(precisionValidator.name)},handler:function(){return!0},parser:function(value){if(value&&precisionValidator.handler($ngModel.$modelValue,value)){var money=Validate._toMoney(value,validator.money);return money||(_this205._validateByName("asset"),null)}return null},formatter:function(value){var viewValue=$input.val(),money=precisionValidator.handler($ngModel.$modelValue,viewValue)&&Validate._toMoney(viewValue,validator.money);return Validate._isFocused()&&(!value||money&&money.eq(value))?$input.val():Validate._toString(value)}};return $input.on("input",function(){_this205._validateByName(precisionValidator.name),$scope.$apply()}),Object.defineProperty(validator,"value",{get:function(){return value},set:function(assetData){if(validator.money=null,!assetData)return null;(value=Validate._toAssetId(assetData))&&ds.moneyFromTokens("0",value).then(function(money){utils.isNotEqualValue(validator.money,money)&&(validator.money=money,validator.apply(),$ngModel.$modelValue=validator.parser($ngModel.$viewValue))})}}),this._listenValidatorChanges(name,validator),validator}},{key:"_createAddressValidator",value:function(name){var validator={name:name,value:null,handler:function(value){return validateService[name](value,validator.value)}};return this._listenValidatorChanges(name,validator),validator}},{key:"_createByteValidator",value:function(name){var validator=this._createSimpleValidator(name),$byteScope=$rootScope.$new(!0),$element=$compile("<div "+['w-i18n-ns="app.utils"','class="byte-validator__help"','w-i18n="validators.byte.help"','params="{bytes: bytes}"'].join(" ")+"></div>")($byteScope);$input.after($element),$scope.$on("$destroy",function(){$byteScope.$destroy()});var origin=validator.handler;return validator.handler=function(modelValue){var stringBytes=validateService.getByteFromString(modelValue||"");return $byteScope.bytes=Number(validator.value)-stringBytes,$byteScope.$apply(),origin(modelValue)},validator}},{key:"_createSimpleValidator",value:function(name){var handler=void 0;switch(name){case"precision":handler=function(modelValue,viewValue){var value=void 0;try{value=viewValue?utils.parseNiceNumber(viewValue):null}catch(e){value=null}return validateService[name](value,validator.value)};break;default:handler=function(modelValue){return validateService[name](modelValue,validator.value)}}var validator={name:name,value:null,handler:handler};return this._listenValidatorChanges(name,validator),validator}},{key:"_createBigNumberValidator",value:function(name){return this._addInputPattern(PATTERNS.NUMBER),{name:name,handler:function(){return!0},parser:function(value){if(""!==value)return Validate._toBigNumber(value)},formatter:Validate._toString}}},{key:"_listenValidatorChanges",value:function(name,validator){var _this206=this,attrValue=$attrs[Validate._getAttrName(name)];if(Validate._hasExp(attrValue)){var exp=attrValue.replace(/{{(.*)?}}/g,"$1");-1!==exp.indexOf("::")?validator.value=$scope.$eval(exp.replace("::","")):$scope.$watch(exp,function(value){validator.value=value,_this206._validateByName(validator.name)})}else validator.value=attrValue}}],[{key:"_isFocused",value:function(){return document.activeElement===$input.get(0)}},{key:"_toAssetId",value:function(data){return"string"==typeof data?data:data instanceof ds.wavesDataEntities.Money?data.asset.id:data instanceof ds.wavesDataEntities.Asset?data.id:null}},{key:"_toString",value:function(value){return value instanceof BigNumber?value.toFixed():value instanceof ds.wavesDataEntities.Money?value.getTokens().toFormat():value?String(value):""}},{key:"_toMoney",value:function(value,target){if(!target)return null;try{return target.cloneWithTokens(utils.parseNiceNumber(value))}catch(e){return null}}},{key:"_toBigNumber",value:function(value){try{return new BigNumber(utils.parseNiceNumber(value))}catch(e){return null}}},{key:"_hasExp",value:function(value){if(!value)return!1;var openIndex=value.indexOf("{{"),closeIndex=value.indexOf("}}");return-1!==openIndex&&-1!==closeIndex&&openIndex<closeIndex}},{key:"_getAttrName",value:function(validatorName){return"wValidator"+validatorName.charAt(0).toUpperCase()+validatorName.slice(1)}},{key:"_hasValidator",value:function(name){return Validate._getAttrName(name)in $attrs}},{key:"_replaceInputValue",value:function(newValue){$ngModel.$viewValue=newValue,$ngModel.$render()}},{key:"_replaceGroupSeparator",value:function(value){var separator=WavesApp.localize[i18next.language].separators.group,reg=new RegExp("\\"+separator,"g");return value.replace(reg,"")}}]),Validate}()).prototype,"_validate",[_dec9],Object.getOwnPropertyDescriptor(_class30.prototype,"_validate"),_class30.prototype),_class30)}}}};directive.$inject=["utils","validateService","decorators","$rootScope","$compile","Base"],angular.module("app.utils").directive("wValidate",directive)}(),function(){var BigNumber=require("@waves/bignumber").BigNumber,factory=function(waves,$q,_outerBlockchains,utils,user){var _class31,ValidateService=(_applyDecoratedDescriptor((_class31=function(){function ValidateService(){_classCallCheck(this,ValidateService)}return _createClass(ValidateService,[{key:"gt",value:function(inputValue,validateValue){return inputValue.gt(validateValue)}},{key:"gte",value:function(inputValue,validateValue){return inputValue.gte(validateValue)}},{key:"lt",value:function(inputValue,validateValue){return inputValue.lt(validateValue)}},{key:"lte",value:function(inputValue,validateValue){return inputValue.lte(validateValue)}},{key:"length",value:function(inputValue,_length){return String(inputValue).length<=_length}},{key:"precision",value:function(inputValue,_precision){var _inputValue$toFixed$s=inputValue.toFixed().split("."),_inputValue$toFixed$s2=_slicedToArray(_inputValue$toFixed$s,2),dec=(_inputValue$toFixed$s2[0],_inputValue$toFixed$s2[1]);return!dec||_precision.gte(dec.length)}},{key:"byteLt",value:function(inputValue,bytes){return this.getByteFromString(inputValue)<Number(bytes)}},{key:"byteLte",value:function(inputValue,bytes){return this.getByteFromString(inputValue)<=Number(bytes)}},{key:"byteGt",value:function(inputValue,bytes){return this.getByteFromString(inputValue)>Number(bytes)}},{key:"byteGte",value:function(inputValue,bytes){return this.getByteFromString(inputValue)>=Number(bytes)}},{key:"integer",value:function(inputValue){return inputValue.round().eq(inputValue)}},{key:"anyAddress",value:function(address,assetId){return!!this.outerBlockchains(address,assetId)||this.wavesAddress(address)}},{key:"wavesAddress",value:function(address,value){return utils.whenAll([this.alias(address,value),this.address(address,value)]).then(function(_ref92){var _ref93=_slicedToArray(_ref92,2),_ref93$=_ref93[0],alias=void 0===_ref93$||_ref93$,_ref93$2=_ref93[1];return alias||(void 0===_ref93$2||_ref93$2)?$q.resolve():$q.reject()})}},{key:"outerBlockchains",value:function(address,assetId){if(!address||!assetId)return!0;var outerChain=_outerBlockchains[assetId];return!!outerChain&&outerChain.isValidAddress(address)}},{key:"alias",value:function(address,argument_1){var value=1<arguments.length&&void 0!==argument_1?argument_1:void 0;return!address||!(address.length<WavesApp.minAliasLength)&&(!(address.length>WavesApp.maxAliasLength)&&(!!waves.node.aliases.validate(address)&&(value&&"no-self"===value?!waves.node.aliases.getAliasList().includes(address)&&waves.node.aliases.getAddress(address):waves.node.aliases.getAddress(address))))}},{key:"address",value:function(_address,argument_1){var value=1<arguments.length&&void 0!==argument_1?argument_1:"";return!_address||!(_address.length<=WavesApp.maxAliasLength)&&(!(_address.length>WavesApp.maxAddressLength)&&(!!waves.node.isValidAddress(_address)&&(!value||"no-self"!==value||_address!==user.address)))}},{key:"getByteFromString",value:function(str){return new Blob([str],{type:"text/plain"}).size}}],[{key:"toBigNumber",value:function(item){switch(void 0===item?"undefined":_typeof(item)){case"string":case"number":try{return new BigNumber(item)}catch(e){return null}case"object":return item instanceof BigNumber?item:item instanceof ds.wavesDataEntities.Money?item.getTokens():null}}}]),ValidateService}()).prototype,"gt",[toBigNumberArgs,notNullArgs],Object.getOwnPropertyDescriptor(_class31.prototype,"gt"),_class31.prototype),_applyDecoratedDescriptor(_class31.prototype,"gte",[toBigNumberArgs,notNullArgs],Object.getOwnPropertyDescriptor(_class31.prototype,"gte"),_class31.prototype),_applyDecoratedDescriptor(_class31.prototype,"lt",[toBigNumberArgs,notNullArgs],Object.getOwnPropertyDescriptor(_class31.prototype,"lt"),_class31.prototype),_applyDecoratedDescriptor(_class31.prototype,"lte",[toBigNumberArgs,notNullArgs],Object.getOwnPropertyDescriptor(_class31.prototype,"lte"),_class31.prototype),_applyDecoratedDescriptor(_class31.prototype,"length",[notNullArgs],Object.getOwnPropertyDescriptor(_class31.prototype,"length"),_class31.prototype),_applyDecoratedDescriptor(_class31.prototype,"precision",[toBigNumberArgs,notNullArgs],Object.getOwnPropertyDescriptor(_class31.prototype,"precision"),_class31.prototype),_applyDecoratedDescriptor(_class31.prototype,"byteLt",[notNullArgs],Object.getOwnPropertyDescriptor(_class31.prototype,"byteLt"),_class31.prototype),_applyDecoratedDescriptor(_class31.prototype,"byteLte",[notNullArgs],Object.getOwnPropertyDescriptor(_class31.prototype,"byteLte"),_class31.prototype),_applyDecoratedDescriptor(_class31.prototype,"byteGt",[notNullArgs],Object.getOwnPropertyDescriptor(_class31.prototype,"byteGt"),_class31.prototype),_applyDecoratedDescriptor(_class31.prototype,"byteGte",[notNullArgs],Object.getOwnPropertyDescriptor(_class31.prototype,"byteGte"),_class31.prototype),_applyDecoratedDescriptor(_class31.prototype,"integer",[notNullArgs],Object.getOwnPropertyDescriptor(_class31.prototype,"integer"),_class31.prototype),_class31);function notNullArgs(target,key,descriptor){var origin=descriptor.value;descriptor.value=function(){for(var _len15=arguments.length,args=Array(_len15),_key15=0;_key15<_len15;_key15++)args[_key15]=arguments[_key15];return!!args.some(function(value){return null==value||""===value})||origin.call.apply(origin,[this].concat(args))}}function toBigNumberArgs(target,key,descriptor){var origin=descriptor.value;descriptor.value=function(){for(var _len16=arguments.length,args=Array(_len16),_key16=0;_key16<_len16;_key16++)args[_key16]=arguments[_key16];return origin.call.apply(origin,[this].concat(_toConsumableArray(args.map(ValidateService.toBigNumber))))}}return utils.bind(new ValidateService)};factory.$inject=["waves","$q","outerBlockchains","utils","user"],angular.module("app.utils").factory("validateService",factory)}(),angular.module("app.ui").component("wActionItem",{require:{parent:"^wActions"},scope:!1,templateUrl:"modules/ui/directives/actions/action-item.html",transclude:!0}),function(){var controller=function(Base,$timeout,$element,$scope){var analytics=require("@waves/event-sender");return new(function(){function Actions(){_classCallCheck(this,Actions);var _this207=_possibleConstructorReturn(this,(Actions.__proto__||Object.getPrototypeOf(Actions)).call(this));return _this207.expanded=!1,_this207.collapseTimer=null,_this207.DROP_DOWN_CLASS="actions__container",_this207.openUp=!1,_this207._handler=function(e){0===$(e.target).closest($element).length&&_this207.close()},_this207.observe("expanded",function(){_this207.expanded?(_this207.analyticsText&&analytics.send({name:_this207.analyticsText,target:"ui"}),$(document).on("mousedown",_this207._handler)):$(document).off("mousedown",_this207._handler)}),_this207}return _inherits(Actions,Base),_createClass(Actions,[{key:"$onDestroy",value:function(){_get2(Actions.prototype.__proto__||Object.getPrototypeOf(Actions.prototype),"$onDestroy",this).call(this),$(document).off("mousedown",this._handler)}},{key:"toggleActions",value:function(){var _this208=this;this.expanded=!this.expanded,this.expanded?requestAnimationFrame(function(){var dropDown=$element[0].querySelector("."+_this208.DROP_DOWN_CLASS)||{getBoundingClientRect:function(){return{bottom:0}}};_this208.setActionsOpeningStyle(dropDown),_this208.preventBlink(dropDown)}):this.openUp=!1}},{key:"setActionsOpeningStyle",value:function(dropDown){var _this209=this;setTimeout(function(){var dropDownPosition=dropDown.getBoundingClientRect(),bodyPosition=document.body.getBoundingClientRect();dropDownPosition.bottom>bodyPosition.bottom&&(_this209.openUp=!0,$scope.$digest())},0)}},{key:"preventBlink",value:function(dropDown){dropDown.style.visibility="hidden",setTimeout(function(){dropDown.style.visibility=""},0)}},{key:"onClick",value:function(){var _this210=this;$timeout(function(){_this210.close()},0)}},{key:"onMouseLeave",value:function(){var _this211=this;this.collapseTimer=$timeout(function(){_this211.close()},900)}},{key:"onMouseEnter",value:function(){$timeout.cancel(this.collapseTimer)}},{key:"close",value:function(){this.expanded=!1,this.openUp=!1}}]),Actions}())};controller.$inject=["Base","$timeout","$element","$scope"],angular.module("app.ui").component("wActions",{bindings:{analyticsText:"<"},templateUrl:"modules/ui/directives/actions/actions.html",transclude:!0,controller:controller})}(),function(){var controller=function(Base,$scope,waves){var _class32,_temp3,_require53=require("ramda"),indexBy=_require53.indexBy,prop=_require53.prop,head=_require53.head,SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,Money=require("@waves/data-entities").Money,ds=require("data-service"),analytics=require("@waves/event-sender");return new(_temp3=_class32=function(){function AnyTransactionForm(){_classCallCheck(this,AnyTransactionForm);var _this212=_possibleConstructorReturn(this,(AnyTransactionForm.__proto__||Object.getPrototypeOf(AnyTransactionForm)).call(this));return _this212.state=Object.create(null),_this212.json="",_this212.onSuccess=null,_this212.isValidJSON=!0,_this212.signable=null,_this212.observe("json",_this212._onChangeJSON),_this212.observe("state",_this212._onChangeState),_this212}return _inherits(AnyTransactionForm,Base),_createClass(AnyTransactionForm,[{key:"next",value:function(){analytics.send({name:"Wallet Assets JSON Continue Click",target:"ui"}),this.onSuccess({signable:this.signable})}},{key:"_onChangeState",value:function(){var state=this.state;if(state.tx){if(state.tx)try{this.json=WavesApp.stringifyJSON(this.state.tx,null,4)}catch(e){this.json=""}}else state.tx=Object.create(null)}},{key:"_onChangeJSON",value:function(){var _this213=this;this.isValidJSON=!1;var json=this.json;if(this.fee=null,!this.json)return this.isValidJSON=!0,null;WavesApp.parseJSON(json).then(function(data){return _this213._updateSignable(data).then(function(){_this213.state.tx=data,_this213.isValidJSON=!0})}).catch(function(){_this213.state.tx=null,_this213.isValidJSON=!1}).then(function(){$scope.$apply()})}},{key:"_updateSignable",value:function(data){var _this214=this;if(!data)return Promise.resolve(null);var clone=Object.keys(data).reduce(function(acc,name){var value=AnyTransactionForm._normalizeValue(data[name]);return acc[name]=value,acc},Object.create(null)),type=AnyTransactionForm._normalizeSignType(clone);return AnyTransactionForm._parse(type,clone).then(function(data){_this214.fee=data.fee,data.type!==SIGN_TYPE.SET_SCRIPT||data.script||(data.script=""),data.type!==SIGN_TYPE.TRANSFER&&data.type!==SIGN_TYPE.MASS_TRANSFER||(data.attachment=Array.from(data.attachment));try{_this214.signable=ds.signature.getSignatureApi().makeSignable({type:type,data:data})}catch(e){return Promise.reject(e)}})}}],[{key:"_parse",value:function(type,data){switch(type){case SIGN_TYPE.CREATE_ORDER:return AnyTransactionForm._parseOrder(data);case SIGN_TYPE.CANCEL_ORDER:return Promise.resolve(data);default:return AnyTransactionForm._parseTransaction(data)}}},{key:"_parseOrder",value:function(data){var moneyFactory=ds.api.matcher.factory;return Promise.all([waves.node.assets.getAsset("WAVES"),waves.node.assets.getAsset(ds.utils.normalizeAssetId(data.assetPair.amountAsset)),waves.node.assets.getAsset(ds.utils.normalizeAssetId(data.assetPair.priceAsset))]).then(indexBy(prop("id"))).then(function(hash){return ds.api.transactions.parseExchangeOrder(moneyFactory,data,hash)})}},{key:"_parseTransaction",value:function(data){switch(data.type){case SIGN_TYPE.CANCEL_LEASING:return Promise.all([AnyTransactionForm._parseDefaultTransaction(data),waves.node.transactions.get(data.leaseId)]).then(function(_ref94){var _ref95=_slicedToArray(_ref94,2),tx=_ref95[0],lease=_ref95[1];return _extends({},tx,{lease:lease})});case SIGN_TYPE.BURN:return Promise.all([AnyTransactionForm._parseDefaultTransaction(data),waves.node.assets.getAsset(data.assetId)]).then(function(_ref96){var _ref97=_slicedToArray(_ref96,2),tx=_ref97[0],asset=_ref97[1];return _extends({},tx,{amount:new Money(tx.quantity,asset)})});default:return AnyTransactionForm._parseDefaultTransaction(data)}}},{key:"_parseDefaultTransaction",value:function(data){return ds.api.transactions.parseTx([data]).then(head)}},{key:"_normalizeSignType",value:function(data){return data.type&&SIGN_TYPE[data.type]?data.type:data.orderType&&["sell","buy"].includes(data.orderType)?SIGN_TYPE.CREATE_ORDER:data.id&&"string"==typeof data.id?SIGN_TYPE.CANCEL_ORDER:void 0}}]),AnyTransactionForm}(),_class32._normalizeValue=function(value){if("true"===value)return!0;if("false"===value)return!1;var num=Number(value);return String(num)===value?num:value},_temp3)};controller.$inject=["Base","$scope","waves"],angular.module("app.ui").component("wAnyTransactionForm",{controller:controller,scope:!1,bindings:{state:"=",onSuccess:"&"},templateUrl:"modules/ui/directives/anyTransactionForm/any-tx-form.html"})}(),function(){var controller=function(Base,$scope,user,waves,utils,createPoll){return new(function(){function AssetInfoHead(){var _ref98,_temp4,_this215;_classCallCheck(this,AssetInfoHead);for(var _len17=arguments.length,args=Array(_len17),_key17=0;_key17<_len17;_key17++)args[_key17]=arguments[_key17];return(_temp4=_this215=_possibleConstructorReturn(this,(_ref98=AssetInfoHead.__proto__||Object.getPrototypeOf(AssetInfoHead)).call.apply(_ref98,[this].concat(args)))).ratingError=!1,_possibleConstructorReturn(_this215,_temp4)}return _inherits(AssetInfoHead,Base),_createClass(AssetInfoHead,[{key:"$postLink",value:function(){this._getAssetInfo(),this._setLink(),this.observe("assetId",this._getAssetInfo),createPoll(this,this._getTokenRating,this._setTokenRating,6e4)}},{key:"_getAssetInfo",value:function(){var _this216=this;waves.node.assets.getAsset(this.assetId).then(function(asset){_this216.assetName=asset.name,_this216.ticker=asset.ticker;var _utils$getDataFromOra=utils.getDataFromOracles(asset.id),hasLabel=_utils$getDataFromOra.hasLabel,isGateway=_utils$getDataFromOra.isGateway;_this216.hasLabel=hasLabel,_this216.isGatewayOrWaves=_this216.assetId===WavesApp.defaultAssets.WAVES||isGateway&&_this216.assetId!==WavesApp.defaultAssets.VST&&_this216.assetId!==WavesApp.defaultAssets.ERGO&&_this216.assetId!==WavesApp.defaultAssets.BNT,$scope.$apply()}),this.state={assetId:this.assetId}}},{key:"_getTokenRating",value:function(){return ds.api.rating.getAssetsRating(this.assetId).then(function(assetList){return assetList}).catch(function(){return null})}},{key:"_setTokenRating",value:function(assetList){return assetList?assetList[0]?(this.rating=assetList[0].rating,void $scope.$apply()):null:(this.ratingError=!0,null)}},{key:"_setLink",value:function(){this.tokenratingLink=WavesApp.network.tokenrating}}]),AssetInfoHead}())};controller.$inject=["Base","$scope","user","waves","utils","createPoll"],angular.module("app.ui").component("wAssetInfoHead",{controller:controller,templateUrl:"modules/ui/directives/assetInfoHead/asset-info-head.html",bindings:{assetId:"<"}})}(),function(){var ds=require("data-service"),isEmpty=require("ts-utils").isEmpty,controller=function(Base,$element,utils,waves){return new(function(){function AssetLogo(){_classCallCheck(this,AssetLogo);var _this217=_possibleConstructorReturn(this,(AssetLogo.__proto__||Object.getPrototypeOf(AssetLogo)).call(this));return _this217.isNew=!1,_this217._canPayFee=!1,_this217._isSmart=!1,_this217.observe("_canPayFee",_this217._onChangeCanPayFee),_this217.observe(["_isSmart","hasScript"],_this217._onChangeIsSmart),_this217}return _inherits(AssetLogo,Base),_createClass(AssetLogo,[{key:"$postLink",value:function(){var _this218=this;if(!this.size)throw new Error("Wrong params!");if(!this.isNew){if(!this.assetName&&!this.assetId)throw new Error("Wrong params!");this._canPayFee=!!ds.utils.getTransferFeeList().find(function(money){return money.asset.id===_this218.assetId}),this.assetId&&waves.node.assets.getAsset(this.assetId).then(function(asset){_this218._isSmart=asset.hasScript})}$element.find(".asset-logo__logo").css({width:this.size+"px",height:this.size+"px"}),this._addLogo()}},{key:"_addLogo",value:function(){var _this219=this;if(!this.isNew&&this.assetId){var logo=utils.getDataFromOracles(this.assetId).logo;if(logo)return $element.find(".asset-logo__logo").addClass("asset-logo_custom").css("backgroundImage","url("+logo+")"),null;waves.node.assets.getAsset(this.assetId).then(function(asset){var logo=utils.getAssetLogo(_this219.assetId);logo?utils.loadImage(logo).then(function(){$element.find(".asset-logo__logo").css("backgroundImage","url("+logo+")")}).catch(function(){return _this219._addLetter(asset.name)}):_this219._addLetter(asset.name)})}else $element.addClass("asset-logo_new"),this.observe(["assetName","assetId"],function(){return _this219._addLetter(_this219.assetName)}),this._addLetter(this.assetName)}},{key:"_addLetter",value:function(name){var letter=name.charAt(0).toUpperCase(),color=utils.getAssetLogoBackground(this.assetId),fontSize=Math.round(.43*(Number(this.size)||0));$element.find(".asset-logo__logo, .asset-logo__marker").css({"background-color":color}),$element.find(".asset-logo__letter").text(letter).css({"font-size":fontSize+"px"})}},{key:"_onChangeCanPayFee",value:function(){$element.find(".asset-logo__marker").toggleClass("asset-logo__marker_sponsored",this._canPayFee)}},{key:"_onChangeIsSmart",value:function(){var isSmart=isEmpty(this.hasScript)?this._isSmart:this.hasScript;$element.find(".asset-logo__marker").toggleClass("asset-logo__marker_smart",isSmart)}}]),AssetLogo}())};controller.$inject=["Base","$element","utils","waves"],angular.module("app.ui").component("wAssetLogo",{templateUrl:"modules/ui/directives/assetLogo/asset-logo.html",controller:controller,bindings:{assetId:"<",hasScript:"<",assetName:"<",isNew:"<",size:"@"}})}(),function(){var controller=function(Base,$scope,user,waves,utils){return new(function(){function AssetInfoHead(){return _classCallCheck(this,AssetInfoHead),_possibleConstructorReturn(this,(AssetInfoHead.__proto__||Object.getPrototypeOf(AssetInfoHead)).apply(this,arguments))}return _inherits(AssetInfoHead,Base),_createClass(AssetInfoHead,[{key:"$postLink",value:function(){this._getAssetInfo(),this.observe("assetId",this._getAssetInfo)}},{key:"_getAssetInfo",value:function(){var _utils$getDataFromOra3=utils.getDataFromOracles(this.assetId),isVerified=_utils$getDataFromOra3.isVerified,isGateway=_utils$getDataFromOra3.isGateway,isTokenomica=_utils$getDataFromOra3.isTokenomica,isSuspicious=_utils$getDataFromOra3.isSuspicious,isGatewaySoon=_utils$getDataFromOra3.isGatewaySoon,hasLabel=_utils$getDataFromOra3.hasLabel;this.isGateway=isGateway,this.isTokenomica=!isGateway&&isTokenomica,this.isVerified=!isTokenomica&&isVerified,this.isSuspicious=!isVerified&&isSuspicious,this.isGatewaySoon=!isGateway&&isGatewaySoon,this.hasLabel=hasLabel}}]),AssetInfoHead}())};controller.$inject=["Base","$scope","user","waves","utils"],angular.module("app.ui").component("wAssetStatus",{controller:controller,templateUrl:"modules/ui/directives/assetStatus/asset-status.html",bindings:{assetId:"<"}})}(),angular.module("app.ui").directive("wAutofocus",function(){return{restrict:"A",link:function($scope,$element){var tagName=$element.get(0).tagName.toLowerCase();"input"!==tagName&&"textarea"!==tagName||setTimeout(function(){$element.focus()},100)}}}),function(){var map=require("ramda").map,controller=function(Base,createPoll,waves,utils,user){return new(function(){function AssetRateChart(){_classCallCheck(this,AssetRateChart);var _this221=_possibleConstructorReturn(this,(AssetRateChart.__proto__||Object.getPrototypeOf(AssetRateChart)).call(this));return _this221.options={axisX:"timestamp",axisY:"rate",checkWidth:!0,view:{rate:{lineColor:"#5a81ea",fillColor:"#FFF",lineWidth:4}}},_this221.startFrom=null,_this221.assetId=null,_this221.chartToId=null,_this221.noUpdate=null,_this221._poll=null,_this221._setThemSettings(),_this221}return _inherits(AssetRateChart,Base),_createClass(AssetRateChart,[{key:"$postLink",value:function(){this.observe("noUpdate",this._onChangeNoUpdate),this.observe(["assetId","chartToId","startFrom"],this._onChangeMainParams),this.observe("theme",this._setThemSettings),this.syncSettings({theme:"theme"}),this.noUpdate?this._onChangeMainParams():this._poll=this._createPoll()}},{key:"_setThemSettings",value:function(){var wAssetRateChart=user.getThemeSettings().wAssetRateChart;this.options.view.rate.fillColor=wAssetRateChart.seriesColor,this.options.view.rate.lineColor=wAssetRateChart.lineColor}},{key:"_onChangeNoUpdate",value:function(){var noUpdate=this.noUpdate;noUpdate&&!this._poll&&(this._poll=this._createPoll()),!noUpdate&&this._poll&&(this._poll.destroy(),this._poll=null)}},{key:"_onChangeMainParams",value:function(){var _this222=this;this._poll?this._poll.restart():this._getGraphData().then(function(values){_this222.chartData=values},function(){return null})}},{key:"_getGraphData",value:function(){var startDate=this.startFrom||utils.moment().add().day(-100),assetId=this.assetId,baseAssetId=this.chartToId||user.getSetting("baseAssetId");return assetId&&baseAssetId!==assetId?waves.utils.getRateHistory(assetId,baseAssetId,startDate).then(map(function(item){return _extends({},item,{rate:Number(item.rate.toFixed())})})).then(function(rate){return{rate:rate}}):Promise.resolve(null)}},{key:"_createPoll",value:function(){return createPoll(this,this._getGraphData,"chartData",15e3)}}]),AssetRateChart}())};controller.$inject=["Base","createPoll","waves","utils","user"],angular.module("app.ui").component("wAssetRateChart",{bindings:{startFrom:"<",assetId:"<",noUpdate:"<",chartToId:"<"},template:'<w-chart ng-if="$ctrl.chartData" data="$ctrl.chartData" options="$ctrl.options""></w-chart>',transclude:!1,controller:controller})}(),function(){var ds=require("data-service"),controller=function(Base,$q,$scope,user,waves){return new(function(){function Avatar(){var _ref99,_temp5,_this223;_classCallCheck(this,Avatar);for(var _len18=arguments.length,args=Array(_len18),_key18=0;_key18<_len18;_key18++)args[_key18]=arguments[_key18];return(_temp5=_this223=_possibleConstructorReturn(this,(_ref99=Avatar.__proto__||Object.getPrototypeOf(Avatar)).call.apply(_ref99,[this].concat(args)))).hasScript=!1,_this223.size=null,_this223.address=null,_this223.src=null,_possibleConstructorReturn(_this223,_temp5)}return _inherits(Avatar,Base),_createClass(Avatar,[{key:"$postLink",value:function(){var _this224=this;this.style={width:this.size+"px",height:this.size+"px"},this.receive(user.changeScript,function(){_this224.hasScript=user.hasScript(),$scope.$apply()})}},{key:"$onChanges",value:function(){var _this225=this;this.size||(this.size=67),this.address?(ds.fetch(ds.config.get("node")+"/addresses/scriptInfo/"+this.address).then(function(data){_this225.hasScript=!!data.script,$scope.$apply()}),waves.node.scriptInfo(this.address).then(function(data){_this225.hasScript=!!data.script,$scope.$apply()}),$q(function(resolve){resolve(identityImg.create(_this225.address,{size:3*_this225.size}))}).then(function(data){_this225.src=data})):this.hasScript=!1}}]),Avatar}())};controller.$inject=["Base","$q","$scope","user","waves"],angular.module("app.ui").component("wAvatar",{bindings:{size:"@",address:"<"},controller:controller,templateUrl:"modules/ui/directives/avatar/avatar.html"})}(),function(){var controller=function(Base){return new(function(){function Balance(){_classCallCheck(this,Balance);var _this226=_possibleConstructorReturn(this,(Balance.__proto__||Object.getPrototypeOf(Balance)).call(this));return _this226.money=null,_this226.tokens=null,_this226.observe("money",_this226._onChangeMoney,{set:function(val){return val||null}}),_this226}return _inherits(Balance,Base),_createClass(Balance,[{key:"_onChangeMoney",value:function(_ref100){var value=_ref100.value;this.tokens=value?value.getTokens():null}}]),Balance}())};controller.$inject=["Base"];angular.module("app.ui").component("wBalance",{template:"<span "+['w-nice-number="$ctrl.tokens"','short-mode="$ctrl.shortMode"','precision="$ctrl.money.asset.precision"'].join(" ")+"></span>",bindings:{money:"<",shortMode:"<"},controller:controller})}(),function(){var controller=function(Base,waves,$attrs,utils){return new(function(){function BalanceInput(){_classCallCheck(this,BalanceInput);var _this227=_possibleConstructorReturn(this,(BalanceInput.__proto__||Object.getPrototypeOf(BalanceInput)).call(this));return _this227.name=null,_this227.focus=!1,_this227.amount=null,_this227.assetId=null,_this227.maxBalance=null,_this227.fee=null,_this227.realMaxBalance=null,_this227.fillMax=null,_this227.observe("assetId",_this227._onChangeAssetId),_this227.observe(["fee","maxBalance"],_this227._setMaxBalance),_this227.observe("focus",function(){_this227.focus?_this227.onFocus():_this227.onBlur()}),_this227}return _inherits(BalanceInput,Base),_createClass(BalanceInput,[{key:"$postLink",value:function(){if(!this.name)throw new Error("Has no name for input!")}},{key:"fillMaxClick",value:function(){if($attrs.fillMax)return this.fillMax(),null;if(this.maxBalance){var feeHash=utils.groupMoney(utils.toArray(this.fee)),amount=null;(amount=feeHash[this.assetId]?this.maxBalance.sub(feeHash[this.assetId]):this.maxBalance).getTokens().lt(0)?this.amount=this.maxBalance.cloneWithTokens("0"):this.amount=amount}}},{key:"_setMaxBalance",value:function(){if(this.fee&&this.maxBalance){var feeList=utils.toArray(this.fee),feeHash=utils.groupMoney(feeList);if(feeHash[this.maxBalance.asset.id]){var max=this.maxBalance.sub(feeHash[this.maxBalance.asset.id]);max.getTokens().lt(0)?this.realMaxBalance=this.maxBalance.cloneWithTokens("0"):this.realMaxBalance=max}else this.realMaxBalance=this.maxBalance}else this.realMaxBalance=this.maxBalance}},{key:"_onChangeAssetId",value:function(){var _this228=this;if(!this.assetId)return null;ds.moneyFromTokens("0",this.assetId).then(function(money){_this228.asset=money.asset,_this228.amount||(_this228.amount=money)})}}]),BalanceInput}())};controller.$inject=["Base","waves","$attrs","utils"],angular.module("app.ui").component("wBalanceInput",{bindings:{name:"@",inputClasses:"@",fillMax:"&",onFocus:"&",onBlur:"&",amount:"=",assetId:"<",maxBalance:"<",fee:"<",min:"<",disabled:"<"},scope:!1,templateUrl:"modules/ui/directives/balanceInput/balanceInput.html",controller:controller})}(),function(){var module=angular.module("app.ui"),controller=function(Base,$element,$attrs,utils,createPromise,$scope){var SYNC_ATTRS=["type","class"];return new(function(){function Button(){_classCallCheck(this,Button);var _this229=_possibleConstructorReturn(this,(Button.__proto__||Object.getPrototypeOf(Button)).call(this));if(_this229._disabled=!1,_this229._pending=!1,_this229._canClick=!0,_this229._$button=null,$element.attr("ng-click"))throw new Error("Wrong use w-button component! Use on-click!");return _this229.observe(["_disabled","_pending"],_this229._currentCanClick),_this229.observe("_pending",_this229._togglePendingClass),_this229.observe("_canClick",utils.debounceRequestAnimationFrame(_this229._onChangeDisabled)),_this229}return _inherits(Button,Base),_createClass(Button,[{key:"$postLink",value:function(){var _this230=this;this._$button=$element.find("button:first"),SYNC_ATTRS.forEach(function(name){name in $attrs&&_this230._$button.attr(name,$attrs[name])}),$element.get(0).addEventListener("click",function(e){if(_this230._canClick){var result=_this230.onClick({$event:e});_this230._applyClick(result),$scope.$apply()}else e.stopPropagation(),e.preventDefault(),e.stopImmediatePropagation()},!1)}},{key:"_currentCanClick",value:function(){this._canClick=!(this._disabled||this._pending)}},{key:"_applyClick",value:function(result){var _this231=this;this._pending=!0;var onEnd=function(){if(!_this231._pending)throw new Error("Already drop pending state!");_this231._pending=!1};result&&"function"==typeof result.then?createPromise(this,result).then(onEnd,onEnd):createPromise(this,utils.wait(700)).then(onEnd)}},{key:"_togglePendingClass",value:function(){this._$button.toggleClass("pending",this._pending)}},{key:"_onChangeDisabled",value:function(){this._$button.prop("disabled",!this._canClick)}}]),Button}())};controller.$inject=["Base","$element","$attrs","utils","createPromise","$scope"],module.component("wButton",{templateUrl:"modules/ui/directives/button/button.html",transclude:!0,bindings:{_disabled:"<disabled",onClick:"&"},controller:controller})}(),function(){var controller=function($element,$timeout,carouselManager,utils,Base,$scope,ChartFactory){var last=require("ramda").last,chartOptions={red:{axisX:"timestamp",axisY:"rate",view:{rate:{lineColor:"#ef4829",fillColor:"#FFF",gradientColor:["#FEEFEC","#FFF"],lineWidth:4}}},blue:{axisX:"timestamp",axisY:"rate",view:{rate:{lineColor:"#1f5af6",fillColor:"#FFF",gradientColor:["#EAF0FE","#FFF"],lineWidth:4}}}};return new(function(){function Carousel(){var _ref101,_temp6,_this232;_classCallCheck(this,Carousel);for(var _len19=arguments.length,args=Array(_len19),_key19=0;_key19<_len19;_key19++)args[_key19]=arguments[_key19];return(_temp6=_this232=_possibleConstructorReturn(this,(_ref101=Carousel.__proto__||Object.getPrototypeOf(Carousel)).call.apply(_ref101,[this].concat(args)))).length=null,_this232.id=null,_this232.interval=null,_this232.timer=null,_this232._diff=null,_this232.$slides=null,_this232._coords=null,_possibleConstructorReturn(_this232,_temp6)}return _inherits(Carousel,Base),_createClass(Carousel,[{key:"$postLink",value:function(){var _this233=this;this.observeOnce("pairsInfoList",function(){utils.postDigest($scope).then(function(){carouselManager.registerSlider(_this233.id,_this233),_this233.interval=Number(_this233.interval)||0,_this233.$slidesContainer=$element.find(".slider-content:first"),_this233.$slides=$element.find(".slider-content:first").children(),_this233._mapSlides=_this233.$slides.toArray().map(function(slide){return{$slide:$(slide),translateX:null}}),_this233._fillGraphs(),_this233._remapSlides();var onResize=utils.debounceRequestAnimationFrame(function(){_this233._remapSlides(),_this233.initializeInterval()});_this233.listenEventEmitter($(window),"resize",onResize),$element.hover(function(){_this233.stopInterval()},function(){_this233.initializeInterval()}),_this233.initializeInterval()})})}},{key:"$onDestroy",value:function(){carouselManager.removeSlider(this.id)}},{key:"initializeInterval",value:function(){var _this234=this;this.interval&&(this.timer&&this.stopInterval(),this.timer=$timeout(function(){return _this234._step()},this.interval))}},{key:"stopInterval",value:function(){this.interval&&this.timer&&($timeout.cancel(this.timer),this.timer=null)}},{key:"goToDexDemo",value:function(pairAssets){utils.openDex(pairAssets.assetId1,pairAssets.assetId2,"dex-demo")}},{key:"_fillGraphs",value:function(){var _this235=this;this._mapSlides.forEach(function(_ref102,i){var $slide=_ref102.$slide,info=_this235.pairsInfoList[i],options=info.change24.gt(0)?chartOptions.blue:chartOptions.red,chartData={rate:info.rateHistory};new ChartFactory($slide.find(".graph"),options,chartData)})}},{key:"_remapSlides",value:function(){var _this236=this;this._stopSlides(),this.slidesAmount=Carousel._getSlidesInWindowAmount(window.innerWidth);var _getWidthAndStart2=this._getWidthAndStart(),width=_getWidthAndStart2.width,startCoords=_getWidthAndStart2.startCoords;this._diff=1<startCoords.length?startCoords[1]-startCoords[0]:width+10,this._coords=this.$slides.toArray().map(function(element,i){return(i-1)*_this236._diff}),this._mapSlides.forEach(function(slide,i){slide.translateX=_this236._coords[i],slide.$slide.css({transform:"translateX("+_this236._coords[i]+"px)"})}),this.$slides.addClass("absolute")}},{key:"_getWidthAndStart",value:function(){var tempSlidesContainer=this.$slidesContainer.clone();tempSlidesContainer.find(".slide").slice(this.slidesAmount).remove();var slides=tempSlidesContainer.find(".slide");slides.removeAttr("style").removeClass("absolute"),tempSlidesContainer.appendTo($element.find(".slider"));var width=slides.outerWidth(),startCoords=slides.toArray().map(function(slide){return Math.round($(slide).offset().left)});return tempSlidesContainer.remove(),{width:width,startCoords:startCoords}}},{key:"_move",value:function(){var _this237=this,lastPos=last(this._coords);return Promise.all(this._mapSlides.map(function(slide){var $slide=slide.$slide,start=slide.translateX,end=start-_this237._diff;slide.translateX=end;var opacity=_this237._switchOpacity(end);return utils.animate($slide,{opacity:opacity,progress:1},{duration:1e3,progress:_this237._animateProgress(start,end,$slide),complete:function(){end<-_this237._diff&&($slide.css("transform","translateX("+lastPos+"px)"),slide.translateX=lastPos)}})}))}},{key:"_animateProgress",value:function(start,end,slide){return function(animation,progress){slide.css("transform","translateX("+(start+(end-start)*progress)+"px)")}}},{key:"_step",value:function(){var _this238=this;this.stopInterval(),this._move().then(function(){_this238.initializeInterval()})}},{key:"_switchOpacity",value:function(newPos){switch(!0){case newPos<-this._diff||newPos>this._coords[this.slidesAmount+1]:return 0;case newPos<0||newPos>this._coords[this.slidesAmount]:return.2;default:return 1}}},{key:"_stopSlides",value:function(){this._mapSlides.forEach(function(slide){slide.$slide.stop()})}}],[{key:"_getSlidesInWindowAmount",value:function(width){switch(!0){case width<620:return 1;case width<1e3:return 2;case width<1440:return 3;default:return 4}}}]),Carousel}())};controller.$inject=["$element","$timeout","carouselManager","utils","Base","$scope","ChartFactory"],angular.module("app.ui").component("wCarousel",{transclude:!0,bindings:{id:"@",interval:"@",pairsInfoList:"<"},controller:controller,templateUrl:"modules/ui/directives/carousel/carousel.html"})}(),function(){function controller(carouselManager){return new(function(){function CarouselDots(){var _this239=this;_classCallCheck(this,CarouselDots),this.sliderId=null,this.dots=[],this.slider=null,this.$postLink=function(){_this239.slider=carouselManager.getSlider(_this239.sliderId).then(function(slider){_this239.slider=slider,_this239.initialize()})}}return _createClass(CarouselDots,[{key:"initialize",value:function(){for(var _this240=this,loop=function(i){var dot=Object.create(null);dot.index=i,Object.defineProperty(dot,"active",{get:function(){return _this240.slider.getActive()===i}}),_this240.dots.push(dot)},i=0;i<this.slider.length;i++)loop(i)}},{key:"getClass",value:function(dot){return dot.active?"active":""}},{key:"onClick",value:function(dot){dot.active||this.slider.goTo(dot.index)}}]),CarouselDots}())}controller.$inject=["carouselManager"],angular.module("app.ui").component("wCarouselDots",{transclude:!0,bindings:{sliderId:"@"},controller:controller,templateUrl:"modules/ui/directives/carouselDots/dots.html"})}(),function(){var controller=function(Base,$attrs,createPoll,$element,waves){return new(function(){function Change24(){_classCallCheck(this,Change24);var _this241=_possibleConstructorReturn(this,(Change24.__proto__||Object.getPrototypeOf(Change24)).call(this));return _this241.assetFrom=null,_this241.assetTo=null,_this241.precision=null,_this241.interval=null,_this241.directionByPair=null,_this241}return _inherits(Change24,Base),_createClass(Change24,[{key:"$postLink",value:function(){var _this242=this;this.precision=Number(this.precision)||2,this.interval=Number(this.interval)||5e3;var handler=null;if($attrs.noUpdate){var apply=function(){var onFulfilled=_this242._setChange.bind(_this242);_this242._getChange().then(onFulfilled,onFulfilled)};apply(),handler=apply}else{var poll=createPoll(this,this._getChange,this._setChange,this.interval);handler=function(){poll.restart()}}this.observe(["assetFrom","assetTo"],handler)}},{key:"_getChange",value:function(){return this.assetFrom&&this.assetTo?this.directionByPair?ds.api.pairs.get(this.assetFrom,this.assetTo).then(function(pair){return waves.utils.getChange(pair.amountAsset.id,pair.priceAsset.id)}):waves.utils.getChange(this.assetFrom,this.assetTo):Promise.resolve(null)}},{key:"_setChange",value:function(data){"number"==typeof data?($element.toggleClass("green",0<data),$element.toggleClass("red",data<0),$element.html(data.toFixed(this.precision))):$element.html("â")}}]),Change24}())};controller.$inject=["Base","$attrs","createPoll","$element","waves","i18n"],angular.module("app.ui").component("wChange24",{bindings:{assetFrom:"<",assetTo:"<",directionByPair:"<",precision:"@",noUpdate:"@",interval:"@",ns:"@"},transclude:!1,controller:controller})}(),function(){var controller=function(Base){return new(function(){function ChangeLanguage(){_classCallCheck(this,ChangeLanguage);var _this243=_possibleConstructorReturn(this,(ChangeLanguage.__proto__||Object.getPrototypeOf(ChangeLanguage)).call(this));if(_this243.onChange=null,_this243.list=Object.keys(WavesApp.localize).map(function(key){return{code:key,name:WavesApp.localize[key].name}}),i18next.language)_this243.active=i18next.language,_this243.observe("active",_this243._onChangeLanguage);else{i18next.on("initialized",function handler(){_this243.active=i18next.language,_this243.observe("active",_this243._onChangeLanguage),i18next.off("initialized",handler)})}return _this243}return _inherits(ChangeLanguage,Base),_createClass(ChangeLanguage,[{key:"_onChangeLanguage",value:function(){var active=this.active;active&&(i18next.changeLanguage(active),this.onChange({language:active}))}}]),ChangeLanguage}())};controller.$inject=["Base"],angular.module("app.ui").component("wChangeLanguage",{bindings:{onChange:"&"},templateUrl:"modules/ui/directives/changeLanguage/changeLanguage.html",transclude:!1,controller:controller})}(),function(){var BigNumber=require("@waves/bignumber").BigNumber,controller=function(Base,waves,user,createPoll,$scope){return new(function(){function ChangeRate(){_classCallCheck(this,ChangeRate);var _this244=_possibleConstructorReturn(this,(ChangeRate.__proto__||Object.getPrototypeOf(ChangeRate)).call(this));return _this244.rate=null,_this244.assetId=null,_this244.mirror=null,_this244.date=null,_this244.poll=null,_this244.observe("assetId",_this244._onChangeAssetId),_this244}return _inherits(ChangeRate,Base),_createClass(ChangeRate,[{key:"$postLink",value:function(){var _this245=this;this.interval=Number(this.interval)||5e3,waves.node.assets.getAsset(user.getSetting("baseAssetId")).then(function(mirror){_this245.mirror=mirror,_this245.noUpdate?_this245._onChangeAssetId():_this245.poll=createPoll(_this245,_this245._getRate,"rate",_this245.interval,{$scope:$scope})})}},{key:"_onChangeAssetId",value:function(){var _this246=this;this.assetId&&(this.poll?this.poll.restart():this._getRate().then(function(rate){_this246.rate=rate,$scope.$digest()}))}},{key:"_getRate",value:function(){return this.assetId&&this.mirror&&waves.utils.getRate(this.assetId,this.mirror.id).then(function(rate){return rate})||Promise.resolve(new BigNumber(0))}}]),ChangeRate}())};controller.$inject=["Base","waves","user","createPoll","$scope"],angular.module("app.ui").component("wChangeRate",{bindings:{assetId:"<",noUpdate:"@",interval:"@",date:"@"},template:'<span w-nice-number="$ctrl.rate" precision="$ctrl.mirror.precision" class="z-top"></span>',transclude:!1,controller:controller})}(),function(){var controller=function(Base,ChartFactory,$element){var Signal=require("ts-utils").Signal;return new(function(){function Chart(){_classCallCheck(this,Chart);var _this247=_possibleConstructorReturn(this,(Chart.__proto__||Object.getPrototypeOf(Chart)).call(this));return _this247.signals=Object.assign(_this247.signals,{mouseMove:new Signal,mouseLeave:new Signal}),_this247}return _inherits(Chart,Base),_createClass(Chart,[{key:"$postLink",value:function(){this.chart=new ChartFactory($element,this.options,this.data),this.observe("data",this._updateData),this.observe("options",this._updateOptions),this.receive(this.chart.signals.mouseMove,this.signals.mouseMove.dispatch,this.signals.mouseMove),this.receive(this.chart.signals.mouseLeave,this.signals.mouseLeave.dispatch,this.signals.mouseLeave),this.receive(this.chart.signals.mouseMove,this._onMove,this),this.receive(this.chart.signals.mouseLeave,this._onLeave,this)}},{key:"_updateData",value:function(){this.chart.setData(this.data)}},{key:"_updateOptions",value:function(){this.chart.setOptions(this.options)}},{key:"_onMove",value:function(chartData){this.mouseMove({chartData:chartData})}},{key:"_onLeave",value:function(event){this.mouseLeave({event:event})}}]),Chart}())};controller.$inject=["Base","ChartFactory","$element"],angular.module("app.ui").component("wChart",{bindings:{options:"<",data:"<",mouseMove:"&",mouseLeave:"&"},transclude:!0,template:"<div ng-transclude></div>",controller:controller})}(),function(){var factory=function(Base,utils,createPoll){var _class37,_temp7,Money=require("@waves/data-entities").Money,_require62=require("ramda"),equals=_require62.equals,isEmpty=_require62.isEmpty,range=_require62.range,last=_require62.last,head=_require62.head,pipe=_require62.pipe,not=_require62.not,prop=_require62.prop,allPass=_require62.allPass,Signal=require("ts-utils").Signal,BigNumber=require("@waves/bignumber").BigNumber,SCALE=devicePixelRatio||1,isNotEmptyPoint=pipe(allPass([pipe(prop("x"),isEmpty,not),pipe(prop("y"),isEmpty,not)]));return _temp7=_class37=function(){function ChartFactory($element,options,data){_classCallCheck(this,ChartFactory);var _this248=_possibleConstructorReturn(this,(ChartFactory.__proto__||Object.getPrototypeOf(ChartFactory)).call(this));_this248.changeLanguageHandler=function(){return _this248._setAxisCoords()},_this248.signals=Object.assign(_this248.signals,{mouseMove:new Signal,mouseLeave:new Signal}),_this248.$parent=$element,_this248.options=Object.assign(Object.create(null),ChartFactory.defaultOptions,options),_this248.data=data,_this248._initializeCanvasElement($element),_this248.ctx=_this248.canvas.getContext("2d"),_this248._lastEvent=null;var checkInterval=_this248.options.checkWidth;if(checkInterval){var interval="number"==typeof checkInterval&&checkInterval||1e3;createPoll(_this248,function(){return null},_this248._checkAndUpdateSize,interval)}return _this248._render(),_this248._setHandlers(),_this248}return _inherits(ChartFactory,Base),_createClass(ChartFactory,[{key:"setOptions",value:function(options){this.options=Object.assign(Object.create(null),ChartFactory.defaultOptions,options),this._render()}},{key:"setData",value:function(data){this.data=data,this._render(),this._lastEvent&&this._findIntersection(this._lastEvent.event)}},{key:"_initializeCanvasElement",value:function($element){var canvas=document.createElement("canvas"),width=Math.round($element.width()),height=Math.round($element.height());canvas.style.position="absolute",canvas.style.left="0",canvas.style.top="0","static"===$element.css("position")&&$element.css("position","relative"),$element.append(canvas),this.canvas=canvas,this._setSize(width,height)}},{key:"_setHandlers",value:function(){var _this249=this,onMouseMove=utils.debounceRequestAnimationFrame(function(mouseOrTouchEvent){var event=utils.getEventInfo(mouseOrTouchEvent);_this249._findIntersection(event)}),onMouseLeave=utils.debounceRequestAnimationFrame(function(event){_this249.signals.mouseLeave.dispatch({event:event}),_this249._lastEvent=null}),onResize=utils.debounceRequestAnimationFrame(function(){_this249._checkAndUpdateSize()});this.listenEventEmitter(this.$parent,"mousemove",onMouseMove),this.listenEventEmitter(this.$parent,"mouseleave",onMouseLeave),this.listenEventEmitter(window,"resize",onResize,{on:"addEventListener",off:"removeEventListener"})}},{key:"_checkAndUpdateSize",value:function(){this.canvas.width===this.$parent.outerWidth()&&this.canvas.height===this.$parent.outerHeight()||(this._setSize(this.$parent.outerWidth(),this.$parent.outerHeight()),this._render(),this._lastEvent&&this.signals.mouseMove.dispatch(this._lastEvent))}},{key:"_setSize",value:function(width,height){this.canvas.width=width*SCALE,this.canvas.height=height*SCALE,this.canvas.style.width=width+"px",this.canvas.style.height=height+"px"}},{key:"_clear",value:function(){this.canvas.width=this.canvas.width}},{key:"_render",value:function(){var _this250=this;this._clear();var keys=this.data&&Object.keys(this.data);return keys&&keys.length&&keys.some(function(id){return _this250.data[id].length})&&this.options?(this.chartData=this._getChartData(this.data),this._drawChart(this.chartData),void(this.options.hasDates&&(this.legendItemsObjects||this._createBottomLegend(this._getLegendItemsWithCoords()),this._updateLegendObject()))):null}},{key:"_drawChart",value:function(data){var ctx=this.ctx,options=this.options;Object.entries(data.coordinates).forEach(function(_ref103){var _ref104=_slicedToArray(_ref103,2),id=_ref104[0],chartCoords=_ref104[1],viewOptions=options.view[id],first=chartCoords[0];if(ctx.strokeStyle=viewOptions.lineColor,ctx.lineWidth=viewOptions.lineWidth*SCALE,ctx.beginPath(),ctx.moveTo(first.x,first.y),chartCoords.forEach(function(_ref105){var x=_ref105.x,y=_ref105.y;ctx.lineTo(x,y)}),ctx.stroke(),viewOptions.fillColor){if(ctx.fillStyle=viewOptions.fillColor,viewOptions.gradientColor){var grd=ctx.createLinearGradient(0,0,0,data.height.toNumber());grd.addColorStop(0,viewOptions.gradientColor[0]),grd.addColorStop(1,viewOptions.gradientColor[1]),ctx.fillStyle=grd}else ctx.fillStyle=viewOptions.fillColor;var _last=chartCoords[chartCoords.length-1];ctx.lineTo(_last.x,data.height.toNumber()),ctx.lineTo(first.x,data.height.toNumber()),ctx.lineTo(first.x,first.y),ctx.fill()}})}},{key:"_getChartData",value:function(data){var _this251=this,height=new BigNumber(this.canvas.height),width=new BigNumber(this.canvas.width),maxChartHeight=height.mul(this.options.heightFactor),marginBottom=this.options.marginBottom,min={x:new BigNumber(1/0),y:new BigNumber(1/0)},max={x:new BigNumber(-1/0),y:new BigNumber(-1/0)},pointsHash=Object.entries(data).reduce(function(acc,_ref106){var _ref107=_slicedToArray(_ref106,2),id=_ref107[0],chart=_ref107[1],points=acc[id]=[];return chart.forEach(function(item){var itemX=item[_this251.options.axisX],itemY=item[_this251.options.axisY],point={x:ChartFactory._getValues(itemX),y:ChartFactory._getValues(itemY)};isNotEmptyPoint(point)&&(min.x=BigNumber.min(min.x,point.x),min.y=BigNumber.min(min.y,point.y),max.x=BigNumber.max(max.x,point.x),max.y=BigNumber.max(max.y,point.y),points.push(point)),points.sort(utils.comparators.process(prop("x")).bigNumber.asc)}),acc},Object.create(null)),delta={x:max.x.sub(min.x),y:max.y.sub(min.y)},factor={x:width.div(delta.x),y:maxChartHeight.div(delta.y)},coordinates=Object.create(null);return Object.entries(pointsHash).forEach(function(_ref108){var _ref109=_slicedToArray(_ref108,2),id=_ref109[0],points=_ref109[1];coordinates[id]=[],points.forEach(function(value){var xValue=value.x,yValue=value.y,x=Number(xValue.sub(min.x).mul(factor.x).toFixed()),y=Number(height.sub(yValue.sub(min.y).mul(factor.y)).toFixed())-marginBottom*SCALE;coordinates[id].push({x:x,y:y,xValue:xValue,yValue:yValue})})}),{height:height,maxChartHeight:maxChartHeight,width:width,min:min,max:max,delta:delta,factor:factor,coordinates:coordinates}}},{key:"_findIntersection",value:function(event){if(!this.chartData&&!this.chartData.coordinates)return null;var eventOffsetX=event.pageX-$(event.target).offset().left,intersection=Object.entries(this.chartData.coordinates).reduce(function(acc,_ref110){var _ref111=_slicedToArray(_ref110,2),id=_ref111[0],points=_ref111[1],point=function binarySearch(data,target,start,end){if(end<1)return data[0];if(end-1===start)return Math.abs(data[start].x-target)>Math.abs(data[end].x-target)?data[end]:data[start];var middle=Math.floor(start+(end-start)/2);return target===data[middle].x?data[middle]:target>data[middle].x?binarySearch(data,target,middle,end):target<data[middle].x?binarySearch(data,target,start,middle):void 0}(points,eventOffsetX*SCALE,0,points.length-1),data={id:id,point:point,event:_extends({},event,{offsetX:eventOffsetX})};return!acc||Math.abs(point.x-eventOffsetX*SCALE)<Math.abs(acc.point.x-eventOffsetX*SCALE)?data:acc},null);intersection&&this._dispatchMouseMove(intersection)}},{key:"_dispatchMouseMove",value:function(intersection){this._lastEvent&&equals(this._lastEvent.point,intersection.point)||(this.signals.mouseMove.dispatch(intersection),this._lastEvent=intersection)}},{key:"_getLegendItemsWithCoords",value:function(){var _Array$prototype,_this252=this,width=this.$parent.outerWidth()/4,exactCoords=range(0,4).map(function(i){return width*i+width/2}),combinedCoordinates=(_Array$prototype=Array.prototype).concat.apply(_Array$prototype,_toConsumableArray(Object.keys(this.chartData.coordinates).map(function(key){return _this252.chartData.coordinates[key]}))),xCoords=combinedCoordinates.map(prop("x")),combinedXValues=combinedCoordinates.map(prop("xValue"));return exactCoords.map(function(x){return xCoords.reduce(function(prevXCoord,currentXCoord){return Math.abs(currentXCoord/SCALE-x)<Math.abs(prevXCoord/SCALE-x)?currentXCoord:prevXCoord})}).map(function(foundX){var dateIndex=combinedCoordinates.findIndex(function(_ref112){var x=_ref112.x;return foundX===x});return{coords:foundX/SCALE,value:new Date(combinedXValues[dateIndex].toNumber())}})}},{key:"_createBottomLegend",value:function(axisItemsWithCoords){var _this253=this;this.legendItemsObjects=axisItemsWithCoords.map(function(_ref113){var value=_ref113.value,x=_ref113.x,$legendItem=$('<div class="chart-legend">'+ChartFactory._localDate(value)+"</div>");_this253.$parent.append($legendItem);var coords=Math.round(x-$legendItem.width()/2);return $legendItem.css({left:coords}),{$legendItem:$legendItem,legendValue:value,coords:coords}}),this.listenEventEmitter(i18next,"languageChanged",this.changeLanguageHandler)}},{key:"_updateLegendObject",value:function(){var newCoords=this._getLegendItemsWithCoords();this.legendItemsObjects=this.legendItemsObjects.map(function(object,i){return{$legendItem:object.$legendItem,legendValue:newCoords[i].value,coords:newCoords[i].coords}}),this._setAxisCoords()}},{key:"_setAxisCoords",value:function(){var isTime=last(this.legendItemsObjects).legendValue-head(this.legendItemsObjects).legendValue<1728e5;this.legendItemsObjects.forEach(function(object){var legendDate=isTime?tsUtils.date("hh:mm")(object.legendValue):ChartFactory._localDate(object.legendValue);object.$legendItem.html(legendDate).css({left:object.coords})})}}],[{key:"_getValues",value:function(item){switch(!0){case item instanceof Date:return new BigNumber(item.getTime());case item instanceof Money:return item.getTokens();case item instanceof BigNumber:return item;case"number"==typeof item:return new BigNumber(item);default:throw new Error("Wrong value type!")}}},{key:"_localDate",value:function(date,argument_1){return 1<arguments.length&&void 0!==argument_1&&argument_1?tsUtils.date("DD.MM.YYYY")(date):tsUtils.date("DD.MM")(date)}}]),ChartFactory}(),_class37.defaultOptions={axisX:"timestamp",axisY:"rate",marginBottom:0,hasDates:!1,checkWidth:!1,heightFactor:.9,view:{rate:{lineColor:"#ef4829",fillColor:"#FFF",gradientColor:!1,lineWidth:2}}},_temp7};factory.$inject=["Base","utils","createPoll"],angular.module("app.ui").factory("ChartFactory",factory)}(),function(){var controller=function(Base,$element){var SELECTORS_plate=".chart-plate",SELECTORS_marker=".chart-plate__marker",SCALE=devicePixelRatio||1;return new(function(){function ChartPlate(){return _classCallCheck(this,ChartPlate),_possibleConstructorReturn(this,(ChartPlate.__proto__||Object.getPrototypeOf(ChartPlate)).apply(this,arguments))}return _inherits(ChartPlate,Base),_createClass(ChartPlate,[{key:"$postLink",value:function(){this.plate=$element.find(SELECTORS_plate),this.marker=$element.find(SELECTORS_marker),this.receive(this.wChart.signals.mouseMove,this._onMove,this),this.receive(this.wChart.signals.mouseLeave,this._onLeave,this)}},{key:"_onMove",value:function(data){this._setMarkerAndPlatePosition(data)}},{key:"_onLeave",value:function(){this.plate.removeClass("visible"),this.marker.removeClass("visible")}},{key:"_setMarkerAndPlatePosition",value:function(_ref114){var event=_ref114.event,point=_ref114.point,id=_ref114.id,x=point.x,y=point.y,markerX=x/SCALE-this.marker.outerWidth()/2,markerY=y/SCALE-this.marker.outerHeight()/2,plateX=void 0;event.offsetX<$element.closest("w-chart").innerWidth()/2?(plateX=x/SCALE+this.marker.outerWidth()/2+5,this.plate.addClass("to-right")):(plateX=markerX-this.plate.outerWidth()-5,this.plate.removeClass("to-right"));var plateY=y/SCALE-this.plate.outerHeight()/2;if(this.plate.css("transform","translate("+plateX+"px,"+plateY+"px)"),this.marker.css("transform","translate("+markerX+"px,"+markerY+"px)"),this.plate.addClass("visible"),this.marker.addClass("visible"),this.options&&this.options.markerColors){var markerColors=this.options.markerColors,color="string"==typeof markerColors&&markerColors||markerColors[id];this.marker.css("border-color",color)}}}]),ChartPlate}())};controller.$inject=["Base","$element"],angular.module("app.ui").component("wChartPlate",{transclude:!0,require:{wChart:"^wChart"},bindings:{options:"<"},templateUrl:"modules/ui/directives/chartPlate/chartPlate.html",controller:controller})}(),function(){var controller=function(Base,$element){return new(function(){function Checkbox(){_classCallCheck(this,Checkbox);var _this255=_possibleConstructorReturn(this,(Checkbox.__proto__||Object.getPrototypeOf(Checkbox)).call(this));return _this255.mode="",_this255.disabled=!1,_this255}return _inherits(Checkbox,Base),_createClass(Checkbox,[{key:"$postLink",value:function(){$element.removeAttr("id")}}]),Checkbox}())};controller.$inject=["Base","$element"];var getComponentData=function(type){var attrs;return{bindings:{mode:"@",id:"@",disabled:"<",ngModel:"="},template:(attrs=['ng-model="$ctrl.ngModel"','ng-class="$ctrl.mode"','ng-disabled="$ctrl.disabled"'],'<input type="checkbox" id="{{::$ctrl.id}}" '+attrs.join(" ")+' class="'+type+'">'),transclude:!1,controller:controller}};angular.module("app.ui").component("wCheckboxSubmit",getComponentData("submit")),angular.module("app.ui").component("wCheckboxSuccess",getComponentData("success")),angular.module("app.ui").component("wCheckboxSwitcher",getComponentData("switcher"))}(),function(){var DEFAULT_OPTIONS_center=0,ds=require("data-service"),BigNumber=require("@waves/bignumber").BigNumber,controller=function(Base,$element){return new(function(){function CircleChart(){_classCallCheck(this,CircleChart);var _this256=_possibleConstructorReturn(this,(CircleChart.__proto__||Object.getPrototypeOf(CircleChart)).call(this));return _this256._canvas=null,_this256._ctx=null,_this256._options=null,_this256._data=null,_this256.observe(["_options","_data"],_this256._redrawGraph),_this256}return _inherits(CircleChart,Base),_createClass(CircleChart,[{key:"$postLink",value:function(){this._canvas=$element.find("canvas").get(0),this._ctx=this._canvas.getContext("2d"),this._redrawGraph()}},{key:"_resetCanvasSize",value:function(){var _this257=this,size=2*this._data.reduce(function(result,item){return Math.max(result,_this257._options.items[item.id].radius)},0)+2;this._canvas.width=size,this._canvas.height=size}},{key:"_getBalances",value:function(){var Money=ds.wavesDataEntities.Money;return this._data.map(function(item){var value=item.value instanceof Money?item.value.getTokens():item.value;return{id:item.id,value:value}})}},{key:"_redrawGraph",value:function(){return this._canvas&&this._data&&this._data.length&&this._options&&this._options.items?(this._resetCanvasSize(),void this._draw()):null}},{key:"_draw",value:function(){var _this258=this,balances=this._getBalances(),total=balances.reduce(function(result,item){return result.add(item.value)},new BigNumber(0)),center=this._canvas.height/2+.5,insightRadius=this._options.center||DEFAULT_OPTIONS_center,empty=total.eq(0);if($element.toggleClass("empty-chart",empty),empty)return!1;var startFrom=this._options.startFrom;balances.forEach(function(item){var options=_this258._options.items[item.id],progress=item.value.div(total),end=startFrom+2*Math.PI*progress,startInsight={x:center+insightRadius*Math.cos(startFrom),y:center+insightRadius*Math.cos(Math.PI/2-startFrom)},startOut={x:center+options.radius*Math.cos(startFrom),y:center+options.radius*Math.cos(Math.PI/2-startFrom)},endInsight={x:center+insightRadius*Math.cos(end),y:center+insightRadius*Math.cos(Math.PI/2-end)};_this258._ctx.beginPath(),_this258._ctx.fillStyle=options.color,_this258._ctx.strokeStyle=options.color,_this258._ctx.lineWidth=1,_this258._ctx.moveTo(startInsight.x,startInsight.y),_this258._ctx.lineTo(startOut.x,startOut.y),_this258._ctx.arc(center,center,options.radius,startFrom,end),_this258._ctx.lineTo(endInsight.x,endInsight.y),_this258._ctx.moveTo(startInsight.x,startInsight.y),_this258._ctx.arc(center,center,insightRadius,startFrom,end),_this258._ctx.fill(),_this258._ctx.closePath(),startFrom=end}),insightRadius&&(this._ctx.save(),this._ctx.globalCompositeOperation="destination-out",this._ctx.beginPath(),this._ctx.fillStyle="rgba(255,255,255,1)",this._ctx.arc(center,center,insightRadius,0,2*Math.PI),this._ctx.fill(),this._ctx.closePath(),this._ctx.restore())}}]),CircleChart}())};controller.$inject=["Base","$element","utils"],angular.module("app.ui").component("wCircleChart",{bindings:{_options:"<options",_data:"<data"},template:"<canvas></canvas>",transclude:!1,controller:controller})}(),function(){var controller=function(Base,$element,$document,$scope){return new(function(){function ClickOutSide(){return _classCallCheck(this,ClickOutSide),_possibleConstructorReturn(this,(ClickOutSide.__proto__||Object.getPrototypeOf(ClickOutSide)).apply(this,arguments))}return _inherits(ClickOutSide,Base),_createClass(ClickOutSide,[{key:"$postLink",value:function(){var _this260=this;requestAnimationFrame(function(){_this260.listenEventEmitter($document,"click",function(e){0===$(e.target).closest($element).length&&(_this260.onClickOutside({event:e}),$scope.$apply())})})}}]),ClickOutSide}())};controller.$inject=["Base","$element","$document","$scope"],angular.module("app.ui").component("wClickOutside",{bindings:{onClickOutside:"&"},template:"<ng-transclude></ng-transclude>",transclude:!0,controller:controller})}(),function(){var ds=require("data-service"),SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,controller=function(Base,$scope,user,coinomatService){return new(function(){function CoinomatTerms(){_classCallCheck(this,CoinomatTerms);var _this261=_possibleConstructorReturn(this,(CoinomatTerms.__proto__||Object.getPrototypeOf(CoinomatTerms)).call(this));return _this261.termsAccepted=!1,_this261.termsAcceptedFreeze=!1,_this261.canShowTerms=!1,_this261.canShowCheckBox=!1,_this261.isVerified=!1,_this261.userModelTerms=!1,_this261.signPending=!1,_this261.signable=null,_this261.forceShowTerms=!1,_this261.showAcceptedCheckbox=!1,_this261.onSignStart=null,_this261.onSignEnd=null,_this261.termsPending=!1,_this261.loadError=null,_this261._ts=0,_this261.observe(["forceShowTerms","termsAcceptedFreeze"],_this261._currentCanShowTerms),_this261.observe(["showAcceptedCheckbox","termsAcceptedFreeze"],_this261._currentCanShowCheckbox),_this261}return _inherits(CoinomatTerms,Base),_createClass(CoinomatTerms,[{key:"$postLink",value:function(){var _this262=this;this.termsPending=!0,Promise.all([coinomatService.hasConfirmation(user.address),coinomatService.isVerified(user.address)]).then(function(_ref115){var _ref116=_slicedToArray(_ref115,2),terms=_ref116[0],verified=_ref116[1];_this262.termsAccepted=terms,_this262.userModelTerms=terms,_this262.termsAcceptedFreeze=terms,_this262.isVerified=verified,_this262.termsPending=!1,_this262.observe("userModelTerms",_this262._onChangeTerms),_this262._currentCanShowTerms(),_this262._currentCanShowCheckbox(),$scope.$apply()}).catch(function(e){_this262.loadError=e,_this262.termsPending=!1,_this262._currentCanShowTerms(),_this262._currentCanShowCheckbox(),$scope.$apply()})}},{key:"onSignCancel",value:function(){this.signPending=!1,this.userModelTerms=this.termsAccepted,this.signable=null,this.onSignEnd()}},{key:"onSignSuccess",value:function(signature){var _this263=this;return coinomatService.setCoinomatTermsAccepted(signature,this._ts,this.userModelTerms).catch(function(){_this263.userModelTerms=_this263.termsAccepted}).then(function(){_this263.signPending=!1,_this263.signable=null,_this263._ts=0,_this263.termsAccepted=_this263.userModelTerms,_this263.onSignEnd(),$scope.$apply()})}},{key:"_currentCanShowTerms",value:function(){this.canShowTerms=this.forceShowTerms||!this.termsAcceptedFreeze}},{key:"_currentCanShowCheckbox",value:function(){this.canShowCheckBox=this.showAcceptedCheckbox||this.isVerified&&!this.termsAcceptedFreeze}},{key:"_onChangeTerms",value:function(){var _this264=this;return this.termsAccepted===this.userModelTerms?null:(this.signPending=!0,this.onSignStart(),coinomatService.getCoinomatTimestamp().then(function(ts){return _this264._ts=ts}).then(CoinomatTerms._createSignable).then(function(signable){_this264.signable=signable,$scope.$apply()}))}}],[{key:"_createSignable",value:function(timestamp){return ds.signature.getSignatureApi().makeSignable({type:SIGN_TYPE.COINOMAT_CONFIRMATION,data:{timestamp:timestamp}})}}]),CoinomatTerms}())};controller.$inject=["Base","$scope","user","coinomatService"],angular.module("app.ui").component("wCoinomatTerms",{controller:controller,scope:!1,templateUrl:"modules/ui/directives/coinomatTerms/coinomat-terms.html",bindings:{onSignStart:"&",onSignEnd:"&",isVerified:"=",termsAccepted:"=",termsPending:"=",loadError:"=",forceShowTerms:"<",showAcceptedCheckbox:"<"}})}(),function(){var controller=function(Base,$element){return new(function(){function ComplexityMessage(){_classCallCheck(this,ComplexityMessage);var _this265=_possibleConstructorReturn(this,(ComplexityMessage.__proto__||Object.getPrototypeOf(ComplexityMessage)).call(this));return _this265.message=null,_this265.type=null,_this265.validators=null,_this265.parent=null,_this265.show=!1,_this265.observe("show",_this265._onChangeShow),_this265._onChangeShow(),_this265}return _inherits(ComplexityMessage,Base),_createClass(ComplexityMessage,[{key:"$postLink",value:function(){if(this.type){switch(this.type){case"warn":this.parent.addWarn(this);break;case"success":this.parent.addSuccess(this);break;default:throw new Error("Wrong message type!")}return null}if(this.validators=(this.message||"").split(",").map(function(item){return item.trim()}).filter(Boolean),!this.validators.length)throw new Error("Has no message");this.parent.addMessage(this)}},{key:"_onChangeShow",value:function(){$element.toggleClass("hidden",!this.show)}}]),ComplexityMessage}())};controller.$inject=["Base","$element"],angular.module("app.ui").component("complexityMessage",{controller:controller,require:{parent:"^wComplexityMeter"},bindings:{message:"@",type:"@"}})}(),function(){var controller=function(Base,$element,$scope,utils,i18n){return new(function(){function ComplexityMeter(){_classCallCheck(this,ComplexityMeter);var _this266=_possibleConstructorReturn(this,(ComplexityMeter.__proto__||Object.getPrototypeOf(ComplexityMeter)).call(this));return _this266.$input=null,_this266.field=null,_this266.steps=[],_this266.touched=!1,_this266._form=null,_this266._messages=[],_this266._messageWarn=null,_this266._messageSuccess=null,_this266._addSteps(),_this266}return _inherits(ComplexityMeter,Base),_createClass(ComplexityMeter,[{key:"value",get:function(){return this.$input.val()}},{key:"valid",get:function(){return this._form&&this._form[this.field]&&this._form[this.field].$valid||!1}}]),_createClass(ComplexityMeter,[{key:"$postLink",value:function(){var _this267=this,form=$element.closest("form");this._form=$scope.$parent.$eval(form.attr("name")),this.$input=form.find('input[name="'+this.field+'"]'),this.$input.on("input",function(){_this267._onChangeValue(),$scope.$apply()}),this.receive(utils.observe(this._form[this.field],"$viewValue"),this._onChangeValue,this),this.receive(utils.observe(this._form[this.field],"$valid"),this._onChangeValue,this),this._onChangeValue()}},{key:"addMessage",value:function(message){this._messages.push(message)}},{key:"addWarn",value:function(warn){this._messageWarn=warn}},{key:"addSuccess",value:function(success){this._messageSuccess=success}},{key:"_applyMessage",value:function(message){var _this268=this;message.show=message.validators.some(function(name){return _this268._form[_this268.field].$error[name]})}},{key:"_onChangeValue",value:function(){var value=this.value,complexity=this._getComplexy([this._getLengthComplexy(value),this._getComplexyByReg(value,/[A-Z]/g,30),this._getComplexyByReg(value,/[a-z]/g,30),this._getComplexyByReg(value,/[0-9]/g,30),this._getComplexyByReg(value,/\W/g,20)]);this._activateSteps(Math.round(complexity/10)),this._initializeMessage()}},{key:"_initializeMessage",value:function(){switch(this._hideAllMessages(),this.state){case"not-secure":this._messages.forEach(this._applyMessage,this);break;case"warn":this._messageWarn.show=!0;break;case"success":this._messageSuccess.show=!0;break;default:throw new Error("Wrong status")}}},{key:"_hideAllMessages",value:function(){this._messages.forEach(function(message){message.show=!1}),this._messageWarn.show=!1,this._messageSuccess.show=!1}},{key:"_activateSteps",value:function(activeStep){activeStep=this.valid?Math.max(activeStep,3):Math.min(activeStep,2);for(var i=0;i<this.steps.length;i++)this.steps[i].active=i<activeStep;if(activeStep<=2){var minLength=Number(this.$input.attr("min-length"))||8;this.state="not-secure",this.helpText=i18n.translate("createAccount.inputHelpError","app.create",{minLength:minLength})}else activeStep<7?(this.state="warn",this.helpText=i18n.translate("createAccount.inputHelpWarn","app.create")):this.state="success"}},{key:"_getComplexy",value:function(complexityList){return complexityList.reduce(function(result,item){return result+item})/complexityList.length*100}},{key:"_getLengthComplexy",value:function(value){var minLength=Number(this.$input.attr("min-length"))||8,targetLength=Math.round(1.8*minLength),complexity=Math.min(value.length/targetLength,1);return value.length<minLength?complexity/2:complexity}},{key:"_getComplexyByReg",value:function(value,reg,targetScore){var parts=value.match(reg);if(!parts)return 0;var score=0,charHash=Object.create(null);return parts.forEach(function(char){charHash[char]?score+=2:(score+=10,charHash[char]=char)}),Math.min(score/targetScore,1)}},{key:"_addSteps",value:function(){for(var i=0;i<10;i++)this.steps.push({active:!1})}}]),ComplexityMeter}())};controller.$inject=["Base","$element","$scope","utils","i18n"],angular.module("app.ui").component("wComplexityMeter",{bindings:{field:"@"},templateUrl:"modules/ui/directives/complexityMeter/complexityMeter.html",transclude:!0,controller:controller})}(),function(){var controller=function(Base){return new(function(){function ConfirmAction(){return _classCallCheck(this,ConfirmAction),_possibleConstructorReturn(this,(ConfirmAction.__proto__||Object.getPrototypeOf(ConfirmAction)).apply(this,arguments))}return _inherits(ConfirmAction,Base),_createClass(ConfirmAction,[{key:"$postLink",value:function(){this.clicked=!1}},{key:"onClickAction",value:function(){this.clicked=!0}},{key:"runAction",value:function(){this.action(),this.clicked=!1}},{key:"removeClicked",value:function(){this.clicked=!1}}]),ConfirmAction}())};controller.$inject=["Base"],angular.module("app.ui").component("wConfirmAction",{bindings:{literalText:"<",literalConfirm:"<",literalBack:"<",literalHeader:"<",literalDescription:"<",action:"&"},templateUrl:"modules/ui/directives/confirmAction/confirmAction.html",transclude:!1,controller:controller})}(),function(){var analytics=require("@waves/event-sender"),ds=require("data-service"),WAVES_GATEWAY_ASSETS_ID=[WavesApp.defaultAssets.VST,WavesApp.defaultAssets.ERGO,WavesApp.defaultAssets.BNT],controller=function(ConfirmTxService,$scope){return new(function(){function ConfirmGatewayTransaction(props){_classCallCheck(this,ConfirmGatewayTransaction);var _this270=_possibleConstructorReturn(this,(ConfirmGatewayTransaction.__proto__||Object.getPrototypeOf(ConfirmGatewayTransaction)).call(this,props));return _this270.targetRecipient="",_this270.gatewayDetails=null,_this270.observe(["gatewayDetails","tx"],function(){if(!_this270.gatewayDetails||!_this270.tx)return null;var fee=_this270.tx.amount.cloneWithTokens(_this270.gatewayDetails.gatewayFee);_this270.tx.amount=_this270.tx.amount.sub(fee)}),_this270}return _inherits(ConfirmGatewayTransaction,ConfirmTxService),_createClass(ConfirmGatewayTransaction,[{key:"getEventName",value:function(){return"Gateway"}},{key:"sendTransaction",value:function(){var signableAmountAsset=this.signable.getTxData().amount.asset;return WAVES_GATEWAY_ASSETS_ID.includes(signableAmountAsset.id)?this.signable.getDataForApi().then(function(data){return ds.fetch(WavesApp.network.wavesGateway+"/api/v1/external/send",{method:"POST",body:WavesApp.stringifyJSON(_extends({},data,{sender:ds.app.address}))})}).then(function(data){return analytics.send({name:signableAmountAsset.name.toUpperCase()+" Transaction Success"}),data},function(error){return analytics.send({name:signableAmountAsset.name.toUpperCase()+" Transaction Error"}),Promise.reject(error)}):_get2(ConfirmGatewayTransaction.prototype.__proto__||Object.getPrototypeOf(ConfirmGatewayTransaction.prototype),"sendTransaction",this).call(this)}}]),ConfirmGatewayTransaction}())($scope)};controller.$inject=["ConfirmTxService","$scope"],angular.module("app.ui").component("wConfirmGatewayTransaction",{bindings:{signable:"<",gatewayDetails:"<",targetRecipient:"<",onClickBack:"&"},templateUrl:"modules/ui/directives/confirmGatewayTransaction/confirmGatewayTransaction.html",scope:!1,transclude:!1,controller:controller})}(),function(){var controller=function(ConfirmTxService,$scope,validateService,utils,waves,$attrs,balanceWatcher,user){var _require67=require("ramda"),flatten=_require67.flatten,propEq=_require67.propEq,SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,analytics=require("@waves/event-sender"),ANALYTICS_TABS_NAMES={details:"View Details",JSON:"JSON",export:"Export"};return new(function(){function ConfirmTransaction(){_classCallCheck(this,ConfirmTransaction);var _this271=_possibleConstructorReturn(this,(ConfirmTransaction.__proto__||Object.getPrototypeOf(ConfirmTransaction)).call(this,$scope));return _this271.locale=$attrs.ns||"app.ui",_this271.step=0,_this271.type=0,_this271.isSetScript=!1,_this271.observe(["signable"],_this271._showErrors),_this271.receive(balanceWatcher.change,_this271._showErrors,_this271),_this271}return _inherits(ConfirmTransaction,ConfirmTxService),_createClass(ConfirmTransaction,[{key:"$postLink",value:function(){var _this272=this,tx=this.signable.getTxData();this.type=this.signable.type,this.isSetScript=this.type===SIGN_TYPE.SET_SCRIPT&&tx.script,this.isTockenIssue=this.type===SIGN_TYPE.ISSUE,this.isAnyTx&&this.observe("activeTab",function(){var name="Wallet Assets JSON "+ANALYTICS_TABS_NAMES[_this272.activeTab]+" Show";analytics.send({name:name,target:"ui"})});var key,NAME=this.getEventName(tx);if(analytics.send({name:NAME+" Info Show",target:"ui"}),this.signable.hasMySignature().then(function(state){_this272.step=state?1:0,$scope.$apply()}),"data-vote"===this.tx.typeName){var assetId=(key="assetId",tx.data.find(propEq("key",key))).value;waves.node.assets.getAsset(assetId).then(function(asset){_this272.votedAssetID=asset.displayName})}}},{key:"sendTransaction",value:function(){var _this273=this;if(this.isAnyTx){var name="Wallet Assets JSON "+ANALYTICS_TABS_NAMES[this.activeTab]+" Send Click";analytics.send({name:name,target:"ui"})}return analytics.send(this._getConfirmAnalytics(this.signable.getTxData(),!0)),_get2(ConfirmTransaction.prototype.__proto__||Object.getPrototypeOf(ConfirmTransaction.prototype),"sendTransaction",this).call(this).then(function(data){return _this273.onTransactionSend(),data})}},{key:"onChangeSignable",value:function(){_get2(ConfirmTransaction.prototype.__proto__||Object.getPrototypeOf(ConfirmTransaction.prototype),"onChangeSignable",this).call(this),this.tx&&(this.permissionName=ConfirmTransaction._getPermissionNameByTx(this.signable.type))}},{key:"getSignable",value:function(){return this.signable}},{key:"getSignableAndSendEvent",value:function(){switch(this.signable.type){case 14:analytics.send({name:"Disable Sponsorship Continue Click",target:"ui"});break;case 9:analytics.send({name:"Leasing Cancel Sign Click",target:"ui"})}return this.signable}},{key:"nextStep",value:function(){this.step++,this.initExportLink()}},{key:"_getConfirmAnalytics",value:function(data,isOnSendClick){var NAME=this.getEventName(data);return{name:isOnSendClick?NAME+" Info Send Click":NAME+" Info Go Back Click",params:{type:data.type},target:"ui"}}},{key:"_showErrors",value:function(){var _this274=this;if(!this.signable)return null;var promise=void 0,_signable$getTxData=this.signable.getTxData(),amount=_signable$getTxData.amount,fee=_signable$getTxData.fee,senderPublicKey=_signable$getTxData.senderPublicKey,type=this.signable.type;if(senderPublicKey&&senderPublicKey!==user.publicKey)return null;switch(type){case SIGN_TYPE.TRANSFER:promise=Promise.all([this._validateAmount(amount,!1),this._validateAmount(fee,!0),this._validateAddress()]);break;case SIGN_TYPE.CREATE_ORDER:case SIGN_TYPE.CANCEL_LEASING:promise=Promise.all([]);break;default:promise=Promise.all([this._validateAmount(fee,!0)])}return promise.then(flatten).then(function(errors){_this274.errors=errors,$scope.$apply()})}},{key:"_validateAddress",value:function(){var recipient=this.signable.getTxData().recipient,errors=[];return utils.resolve(utils.when(validateService.wavesAddress(recipient))).then(function(_ref117){return _ref117.state||errors.push({literal:"confirmTransaction.send.errors.recipient.invalid"}),errors})}},{key:"_validateAmount",value:function(amount,isFee){var errors=[],hash=balanceWatcher.getBalance();if(!hash[amount.asset.id]||hash[amount.asset.id].lt(amount)||amount.getTokens().lte(0)){var literal=isFee?"confirmTransaction.send.errors.fee":"confirmTransaction.send.errors.balance.invalid";errors.push({literal:literal,data:{fee:amount}})}return errors}},{key:"back",value:function(){analytics.send(this._getConfirmAnalytics(this.signable.getTxData(),!1)),this.onClickBack()}}],[{key:"_getPermissionNameByTx",value:function(type){switch(type){case SIGN_TYPE.ISSUE:return"CAN_ISSUE_TRANSACTION";case SIGN_TYPE.TRANSFER:return"CAN_TRANSFER_TRANSACTION";case SIGN_TYPE.REISSUE:return"CAN_REISSUE_TRANSACTION";case SIGN_TYPE.BURN:return"CAN_BURN_TRANSACTION";case 7:throw new Error("Can' confirm exchange transaction!");case SIGN_TYPE.LEASE:return"CAN_LEASE_TRANSACTION";case SIGN_TYPE.CANCEL_LEASING:return"CAN_CANCEL_LEASE_TRANSACTION";case SIGN_TYPE.CREATE_ALIAS:return"CAN_CREATE_ALIAS_TRANSACTION";case SIGN_TYPE.MASS_TRANSFER:return"CAN_MASS_TRANSFER_TRANSACTION";case SIGN_TYPE.DATA:return"CAN_DATA_TRANSACTION";case SIGN_TYPE.SET_SCRIPT:return"CAN_SET_SCRIPT_TRANSACTION";case SIGN_TYPE.SPONSORSHIP:return"CAN_SPONSORSHIP_TRANSACTION";case SIGN_TYPE.CREATE_ORDER:return"CAN_CREATE_ORDER";case SIGN_TYPE.CANCEL_ORDER:return"CAN_CANCEL_ORDER";default:return""}}}]),ConfirmTransaction}())};controller.$inject=["ConfirmTxService","$scope","validateService","utils","waves","$attrs","balanceWatcher","user"],angular.module("app.ui").component("wConfirmTransaction",{bindings:{signable:"<",onClickBack:"&",onTxSent:"&",noBackButton:"<",warning:"<",onTransactionSend:"&",referrer:"<",activeTab:"<",isAnyTx:"<"},templateUrl:"modules/ui/directives/confirmTransaction/confirmTransaction.html",transclude:!1,controller:controller})}(),angular.module("app.ui").component("wCopyWrap",{bindings:{info:"<",onCopy:"&"},template:'<div class="container" ng-transclude></div><div ng-click="$ctrl.onCopy()" w-copy="$ctrl.info" class="copy-icon"></div>',transclude:!0}),angular.module("app.ui").component("wCopyWrapDefault",{bindings:{info:"<",onCopy:"&"},template:'<div ng-click="$ctrl.onCopy()" w-copy="$ctrl.info" class="container" ng-transclude></div><div ng-click="$ctrl.onCopy()" w-copy="$ctrl.info" class="copy-icon"></div>',transclude:!0}),function(){var controller=function(Base,$scope,utils,notification,$element){return new(function(){function Copy(){_classCallCheck(this,Copy);var _this275=_possibleConstructorReturn(this,(Copy.__proto__||Object.getPrototypeOf(Copy)).call(this,$scope)),element=$element.get(0),clipboard=new Clipboard(element,{text:function(){return $scope.wCopy},container:element});return clipboard.on("success",function(){notification.info({ns:"app.ui",title:{literal:"copySuccess"}})}),clipboard.on("error",function(){notification.error({ns:"app.ui",title:{literal:"copyError"}})}),_this275.signals.destroy.once(function(){clipboard.destroy()}),_this275}return _inherits(Copy,Base),Copy}())};controller.$inject=["Base","$scope","utils","notification","$element"];var directive=function(){return{restrict:"A",priority:100,scope:{wCopy:"<"},controller:controller}};directive.$inject=[],angular.module("app.ui").directive("wCopy",directive)}(),function(){function controller($scope,$element){return new(function(){function WDate(){_classCallCheck(this,WDate),this._date=null,this.handlerType=null,this.timerCallback=null}return _createClass(WDate,[{key:"date",get:function(){return $scope.date instanceof Date?$scope.date:"string"==typeof $scope.date?new Date(Number($scope.date)):new Date($scope.date)}}]),_createClass(WDate,[{key:"$postLink",value:function(){var _this276=this;if(this.mode=$scope.mode||AVAILABLE_MODES[0],!AVAILABLE_MODES.includes(this.mode))throw new Error("Wrong date mode!");"time-ago"===this.mode?(this.listener=function(){return _this276._initTimeAgoMode()},$scope.$watch("date",function(){return _this276._initTimeAgoMode()}),this._initTimeAgoMode()):(this.filter=tsUtils.date(PATTERNS[this.mode][i18next.language]),this.listener=function(){_this276.filter=tsUtils.date(PATTERNS[_this276.mode][i18next.language]),_this276._initSimpleMode()},$scope.$watch("date",function(){return _this276._initSimpleMode()}),this._initSimpleMode()),i18next.on("languageChanged",this.listener)}},{key:"_initTimeAgoMode",value:function(){var _this277=this;if(null==$scope.date)return $element.html("");this.handlerType&&this.timerCallback&&controller.off(this.handlerType,this.timerCallback);var date=this.date,delta=Date.now()-date;this.timerCallback=function(){return _this277._initTimeAgoMode()},delta<TIMES.min?($element.html(Math.round(delta/TIMES.sec)+" sec ago"),this.handlerType="sec",controller.once(this.handlerType,this.timerCallback)):delta<TIMES.hour?($element.html(Math.round(delta/TIMES.min)+" min ago"),this.handlerType="min",controller.once(this.handlerType,this.timerCallback)):delta<TIMES.day?($element.html(Math.round(delta/TIMES.hour)+" hours ago"),this.handlerType="hour",controller.once(this.handlerType,this.timerCallback)):delta<TIMES.week?$element.html(Math.round(delta/TIMES.day)+" days ago"):delta<TIMES.month?$element.html(Math.round(delta/TIMES.week)+" weeks ago"):delta<TIMES.year?$element.html(Math.round(delta/TIMES.month)+" months ago"):$element.html("A lot of time ago")}},{key:"_initSimpleMode",value:function(){if(null==$scope.date)return $element.html("");$element.text(this.filter(this.date))}},{key:"$onDestroy",value:function(){i18next.off("languageChanged",this.listener),this.handlerType&&this.timerCallback&&controller.off(this.handlerType,this.timerCallback)}}]),WDate}())}var PATTERNS={default:{en:"DD/MM/YYYY",ru:"DD.MM.YYYY"},short:{en:"DD/MM",ru:"DD.MM"}},TIMES={sec:1e3,min:6e4,hour:36e5,day:864e5,week:6048e5,month:2592e6,year:31536e6},AVAILABLE_MODES=["default","short","time-ago"];controller.$inject=["$scope","$element"],controller.handlers={sec:[],min:[],hour:[]},controller.timers={sec:null,min:null,hour:null},controller.once=function(type,handler){controller.handlers[type].push(handler),controller.isNeedStart(type)&&controller.startTimer(type)},controller.off=function(type,handler){controller.handlers[type]=controller.handlers[type].filter(tsUtils.notContains(handler))},controller.trigger=function(type){var handlers=controller.handlers[type].slice();controller.handlers[type]=[],handlers.forEach(function(cb){return cb()})},controller.isNeedStart=function(type){return!!controller.handlers[type].length&&!controller.timers[type]},controller.startTimer=function(type){controller.timers[type]=setTimeout(function(){controller.timers[type]=null,controller.trigger(type)},TIMES[type])},angular.module("app").directive("wDate",function(){return{restrict:"A",scope:{mode:"@",date:"<wDate"},controller:controller}})}(),angular.module("app.ui").component("wDesktopOnly",{scope:!1,transclude:!0,template:'<div ng-if="::'+WavesApp.isDesktop()+'" ng-transclude></div>'}),angular.module("app.ui").component("wDots",{templateUrl:"modules/ui/directives/dots/dots.html"}),function(){var TOUCH_EVENTS_START="touchstart",TOUCH_EVENTS_MOVE="touchmove",TOUCH_EVENTS_END="touchend",POINTER_EVENTS={START:"mousedown"+" "+TOUCH_EVENTS_START,MOVE:"mousemove"+" "+TOUCH_EVENTS_MOVE,END:"mouseup"+" "+TOUCH_EVENTS_END},directive=function(utils,$document,Base){return{scope:!1,link:function($scope,$element){new(function(){function Draggable(){_classCallCheck(this,Draggable);var _this278=_possibleConstructorReturn(this,(Draggable.__proto__||Object.getPrototypeOf(Draggable)).call(this,$scope)),element=$element.get(0),startRect=element.getBoundingClientRect();return _this278.x=startRect.left,_this278.y=startRect.top,_this278.delta={x:0,y:0},_this278.touchId=0,_this278.element=element,_this278.$overlay=$('<div class="drag-overlay">'),_this278.moveHandler=_this278._getMoveHandler(),_this278.resizeHandler=utils.debounceRequestAnimationFrame(function(){return _this278._onResize()}),_this278._initializeElementPosition(),_this278._setHandlers(),_this278._draw(),_this278}return _inherits(Draggable,Base),_createClass(Draggable,[{key:"$onDestroy",value:function(){_get2(Draggable.prototype.__proto__||Object.getPrototypeOf(Draggable.prototype),"$onDestroy",this).call(this),$element.remove()}},{key:"_initializeElementPosition",value:function(){var position=$element.css("position");"static"!==position&&"relative"!==position||$element.css("position","absolute"),$element.addClass("drag-element"),document.body.appendChild(this.element)}},{key:"_setHandlers",value:function(){var _this279=this;this.listenEventEmitter($element,POINTER_EVENTS.START,function(e){return _this279._onStart(e)}),this.listenEventEmitter($(window),"resize",this.resizeHandler),$scope.$watch(function(){return _this279._getElementSize()},this.resizeHandler)}},{key:"_onStart",value:function(e){var _this280=this,event=this._getDistilledEvent(e);if(event.type!==TOUCH_EVENTS_START&&event.preventDefault(),0!==event.button)return!1;this.$overlay.insertBefore($element);var rect=this.element.getBoundingClientRect();this.delta.x=event.pageX-rect.left,this.delta.y=event.pageY-rect.top,this.listenEventEmitter($document,POINTER_EVENTS.MOVE,this.moveHandler),this.listenEventEmitter($document,POINTER_EVENTS.END,function(){return _this280._onEnd()})}},{key:"_onMove",value:function(e){var rect=this.element.getBoundingClientRect(),x=e.pageX-this.delta.x,y=e.pageY-this.delta.y;this._updateTranslation(rect,{x:x,y:y}),this._draw()}},{key:"_onResize",value:function(){var rect=this.element.getBoundingClientRect();this._updateTranslation(rect),this._draw()}},{key:"_onEnd",value:function(){this.$overlay.detach(),this.stopListenEventEmitter(POINTER_EVENTS.MOVE,$document),this.stopListenEventEmitter(POINTER_EVENTS.END,$document)}},{key:"_updateTranslation",value:function(rect,argument_1){var coordinates=1<arguments.length&&void 0!==argument_1?argument_1:{x:rect.left,y:rect.top};this.x=Draggable._getValueInRange({min:0,max:innerWidth-rect.width,value:coordinates.x}),this.y=Draggable._getValueInRange({min:0,max:innerHeight-rect.height,value:coordinates.y})}},{key:"_getDistilledEvent",value:function(e){var touch=this._getTouch(e.originalEvent);return{preventDefault:function(){return e.originalEvent.preventDefault()},button:e.button||0,pageX:Draggable._getCoordinateValue(e,touch,"pageX"),pageY:Draggable._getCoordinateValue(e,touch,"pageY"),type:e.type}}},{key:"_getMoveHandler",value:function(){var _this281=this;return utils.debounceRequestAnimationFrame(function(e){return _this281._onMove(_this281._getDistilledEvent(e))})}},{key:"_getTouch",value:function(event){switch(event.type){case TOUCH_EVENTS_START:return this.touchId=event.targetTouches[0].identifier,this._getTouchEventById(event);case TOUCH_EVENTS_MOVE:return this._getTouchEventById(event);case TOUCH_EVENTS_END:return this.touchId=0,event.changedTouches[0];default:return{}}}},{key:"_getTouchEventById",value:function(event){var _this282=this;return Array.prototype.filter.call(event.targetTouches,function(_ref118){return _ref118.identifier===_this282.touchId})[0]}},{key:"_draw",value:function(){$element.css("transform","translate("+this.x+"px, "+this.y+"px)")}},{key:"_getElementSize",value:function(){return this.element.clientWidth+" / "+this.element.clientHeight}}],[{key:"_getValueInRange",value:function(parameters){var min=parameters.min,max=parameters.max,value=parameters.value;return Math.min(Math.max(value,min),max)}},{key:"_getCoordinateValue",value:function(event,touch,coordinate){return"number"!=typeof event[coordinate]?touch[coordinate]:event[coordinate]}}]),Draggable}())}}};directive.$inject=["utils","$document","Base"],angular.module("app.ui").directive("wDraggable",directive)}(),angular.module("app.ui").component("wEmptyBlock",{templateUrl:"modules/ui/directives/emptyBlock/emptyBlock.html"}),angular.module("app.ui").component("wErrorBlock",{templateUrl:"modules/ui/directives/errorBlock/errorBlock.html"}),function(){var controller=function(Base,createPoll,user,waves,utils,$element,$scope){return new(function(){function Exchange(){_classCallCheck(this,Exchange);var _this283=_possibleConstructorReturn(this,(Exchange.__proto__||Object.getPrototypeOf(Exchange)).call(this));return _this283.balance=null,_this283.mirrorBalance=null,_this283.interval=null,_this283.mirror=null,_this283.targetAssetId=null,_this283.noUpdate=null,_this283.rateDate=null,_this283.poll=null,_this283}return _inherits(Exchange,Base),_createClass(Exchange,[{key:"$postLink",value:function(){var _this284=this;this.interval=Number(this.interval)||5e3,this.noUpdate=null==this.noUpdate,waves.node.assets.getAsset(this.targetAssetId||user.getSetting("baseAssetId")).then(function(mirror){_this284.mirror=mirror,_this284.noUpdate?_this284._getMirrorBalance().then(function(balance){_this284.mirrorBalance=balance,$scope.$digest()}):_this284.poll=createPoll(_this284,_this284._getMirrorBalance,"mirrorBalance",_this284.interval,{$scope:$scope}),_this284.observe("balance",_this284._onChangeBalance),_this284.observe("mirrorBalance",_this284._onChangeMirrorBalance),_this284._onChangeBalance()})}},{key:"_onChangeBalance",value:function(){var _this285=this;this.balance&&(this.noUpdate?this._getMirrorBalance().then(function(balance){_this285.mirrorBalance=balance}):this.poll.restart())}},{key:"_getMirrorBalance",value:function(){var _this286=this;return this.balance?waves.utils.getRateApi(this.balance.asset.id,this.mirror.id).then(function(api){return _this286.balance&&api.exchange(_this286.balance.getTokens())||0}):Promise.resolve(null)}},{key:"_onChangeMirrorBalance",value:function(){$element.html(this.mirrorBalance?this.mirrorBalance.toFormat():"")}}]),Exchange}())};controller.$inject=["Base","createPoll","user","waves","utils","$element","$scope"],angular.module("app.ui").component("wExchange",{bindings:{balance:"<",interval:"@",rateDate:"@",noUpdate:"@",targetAssetId:"@"},transclude:!1,controller:controller})}(),function(){var controller=function(Base){return new(function(){function ExpandBtn(){return _classCallCheck(this,ExpandBtn),_possibleConstructorReturn(this,(ExpandBtn.__proto__||Object.getPrototypeOf(ExpandBtn)).apply(this,arguments))}return _inherits(ExpandBtn,Base),_createClass(ExpandBtn,[{key:"toggleOpen",value:function(){this.isUp=!this.isUp}}]),ExpandBtn}())};controller.$inject=["Base"],angular.module("app.ui").component("wExpandBtn",{templateUrl:"modules/ui/directives/expandBtn/expandBtn.html",transclude:!0,bindings:{btnTxt:"<",i18key:"<",isUp:"<",i18nParams:"<"},controller:controller})}(),function(){var controller=function(Base,waves,$scope,user){return new(function(){function FeeList(){_classCallCheck(this,FeeList);var _this288=_possibleConstructorReturn(this,(FeeList.__proto__||Object.getPrototypeOf(FeeList)).call(this));return _this288.tx=null,_this288.fee=null,_this288.feeList=[],_this288.balanceHash=null,$scope.$watch("$ctrl.tx",function(){return _this288._onChangeTx()},!0),_this288.observe("balanceHash",_this288._onChangeBalanceHash),_this288}return _inherits(FeeList,Base),_createClass(FeeList,[{key:"_onChangeTx",value:function(){var _this289=this;if(!this.tx)return null;waves.node.getFeeList(this.tx).then(function(list){_this289.originalFeeList=list,_this289._setActualFeeList();if(_this289.fee&&list.some(function(item){return function(money1,money2){return function(asset1,asset2){return asset1.id===asset2.id}(money1.asset,money2.asset)&&money1.eq(money2)}(item,_this289.fee)})||(_this289.fee=null),!_this289.fee||!list.find(function(item){return item.asset.id===_this289.fee.asset.id})){var fee=_this289.balanceHash&&Object.keys(_this289.balanceHash).length&&_this289.feeList.find(function(item){var balance=_this289.balanceHash[item.asset.id];return balance&&balance.gte(item)});_this289.fee=fee||_this289.feeList[0]}$scope.$apply()})}},{key:"_onChangeBalanceHash",value:function(){var _this290=this;if(!this.fee)return null;if(this._setActualFeeList(),1===this.feeList.length)return null;var feeBalance=this.balanceHash[this.fee.asset.id];feeBalance&&!feeBalance.lt(this.fee)||(this.fee=this.balanceHash&&Object.keys(this.balanceHash).length&&this.feeList.find(function(item){var balance=_this290.balanceHash[item.asset.id];return balance&&balance.gte(item)})||this.fee)}},{key:"_setActualFeeList",value:function(argument_0){var _this291=this,list=0<arguments.length&&void 0!==argument_0?argument_0:this.originalFeeList,hasBalances=this.balanceHash&&Object.keys(this.balanceHash).length;if(!list||list.length<2||!hasBalances)return this.feeList=[].concat(_toConsumableArray(list||[])),null;var wavesFee=list.find(function(item){return"WAVES"===item.asset.id}),filteredList=list.filter(function(fee){var feeBalance=_this291.balanceHash[fee.asset.id],canUseOwnFee=user.address!==fee.asset.sender||_this291.balanceHash.WAVES.gte(wavesFee);return hasBalances&&feeBalance&&feeBalance.gte(fee)&&canUseOwnFee});filteredList.length||filteredList.push(wavesFee),this.feeList=filteredList}}]),FeeList}())};controller.$inject=["Base","waves","$scope","user"],angular.module("app.ui").component("wFeeList",{bindings:{tx:"<",balanceHash:"<",disabled:"<",fee:"="},scope:!1,transclude:!1,templateUrl:"modules/ui/directives/feeList/feeList.html",controller:controller})}(),angular.module("app.ui").component("wExpandableBlock",{bindings:{title:"<"},templateUrl:"modules/ui/directives/expandableBlock/expandableBlock.html",transclude:!0}),function(){var controller=function(Base,user,$scope,angularUtils){return new(function(){function GetStartedLinkCtrl(){_classCallCheck(this,GetStartedLinkCtrl);var _this292=_possibleConstructorReturn(this,(GetStartedLinkCtrl.__proto__||Object.getPrototypeOf(GetStartedLinkCtrl)).call(this,$scope));return _this292._userList=[],_this292.hovered=!1,_this292._initUserList(),_this292}return _inherits(GetStartedLinkCtrl,Base),_createClass(GetStartedLinkCtrl,[{key:"_initUserList",value:function(){var _this293=this;user.getFilteredUserList().then(function(list){_this293._userList=list,angularUtils.postDigest($scope).then(function(){$scope.$apply()})})}}]),GetStartedLinkCtrl}())};controller.$inject=["Base","user","$scope","utils"],angular.module("app.ui").component("wGetStartedLink",{templateUrl:"modules/ui/directives/getStartedLink/getStartedLink.html",bindings:{hasSignIn:"<",hasCreate:"<",hasImport:"<"},controller:controller})}(),function(){var analytics=require("@waves/event-sender"),controller=function(Base,$scope,$element,utils,storage){return new(function(){function FooterCtrl(){_classCallCheck(this,FooterCtrl);var _this294=_possibleConstructorReturn(this,(FooterCtrl.__proto__||Object.getPrototypeOf(FooterCtrl)).call(this));return _this294._toasterMobilesStorageKey="toasterMobilesHidden",_this294.hovered=!1,_this294.mobileAppLink=navigator.userAgent.match(/iPhone|iPad|iPod/i)?"https://itunes.apple.com/us/app/waves-wallet/id1233158971?mt=8":"https://play.google.com/store/apps/details?id=com.wavesplatform.wallet",_this294.telegramLink="ru"===localStorage.getItem("lng")?"https://t.me/WavesCommunityRU":"https://t.me/WavesCommunity",_this294.lang="ru"===localStorage.getItem("lng")?"Ru":"Global",storage.load(_this294._toasterMobilesStorageKey).then(function(wasHidden){_this294.isToasterMobilesVisible=!wasHidden,wasHidden||analytics.send({name:"Download Mobile Display",target:"all"}),utils.safeApply($scope)}),_this294}return _inherits(FooterCtrl,Base),_createClass(FooterCtrl,[{key:"hideToaster",value:function(){analytics.send({name:"Download Mobile Close",target:"all"}),$element.find(".toaster-mobiles").addClass("hidden-toaster"),storage.save(this._toasterMobilesStorageKey,!0)}}]),FooterCtrl}())};controller.$inject=["Base","$scope","$element","utils","storage"],angular.module("app.ui").component("wFooter",{templateUrl:"modules/ui/directives/footer/footer.html",controller:controller})}(),function(){var controller=function(Base,$element,utils){var tsUtils=require("ts-utils");return new(function(){function ImportFile(){_classCallCheck(this,ImportFile);var _this295=_possibleConstructorReturn(this,(ImportFile.__proto__||Object.getPrototypeOf(ImportFile)).call(this));return _this295.extensionList=null,_this295.onChange=null,_this295._input=ImportFile._createInput(),_this295._setHandlers(),_this295}return _inherits(ImportFile,Base),_createClass(ImportFile,[{key:"$onDestroy",value:function(){document.body.removeChild(this._input),_get2(ImportFile.prototype.__proto__||Object.getPrototypeOf(ImportFile.prototype),"$onDestroy",this).call(this)}},{key:"_setHandlers",value:function(){var _this296=this;this.listenEventEmitter($element,"click",function(){return _this296._onClick()}),this.listenEventEmitter(this._input,"change",function(){return _this296._onChange()},{on:"addEventListener",off:"removeEventListener"})}},{key:"_onChange",value:function(){var file=_slicedToArray(this._input.files,1)[0];if(file){if(!this._isFileValid(file))return this.onChange({data:{status:"error",type:"extension",message:"Wrong extension",file:file}}),null;this.onChange({data:{status:"ok",file:file}})}this._input.value=""}},{key:"_onClick",value:function(){this._input.click()}},{key:"_isFileValid",value:function(file){if(tsUtils.isNotEmpty(this.extensionList)){var extensionList=utils.toArray(this.extensionList),fileExtension=file.name.split(".")[1];return fileExtension&&extensionList.some(function(ext){return ext===fileExtension})}return!0}}],[{key:"_createInput",value:function(){var input=document.createElement("input");return input.type="file",input.style.position="absolute",input.style.left="-100px",input.style.top="-100px",document.body.appendChild(input),input}}]),ImportFile}())};controller.$inject=["Base","$element","utils"],angular.module("app.ui").component("wImportFile",{bindings:{extensionList:"<",onChange:"&"},template:"<ng-transclude></ng-transclude>",transclude:!0,controller:controller})}(),function(){var controller=function(Base,$scope,$element){return new(function(){function HelpIconController(){_classCallCheck(this,HelpIconController);var _this297=_possibleConstructorReturn(this,(HelpIconController.__proto__||Object.getPrototypeOf(HelpIconController)).call(this));return _this297.hovered=!1,_this297}return _inherits(HelpIconController,Base),_createClass(HelpIconController,[{key:"hoverIn",value:function(){this.hovered=!0,clearTimeout(this.timer),$scope.$apply()}},{key:"hoverOut",value:function(){var _this298=this;clearTimeout(this.timer),this.timer=setTimeout(function(){_this298.hovered=!1,$scope.$apply()},Number(this.delay)||1e3)}},{key:"$postLink",value:function(){var _this299=this;$element.on("mouseover",function(){return _this299.hoverIn()}),$element.on("mouseout",function(){return _this299.hoverOut()})}}]),HelpIconController}())};controller.$inject=["Base","$scope","$element"],angular.module("app.ui").component("wHelpIcon",{templateUrl:"modules/ui/directives/helpIcon/helpIcon.html",transclude:!0,bindings:{delay:"="},controller:controller})}(),function(){var controller=function(Base,$scope,$element){return new(function(){function InfoTooltipController(){_classCallCheck(this,InfoTooltipController);var _this300=_possibleConstructorReturn(this,(InfoTooltipController.__proto__||Object.getPrototypeOf(InfoTooltipController)).call(this));return _this300.hovered=!1,_this300}return _inherits(InfoTooltipController,Base),_createClass(InfoTooltipController,[{key:"hoverIn",value:function(){this.hovered=!0,clearTimeout(this.timer),$scope.$apply()}},{key:"hoverOut",value:function(){var _this301=this;clearTimeout(this.timer),this.timer=setTimeout(function(){_this301.hovered=!1,$scope.$apply()},Number(this.delay)||1e3)}},{key:"$postLink",value:function(){var _this302=this;$element.find("i").on("mouseover",function(){return _this302.hoverIn()}),$element.find("i").on("mouseout",function(){return _this302.hoverOut()})}}]),InfoTooltipController}())};controller.$inject=["Base","$scope","$element"],angular.module("app.ui").component("wInfoTooltip",{templateUrl:"modules/ui/directives/infoTooltip/infoTooltip.html",transclude:!0,bindings:{delay:"<",noIcon:"<"},controller:controller})}(),function(){var EXCLUDE_ATRIBUTES=["tabindex"],directive=function(Base,utils){return{result:"E",require:null,transclude:!1,template:function($element,$data){var attrs=Object.keys($data.$attr).reduce(function(result,name){return result.push($data.$attr[name]+'="'+$data[name]+'"'),result},[]),typeClass=$data.type?"input-type-"+$data.type:"",element=$element[0];return EXCLUDE_ATRIBUTES.forEach(function(attr){element.removeAttribute(attr)}),"textarea"in $data?'<div class="w-input-wrap '+typeClass+'"><textarea '+attrs.join(" ")+"></textarea></div>":'<div class="w-input-wrap '+typeClass+'"><input '+attrs.join(" ")+"></div>"},link:function($scope,$element,$attrs){return new(function(){function Input(){_classCallCheck(this,Input);var _this303=_possibleConstructorReturn(this,(Input.__proto__||Object.getPrototypeOf(Input)).call(this,$scope));return _this303._$input=null,_this303._$inputWrap=null,_this303._$form=null,_this303._stopScopeHandlers=[],_this303._name=null,_this303._initialize(),_this303}return _inherits(Input,Base),_createClass(Input,[{key:"$onDestroy",value:function(){_get2(Input.prototype.__proto__||Object.getPrototypeOf(Input.prototype),"$onDestroy",this).call(this),this._stopScopeHandlers.forEach(function(cb){return cb()})}},{key:"_initialize",value:function(){this._$input=$element.find("input,textarea"),this._$inputWrap=$element.find(".w-input-wrap");var name=this._name=this._getName(),formName=$element.closest("form").attr("name");if(this._setHandlers(),this._name&&formName){var form=this._$form=this._getForm(formName);this.receive(utils.observe(form[name],"$valid"),this._onChangeValid,this),this.receive(utils.observe(form[name],"$touched"),this._onChangeTouched,this),this._onChangeValid(),this._onChangeTouched()}$attrs.autoFocus&&this._$input.focus()}},{key:"_setHandlers",value:function(){var _this304=this;this._$input.on("focus",function(){_this304._$inputWrap.addClass("focused")}),this._$input.on("blur",function(){_this304._$inputWrap.removeClass("focused")})}},{key:"_getName",value:function(){var name=this._$input.attr("name");return name?-1===name.indexOf("{{")?name:$scope.$eval(name.replace("{{","").replace("}}","").replace("::","")):null}},{key:"_getForm",value:function(name){var $localScope=$scope,form=null;do{if(form=$localScope.$eval(name))break;$localScope=$localScope.$parent}while($localScope.$parent);if(!form)throw new Error("Cant find parent form data!");return form}},{key:"_onChangeValid",value:function(){this._$inputWrap.toggleClass("valid",this._$form[this._name].$valid),this._$inputWrap.toggleClass("invalid",!this._$form[this._name].$valid)}},{key:"_onChangeTouched",value:function(){this._$inputWrap.toggleClass("touched",this._$form[this._name].$touched)}}]),Input}())}}};directive.$inject=["Base","utils"],angular.module("app.ui").directive("wInput",directive)}(),function(){var controller=function(Base,$element,$scope,createPoll,utils,decorators){var _dec10,_class46,tsUtisl=require("ts-utils");return new(_dec10=decorators.async(),_applyDecoratedDescriptor((_class46=function(){function InputContainer(){_classCallCheck(this,InputContainer);var _this305=_possibleConstructorReturn(this,(InputContainer.__proto__||Object.getPrototypeOf(InputContainer)).call(this));return _this305.form=null,_this305.tik=new tsUtisl.Signal,_this305}return _inherits(InputContainer,Base),_createClass(InputContainer,[{key:"$postLink",value:function(){var _this306=this,name=$element.closest("form").attr("name");if(this.form=name&&$scope.$parent.$eval(name),!this.form)throw new Error("Can't get form!");this.receive(utils.observe(this.form,"$valid"),this._runApply,this),createPoll(this,function(){return null},function(){_this306.tik.dispatch(_this306._getElements())},250)}},{key:"_getElements",value:function(){return $element.find("input,textarea").toArray()}},{key:"_runApply",value:function(){$scope.$apply()}}]),InputContainer}()).prototype,"_runApply",[_dec10],Object.getOwnPropertyDescriptor(_class46.prototype,"_runApply"),_class46.prototype),_class46)};controller.$inject=["Base","$element","$scope","createPoll","utils","decorators"],angular.module("app.ui").component("wInputContainer",{transclude:!0,template:"<ng-transclude></ng-transclude>",controller:controller})}(),function(){var controller=function(Base,$scope,$element){return new(function(){function InputError(){_classCallCheck(this,InputError);var _this307=_possibleConstructorReturn(this,(InputError.__proto__||Object.getPrototypeOf(InputError)).call(this));return _this307.model=null,_this307.inputContainer=null,_this307.message=null,_this307.name=null,_this307.canShow=!1,_this307.hiddenByTimeout=!1,_this307.timer=null,_this307.hideWithin=0,_this307}return _inherits(InputError,Base),_createClass(InputError,[{key:"$postLink",value:function(){this.receive(this.inputContainer.tik,this._onTick,this),this.observe("canShow",this._onChangeCanShow),this.observe("hiddenByTimeout",this._onChangeCanShowByTimeout),this._onChangeCanShow()}},{key:"_onChangeCanShow",value:function(){var _this308=this;this.hiddenByTimeout=!1,this.timer&&clearTimeout(this.timer),$element.toggleClass("hidden",!this.canShow),this.hideWithin&&this.canShow&&(this.timer=setTimeout(function(){_this308.timer=null,_this308.hiddenByTimeout=!0},1e3*this.hideWithin))}},{key:"_onChangeCanShowByTimeout",value:function(){$element.toggleClass("hidden",this.canShow&&this.hiddenByTimeout)}},{key:"_onTick",value:function(elements){var _this309=this;elements.forEach(function(element){var name=element.getAttribute("name");if(!name)return null;if(_this309.name&&_this309.name!==name)return null;var model=_this309.inputContainer.form[name];if(!model)return null;_this309.model||(_this309.model=model);var isFocused=element===document.activeElement,pending=_this309.inputContainer.form.$pending||model.$pending,isTouchedOrSubmited=_this309.inputContainer.form.$submitted||model.$touched;_this309.canShow=!(pending||isFocused||!isTouchedOrSubmited||!model.$error[_this309.message])})}}]),InputError}())};controller.$inject=["Base","$scope","$element"],angular.module("app.ui").component("wInputError",{transclude:!0,require:{inputContainer:"^wInputContainer"},bindings:{message:"@",name:"@",hideWithin:"<?"},template:'<span class="error active" ng-transclude></span>',controller:controller})}(),angular.module("app.ui").component("wInputHelper",{templateUrl:"modules/ui/directives/inputHelper/inputHelper.html",transclude:!0}),angular.module("app.ui").component("wLoader",{templateUrl:"modules/ui/directives/loader/loader.html"}),function(){var SELECTORS={MAIN_HEADER_USER:"js-main-header-user",MAIN_HEADER_FADER:"js-main-header-fader",TOOLTIP_RENAME:"js-tooltip-rename",HEADER:"js-header"},controller=function(Base,stateManager,modalManager,user,$state,$element,$document,utils,$scope,userNameService){var PATH="modules/ui/directives/mainHeader/templates";return new(function(){function MainHeaderCtrl(){_classCallCheck(this,MainHeaderCtrl);var _this310=_possibleConstructorReturn(this,(MainHeaderCtrl.__proto__||Object.getPrototypeOf(MainHeaderCtrl)).call(this,$scope));return _this310.userList=[],_this310.isUniqueUserName=!0,_this310.showInput=!1,$scope.ERROR_DISPLAY_INTERVAL=3,$scope.user=user,$scope.SELECTORS=SELECTORS,$scope.MAX_USER_NAME_LENGTH=userNameService.MAX_USER_NAME_LENGTH,_this310.userName=userNameService.name,_this310.address=user.address||"3PHBX4uXhCyaANUxccLHNXw3sqyksV7YnDz",_this310.isLogined=!!user.address,_this310.userType=user.userType,_this310.isDesktop=WavesApp.isDesktop(),_this310.isScript=user.hasScript(),_this310.isKeeper="wavesKeeper"===user.userType,_this310.isLedger="ledger"===user.userType,_this310.hasTypeHelp=_this310.isScript&&(_this310.isLedger||_this310.isKeeper),user.getFilteredUserList().then(function(list){_this310.userList=list}),_this310.largeTemplate=PATH+"/largeHeader.html",_this310.mobileTemplate=PATH+"/mobileHeader.html",user.onLogin().then(function(){return _this310._handleLogin()},function(){return _this310._handleLogout()}),_this310.observe("userName",function(){userNameService.setName(_this310.userName),userNameService.isUniqueName().then(function(data){_this310.isUniqueUserName=data})}),_this310.receive(utils.observe(userNameService,"name"),function(){this.userName=userNameService.name},_this310),_this310.observe("isUniqueUserName",function(){_this310.setUserName&&_this310.setUserName.userName.$setValidity("user-name-unique",_this310.isUniqueUserName)}),_this310}return _inherits(MainHeaderCtrl,Base),_createClass(MainHeaderCtrl,[{key:"hideTooltip",value:function(){$element.find("."+SELECTORS.TOOLTIP_RENAME).hide()}},{key:"onFocus",value:function(){this.hideTooltip()}},{key:"onBlur",value:function(){var _this311=this;this.userName?userNameService.save().then(function(){_this311.setNameView(!1),_this311.showTooltip()}):this.onCancel()}},{key:"showTooltip",value:function(){$element.find("."+SELECTORS.TOOLTIP_RENAME).show()}},{key:"onCancel",value:function(){this.showTooltip(),this.setNameView(),this._resetUserName()}},{key:"onSave",value:function(){var _this312=this;userNameService.save().then(function(){_this312.showTooltip(),_this312.setNameView()})}},{key:"logout",value:function(){user.logout("welcome")}},{key:"showAliases",value:function(){this.removeBodyClass(),this.isLogined?modalManager.showAccountInfo():this._getDialogModal("account",function(){return $state.go("welcome")},function(){return $state.go("create")})}},{key:"changeName",value:function(){this.removeBodyClass(),this.isLogined?modalManager.showAccountChangeName():this._getDialogModal("account",function(){return $state.go("welcome")},function(){return $state.go("create")})}},{key:"showAddress",value:function(){this.removeBodyClass(),this.isLogined?modalManager.showAccountAddress():this._getDialogModal("account",function(){return $state.go("welcome")},function(){return $state.go("create")})}},{key:"showSettings",value:function(){this.removeBodyClass(),this.isLogined?modalManager.showSettings():this._getDialogModal("settings",function(){return $state.go("welcome")},function(){return $state.go("create")})}},{key:"removeInnerMenu",value:function(){$document.find("."+SELECTORS.HEADER).removeClass("show-wallet show-aliases show-downloads show-address")}},{key:"removeBodyClass",value:function(){$document.find("body").removeClass("menu-is-shown")}},{key:"toggleBodyClass",value:function(){$document.find("body").toggleClass("menu-is-shown")}},{key:"setNameView",value:function(value){var _this313=this;this.showInput=void 0!==value?value:!this.showInput,utils.postDigest($scope).then(function(){_this313.showInput&&_this313.setUserName.userName.$$element.focus()})}},{key:"toggleDropdown",value:function(){$element.find("."+SELECTORS.MAIN_HEADER_USER).toggleClass("open"),$element.find("."+SELECTORS.MAIN_HEADER_FADER).toggleClass("show-fader")}},{key:"closeDropdown",value:function(){var mainHeaderUser=$element.find("."+SELECTORS.MAIN_HEADER_USER);mainHeaderUser.hasClass("open")&&(mainHeaderUser.removeClass("open"),$element.find("."+SELECTORS.MAIN_HEADER_FADER).removeClass("show-fader"),this.onBlur())}},{key:"onMobileTogglerClick",value:function(){this.removeInnerMenu(),$element.find("."+SELECTORS.HEADER).toggleClass("expanded"),this.toggleBodyClass()}},{key:"onMobileFaderClick",value:function(){$element.find("."+SELECTORS.HEADER).removeClass("expanded"),this.removeBodyClass()}},{key:"_handleLogin",value:function(){var _this314=this;this._resetUserFields(),user.getFilteredUserList().then(function(list){_this314.userList=list}),user.logoutSignal.once(this._handleLogout,this)}},{key:"_handleLogout",value:function(){this._resetUserFields(),user.loginSignal.once(this._handleLogin,this)}},{key:"_resetUserFields",value:function(){this.address=user.address||"3PHBX4uXhCyaANUxccLHNXw3sqyksV7YnDz",this.isLogined=!!user.address,this.userName=user.name,this.userType=user.userType,this.isScript=user.hasScript(),this.isKeeper="wavesKeeper"===user.userType,this.isLedger="ledger"===user.userType,this.hasTypeHelp=this.isScript&&(this.isLedger||this.isKeeper),this.userList=[]}},{key:"_getDialogModal",value:function(type,success,error){return modalManager.showDialogModal({iconClass:type.replace(/\./g,"-")+"-account-info",message:{literal:"modal."+type+".message"},buttons:[{success:!1,classes:"big",text:{literal:"modal."+type+".cancel"},click:error},{success:!0,classes:"big submit",text:{literal:"modal."+type+".ok"},click:success}]})}},{key:"_resetUserName",value:function(){userNameService.setName(user.name)}}]),MainHeaderCtrl}())};controller.$inject=["Base","stateManager","modalManager","user","$state","$element","$document","utils","$scope","userNameService"],angular.module("app.ui").component("wMainHeader",{bindings:{userList:"<"},templateUrl:"modules/ui/directives/mainHeader/templates/mainHeader.html",transclude:!1,controller:controller})}(),angular.module("app.ui").component("wNavigation",{transclude:!0,bindings:{type:"@type"},template:'<div class="navigation {{$ctrl.type}}" ng-transclude></div>'}),function(){var controller=function(Base,$scope,$element,utils,decorators){var _dec11,_class48;return new(_dec11=decorators.async(),_applyDecoratedDescriptor((_class48=function(){function NiceNumber(){_classCallCheck(this,NiceNumber);var _this315=_possibleConstructorReturn(this,(NiceNumber.__proto__||Object.getPrototypeOf(NiceNumber)).call(this,$scope));return _this315.listenEventEmitter(i18next,"languageChanged",function(){return _this315.$onChanges()}),_this315.receive(utils.observe($scope,"number"),_this315.$onChanges,_this315),_this315.receive(utils.observe($scope,"precision"),_this315.$onChanges,_this315),_this315}return _inherits(NiceNumber,Base),_createClass(NiceNumber,[{key:"$onChanges",value:function(){if(null==$scope.number)return $element.html("");$element.html(utils.getNiceNumberTemplate($scope.number,$scope.precision,$scope.shortMode))}}]),NiceNumber}()).prototype,"$onChanges",[_dec11],Object.getOwnPropertyDescriptor(_class48.prototype,"$onChanges"),_class48.prototype),_class48)};controller.$inject=["Base","$scope","$element","utils","decorators"],angular.module("app").directive("wNiceNumber",function(){return{restrict:"A",scope:{number:"<wNiceNumber",precision:"<",shortMode:"<"},controller:controller}})}(),function(){var controller=function(Base,utils,user){return new(function(){function Password(){_classCallCheck(this,Password);var _this316=_possibleConstructorReturn(this,(Password.__proto__||Object.getPrototypeOf(Password)).call(this));return _this316.create=null,_this316.valid=!1,_this316.confirmPassword="",_this316}return _inherits(Password,Base),_createClass(Password,[{key:"$postLink",value:function(){this.receive(utils.observe(this.create,"$valid"),this._onChangeFormValid,this),this.observe("name",this._onChangeName)}},{key:"_onChangeFormValid",value:function(){this.valid=this.create.$valid}},{key:"_onChangeName",value:function(){var _this317=this;user.getFilteredUserList().then(function(usersInStorage){return usersInStorage.some(function(user){return user.name===_this317.name&&user.address!==_this317.address})}).then(function(isUnique){_this317.create.userName.$setValidity("isUnique",!isUnique)})}}]),Password}())};controller.$inject=["Base","utils","user"],angular.module("app.ui").component("wPassword",{bindings:{onSubmit:"&",password:"=",name:"=",address:"<"},templateUrl:"modules/ui/directives/password/password.html",transclude:!0,controller:controller})}(),function(){var controller=function(Base,permissionManager){return new(function(){function Permit(){return _classCallCheck(this,Permit),_possibleConstructorReturn(this,(Permit.__proto__||Object.getPrototypeOf(Permit)).apply(this,arguments))}return _inherits(Permit,Base),_createClass(Permit,[{key:"$postLink",value:function(){this.receive(permissionManager.change,this._onChange,this),this._onChange()}},{key:"_onChange",value:function(){var isPermitted=permissionManager.isPermitted(this.name);this.isVisible=!isPermitted&&"off"===this.mode||isPermitted&&"on"===this.mode}}]),Permit}())};controller.$inject=["Base","permissionManager"],angular.module("app.ui").component("wPermit",{bindings:{name:"@",mode:"@"},template:'<div ng-transclude class="w-permit" ng-if="$ctrl.isVisible"></div>',transclude:!0,controller:controller})}(),angular.module("app.ui").component("wPermitMessage",{require:{parent:"^wPermit"},bindings:{literal:"@"},template:'<div class="w-permit-message" w-i18n="{{::$ctrl.literal}}"></div>'}),function(){var controller=function($element){return new(function(){function QrCode(){_classCallCheck(this,QrCode),this.url=null,this.size=null,this.qrNode=document.createElement("DIV"),$element.append(this.qrNode)}return _createClass(QrCode,[{key:"$onChanges",value:function(){var _this319=this;if(!this.url)return null;QRCode.toDataURL(this.url,function(error,encrypted){_this319.qrNode.classList.add("qr-code-wrap"),_this319.qrNode.style.width=_this319.size+"px",_this319.qrNode.style.height=_this319.size+"px",_this319.qrNode.innerHTML='<img style="display: block" src="'+encrypted+'">'})}}]),QrCode}())};controller.$inject=["$element"],angular.module("app.ui").component("wQrCode",{bindings:{size:"@",url:"<"},controller:controller})}(),function(){var controller=function($element,$scope,Base){return new(function(){function Radio(){_classCallCheck(this,Radio);var _this320=_possibleConstructorReturn(this,(Radio.__proto__||Object.getPrototypeOf(Radio)).call(this));return _this320.radioWrap=null,_this320.input=null,_this320.name=null,_this320.value=null,_this320.class=null,_this320}return _inherits(Radio,Base),_createClass(Radio,[{key:"checked",get:function(){return this.radioWrap.getValue()===this.value}}]),_createClass(Radio,[{key:"$postLink",value:function(){this.class=this.class||"btn btn-radio",this.input=$element.find("input"),this.radioWrap.addRadio(this),this._setHandlers(),this.observe("value",this._onChangeValueAttr),this._onChangeValueAttr()}},{key:"init",value:function(){this._setChecked()}},{key:"_setHandlers",value:function(){var _this321=this;this.input.on("change",function(){_this321.radioWrap.setValue(_this321.value),$scope.$apply()})}},{key:"_onChangeValueAttr",value:function(){this._setChecked()}},{key:"_setChecked",value:function(){this.input.prop("checked",this.checked)}}]),Radio}())};controller.$inject=["$element","$scope","Base"],angular.module("app.ui").component("wRadio",{bindings:{value:"<",class:"@"},transclude:!0,templateUrl:"modules/ui/directives/radio/radio.html",require:{radioWrap:"^wRadioWrap"},controller:controller})}(),function(){var controller=function(Base){return new(function(){function RadioWrap(){_classCallCheck(this,RadioWrap);var _this322=_possibleConstructorReturn(this,(RadioWrap.__proto__||Object.getPrototypeOf(RadioWrap)).call(this));return _this322.children=[],_this322.name="name-"+Math.random()+"-"+Date.now(),_this322.observe("value",function(){_this322.children.forEach(function(item){return item.init()})}),_this322}return _inherits(RadioWrap,Base),_createClass(RadioWrap,[{key:"addRadio",value:function(item){item.name=this.name,this.children.push(item)}},{key:"getValue",value:function(){return this.value}},{key:"setValue",value:function(newValue){this.value=newValue}}]),RadioWrap}())};controller.$inject=["Base"],angular.module("app.ui").component("wRadioWrap",{bindings:{value:"=ngModel"},transclude:!0,template:'<div ng-transclude class="btn-wrap btn-group"></div>',controller:controller})}(),function(){var controller=function(Base,$element,QrCodeReadService,$templateRequest,utils,$compile,$scope,decorators){var _dec12,_dec13,_dec14,_class49;return new(_dec12=decorators.async(),_dec13=decorators.async(),_dec14=decorators.async(),_applyDecoratedDescriptor((_class49=function(){function QrCodeRead(){_classCallCheck(this,QrCodeRead);var _this323=_possibleConstructorReturn(this,(QrCodeRead.__proto__||Object.getPrototypeOf(QrCodeRead)).call(this));_this323.maxWidth=null,_this323.maxHeight=null,_this323.isWatched=!1,_this323.popupNode=null,_this323.onRead=null,_this323.readService=null,_this323.videoSize=null,_this323.templatePromise=$templateRequest("modules/ui/directives/qrCodeRead/cameraPopup.html"),_this323.videoError=!1,_this323.observe("isWatched",_this323._dropLastVideoSize),_this323.observe(["isWatched","videoSize"],_this323._onChangeWatched),_this323.observe("videoSize",_this323._onChangeVideoSize);var positionHandler=utils.debounceRequestAnimationFrame(function(){return _this323._onChangePosition()});return _this323.listenEventEmitter(window,"resize",positionHandler,{on:"addEventListener",off:"removeEventListener"}),_this323.listenEventEmitter(document,"scroll",positionHandler,{on:"addEventListener",off:"removeEventListener",capture:!0}),_this323}return _inherits(QrCodeRead,Base),_createClass(QrCodeRead,[{key:"videoPending",get:function(){return!this.isWatched||!this.videoSize&&!this.videoError}}]),_createClass(QrCodeRead,[{key:"$onDestroy",value:function(){_get2(QrCodeRead.prototype.__proto__||Object.getPrototypeOf(QrCodeRead.prototype),"$onDestroy",this).call(this),this._removeReadQrService(),this._removePopup()}},{key:"toggleWatchQrCode",value:function(){var _this324=this;if(this.isWatched)return this.stopWatchQrCode(),null;this.videoError=!1,this.isWatched=!0,this.webCamError=!1,this._createPopup().then(function(){return _this324._createReadQrService()})}},{key:"stopWatchQrCode",value:function(){this.isWatched=!1,this._removeReadQrService()}},{key:"_onChangePosition",value:function(){this.isWatched&&this._setPopupPosition()}},{key:"_createReadQrService",value:function(){if(!this.readService){var _$element=$(this.popupNode).find(".js-camera-wrapper"),maxSize=void 0;maxSize=WavesApp.device.phone()?{width:window.innerWidth,height:window.innerHeight}:{width:this.maxWidth,height:this.maxHeight},this.readService=new QrCodeReadService({$element:_$element,maxSize:maxSize}),this.receiveOnce(this.readService.onRead,this._onSuccessReadQrCode,this),this.receiveOnce(this.readService.onError,this._onErrorRead,this),this.receiveOnce(this.readService.onHasSize,this._onAddVideoSize,this)}return this}},{key:"_onErrorRead",value:function(){this.videoError=!0,this._setPopupPosition(),$scope.$apply()}},{key:"_onAddVideoSize",value:function(size){this.videoSize=size,$scope.$apply()}},{key:"_onSuccessReadQrCode",value:function(text){this.onRead({text:text}),this.isWatched=!1}},{key:"_removeReadQrService",value:function(){return this.readService&&(this.stopReceive(this.readService.onRead),this.stopReceive(this.readService.onError),this.stopReceive(this.readService.onHasSize),this.readService.destroy(),this.readService=null,this.videoSize=null),this}},{key:"_onChangeVideoSize",value:function(){this._addPopupSize(),this._setPopupPosition()}},{key:"_createPopup",value:function(){var _this325=this;return this.popupNode?Promise.resolve():this.templatePromise.then(function(template){var $node=$compile(template)($scope);_this325.popupNode=$node.get(0),document.body.appendChild(_this325.popupNode),_this325._onChangeWatched(),_this325._setPopupPosition()})}},{key:"_removePopup",value:function(){this.popupNode&&document.body.removeChild(this.popupNode)}},{key:"_onChangeWatched",value:function(){this.popupNode&&(this.popupNode.classList.toggle("active",this.isWatched),this.isWatched&&this._setPopupPosition())}},{key:"_dropLastVideoSize",value:function(){this.isWatched||this.stopWatchQrCode()}},{key:"_setPopupPosition",value:function(){var $btn=$element.find(".btn"),offset=$btn.offset(),videoWrapper=this.popupNode.querySelector(".js-camera-wrapper"),width=videoWrapper.clientWidth,height=videoWrapper.clientHeight,top=offset.top-height/2+$btn.height()/2,left=offset.left-(width+10);$(this.popupNode).find(".js-camera-wrapper").offset({top:top,left:left})}},{key:"_addPopupSize",value:function(){if(!this.videoSize)return null;var videoWrapper=this.popupNode.querySelector(".js-camera-wrapper"),factor=Math.min(this.maxWidth/this.videoSize.width,this.maxHeight/this.videoSize.height),width=Math.round(this.videoSize.width*factor),height=Math.round(this.videoSize.height*factor);videoWrapper.style.width=width+"px",videoWrapper.style.height=height+"px"}}]),QrCodeRead}()).prototype,"_onErrorRead",[_dec12],Object.getOwnPropertyDescriptor(_class49.prototype,"_onErrorRead"),_class49.prototype),_applyDecoratedDescriptor(_class49.prototype,"_onAddVideoSize",[_dec13],Object.getOwnPropertyDescriptor(_class49.prototype,"_onAddVideoSize"),_class49.prototype),_applyDecoratedDescriptor(_class49.prototype,"_onSuccessReadQrCode",[_dec14],Object.getOwnPropertyDescriptor(_class49.prototype,"_onSuccessReadQrCode"),_class49.prototype),_class49)};controller.$inject=["Base","$element","QrCodeReadService","$templateRequest","utils","$compile","$scope","decorators"],angular.module("app.ui").component("wQrCodeRead",{bindings:{maxWidth:"<",maxHeight:"<",onRead:"&"},templateUrl:"modules/ui/directives/qrCodeRead/qrCodeRead.html",controller:controller})}(),function(){var factory=function(mediaStream,Poll){var Signal=require("ts-utils").Signal,wrapper=require("worker-wrapper");return function(){function QrCodeReadService(options){var _this326=this;_classCallCheck(this,QrCodeReadService),this.onRead=new Signal,this.onError=new Signal,this.onHasSize=new Signal,this.size=null,this._canvas=document.createElement("CANVAS"),this._ctx=null,this._stream=null,this._video=document.createElement("VIDEO"),this._worker=null,this._poll=null,this._readQrHash=Object.create(null),this._readCount=4,this._maxSize=null,this._factor=1,options.readCount&&(this._readCount=options.readCount),this._maxSize=options.maxSize,this._initializeDom(options),requestAnimationFrame(function(){_this326._createWorker()._createStream().then(function(){return _this326._loadVideoSize()}).then(function(){return _this326._createPoll()}).catch(function(e){return _this326._dispatchError(e)})})}return _createClass(QrCodeReadService,[{key:"destroy",value:function(){this._removeWorker()._clearSignalHandlers()._stopStream()._removePoll()._removeVideoElement()}},{key:"_initializeDom",value:function(options){return this._createContext()._addVideoAttrs(),options.$element.append(this._video),this}},{key:"_removeVideoElement",value:function(){return this._video.parentNode&&this._video.parentNode.removeChild(this._video),this}},{key:"_createContext",value:function(){return this._ctx=this._canvas.getContext("2d"),this}},{key:"_addVideoAttrs",value:function(){return this._video.setAttribute("autoplay","true"),this._video.setAttribute("preload","auto"),this._video.setAttribute("muted","true"),this._video.setAttribute("playsinline","true"),this}},{key:"_clearSignalHandlers",value:function(){return this.onRead.off(),this.onError.off(),this}},{key:"_removeWorker",value:function(){return this._worker&&(this._worker.terminate(),this._worker=null),this}},{key:"_stopStream",value:function(){return this._stream&&(this._stream.stop(),this._stream=null),this}},{key:"_createWorker",value:function(){return this._worker||(this._worker=wrapper.create(function(){return new QrCode},{libs:["/node_modules/qrcode-reader/dist/index.min.js?"+WavesApp.version]})),this}},{key:"_createPoll",value:function(){var _this327=this;return this._poll||(this._poll=new Poll(function(){return _this327._decodeImage()},function(result){return _this327._checkStop(result)},1e3/24)),this}},{key:"_removePoll",value:function(){return this._poll&&(this._poll.destroy(),this._poll=null),this}},{key:"_createStream",value:function(){var _this328=this;return mediaStream.create().then(function(stream){_this328._stream=stream,_this328._video.srcObject=stream.stream})}},{key:"_loadVideoSize",value:function(){var _this329=this;return new Promise(function(resolve){_this329._video.addEventListener("loadedmetadata",function handler(){_this329.size={width:_this329._video.videoWidth,height:_this329._video.videoHeight};var factor=_this329._maxSize&&Math.min(_this329._maxSize.width/_this329.size.width,_this329._maxSize.height/_this329.size.height)||1;_this329._factor=factor,_this329._video.style.transform="scale("+factor+") translate(-50%, -50%)",_this329._video.style.transformOrigin="0 0",_this329._canvas.width=170/factor,_this329._canvas.height=170/factor,_this329.onHasSize.dispatch(_extends({},_this329.size)),_this329._video.removeEventListener("loadedmetadata",handler,!1),resolve()},!1)})}},{key:"_decodeImage",value:function(){var _this330=this;if(!this.size||!this.size.width||!this.size.height)return null;var frame=this._getFrame();return this._worker.process(function(qr,_ref119){var frame=_ref119.frame;return new Promise(function(resolve){qr.callback=function(error,response){resolve(error?null:response.result)},qr.decode(frame)})},{frame:frame}).catch(function(e){return _this330._dispatchError(e)})}},{key:"_checkStop",value:function(parsedQr){if(!parsedQr)return null;this._readQrHash[parsedQr]?this._readQrHash[parsedQr]++:this._readQrHash[parsedQr]=1,this._readQrHash[parsedQr]>=this._readCount&&(this.onRead.dispatch(parsedQr),this.destroy())}},{key:"_getFrame",value:function(){var _ctx,size=170*(1/this._factor),args=[(this.size.width-size)/2,(this.size.height-size)/2,size,size,0,0,size,size];return(_ctx=this._ctx).drawImage.apply(_ctx,[this._video].concat(args)),this._ctx.getImageData(0,0,size,size)}},{key:"_dispatchError",value:function(error){this.onError.dispatch(error),this.destroy()}}]),QrCodeReadService}()};factory.$inject=["mediaStream","Poll"],angular.module("app.ui").factory("QrCodeReadService",factory)}(),function(){var controller=function($element,$scope,Base,utils,$document){var _require70=require("ramda"),range=_require70.range,last=_require70.last,head=_require70.head;return new(function(){function RangeSlider(){var _ref120,_temp8,_this331;_classCallCheck(this,RangeSlider);for(var _len20=arguments.length,args=Array(_len20),_key20=0;_key20<_len20;_key20++)args[_key20]=arguments[_key20];return(_temp8=_this331=_possibleConstructorReturn(this,(_ref120=RangeSlider.__proto__||Object.getPrototypeOf(RangeSlider)).call.apply(_ref120,[this].concat(args))))._applyValueMode=!1,_this331.__handlePosition=0,_possibleConstructorReturn(_this331,_temp8)}return _inherits(RangeSlider,Base),_createClass(RangeSlider,[{key:"$postLink",value:function(){this._track=$element.find(".range-slider__track"),this._trackColor=$element.find(".range-slider__track_colorize"),this._handle=$element.find(".range-slider__handle"),this._container=$element.find(".range-slider"),this.observe(["min","max","scaleInterval","intervals"],this._onChangeParams),this.observe("ngModel",this._onChangeModel),this._onChangeParams(),this._initEvents()}},{key:"_onChangeModel",value:function(){if(this._applyValueMode)return null;this._drawModelState()}},{key:"_drawModelState",value:function(){var _this332=this,newPos=this._coords[this._numberValues[this.ngModel]],start=this._handleTranslateX;this._handle.prop("progress",0),utils.animate(this._handle,{progress:1},{duration:100,step:function(progress){_this332._handleTranslateX=start+(newPos-start)*progress}}),utils.animate(this._trackColor,{width:newPos},{duration:100})}},{key:"_onChangeParams",value:function(){if(null==this.max)return $element.hide(),null;$element.show();var min=this.min||0,max=this.max,scaleInterval=this.scaleInterval||1;this._amount=(max-min)/scaleInterval,this.gridValues=range(min,max+1).map(function(num){return num*scaleInterval}),this._calcPosition(max,min,scaleInterval)}},{key:"_calcPosition",value:function(max,min,scaleInterval){var _this333=this,intervals=this.intervals||1,sliderLength=this._track.width()-this._handle.outerWidth();this._amountOfPoints=this._amount*intervals;var oneInterval=scaleInterval/intervals;this._numberValues=range(min,this._amountOfPoints+1).map(function(num){return Math.round(num*oneInterval*100)/100}),this._scale=sliderLength/this._amountOfPoints,this._coords=range(0,this._amountOfPoints+1).map(function(num){return _this333._track.position().left+num*_this333._scale})}},{key:"_resizePosition",value:function(){var _this334=this,sliderLength=this._track.width()-this._handle.outerWidth();this._scale=sliderLength/this._amountOfPoints,this._coords=range(0,this._amountOfPoints+1).map(function(num){return _this334._track.position().left+num*_this334._scale}),this._drawModelState()}},{key:"_initEvents",value:function(){var _this335=this,onResize=utils.debounceRequestAnimationFrame(function(){return _this335._resizePosition()});this.listenEventEmitter($element,"mousedown touchstart",function(){_this335._handle.stop(!0,!1),_this335._trackColor.stop(!0,!1);var startPos=_this335._track.offset().left;_this335._container.addClass("range-slider_drag");var onDrag=utils.debounceRequestAnimationFrame(function(event){var utilEvent=utils.getEventInfo(event),position=Math.round(utilEvent.pageX-startPos-_this335._handle.width()/2),newPosition=Math.min(Math.max(head(_this335._coords),position),last(_this335._coords));_this335._updateModel(_this335._numberValues[_this335._findClosestIndex(newPosition)]),_this335._handleTranslateX=newPosition,$scope.$apply()}),onDragEnd=utils.debounceRequestAnimationFrame(function(event){var utilEvent=utils.getEventInfo(event);_this335._container.removeClass("range-slider_drag"),$document.off("mousemove touchmove",onDrag),$document.off("mouseup touchend",onDragEnd),function(pos){_this335._updateModel(_this335._numberValues[_this335._findClosestIndex(pos)]),_this335._drawModelState()}(utilEvent.pageX-startPos-_this335._handle.width()/2),$scope.$apply()});$document.on("mousemove touchmove",onDrag),$document.on("mouseup touchend",onDragEnd)}),this.listenEventEmitter($(window),"resize",onResize)}},{key:"_findClosestIndex",value:function(position){var _this336=this;return position=Math.min(Math.max(position,head(this._coords)),last(this._coords)),this._coords.findIndex(function(section){return Math.abs(position-section)<=_this336._scale/2})}},{key:"_updateModel",value:function(value){this._applyValueMode=!0,this.ngModel=this._numberValues[value],this._applyValueMode=!1}},{key:"_handleTranslateX",get:function(){return this.__handlePosition},set:function(translate){translate!==this.__handlePosition&&(this.__handlePosition=translate,this._handle.css("transform","translateX("+translate+"px)"),this._trackColor.css("width",translate))}}]),RangeSlider}())};controller.$inject=["$element","$scope","Base","utils","$document"],angular.module("app.ui").component("wRangeSlider",{bindings:{min:"<",max:"<",scaleInterval:"<",intervals:"<",ngModel:"="},templateUrl:"modules/ui/directives/rangeSlider/rangeSlider.html",controller:controller})}(),function(){var controller=function(Base,user,$scope,RatingStarsFactory,$element,waves,modalManager,balanceWatcher,$mdDialog,utils){var SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,WCT_ID=WavesApp.WCTAsset,WAVES_ID=WavesApp.defaultAssets.WAVES;return new(function(){function RatingStars(){var _ref121,_temp9,_this337;_classCallCheck(this,RatingStars);for(var _len21=arguments.length,args=Array(_len21),_key21=0;_key21<_len21;_key21++)args[_key21]=arguments[_key21];return(_temp9=_this337=_possibleConstructorReturn(this,(_ref121=RatingStars.__proto__||Object.getPrototypeOf(RatingStars)).call.apply(_ref121,[this].concat(args)))).hasBalance=!1,_this337.canRate=!1,_possibleConstructorReturn(_this337,_temp9)}return _inherits(RatingStars,Base),_createClass(RatingStars,[{key:"$postLink",value:function(){var _this338=this,ratingStars=new RatingStarsFactory({$container:$element.find(".rating-stars-wrapper"),rating:this.rating,size:this.size,canRate:this.canRate,hasBalance:this.hasBalance});this.observe("rating",function(){ratingStars.update(_this338.rating)}),this.canRate&&(this.observe("hasBalance",function(){ratingStars.updateStatus(_this338.hasBalance),$scope.$apply()}),waves.node.getFee({type:SIGN_TYPE.DATA}).then(function(money){_this338.fee=money,_this338._checkBalance(),_this338.receive(ratingStars.vote,_this338._onVote,_this338)}))}},{key:"_checkBalance",value:function(){var balance=balanceWatcher.getBalance();this.wavesBalance=balance[WAVES_ID],this.wctBalance=balance[WCT_ID],this.wavesBalance.gte(this.fee)&&this.wctBalance&&this.wctBalance.getTokens().gte(1)&&(this.hasBalance=!0,$scope.$apply())}},{key:"_onVote",value:function(rating){var _this339=this;waves.node.getFee({type:SIGN_TYPE.DATA}).then(function(money){_this339.fee=money;var tx=waves.node.transactions.createTransaction({type:SIGN_TYPE.DATA,data:{data:[{key:"tokenRating",type:"string",value:"tokenRating"},{key:"assetId",type:"string",value:_this339.assetId},{key:"score",type:"integer",value:rating}],fee:_this339.fee,type:SIGN_TYPE.DATA}});_this339.signable=ds.signature.getSignatureApi().makeSignable(tx),RatingStars._generateTx(_this339.signable)})}},{key:"openDex",value:function(){utils.openDex(WCT_ID)}}],[{key:"_generateTx",value:function(signable){return $mdDialog.hide(),modalManager.showConfirmTx(signable)}}]),RatingStars}())};controller.$inject=["Base","user","$scope","RatingStarsFactory","$element","waves","modalManager","balanceWatcher","$mdDialog","utils"],angular.module("app.ui").component("wRatingStars",{bindings:{rating:"<",size:"<",canRate:"<",assetId:"<"},templateUrl:"modules/ui/directives/ratingStars/ratingStars.html",controller:controller})}(),angular.module("app.ui").factory("RatingStarsFactory",function(){var range=require("ramda").range,tsUtils=require("ts-utils");return function(){function RatingStarsFactory(_ref122){var $container=_ref122.$container,rating=_ref122.rating,_ref122$size=_ref122.size,size=void 0===_ref122$size?"m":_ref122$size,_ref122$canRate=_ref122.canRate,canRate=void 0!==_ref122$canRate&&_ref122$canRate,hasBalance=_ref122.hasBalance;_classCallCheck(this,RatingStarsFactory),this.starsStringList=[],this.rating=rating,this.canRate=canRate,this.$container=$container,this.hasBalance=hasBalance,this.size=size,this.update(this.rating),this.canRate&&this._initHandlers(this.hasBalance),this.voteSignal=new tsUtils.Signal}return _createClass(RatingStarsFactory,[{key:"update",value:function(rating){var _this340=this,filledAmount=Math.round(rating);this.starsStringList=range(0,5).map(function(index){return{$star:_this340.getStar(index,filledAmount)}}),this._render(this.$container)}},{key:"updateStatus",value:function(status){this.hasBalance=status,this._initHandlers(this.hasBalance)}},{key:"_initHandlers",value:function(hasBalance){var _this341=this;this.starsList.forEach(function(starObj){hasBalance?starObj.$star.on("click",function(){_this341.voteSignal.dispatch(starObj.weight)}):starObj.$star.off()})}},{key:"_render",value:function($container){this.template='\n                <div class="rating-stars '+this.size+" "+(this.canRate?"can-rate":"")+'">\n                    '+this.starsStringList.map(function(obj){return obj.$star}).join("")+"\n                </div>",$container.html(this.template),this.starsList=this.$container.find(".rating-stars__star").toArray().map(function(star,i){return{$star:$(star),weight:i+1}}),this._initHandlers(this.hasBalance)}},{key:"getStar",value:function(index,filledAmount){return'<div class="rating-stars__star '+(index+1<=filledAmount?"filled":"")+'"></div>'}},{key:"vote",get:function(){return this.voteSignal}}]),RatingStarsFactory}()}),function(){var controller=function($element,$timeout,carouselManager,utils,Base,$scope,$document){var edges=[{date:"roadmap.feb2017.date",title:"roadmap.feb2017.title",text:"roadmap.feb2017.text",timeWhenMade:"past"},{date:"roadmap.feb2018.date",title:"roadmap.feb2018.title",text:"roadmap.feb2018.text",timeWhenMade:"past"},{date:"roadmap.may2018.date",title:"roadmap.may2018.title",text:"roadmap.may2018.text",timeWhenMade:"past"},{date:"roadmap.jul2018.date",title:"roadmap.jul2018.title",text:"roadmap.jul2018.text",timeWhenMade:"past"},{date:"roadmap.jul2018.date",title:"roadmap.jul2018.title_2",text:"roadmap.jul2018.text_2",timeWhenMade:"past"},{date:"roadmap.sep2018.date",title:"roadmap.sep2018.title",text:"roadmap.sep2018.text",timeWhenMade:"past"},{date:"roadmap.nov2018.date",title:"roadmap.nov2018.title",text:"roadmap.nov2018.text",timeWhenMade:"past"},{date:"roadmap.dec2018.date",title:"roadmap.dec2018.title",text:"roadmap.dec2018.text",timeWhenMade:"past"},{date:"roadmap.dec2018.date",title:"roadmap.dec2018.title_2",text:"roadmap.dec2018.text_2",timeWhenMade:"past"},{date:"roadmap.jan2019.date",title:"roadmap.jan2019.title",text:"roadmap.jan2019.text",timeWhenMade:"past"},{date:"roadmap.jan2019.date",title:"roadmap.jan2019.title_2",text:"roadmap.jan2019.text_2",timeWhenMade:"past"},{date:"roadmap.jun2019.date",title:"roadmap.jun2019.title",text:"roadmap.jun2019.text",timeWhenMade:"now"},{date:"roadmap.jul2019.date",title:"roadmap.jul2019.title",text:"roadmap.jul2019.text",timeWhenMade:"now"},{date:"roadmap.jul2019.date",title:"roadmap.jul2019.title_2",text:"roadmap.jul2019.text_2",timeWhenMade:"future"},{date:"roadmap.jul2019.date",title:"roadmap.jul2019.title_3",text:"roadmap.jul2019.text_3",timeWhenMade:"future"},{date:"roadmap.aug2019.date",title:"roadmap.aug2019.title",text:"roadmap.aug2019.text",timeWhenMade:"future"},{date:"roadmap.sep2019.date",title:"roadmap.sep2019.title",text:"roadmap.sep2019.text",timeWhenMade:"future"}];return new(function(){function RoadMap(){return _classCallCheck(this,RoadMap),_possibleConstructorReturn(this,(RoadMap.__proto__||Object.getPrototypeOf(RoadMap)).apply(this,arguments))}return _inherits(RoadMap,Base),_createClass(RoadMap,[{key:"$postLink",value:function(){var _this343=this;this.edges=edges,this._wrapper=$element.find(".roadmap-content"),utils.postDigest($scope).then(function(){_this343._content=_this343._wrapper.children(),_this343._remapSlides(),_this343._initEvents()})}},{key:"_drawModelState",value:function(){var _this344=this,startAnim=this._wrapperTranslate,centerSlide=this._content.toArray().find(function(slide){return Math.abs($(slide).offset().left-_this344._centerSlideX)<=_this344._diff/2}),newPos=this._wrapperTranslate+(this._centerSlideX-$(centerSlide).offset().left);utils.animate(this._wrapper,{progress:1},{duration:200,progress:function(animation,_progress4){_this344._wrapperTranslate=startAnim+(newPos-startAnim)*_progress4}})}},{key:"_initEvents",value:function(){var _this345=this,onResize=utils.debounceRequestAnimationFrame(function(){return _this345._remapSlides()});this.listenEventEmitter($element,"mousedown touchstart",function(eventStart){_this345._wrapper.stop(!0,!1);var offset=utils.getEventInfo(eventStart).pageX-_this345._wrapperTranslate;_this345._wrapper.addClass("roadmap_drag");var onDrag=utils.debounceRequestAnimationFrame(function(event){var utilEvent=utils.getEventInfo(event),position=Math.round(utilEvent.pageX-offset);_this345._wrapperTranslate=Math.max(Math.min(_this345._leftEdge,position),_this345._rightEdge),$scope.$apply()}),onDragEnd=utils.debounceRequestAnimationFrame(function(){$document.off("mousemove touchmove",onDrag),$document.off("mouseup touchend",onDragEnd),_this345._drawModelState(),$scope.$apply()});$document.on("mousemove touchmove",onDrag),$document.on("mouseup touchend",onDragEnd)}),this.listenEventEmitter($(window),"resize",onResize)}},{key:"_remapSlides",value:function(){var _this346=this,slide=function(index){return _this346._content.eq(index)},offsetLeft=function(slide){return slide.offset().left};this._diff=offsetLeft(slide(1))-offsetLeft(slide(0)),this._centerSlideX=$document.width()/2-slide(0).outerWidth()/2;var nowLeft=offsetLeft($element.find(".now")),offset=Math.round(nowLeft-this._centerSlideX);this._wrapper.css("transform","translateX("+-offset+"px)"),this._leftEdge=offsetLeft($element.find(".now"))-offsetLeft($element.find(".roadmap"))+32,this._rightEdge=-(this._content.length-1)*this._diff+this._leftEdge-64,this._wrapperTranslate=-offset}},{key:"_wrapperTranslate",get:function(){return this._wrapper.data("translate")},set:function(translate){this._wrapper.data("translate",translate),this._wrapper.css("transform","translateX("+translate+"px)")}}]),RoadMap}())};controller.$inject=["$element","$timeout","carouselManager","utils","Base","$scope","$document"],angular.module("app.ui").component("wRoadMap",{bindings:{id:"@",interval:"@",startFrom:"@"},controller:controller,templateUrl:"modules/ui/directives/roadMap/roadMap.html"})}(),function(){var controller=function(Base,$element){return new(function(){function ResponsiveMenu(){_classCallCheck(this,ResponsiveMenu);var _this347=_possibleConstructorReturn(this,(ResponsiveMenu.__proto__||Object.getPrototypeOf(ResponsiveMenu)).call(this));return _this347.menuList=[],_this347}return _inherits(ResponsiveMenu,Base),_createClass(ResponsiveMenu,[{key:"registerItem",value:function(item){this.menuList.push(item)}},{key:"menuToggle",value:function(){$element.find(".navigation-menu").toggleClass("active"),$element.find(".navigation-menu-overlay").toggleClass("active")}},{key:"clickItem",value:function(){$element.find(".navigation-menu").removeClass("active")}},{key:"setActive",value:function(item){this.activeMenu=item.value,this.clickItem()}}]),ResponsiveMenu}())};controller.$inject=["Base","$element"],angular.module("app.ui").component("wResponsiveMenu",{templateUrl:"modules/ui/directives/responsiveMenu/responsiveMenu.html",bindings:{activeMenu:"="},transclude:!0,controller:controller})}(),function(){var controller=function(Base,$element,$attrs,$scope,utils,$state,state){return new(function(){function ResponsiveMenuItem(){_classCallCheck(this,ResponsiveMenuItem);var _this348=_possibleConstructorReturn(this,(ResponsiveMenuItem.__proto__||Object.getPrototypeOf(ResponsiveMenuItem)).call(this));return _this348.parent=null,_this348.value=null,$element.on("click",function(e){e.stopPropagation(),null!=_this348.value&&(_this348.parent.setActive(_this348),$scope.$apply())}),_this348}return _inherits(ResponsiveMenuItem,Base),_createClass(ResponsiveMenuItem,[{key:"$postLink",value:function(){var _this349=this;this.parent.registerItem(this),null!=this.value&&$attrs.activeByState?(this.receive(state.signals.changeRouterStateSuccess,this._onChangeState,this),this._onChangeState()):null!=this.value&&(this.receive(utils.observe(this.parent,"activeMenu"),function(){$element.toggleClass("active",_this349.parent.activeMenu===_this349.value)}),$element.toggleClass("active",this.parent.activeMenu===this.value))}},{key:"_onChangeState",value:function(){var id=$state.$current.name.slice($state.$current.name.lastIndexOf(".")+1).replace("-demo",""),path=WavesApp.stateTree.getPath(id);if(path){var active=this.value===path[path.length-1];$element.toggleClass("active",active),$element.toggleClass("has-active",-1!==path.indexOf(this.value)&&!active)}}}]),ResponsiveMenuItem}())};controller.$inject=["Base","$element","$attrs","$scope","utils","$state","state"],angular.module("app.ui").component("wResponsiveMenuItem",{template:'<div class="responsive-menu-item-content" ng-transclude></div>',require:{parent:"^wResponsiveMenu"},bindings:{value:"@"},transclude:!0,controller:controller})}(),function(){var SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,uniqueId=require("ts-utils").uniqueId,fetch=require("data-service").fetch,controller=function(Base,waves,$scope,user,balanceWatcher){return new(function(){function ScriptTxForm(){_classCallCheck(this,ScriptTxForm);var _this350=_possibleConstructorReturn(this,(ScriptTxForm.__proto__||Object.getPrototypeOf(ScriptTxForm)).call(this));return _this350.state=Object.create(null),_this350.script="",_this350.isValid=!0,_this350.onSuccess=null,_this350.hasScript=user.hasScript(),_this350.requiredError=!1,_this350.validationError=!1,_this350.placeHolderLiteral=user.hasScript()?"change":"create",_this350.validationPending=!1,_this350.hasFee=!1,_this350._validateXHR=null,_this350._activeXHR_Id=null,_this350.observe("state",_this350._onChangeState),_this350.observe("script",_this350._onChangeScript),_this350.receive(balanceWatcher.change,function(){_this350._currentHasFee(),$scope.$apply()}),user.hasScript()||(_this350.observe("script",_this350._updateRequiredErrorState),_this350._updateRequiredErrorState()),_this350.observe(["requiredError","validationError"],_this350._updateValidationState),_this350._updateValidationState(),_this350._currentHasFee(),_this350}return _inherits(ScriptTxForm,Base),_createClass(ScriptTxForm,[{key:"$postLink",value:function(){this._initScript()}},{key:"getSignable",value:function(){var tx=waves.node.transactions.createTransaction(_extends({},this.state.tx,{type:SIGN_TYPE.SET_SCRIPT}));return ds.signature.getSignatureApi().makeSignable({type:tx.type,data:tx})}},{key:"next",value:function(signable){this.onSuccess({signable:signable})}},{key:"_currentHasFee",value:function(){if(!this.state||!this.state.tx||!this.state.tx.fee)return null;var balanceHash=balanceWatcher.getBalance(),fee=this.state.tx.fee;this.hasFee=balanceHash[fee.asset.id]&&balanceHash[fee.asset.id].gte(fee)}},{key:"_updateRequiredErrorState",value:function(){this.requiredError=!this.script.replace("base64:","")}},{key:"_updateValidationState",value:function(){this.isValid=!this.validationError&&!this.requiredError}},{key:"_initScript",value:function(){var script=(this.state&&this.state.tx&&this.state.tx.script||"base64:").replace("base64:","");this.script!==script?this.script=script:this._onChangeScript(),this.state.tx.script=script}},{key:"_onChangeState",value:function(){var _this351=this,state=this.state;state.tx||(state.tx=Object.create(null)),state.tx.fee||waves.node.getFee({type:SIGN_TYPE.SET_SCRIPT}).then(function(fee){state.tx.fee=fee,_this351._currentHasFee(),$scope.$apply()})}},{key:"_onChangeScript",value:function(){var script=this.script.replace("base64:","");this._clearActiveValidationXHR(),this._createActiveValidationXHR(script)}},{key:"_clearActiveValidationXHR",value:function(){this._activeXHR_Id=null,this._validateXHR=null,this.validationPending=!1}},{key:"_createActiveValidationXHR",value:function(code){var _this352=this;if(""===code)return this.validationError=!1,this.state.tx.script="",null;this.validationPending=!0;var id=uniqueId("script-form-validate");this._activeXHR_Id=id,this._validateXHR=fetch(user.getSetting("network.node")+"/utils/script/estimate",{method:"POST",body:code}).then(function(){if(_this352._activeXHR_Id!==id)return null;_this352._clearActiveValidationXHR(),_this352.validationError=!1,_this352.state.tx.script="base64:"+code}).catch(function(){if(_this352._activeXHR_Id!==id)return null;_this352._clearActiveValidationXHR(),_this352.validationError=!0,_this352.state.tx.script="base64:"}).then(function(){$scope.$apply()})}}]),ScriptTxForm}())};controller.$inject=["Base","waves","$scope","user","balanceWatcher"],angular.module("app.ui").component("wScriptTxForm",{controller:controller,scope:!1,bindings:{state:"<",onSuccess:"&"},templateUrl:"modules/ui/directives/scriptTxForm/script-form.html"})}(),function(){var directive=function(Base,utils){return{scope:{value:"<",searchValue:"="},require:{select:"^wSelect"},transclude:!0,template:'<div class="option" ng-transclude></div>',link:function($scope,$element,$attrs,_ref123,$transclude){var select=_ref123.select,tsUtils=require("ts-utils");return new(function(){function Option(){_classCallCheck(this,Option);var _this353=_possibleConstructorReturn(this,(Option.__proto__||Object.getPrototypeOf(Option)).call(this,$scope));return _this353.wSelect=select,_this353.changeValue=new tsUtils.Signal,_this353.index=1,_this353._setHandlers(),_this353.wSelect.registerOption(_this353),_this353}return _inherits(Option,Base),_createClass(Option,[{key:"value",get:function(){return $scope.value}}]),_createClass(Option,[{key:"getContent",value:function(){var $element=$(Option._getContentHTML());return $transclude($scope.$parent,function($clone){$element.append($clone)}),$element}},{key:"onClick",value:function(){this.wSelect.setActive(this),$scope.$apply()}},{key:"setActive",value:function(active){var index=this.wSelect.getOptionIndex(this);$element.css("order",active?-index:0).toggleClass("active",active)}},{key:"filterAndSort",value:function(query){var searchValue=utils.toArray($scope.searchValue.filter(Boolean)),queryValue=query.toLocaleLowerCase();this.index=searchValue.findIndex(function(str){return str.toLocaleLowerCase().includes(queryValue)}),$element.css("order",this.index),-1<this.index?$element.show():$element.hide()}},{key:"show",value:function(){$element.show()}},{key:"_setHandlers",value:function(){var _this354=this;this.observe("value",function(){var value=_this354.value;if(tsUtils.isEmpty(value))throw new Error("Value is empty!");_this354.changeValue.dispatch(_this354)}),$element.on("click",this.onClick.bind(this))}}],[{key:"_getContentHTML",value:function(){return'<div class="title-content"></div>'}}]),Option}())}}};directive.$inject=["Base","utils"],angular.module("app.ui").directive("wOption",directive)}(),function(){var controller=function(Base,ComponentList,$element,utils,$scope){var tsUtils=require("ts-utils"),$_DOCUMENT=$(document);return new(function(){function Select(){_classCallCheck(this,Select);var _this355=_possibleConstructorReturn(this,(Select.__proto__||Object.getPrototypeOf(Select)).call(this));return _this355._options=new ComponentList,_this355._activeNode=null,_this355._selectList=null,_this355._select=null,_this355.isOpend=!1,_this355.disabled=!1,_this355.oneItem=!1,_this355.hideActive=!0,_this355.filter="",_this355.canSearch=!1,_this355._render=utils.debounce(function(){_this355._initializeSelected(),$scope.$apply()},100),_this355.observe("disabled",function(){$element.toggleClass("disabled",!!_this355.disabled)}),_this355.observe("oneItem",function(){$element.toggleClass("disabled one-item",!!_this355.oneItem)}),_this355.observeOnce("hideActive",function(){_this355.hideActive||void 0===_this355.hideActive?$element.addClass("hide-active"):$element.removeClass("hide-active")}),_this355.observe("filter",function(){var filter=_this355.filter;_this355._options.forEach(function(option){filter?option.filterAndSort(filter):option.show()})}),_this355}return _inherits(Select,Base),_createClass(Select,[{key:"$postLink",value:function(){this._select=$element.find(".select:first"),this._activeNode=this._select.find(".title:first"),this._selectList=this._select.find(".select-list:first"),this._render(),this._setHandlers()}},{key:"registerOption",value:function(option){this._options.add(option),this._render()}},{key:"getOptionIndex",value:function(option){return this._options.components.indexOf(option)}},{key:"setActive",value:function(option){this._activateTransactionMode=!0,this._options.forEach(function(item){item!==option&&item.setActive(!1)}),this._activeNode.empty(),this.ngModel=option.value,this._activeNode.append(option.getContent()),option.setActive(!0),this._toggleList(!1),this._activateTransactionMode=!1}},{key:"_setHandlers",value:function(){var _this356=this;this.listenEventEmitter(this._activeNode,"click",function(){return _this356._onClick()}),this.observe("disabled",this._onChangeDisabled),this.receive(this._options.signals.remove,this._render,this),this.receive(this._options.signals.add,this._render,this),this.observe("ngModel",this._render)}},{key:"_initializeSelected",value:function(){if(!this._options.length)return null;if(tsUtils.isEmpty(this.ngModel))return this.setActive(this._options.first()),null;var active=_slicedToArray(this._options.where({value:this.ngModel}).components,1)[0];active?this.setActive(active):(this.setActive(this._options.first()),$scope.$apply())}},{key:"_onClick",value:function(){this.disabled||this._toggleList()}},{key:"_checkOutClick",value:function(event){0===$(event.target).closest($element).length&&this._toggleList(!1)}},{key:"_onChangeDisabled",value:function(){this._select.toggleClass("disabled",this.disabled),this._toggleList(!1)}},{key:"_toggleList",value:function(state){var _this357=this,targetState=tsUtils.isEmpty(state)?!this.isOpend:state;targetState!==this.isOpend&&(this.isOpend=targetState,this._select.toggleClass("expanded",this.isOpend),this._animate(),this.isOpend?this.listenEventEmitter($_DOCUMENT,"click",function(e){return _this357._checkOutClick(e)}):(this.filter="",this.stopListenEventEmitter("click",$_DOCUMENT),$scope.$apply()))}},{key:"_animate",value:function(){var _this358=this,fromCss={height:0,top:this.upDirection?0:void 0};if(this.isOpend){this._selectList.css({display:"flex",height:"auto"});var height=this._selectList.outerHeight(),toCss={height:height,top:this.upDirection?-height:void 0};return this._selectList.css(fromCss),utils.animate(this._selectList,toCss,{duration:100})}return utils.animate(this._selectList,fromCss,{duration:100}).then(function(){_this358._selectList.css("display","none")})}}]),Select}())};controller.$inject=["Base","ComponentList","$element","utils","$scope"],angular.module("app.ui").component("wSelect",{bindings:{ngModel:"=",disabled:"<",upDirection:"<",canSearch:"<",oneItem:"<",hideActive:"<"},templateUrl:"modules/ui/directives/select/select.html",transclude:!0,controller:controller})}(),angular.module("app.ui").component("wSelectFilter",{templateUrl:"modules/ui/directives/selectFilter/selectFilter.html",bindings:{search:"="},transclude:!0}),function(){var SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,signature=require("data-service").signature,$=require("jquery"),controller=function(Base,waves,$scope,user,balanceWatcher){var analytics=require("@waves/event-sender");return new(function(){function SetAssetScriptFrom(){_classCallCheck(this,SetAssetScriptFrom);var _this359=_possibleConstructorReturn(this,(SetAssetScriptFrom.__proto__||Object.getPrototypeOf(SetAssetScriptFrom)).call(this));return _this359.script="",_this359.isValidScript=!0,_this359.isPendingScrip=!1,_this359.hasFee=!0,_this359._activeXHR=null,_this359.observe("state",_this359._onChangeState),_this359.observe("script",_this359._onChangeScript),_this359.observe("fee",_this359._currentHasFee),_this359.receive(balanceWatcher.change,_this359._currentHasFee,_this359),_this359._currentHasFee(),_this359}return _inherits(SetAssetScriptFrom,Base),_createClass(SetAssetScriptFrom,[{key:"isAllOk",get:function(){return this.isValidScript&&!this.isPendingScrip}}]),_createClass(SetAssetScriptFrom,[{key:"onClickSign",value:function(){analytics.send({name:"Update Script Continue Click",target:"ui"});var tx=this._getTx();return signature.getSignatureApi().makeSignable({type:tx.type,data:tx})}},{key:"_onChangeScript",value:function(){var _this360=this,script=this.script.replace("base64:","");if(this._activeXHR&&(this._activeXHR.abort(),this._activeXHR=null),!script)return this.isValidScript=!0,this.isPendingScrip=!1,null;this._activeXHR=$.ajax({url:user.getSetting("network.node")+"/utils/script/estimate",method:"POST",data:script}),this._activeXHR.then(function(){_this360.isValidScript=!0}).catch(function(){_this360.isValidScript=!1}).always(function(){_this360.isPendingScrip=!1,$scope.$apply()})}},{key:"_onChangeState",value:function(){var _this361=this;if(!this.state||!this.state.assetId)throw new Error("Has no assetId!");this.script=this.state.script||"",waves.node.assets.getAsset(this.state.assetId).then(function(asset){if(!asset.hasScript)throw new Error("This asset has no script!");_this361.asset=asset,$scope.$apply()}),waves.node.getFee(this._getTx()).then(function(fee){_this361.fee=fee,$scope.$apply()})}},{key:"_getTx",value:function(){var script=this.script.replace("base64:","");return{type:SIGN_TYPE.SET_ASSET_SCRIPT,assetId:this.state.assetId,script:this.isAllOk&&this.script?"base64:"+script:"base64:AQa3b8tH",fee:this.fee||null}}},{key:"_currentHasFee",value:function(){var waves=balanceWatcher.getBalance().WAVES;if(!this.fee)return null;this.hasFee=!!waves&&waves.gte(this.fee)}}]),SetAssetScriptFrom}())};controller.$inject=["Base","waves","$scope","user","balanceWatcher"],angular.module("app.ui").component("wSetAssetScriptFrom",{bindings:{state:"<",onSuccess:"&"},templateUrl:"modules/ui/directives/setAssetScriptForm/setAssetScriptFrom.html",transclude:!1,controller:controller})}(),_temp10=_class60=function(){function ShowHidePassword($element){_classCallCheck(this,ShowHidePassword),this.isActive=!1,this.$element=$element}return _createClass(ShowHidePassword,[{key:"$postLink",value:function(){this.$element.addClass("show-hide-password"),this.inputEl=this.$element.find("input")}},{key:"toggle",value:function(){this.isActive=!this.isActive,this.inputEl.attr("type",this.isActive?"text":"password")}}]),ShowHidePassword}(),_class60.$inject=["$element"],ShowHidePassword=_temp10,angular.module("app.ui").component("wShowHidePassword",{templateUrl:"modules/ui/directives/showHidePassword/showHidePassword.html",controller:ShowHidePassword,transclude:!0}),function(){var controller=function(Base,user,$scope){return new(function(){function Sign(){_classCallCheck(this,Sign);var _this362=_possibleConstructorReturn(this,(Sign.__proto__||Object.getPrototypeOf(Sign)).call(this));return _this362.userType=user.userType,_this362.isLedger="ledger"===user.userType,_this362.isKeeper="wavesKeeper"===user.userType,_this362.signPending=!1,_this362.signable=null,_this362.signError=!1,_this362.id="",_this362.hideId=!1,_this362.observe("signable",_this362._onChangeSignable),_this362}return _inherits(Sign,Base),_createClass(Sign,[{key:"isShown",get:function(){return user.userType&&"seed"!==user.userType&&this.signable}}]),_createClass(Sign,[{key:"trySign",value:function(){var _this363=this;return this.signError=!1,this.signPending=!0,this.signable.addMyProof().then(function(signature){_this363.signPending=!1,_this363.onSuccess({signature:signature})}).catch(function(){_this363.signPending=!1,_this363.signError=!0}).then(function(){$scope.$apply()})}},{key:"cancel",value:function(){this.signError=!1,this.signPending=!1,this.onCancel()}},{key:"_onChangeSignable",value:function(){var _this364=this,signable=this.signable;signable?(signable.getId().then(function(id){_this364.id=id,$scope.$apply()}),this.trySign()):(this.signPending=!1,this.id="")}}]),Sign}())};controller.$inject=["Base","user","$scope"],angular.module("app.ui").component("wSign",{scope:!1,bindings:{signable:"<",hideId:"<",onSuccess:"&",onCancel:"&"},templateUrl:"modules/ui/directives/sign/sign.html",controller:controller})}(),function(){var controller=function(Base,$scope,$element){return new(function(){function SignButton(){_classCallCheck(this,SignButton);var _this365=_possibleConstructorReturn(this,(SignButton.__proto__||Object.getPrototypeOf(SignButton)).call(this));return _this365.disabled=!1,_this365.signable=null,_this365.onSuccess=null,_this365.onCancel=null,_this365.onClick=null,_this365.signPending=!1,_this365.ns=null,_this365.observe("ns",_this365._updateNs),_this365._updateNs(),_this365}return _inherits(SignButton,Base),_createClass(SignButton,[{key:"onSignSuccess",value:function(){this.signPending=!1;var signable=this.signable;this.signable=null,this.onSuccess({signable:signable})}},{key:"onSignCancel",value:function(){this.signPending=!1,this.signable=null,this.onCancel()}},{key:"onClickButton",value:function(){var _this366=this,some=this.onClick();if(!some)throw new Error("Has no signable!");SignButton.isPromiseLike(some)?some.then(function(signable){_this366.signable=signable,$scope.$apply()}):this.signable=some,this.signPending=!0}},{key:"_getNs",value:function(){return this.ns||"app.ui"}},{key:"_updateNs",value:function(){$element.attr("w-i18n-ns",this._getNs())}}],[{key:"isPromiseLike",value:function(some){return some&&some.then&&"function"==typeof some.then}}]),SignButton}())};controller.$inject=["Base","$scope","$element"],angular.module("app.ui").component("wSignButton",{controller:controller,scope:!1,bindings:{ns:"<",disabled:"<",hideId:"<",onClick:"&",onSuccess:"&",onCancel:"&"},transclude:!0,templateUrl:"modules/ui/directives/signButton/sign-button.html"})}(),function(){var PATH="modules/ui/directives/smartTable/templates",controller=function(Base,$scope,$element,decorators,$templateRequest,$compile,utils,stService,i18n){var _dec15,_dec16,_dec17,_class63,tsUtils=require("ts-utils");return new(_dec15=decorators.async(),_dec16=decorators.async(),_dec17=decorators.async(),_applyDecoratedDescriptor((_class63=function(){function SmartTable(){_classCallCheck(this,SmartTable);var _this367=_possibleConstructorReturn(this,(SmartTable.__proto__||Object.getPrototypeOf(SmartTable)).call(this));return _this367.data=null,_this367.headerInfo=null,_this367._filterList=[],_this367.options=null,_this367._headerData=null,_this367._header=null,_this367._visibleList=[],_this367._filtredList=[],_this367._headerCellPromise=$templateRequest(PATH+"/headerCell.html"),_this367.observe("headerInfo",_this367._onChangeHeader),_this367.observe("options",_this367._onChangeOptions),_this367.observeOnce("_headerData",function(){_this367.observe(["_headerData","data","filterList","options"],_this367.render),_this367.render()}),stService.register(_this367),_this367}return _inherits(SmartTable,Base),_createClass(SmartTable,[{key:"$postLink",value:function(){this._header=$element.find(".smart-table__thead")}},{key:"$onDestroy",value:function(){stService.unregister(this),_get2(SmartTable.prototype.__proto__||Object.getPrototypeOf(SmartTable.prototype),"$onDestroy",this).call(this)}},{key:"getIdByIndex",value:function(index){return this.headerInfo[index].id}},{key:"_onChangeOptions",value:function(_ref124){var _this368=this,value=_ref124.value,prev=_ref124.prev;this._dropOldOptions(prev),utils.toArray(value&&value.filter||[]).forEach(function(item){_this368._filterList.push(item)})}},{key:"_dropOldOptions",value:function(oldOptions){var _this369=this;if(!oldOptions)return null;utils.toArray(oldOptions.filter).forEach(function(filter){_this369._filterList=_this369._filterList.filter(function(f){return f!==filter})})}},{key:"_applySort",value:function(){this._sort(),this._draw()}},{key:"render",value:function(){this._visibleList=[],this._filtredList=[],this.data&&this.data.length&&(this._filter(),this._sort()),this._draw()}},{key:"_onChangeHeader",value:function(){var _this370=this,headers=this.headerInfo,defaultNs=i18n.getNs($element);if(!headers||!headers.length)return null;var $tr=this._header.find(".smart-table__row");$tr.empty(),this._clearHeader(),Promise.all(this.headerInfo.map(this._remapHeaders,this)).then(function(headerDataList){headerDataList.forEach(function(data){var descriptorHash=Object.create(null);data.sort&&(data.$element.on("click",".sort-by",_this370._getClickHeaderHandler(data)),Object.assign(descriptorHash,{sorting:{get:function(){return data.sorting},enumerable:!1,configurable:!1},isAsc:{get:function(){return data.isAsc},enumerable:!1,configurable:!1}})),data.search&&(_this370._filterList.push(data.search),descriptorHash.searchQuery={get:function(){return data.searchQuery},set:function(value){value!==data.searchQuery&&(data.searchQuery=value,_this370.render())}}),data.$scope.title=data.title||Object.create(null),data.$scope.title.ns=data.$scope.title&&data.$scope.title.ns||defaultNs,data.$scope.sort=!!data.sort,data.$scope.search=!!data.search,data.$scope.placeholder=data.placeholder,Object.defineProperties(data.$scope,descriptorHash),$tr.append(data.$element)}),_this370._headerData=headerDataList,$scope.$digest()})}},{key:"_clearHeader",value:function(){var headerData=this._headerData;headerData&&headerData.length&&headerData.forEach(function(item){item.$scope.$destroy()}),this._headerData=[]}},{key:"_remapHeaders",value:function(header){var id=header.id,title=header.title,valuePath=header.valuePath||id,$headerScope=$scope.$new(!0),xhr=header.templatePath?$templateRequest(header.templatePath):this._headerCellPromise,sorting=header.sortActive||!1;return Object.assign($headerScope,_extends({},header.scopeData||Object.create(null)),{id:id}),xhr.then(function(template){var $element=$compile(template)($headerScope);return{id:id,title:title,valuePath:valuePath,sort:SmartTable._getSortFunction(header.sort,valuePath),search:SmartTable._getSearchFunction($headerScope,header.search,valuePath),sorting:sorting,isAsc:!!tsUtils.isEmpty(header.isAsc)||header.isAsc,searchQuery:"",$scope:$headerScope,$element:$element,placeholder:header.placeholder||"filter"}})}},{key:"_getClickHeaderHandler",value:function(headerData){var _this371=this;return function(){headerData.sorting?headerData.isAsc=!headerData.isAsc:(_this371._headerData.forEach(function(item){item.sorting=!1}),headerData.sorting=!0,headerData.isAsc=!1),_this371.name&&stService.draw.once(function(){stService.sort.dispatch({name:_this371.name,isAsc:headerData.isAsc})}),_this371._applySort()}}},{key:"_sort",value:function(){var header=tsUtils.find(this._headerData||[],{sorting:!0});this._visibleList=header?header.sort(this._filtredList.slice(),header.isAsc):this._filtredList.slice()}},{key:"_filter",value:function(){var filters=this._getFilterList();if(!filters||!filters.length)return this._filtredList=this.data.slice(),null;this._filtredList=filters.reduce(function(result,filter){return filter(result)},this.data.slice())}},{key:"_getFilterList",value:function(){return utils.toArray(this._filterList||[])}},{key:"_draw",value:function(){var _this372=this;$scope.$parent.$data=this._visibleList,SmartTable._postDraw().then(function(){_this372.name&&stService.draw.dispatch(_this372.name)}),$scope.$parent.$digest()}}],[{key:"_postDraw",value:function(){return new Promise(function(resolve){$scope.$parent.$$postDigest(resolve)})}},{key:"_getSortFunction",value:function(sort,valuePath){return"function"==typeof sort?sort:sort&&function(list,isAsc){var method=isAsc?"asc":"desc";return list.sort(utils.comparators.process(function(item){return tsUtils.get({item:item},valuePath)}).smart[method])}||null}},{key:"_getSearchFunction",value:function($scope,search,valuePath){return"function"==typeof search?function(list){return search($scope,"searchQuery",list)}:search&&function(list){return function($scope,key,list){var query=$scope[key];return query?list.filter(function(item){var value=tsUtils.get({item:item},valuePath);return-1!==String(value).toLowerCase().indexOf(query.toLowerCase())}):list}($scope,"searchQuery",list)}||null}}]),SmartTable}()).prototype,"render",[_dec15],Object.getOwnPropertyDescriptor(_class63.prototype,"render"),_class63.prototype),_applyDecoratedDescriptor(_class63.prototype,"_onChangeHeader",[_dec16],Object.getOwnPropertyDescriptor(_class63.prototype,"_onChangeHeader"),_class63.prototype),_applyDecoratedDescriptor(_class63.prototype,"_draw",[_dec17],Object.getOwnPropertyDescriptor(_class63.prototype,"_draw"),_class63.prototype),_class63)};controller.$inject=["Base","$scope","$element","decorators","$templateRequest","$compile","utils","stService","i18n"],angular.module("app.ui").component("wSmartTable",{bindings:{name:"@",data:"<",options:"<",headerInfo:"<"},templateUrl:PATH+"/table.html",transclude:!0,controller:controller})}(),angular.module("app.ui").directive("wTableCell",function(){return{require:{parent:"?^wTableRow"},replace:!0,template:'<div class="smart-table__cell" ng-transclude></div>',transclude:!0,link:{post:function($scope,$element,_,_ref125){var parent=_ref125.parent;parent?parent.registerCell($element,$scope.id):$element.attr("data-column-id",$scope.id)}}}}),(Row=function(){function Row($element,stService){_classCallCheck(this,Row),this.stService=stService,this._children=[],this.parentCid=$element.closest("[data-cid]").attr("data-cid")}return _createClass(Row,[{key:"registerCell",value:function($element,id){this._children.push({$element:$element,id:id}),this._children.forEach(this._updateId,this)}},{key:"_updateId",value:function(_ref126){var $element=_ref126.$element,id=_ref126.id,index=$element.index();$element.get(0).parentElement?$element.attr("data-column-id",this.stService.getTableByCid(this.parentCid).getIdByIndex(index)):$element.attr("data-column-id",id)}}]),Row}()).$inject=["$element","stService"],angular.module("app.ui").directive("wTableRow",function(){return{bindings:{},replace:!0,template:'<div class="smart-table__row" ng-transclude></div>',transclude:!0,controller:Row}}),function(){var controller=function(Base,$element){return new(function(){function Step(){_classCallCheck(this,Step);var _this373=_possibleConstructorReturn(this,(Step.__proto__||Object.getPrototypeOf(Step)).call(this));return _this373.id=null,_this373.list=null,_this373.state=!1,_this373}return _inherits(Step,Base),_createClass(Step,[{key:"$postLink",value:function(){this.list.registerStep(this),$element.attr("step",this.id)}},{key:"displayToggle",value:function(state){this.state=state}}]),Step}())};controller.$inject=["Base","$element"],angular.module("app.ui").component("wStep",{bindings:{id:"@stepId"},require:{list:"^wStepByStep"},template:'<div ng-if="$ctrl.state" ng-transclude></div>',transclude:!0,controller:controller})}(),function(){var controller=function(Base,$element,ComponentList,$scope){return new(function(){function StepByStep(){_classCallCheck(this,StepByStep);var _this374=_possibleConstructorReturn(this,(StepByStep.__proto__||Object.getPrototypeOf(StepByStep)).call(this));return _this374._steps=new ComponentList,_this374.activeStep=null,_this374.observe("activeStep",_this374._onChangeStep),$element.on("click","[w-step-next]",function(){_this374._setStep(_this374._getStepIndex()+1),$scope.$apply()}),$element.on("click","[w-step-prev]",function(){_this374._setStep(_this374._getStepIndex()-1),$scope.$apply()}),_this374}return _inherits(StepByStep,Base),_createClass(StepByStep,[{key:"registerStep",value:function(step){var id=step.id||this._steps.length;step.id=id,this._steps.push(step),null==this.activeStep&&(this.activeStep=step.id),this._onChangeStep()}},{key:"_onChangeStep",value:function(){var _this375=this;this._steps.forEach(function(step){step.displayToggle(_this375.activeStep===step.id)})}},{key:"_getStepIndex",value:function(){return this._steps.index(this.activeStep,"id")}},{key:"_setStep",value:function(index){this._steps.components[index]&&(this.activeStep=this._steps.components[index].id)}}]),StepByStep}())};controller.$inject=["Base","$element","ComponentList","$scope"],angular.module("app.ui").component("wStepByStep",{bindings:{activeStep:"="},template:'<div class="step-list" ng-transclude></div>',transclude:!0,controller:controller})}(),function(){var controller=function($element){return new(function(){function Cell(){_classCallCheck(this,Cell),this.row=null}return _createClass(Cell,[{key:"$postLink",value:function(){this.row.registerCell(this)}},{key:"setIndex",value:function(index){$element.addClass("cell-"+index)}},{key:"getWidth",value:function(){return $element.width()}}]),Cell}())};controller.$inject=["$element"],angular.module("app.ui").component("wCell",{require:{row:"^wRow"},transclude:!0,template:'<div ng-transclude class="table__cell-wrap"></div>',controller:controller})}(),function(){var controller=function(){return new(function(){function Row(){_classCallCheck(this,Row),this.table=null,this.selectValue=null,this.selected=!1,this.cells=[]}return _createClass(Row,[{key:"$postLink",value:function(){this.table.registerRow(this)}},{key:"registerCell",value:function(cell){var index=this.cells.length;cell.setIndex(index),this.cells.push(cell)}},{key:"select",value:function(){null!=this.selectValue&&(this.table.selected=this.selectValue)}}]),Row}())};controller.$inject=[],angular.module("app.ui").component("wRow",{bindings:{selectValue:"@"},require:{table:"^wTable"},transclude:!0,template:'<div ng-click="$ctrl.select()" ng-transclude ng-class="{selected: $ctrl.selected}" class="table__row-wrap"></div>',controller:controller})}(),angular.module("app.ui").component("wTHead",{require:{table:"^wTable"},transclude:!0,template:'<div ng-transclude class="table-thead"></div>'}),function(){var controller=function($element,Base,StyleManager){return new(function(){function Table(){_classCallCheck(this,Table);var _this376=_possibleConstructorReturn(this,(Table.__proto__||Object.getPrototypeOf(Table)).call(this));return _this376._children=[],_this376.selected=null,_this376.cid=tsUtils.uniqueId("tableView"),$element.addClass(_this376.cid),_this376.styleManager=new StyleManager(_this376.cid),_this376.observe("selected",_this376._onChangeSelected),_this376}return _inherits(Table,Base),_createClass(Table,[{key:"$postLink",value:function(){this._onChangeSelected(),this._initColumnWidths()}},{key:"$onDestroy",value:function(){this.styleManager.destroy()}},{key:"registerRow",value:function(row){this._children.push(row),this._setRowSelected(row)}},{key:"_onChangeSelected",value:function(){this._children.forEach(this._setRowSelected,this)}},{key:"_initColumnWidths",value:function(){for(var columnsCount=this._children[0].cells.length,width=100/columnsCount,i=0;i<columnsCount;i++)this.styleManager.addStyle(".cell-"+i,{width:width+"%"})}},{key:"_setRowSelected",value:function(row){row.selected=null!=row.selectValue&&row.selectValue===this.selected}}]),Table}())};controller.$inject=["$element","Base","StyleManager"],angular.module("app.ui").component("wTable",{bindings:{selected:"="},transclude:!0,template:'<div class="table__wrap" ng-transclude></div>',controller:controller})}(),function(){var controller=function(Base){var tsUtils=require("ts-utils");return new(function(){function Tab(){_classCallCheck(this,Tab);var _this377=_possibleConstructorReturn(this,(Tab.__proto__||Object.getPrototypeOf(Tab)).call(this));return _this377.selected=!1,_this377.wTabs=null,_this377.title="",_this377.id="",_this377.changeId=new tsUtils.Signal,_this377.observe("id",function(){if(!_this377.id)throw new Error("Tab without id!");_this377.changeId.dispatch(_this377)}),_this377}return _inherits(Tab,Base),_createClass(Tab,[{key:"$onInit",value:function(){this.wTabs.addTab(this)}}]),Tab}())};controller.$inject=["Base"],angular.module("app.ui").component("wTab",{transclude:!0,template:'<div ng-if="$ctrl.selected" class="tab-tem" ng-transclude></div>',controller:controller,require:{wTabs:"^wTabs"},bindings:{title:"<titleName",id:"<"}})}(),function(){var controller=function(Base,ComponentList){return new(function(){function Tabs(){_classCallCheck(this,Tabs);var _this378=_possibleConstructorReturn(this,(Tabs.__proto__||Object.getPrototypeOf(Tabs)).call(this));return _this378.tabs=new ComponentList,_this378.ngModel=null,_this378}return _inherits(Tabs,Base),_createClass(Tabs,[{key:"addTab",value:function(tab){this.tabs.push(tab)}},{key:"$postLink",value:function(){this._initializeSelected(),this.receive(this.tabs.signals.remove,this._initializeSelected,this),this.receive(this.tabs.signals.add,this._initializeSelected,this),this.observe("ngModel",this._initializeSelected)}},{key:"select",value:function(tab){this.tabs.forEach(function(myTab){myTab.selected=!1}),tab.selected=!0,this.ngModel=tab.id}},{key:"_initializeSelected",value:function(){if(!this.tabs.length)return null;if(null==this.ngModel)return this.select(this.tabs.first()),null;var active=_slicedToArray(this.tabs.where({id:this.ngModel}).components,1)[0];active?this.select(active):this.select(this.tabs.first())}}]),Tabs}())};controller.$inject=["Base","ComponentList"],angular.module("app.ui").component("wTabs",{transclude:!0,templateUrl:"modules/ui/directives/tabs/tabs.html",controller:controller,bindings:{ngModel:"="}})}(),angular.module("app.ui").directive("wAddClass",function(){return{scope:!1,require:"^^wToggleClassContainer",restrict:"A",link:function($scope,$element,$attrs,$container){$element.on("click",function(){$container.addClass($element.attr("w-toggle-class")||"active")})}}}),angular.module("app.ui").directive("wToggleClass",function(){return{scope:!1,require:"^^wToggleClassContainer",restrict:"A",link:function($scope,$element,$attrs,$container){$element.on("click",function(){$container.toggleClass($element.attr("w-toggle-class")||"active")})}}}),function(){var controller=function($element){return new(function(){function ToggleClassContainer(){_classCallCheck(this,ToggleClassContainer)}return _createClass(ToggleClassContainer,[{key:"toggleClass",value:function(className){$element.toggleClass(className)}},{key:"addClass",value:function(className){$element.addClass(className)}}]),ToggleClassContainer}())};controller.$inject=["$element"];angular.module("app.ui").directive("wToggleClassContainer",function(){return{scope:!1,restrict:"A",controller:controller}})}(),function(){var controller=function(Base,$scope,$element,$document,i18n,utils,$templateRequest,$compile){return new(function(){function Tooltip(){_classCallCheck(this,Tooltip);var _this379=_possibleConstructorReturn(this,(Tooltip.__proto__||Object.getPrototypeOf(Tooltip)).call(this,$scope));return _this379._hasMouseEvent=!1,void 0===$scope.tipOffset&&($scope.tipOffset=0),_this379.receive(utils.observe($scope,"isShow"),_this379._onChangeShow,_this379),_this379._onChangeShow(),_this379}return _inherits(Tooltip,Base),_createClass(Tooltip,[{key:"_render",value:function(){var _this380=this;$templateRequest("modules/ui/directives/tooltip/tooltip.html").then(function(template){_this380.$tooltip=$compile(template)($scope),_this380.$tooltip.find(".js-tooltip-content").append($compile($scope.tipContent)($scope.$parent)),_this380.listenEventEmitter($element,"mouseenter",function(){return _this380._onHover()}),_this380.listenEventEmitter($element,"mouseleave",function(){return _this380._onLeave()})}),this._hasMouseEvent=!0}},{key:"_onHover",value:function(){$document.find("body").append(this.$tooltip),this.$tooltip.css(Tooltip._getPosition()),$scope.$parent.$digest()}},{key:"_onLeave",value:function(){this.$tooltip.remove()}},{key:"_onChangeShow",value:function(){$scope.isShow&&!this._hasMouseEvent&&this._render()}},{key:"$onDestroy",value:function(){_get2(Tooltip.prototype.__proto__||Object.getPrototypeOf(Tooltip.prototype),"$onDestroy",this).call(this),this.$tooltip&&this.$tooltip.remove()}}],[{key:"_getPosition",value:function(){var _$element$0$getBoundi=$element[0].getBoundingClientRect(),elementWidth=_$element$0$getBoundi.width,elementHeight=_$element$0$getBoundi.height,elemLeft=_$element$0$getBoundi.left,elemTop=_$element$0$getBoundi.top,centerLeft=elemLeft+elementWidth/2,centerTop=elemTop+elementHeight/2;switch($scope.direction){case"top":return{left:centerLeft,top:elemTop-$scope.tipOffset-5};case"bottom":return{left:centerLeft,top:elemTop+elementHeight+$scope.tipOffset+5};case"left":return{left:elemLeft-$scope.tipOffset-5,top:centerTop};case"right":return{left:elemLeft+elementWidth+$scope.tipOffset+5,top:centerTop};default:return{left:centerLeft,top:elemTop-$scope.tipOffset-5}}}}]),Tooltip}())};controller.$inject=["Base","$scope","$element","$document","i18n","utils","$templateRequest","$compile"],angular.module("app").directive("wTooltip",function(){return{restrict:"AE",scope:{direction:"<",tipContent:"<",tipOffset:"<",isShow:"<"},controller:controller}})}(),function(){var controller=function(Base,$filter,modalManager,notification,waves,user,$scope){var SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE;return new(function(){function Transaction(){return _classCallCheck(this,Transaction),_possibleConstructorReturn(this,(Transaction.__proto__||Object.getPrototypeOf(Transaction)).apply(this,arguments))}return _inherits(Transaction,Base),_createClass(Transaction,[{key:"$postLink",value:function(){var _this382=this;this.typeName=this.transaction.typeName,this.setScam(),this.receive(user.setScamSignal,function(){_this382.setScam(),$scope.$apply()})}},{key:"setScam",value:function(){if(this.isScam=!!user.scam[this.transaction.assetId],7===this.transaction.type){var isScamAmount=!!user.scam[this.transaction.amount.asset],isScamPrice=!!user.scam[this.transaction.price.asset];this.isScam=this.isScam||isScamAmount||isScamPrice}}},{key:"cancelLeasing",value:function(){var lease=this.transaction,leaseId=lease.id;return waves.node.getFee({type:SIGN_TYPE.CANCEL_LEASING}).then(function(fee){var tx=waves.node.transactions.createTransaction({fee:fee,type:SIGN_TYPE.CANCEL_LEASING,lease:lease,leaseId:leaseId}),signable=ds.signature.getSignatureApi().makeSignable({type:tx.type,data:tx});return modalManager.showConfirmTx(signable)})}},{key:"showTransaction",value:function(){modalManager.showTransactionInfo(this.transaction.id)}},{key:"getCopyAllData",value:function(){var tx=this.transaction,id="Transaction ID: "+tx.id,type="Type: "+tx.type+" ("+this.typeName+")",datetime="Date: "+$filter("date")(tx.timestamp,"MM/dd/yyyy HH:mm"),sender="Sender: "+tx.sender;tx.typeName===WavesApp.TRANSACTION_TYPES.NODE.EXCHANGE&&(sender+=" (matcher address)");var message=id+"\n"+type+"\n"+datetime+"\n"+sender;if(tx.typeName===WavesApp.TRANSACTION_TYPES.EXTENDED.UNKNOWN)return message+="\n\nRAW TX DATA BELOW\n\n",message+=JSON.stringify(tx,null,2);tx.recipient&&(message+="\n"+("Recipient: "+tx.recipient));if(tx.amount&&tx.amount instanceof ds.wavesDataEntities.Money){var asset=tx.amount.asset;message+="\n"+("Amount: "+tx.amount.toFormat()+" "+asset.name+" ("+asset.id+")")}if(this.typeName===WavesApp.TRANSACTION_TYPES.EXTENDED.EXCHANGE_BUY||this.typeName===WavesApp.TRANSACTION_TYPES.EXTENDED.EXCHANGE_SELL){var _asset=tx.price.asset;message+="\n"+("Price: "+tx.price.toFormat()+" "+_asset.name+" ("+_asset.id+")")+"\n"+("Total price: "+this.totalPrice+" "+_asset.name)}return this.typeName===WavesApp.TRANSACTION_TYPES.EXTENDED.DATA&&(message+="\n\n\nDATA START",message+="\n\n"+tx.stringifiedData,message+="\n\nDATA END\n\n"),message+="\n"+("Fee: "+tx.fee.toFormat()+" "+tx.fee.asset.name+" ("+tx.fee.asset.id+")")}}]),Transaction}())};controller.$inject=["Base","$filter","modalManager","notification","waves","user","$scope"],angular.module("app.ui").component("wTransaction",{bindings:{datePattern:"@",transaction:"<"},require:{parent:"^wTransactionList"},templateUrl:"modules/ui/directives/transaction/transaction.html",transclude:!1,controller:controller})}(),angular.module("app.ui").component("wTransactionIcon",{bindings:{typeName:"<"},templateUrl:"modules/ui/directives/transaction/transaction-icon.html"}),function(){var controller=function(Base,utils,$scope,$filter){return new(function(){function TransactionInfoRow(){return _classCallCheck(this,TransactionInfoRow),_possibleConstructorReturn(this,(TransactionInfoRow.__proto__||Object.getPrototypeOf(TransactionInfoRow)).apply(this,arguments))}return _inherits(TransactionInfoRow,Base),_createClass(TransactionInfoRow,[{key:"$postLink",value:function(){var _this384=this;this.type=this.transaction.type,this.props=_extends({},this.transaction,{time:$filter("date")(this.transaction.timestamp,this.datePattern||"HH:mm"),isScam:this.isScam}),this.observe("isScam",function(){_this384.props.isScam=_this384.isScam,utils.safeApply($scope)})}}]),TransactionInfoRow}())};controller.$inject=["Base","utils","$scope","$filter"],angular.module("app.ui").component("wTransactionInfoRow",{bindings:{transaction:"<",datePattern:"<",isScam:"<"},templateUrl:"modules/ui/directives/transaction/transaction-info-row.html",controller:controller})}(),function(){var controller=function(Base){return new(function(){function TransactionExport(){return _classCallCheck(this,TransactionExport),_possibleConstructorReturn(this,(TransactionExport.__proto__||Object.getPrototypeOf(TransactionExport)).apply(this,arguments))}return _inherits(TransactionExport,Base),_createClass(TransactionExport,[{key:"copyLink",value:function(){}}]),TransactionExport}())};controller.$inject=["Base"],angular.module("app.ui").component("wTransactionExport",{controller:controller,scope:!1,bindings:{link:"<"},templateUrl:"modules/ui/directives/transactionExport/transaction-export.html"})}(),function(){var controller=function(Base,$scope){var _ANALYTICS_TX_NAMES2,analytics=require("@waves/event-sender"),SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,ANALYTICS_TX_NAMES=(_defineProperty(_ANALYTICS_TX_NAMES2={},SIGN_TYPE.CREATE_ORDER,"Create order"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.ISSUE,"Token Generation"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.TRANSFER,"Transfer"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.REISSUE,"Reissue"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.BURN,"Burn Token"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.EXCHANGE,"Exchange"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.LEASE,"Leasing"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.CANCEL_LEASING,"Cancel Leasing"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.CREATE_ALIAS,"Create Alias"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.MASS_TRANSFER,"Mass Transfer"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.DATA,"Data"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.SET_SCRIPT,"Set Script"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.SPONSORSHIP,"Sponsorship"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.SET_ASSET_SCRIPT,"Set Asset Script"),_defineProperty(_ANALYTICS_TX_NAMES2,SIGN_TYPE.SCRIPT_INVOCATION,"Script Invocation"),_ANALYTICS_TX_NAMES2);return new(function(){function TransactionInfoCtrl(){_classCallCheck(this,TransactionInfoCtrl);var _this386=_possibleConstructorReturn(this,(TransactionInfoCtrl.__proto__||Object.getPrototypeOf(TransactionInfoCtrl)).call(this,$scope));return _this386.signable=null,_this386}return _inherits(TransactionInfoCtrl,Base),_createClass(TransactionInfoCtrl,[{key:"$postLink",value:function(){if(!this.signable)throw new Error("Has no signable!");var name=this.getEventName(this.signable)+" Info Show";analytics.send({name:name,target:"ui"})}},{key:"getEventName",value:function(data){return data.type?data.type in ANALYTICS_TX_NAMES?ANALYTICS_TX_NAMES[data.type]:"Unknown":ANALYTICS_TX_NAMES[SIGN_TYPE.CREATE_ORDER]}}]),TransactionInfoCtrl}())};controller.$inject=["Base","$scope"],angular.module("app.ui").component("wTransactionInfo",{bindings:{signable:"<",isConfirm:"<",confirmed:"<"},templateUrl:"modules/ui/directives/transactionInfo/transaction-info.html",scope:!1,controller:controller})}(),angular.module("app.ui").component("wTransactionInfoContent",{bindings:{signable:"<",confirmed:"<"},templateUrl:"modules/ui/directives/transactionInfo/transaction-info-content.html"}),angular.module("app.ui").component("wTransactionInfoGeneral",{bindings:{timestamp:"<",height:"<",id:"<",fee:"<"},controller:function(){return new function TransactionInfoGeneral(){_classCallCheck(this,TransactionInfoGeneral)}},templateUrl:"modules/ui/directives/transactionInfo/transaction-info-general.html"}),function(){var SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,controller=function(utils,user,waves){var propEq=require("ramda").propEq;return new(function(){function TransactionInfoHeader(){_classCallCheck(this,TransactionInfoHeader)}return _createClass(TransactionInfoHeader,[{key:"$postLink",value:function(){var isOrder=this.signable.type===SIGN_TYPE.CREATE_ORDER;this.typeName=isOrder?"create-order":utils.getTransactionTypeName(this.signable.getTxData()),this.transaction=this.signable.getTxData(),this.transaction.assetId||this._addAssetId(this.transaction.type),this.isScam=!!user.scam[this.transaction.assetId],7===this.transaction.type&&(this.isScamAmount=!!user.scam[this.transaction.amount.asset],this.isScamPrice=!!user.scam[this.transaction.price.asset]),12===this.signable.type&&this._checkDataTx()}},{key:"_checkDataTx",value:function(){var _this387=this,transaction=this.signable.getTxData(),findKey=function(key){return transaction.data.find(propEq("key",key))},keyRating=findKey("score");this.voteObject=Object.create(null),keyRating&&(this.voteObject.rating=findKey("score").value,this.voteObject.assetId=findKey("assetId").value,waves.node.assets.getAsset(this.voteObject.assetId).then(function(asset){_this387.voteObject.assetName=asset.displayName}))}},{key:"_addAssetId",value:function(typeName){switch(typeName){case 4:case 11:this.transaction=_extends({},this.transaction,{assetId:this.transaction.amount.asset.id});break;case 14:this.transaction=_extends({},this.transaction,{assetId:this.transaction.minSponsoredAssetFee.asset.id})}}}]),TransactionInfoHeader}())};controller.$inject=["utils","user","waves"],angular.module("app.ui").component("wTransactionInfoHeader",{bindings:{signable:"<"},templateUrl:"modules/ui/directives/transactionInfo/transaction-info-header.html",scope:!1,controller:controller})}(),function(){var controller=function($scope){return new(function(){function TransactionInfoJson(){_classCallCheck(this,TransactionInfoJson),this.json="",this.signable=null}return _createClass(TransactionInfoJson,[{key:"$postLink",value:function(){var _this388=this;if(!this.signable)throw new Error("Has no signable!");this.signable.getDataForApi().then(function(json){_this388.json=WavesApp.stringifyJSON(json,null,4),$scope.$apply()})}},{key:"addAnalytic",value:function(){}}]),TransactionInfoJson}())};controller.$inject=["$scope"],angular.module("app.ui").component("wTransactionInfoJson",{bindings:{signable:"<"},templateUrl:"modules/ui/directives/transactionInfo/transaction-info-json.html",scope:!1,controller:controller})}(),function(){var controller=function(Base,user,i18n,waves,utils){return new(function(){function TransactionList(){_classCallCheck(this,TransactionList);var _this389=_possibleConstructorReturn(this,(TransactionList.__proto__||Object.getPrototypeOf(TransactionList)).call(this));return _this389._transactions=null,_this389.transactions=null,_this389.pending=!1,_this389.dontShowSpam=user.getSetting("dontShowSpam"),_this389.syncSettings({dontShowSpam:"dontShowSpam"}),_this389.observe(["_transactions","dontShowSpam"],_this389._onChangeTransactions),_this389}return _inherits(TransactionList,Base),_createClass(TransactionList,[{key:"$postLink",value:function(){this.parentSelector=this.parentSelector||"ul"}},{key:"_onChangeTransactions",value:function(){var transactions=this._transactions||[];this.dontShowSpam&&(transactions=transactions.filter(this._filterSpam));var hash=Object.create(null),toDate=tsUtils.date("DD.MM.YYYY");transactions.forEach(function(transaction){var date=toDate(transaction.timestamp);hash[date]||(hash[date]={timestamp:transaction.timestamp,transactions:[]}),hash[date].transactions.push(transaction)});var dates=Object.keys(hash).sort(utils.comparators.process(function(name){return hash[name].timestamp}).desc);this.transactions=dates.map(function(date){return{transactions:hash[date].transactions,timestamp:hash[date].timestamp,date:date}})}},{key:"_filterSpam",value:function(transaction){var isScam=!!user.scam[transaction.assetId],isScamAmount=void 0,isScamPrice=void 0;return 7===transaction.type&&(isScamAmount=!!user.scam[transaction.amount.asset],isScamPrice=!!user.scam[transaction.price.asset]),!(isScam||isScamAmount||isScamPrice)}}]),TransactionList}())};controller.$inject=["Base","user","i18n","waves","utils"],angular.module("app.ui").component("wTransactionList",{bindings:{transactionDatePattern:"@",parentSelector:"@",pending:"<",_transactions:"<transactions"},templateUrl:"modules/ui/directives/transactionList/transactionList.html",transclude:!1,controller:controller})}(),function(){var directive=function(Base,visibleService){return{restrict:"E",replace:!0,template:'<div class="w-visible"></div>',transclude:!0,scope:!1,link:function($scope,$element,$attrs,$ctrl,$transclude){var once=""===$attrs.once||"true"===$attrs.once,root=$attrs.scrollRootSelector;new(function(){function Visible(){_classCallCheck(this,Visible);var _this390=_possibleConstructorReturn(this,(Visible.__proto__||Object.getPrototypeOf(Visible)).call(this,$scope));_this390.$node=$element,_this390.content=null,_this390.node=$element.get(0),_this390.visible=!1,_this390._appendPromise=null;var $scrollRootElement=root?$element.closest(root):$element.parent();return visibleService.registerVisibleComponent(_this390,$scrollRootElement),_this390.observe("visible",_this390._onChangeVisible),_this390.signals.destroy.once(function(){_this390.content&&(_this390.content.$scope.$destroy(),_this390.content.$element.remove(),_this390.content=null),_this390.$node.remove()}),_this390}return _inherits(Visible,Base),_createClass(Visible,[{key:"currentVisibleState",value:function(){var rect=this.node.getBoundingClientRect(),visible=0<rect.top&&rect.top<innerHeight;return this.visible=visible}},{key:"_onChangeVisible",value:function(){var _this391=this;if(this._appendPromise)return this._appendPromise.then(function(){return _this391._onChangeVisible()}),null;this.visible?(this._appendPromise=this._append().then(function(){_this391._appendPromise=null}),once&&visibleService.unregisterVisibleComponent(this)):(this.content.$element.remove(),this.content.$scope.$destroy())}},{key:"_append",value:function(){var _this392=this;return new Promise(function(resolve){$transclude(function($element,$scope){_this392.$node.append($element),_this392.content={$element:$element,$scope:$scope},resolve()})})}}]),Visible}())}}};directive.$inject=["Base","visibleService"],angular.module("app.ui").directive("wVisible",directive)}(),function(){var tsUtils=require("ts-utils"),factory=function(Base,utils){return new(function(){function VisibleService(){_classCallCheck(this,VisibleService);var _this393=_possibleConstructorReturn(this,(VisibleService.__proto__||Object.getPrototypeOf(VisibleService)).call(this));return _this393.children=Object.create(null),_this393._handlerdebounce=utils.debounceRequestAnimationFrame(function(e){return _this393._onScroll(e)}),_this393._initHandlerDebounce=utils.debounce(function(){return _this393._onScroll()},50),_this393._updateSortDebounce=utils.debounce(function(){return _this393.updateSort()},50),_this393}return _inherits(VisibleService,Base),_createClass(VisibleService,[{key:"checkVisibleContent",value:function(){this._handlerdebounce()}},{key:"registerVisibleComponent",value:function(visible,$parent){var _this394=this;if(!$parent.length)throw new Error("Element visible has no parent!");var id=VisibleService._getParentId($parent);this.children[id]||(this.children[id]={scrollTop:$parent.scrollTop(),visible:Object.create(null),list:[]}),this.children[id].list.push(visible),this.receiveOnce(visible.signals.destroy,function(){_this394.children[id].list=_this394.children[id].list.filter(function(i){return i!==visible}),_this394.children[id].list.length||delete _this394.children[id],0===Object.keys(_this394.children).length&&_this394._removeHandlers(),_this394._updateSortDebounce()}),1===Object.keys(this.children).length&&1===this.children[id].list.length&&this._addHandlers(),this._updateSortDebounce()}},{key:"updateSort",value:function(){var _this395=this;Object.keys(this.children).forEach(function(id){var visibleElements=$("#"+id+" .w-visible").toArray(),childrenHash=utils.toHash(_this395.children[id].list,"cid"),sortList=_this395.children[id].list.map(function(item){return{cid:item.cid,index:visibleElements.indexOf(item.node)}});sortList.sort(utils.comparators.process(function(i){return i.index}).asc),_this395.children[id].list=sortList.map(function(item){return childrenHash[item.cid]}),_this395.children[id].visible=Object.create(null)}),this._onScroll()}},{key:"unregisterVisibleComponent",value:function(visible){Object.values(this.children).forEach(function(info){info.list=info.list.filter(function(i){return i!==visible}),delete info.visible[visible.cid]}),this.stopReceive(visible.signals.destroy)}},{key:"_onScroll",value:function(e){var _this396=this,target=e&&e.target,id=target&&target.getAttribute&&target.getAttribute("id");id&&this.children[id]?this._scrollById(target.scrollTop,id):Object.keys(this.children).forEach(function(id){var element=document.querySelector("#"+id);element?(_this396.children[id].visible=Object.create(null),_this396._scrollById(element.scrollTop,id)):delete _this396.children[id]})}},{key:"_scrollById",value:function(activeScrollTop,id){var _this397=this,direction=this.children[id].scrollTop<activeScrollTop,visibleHash=this.children[id].visible;if(this.children[id].visible=Object.create(null),!Object.keys(visibleHash).length)return this.children[id].list.forEach(function(item){item.currentVisibleState()&&(_this397.children[id].visible[item.cid]=item)}),null;var wasVisible=!1,wasChangeVisible=!1,loop=function(i){var item=_this397.children[id].list[i];if(!(wasVisible=wasVisible||visibleHash[item.cid]))return null;if(item.currentVisibleState())_this397.children[id].visible[item.cid]=item,wasChangeVisible=!0;else if(wasChangeVisible)return!1};if(direction)for(var i=0;i<this.children[id].list.length&&!1!==loop(i);i++);else for(var _i=this.children[id].list.length-1;0<=_i&&!1!==loop(_i);_i--);this.children[id].scrollTop=activeScrollTop}},{key:"_addHandlers",value:function(){document.addEventListener("scroll",this._handlerdebounce,!0),window.addEventListener("resize",this._initHandlerDebounce,!1)}},{key:"_removeHandlers",value:function(){document.removeEventListener("scroll",this._handlerdebounce,!0),window.removeEventListener("resize",this._initHandlerDebounce,!1)}}],[{key:"_getParentId",value:function($parent){var nodeId=$parent.attr("id");if(nodeId)return nodeId;var id=tsUtils.uniqueId("visible-parent-id");return $parent.attr("id",id),id}}]),VisibleService}())};factory.$inject=["Base","utils"],angular.module("app.ui").factory("visibleService",factory)}(),angular.module("app.ui").component("wWebOnly",{scope:!1,transclude:!0,template:'<div ng-if="::'+WavesApp.isWeb()+'" ng-transclude></div>'}),angular.module("app.ui").directive("wWebOnlyClass",function(){return{restrict:"A",scope:!1,link:function($scope,$element,$attr){WavesApp.isWeb()&&$element.addClass($attr.wWebOnlyClass)}}}),function(){var factory=function(user,utils){var _class67,_temp11,tsUtils=require("ts-utils"),Base=(_temp11=_class67=function(){function Base($scope){var _this398=this;if(_classCallCheck(this,Base),this.wasDestroed=!1,this.__emitterListeners=Object.create(null),$scope)var stop=$scope.$on("$destroy",function(){_this398.$onDestroy(),stop()});this.signals={destroy:new tsUtils.Signal,logout:new tsUtils.Signal},this.cid=tsUtils.uniqueId("base"),this.receive(user.logoutSignal,this.signals.logout.dispatch,this.signals.logout)}return _createClass(Base,[{key:"listenEventEmitter",value:function(emitter,event,handler,methods){(methods=methods||Object.create(null)).on=methods.on||"on",methods.off=methods.off||"off",this.__emitterListeners[event]||(this.__emitterListeners[event]=[]),this.__emitterListeners[event].push({emitter:emitter,handler:handler,methods:methods}),emitter[methods.on](event,handler,methods.capture)}},{key:"stopListenEventEmitter",value:function(argument_0,argument_1,argument_2){var _this399=this,event=void 0,handler=void 0,emitter=void 0;return(arguments.length<=0?void 0:argument_0)&&"object"===_typeof(arguments.length<=0?void 0:argument_0)?(handler=event=null,emitter=arguments.length<=0?void 0:argument_0):(arguments.length<=0?void 0:argument_0)&&"function"==typeof(arguments.length<=0?void 0:argument_0)?(handler=arguments.length<=0?void 0:argument_0,emitter=event=null):event=arguments.length<=0?void 0:argument_0,(arguments.length<=1?void 0:argument_1)&&"object"===_typeof(arguments.length<=1?void 0:argument_1)?emitter=arguments.length<=1?void 0:argument_1:handler=arguments.length<=1?void 0:argument_1,(arguments.length<=2?void 0:argument_2)&&(emitter=arguments.length<=2?void 0:argument_2),event?handler?void(this.__emitterListeners[event]=this.__emitterListeners[event].filter(function(data){return emitter?data.emitter!==emitter||data.handler!==handler||(emitter[data.methods.off](event,handler),!1):data.handler!==handler||(data.emitter[data.methods.off](event,handler),!1)})):(this.__emitterListeners[event].slice().forEach(function(data){_this399.stopListenEventEmitter(event,data.handler,emitter)}),null):(Object.keys(this.__emitterListeners).forEach(function(myEvent){_this399.stopListenEventEmitter(myEvent,handler,emitter)}),null)}},{key:"observe",value:function(keys,callback,options){this.receive(utils.observe(this,keys,options),callback,this)}},{key:"observeOnce",value:function(keys,callback,options){this.receiveOnce(utils.observe(this,keys,options),callback,this)}},{key:"stopObserve",value:function(keys,handler){this.stopReceive(utils.observe(this,keys),handler)}},{key:"syncSettings",value:function(syncObject){var _this400=this;return Object.keys(syncObject).forEach(function(name){var settingsPath=syncObject[name];if(_this400.observe(name,function(){user.setSetting(settingsPath,_this400[name])}),user.changeSetting){var handler=function(path){path===settingsPath&&(_this400[name]=user.getSetting(path))};_this400.receive(user.changeSetting,handler),_this400.receiveOnce(user.logoutSignal,function(){_this400.stopReceive(user.logoutSignal,handler)})}_this400[name]=user.getSetting(settingsPath)})}},{key:"$onDestroy",value:function(){this.signals.destroy.dispatch(),this.stopReceive(),this.signals.destroy.off(),this.signals.logout.off(),this.stopListenEventEmitter(),this.wasDestroed=!0}}]),Base}(),_class67.DOM_EVENTS_METHODS={on:"addEventListener",off:"removeEventListener",capture:!1},_temp11);return Base.prototype.receive=tsUtils.Receiver.prototype.receive,Base.prototype.receiveOnce=tsUtils.Receiver.prototype.receiveOnce,Base.prototype.stopReceive=tsUtils.Receiver.prototype.stopReceive,Base};factory.$inject=["user","utils"],angular.module("app.utils").factory("Base",factory)}(),function(){var factory=function(Base){var BaseClassComponent=function(){function BaseClassComponent(parent){if(_classCallCheck(this,BaseClassComponent),!(parent instanceof Base))throw new Error("Can't add component to controller, controller not instanceof Base!");this.parent=parent,this.receiveOnce(parent.signals.destroy,this.remove,this)}return _createClass(BaseClassComponent,[{key:"remove",value:function(){}}]),BaseClassComponent}();return BaseClassComponent.prototype.receive=tsUtils.Receiver.prototype.receive,BaseClassComponent.prototype.receiveOnce=tsUtils.Receiver.prototype.receiveOnce,BaseClassComponent.prototype.stopReceive=tsUtils.Receiver.prototype.stopReceive,BaseClassComponent};factory.$inject=["Base"],angular.module("app.utils").factory("BaseClassComponent",factory)}(),function(){var factory=function(BaseClassComponent,Poll,modalManager,eventManager,Base){var pollComponents=Object.create(null),tsUtils=require("ts-utils");return function(){function PollComponent(parent){_classCallCheck(this,PollComponent);var _this401=_possibleConstructorReturn(this,(PollComponent.__proto__||Object.getPrototypeOf(PollComponent)).call(this,parent));return _this401._polls=Object.create(null),_this401.receive(modalManager.openModal,_this401._onOpenModal,_this401),_this401}return _inherits(PollComponent,BaseClassComponent),_createClass(PollComponent,[{key:"createPoll",value:function(getter,setter,time,options){var _this402=this;"string"==typeof setter?setter=PollComponent._getSetterHandler(setter,this.parent,options):setter=PollComponent._wrapSetterHandler(setter,this.parent,options);var poll=new Poll(getter.bind(this.parent),setter,time);return this._polls[poll.id]=poll,options&&options.isBalance&&this.receive(eventManager.signals.changeBalanceEvent,function(){return poll.restart()}),this.receiveOnce(poll.signals.destroy,function(){delete _this402._polls[poll.id]}),poll}},{key:"remove",value:function(){_get2(PollComponent.prototype.__proto__||Object.getPrototypeOf(PollComponent.prototype),"remove",this).call(this),delete pollComponents[this.parent.cid],tsUtils.each(this._polls,function(poll){poll&&poll.destroy()})}},{key:"_onOpenModal",value:function(modal){tsUtils.each(this._polls,function(poll){poll.pause(modal)})}}],[{key:"create",value:function(base,getter,setter,time,options){if(!(base instanceof Base))throw new Error("Component must be an instance of Base");if(base.wasDestroed)return null;var poll=PollComponent._getPoll(base).createPoll(getter,setter,time,options);return base.signals.logout.once(poll.destroy,poll),poll}},{key:"_getSetterHandler",value:function(path,parent,options){return options&&options.$scope?function(data){tsUtils.set(parent,path,data),options.$scope.$apply()}:function(data){tsUtils.set(parent,path,data)}}},{key:"_wrapSetterHandler",value:function(handler,parent,options){return options&&options.$scope?function(data){handler.call(parent,data),options.$scope.$apply()}:handler.bind(parent)}},{key:"_getPoll",value:function(base){if(pollComponents[base.cid])return pollComponents[base.cid];var poll=new PollComponent(base);return pollComponents[base.cid]=poll}}]),PollComponent}().create};factory.$inject=["BaseClassComponent","Poll","modalManager","eventManager","Base"],angular.module("app.utils").factory("createPoll",factory)}(),function(){var factory=function(BaseClassComponent,PromiseControl){var componentsHash=Object.create(null);return function(){function PromiseComponent(base){_classCallCheck(this,PromiseComponent);var _this403=_possibleConstructorReturn(this,(PromiseComponent.__proto__||Object.getPrototypeOf(PromiseComponent)).call(this,base));return _this403._promiseList=[],_this403}return _inherits(PromiseComponent,BaseClassComponent),_createClass(PromiseComponent,[{key:"remove",value:function(){_get2(PromiseComponent.prototype.__proto__||Object.getPrototypeOf(PromiseComponent.prototype),"remove",this).call(this),delete componentsHash[this.parent.cid],this._promiseList.forEach(function(promise){promise.drop()}),this._promiseList=[]}},{key:"wrap",value:function(promise){var _this404=this,control=new PromiseControl(promise);return this._promiseList.push(control),control.always(function(){var index=_this404._promiseList.indexOf(control);-1!==index&&_this404._promiseList.splice(index,1)}),control}}],[{key:"create",value:function(base,promise){return PromiseComponent._getComponent(base).wrap(promise)}},{key:"_getComponent",value:function(base){return componentsHash[base.cid]||(componentsHash[base.cid]=new PromiseComponent(base)),componentsHash[base.cid]}}]),PromiseComponent}().create};factory.$inject=["BaseClassComponent","PromiseControl"],angular.module("app.utils").factory("createPromise",factory)}(),CARD_GATEWAYS=_defineProperty({},WavesApp.defaultAssets.WAVES,"WAVES"),PATH=WavesApp.network.coinomat+"/api/v2/indacoin",angular.module("app.utils").factory("coinomatCardService",function(){return new(function(){function CoinomatCardService(){_classCallCheck(this,CoinomatCardService)}return _createClass(CoinomatCardService,[{key:"getAll",value:function(){return CARD_GATEWAYS}},{key:"getFiatWithLimits",value:function(crypto,wavesAddress,fiatList){var _this405=this;CoinomatCardService._assertAsset(crypto);var to=CARD_GATEWAYS[crypto.id];return Promise.all(fiatList.map(function(fiat){return _this405._loadBuyLimits(to,fiat.fiatCode,wavesAddress).then(function(limits){return _extends({},fiat,limits)})}))}},{key:"getApproximateCryptoAmount",value:function(crypto,fiat,wavesAddress,fiatAmount){return CoinomatCardService._assertAsset(crypto),$.get(PATH+"/rate.php",{crypto:CARD_GATEWAYS[crypto.id],fiat:fiat,address:wavesAddress,amount:fiatAmount})}},{key:"getCardBuyLink",value:function(crypto,fiat,wavesAddress,fiatAmount){CoinomatCardService._assertAsset(crypto);var to=CARD_GATEWAYS[crypto.id];return PATH+"/buy.php?crypto="+to+"&fiat="+fiat+"&address="+wavesAddress+"&amount="+fiatAmount}},{key:"getSupportMap",value:function(asset){if(CARD_GATEWAYS[asset.id])return{card:!0}}},{key:"getAssetKeyName",value:function(asset){return"coinomat"+CARD_GATEWAYS[asset.id].gateway}},{key:"_loadBuyLimits",value:function(to,from,recipientAddress){return $.get(PATH+"/limits.php",{crypto:to,fiat:from,address:recipientAddress}).then(function(res){try{return JSON.parse(res)}catch(e){return{}}})}}],[{key:"_assertAsset",value:function(assetId){if(!CARD_GATEWAYS[assetId])throw new Error("Asset is not supported by Coinomat")}}]),CoinomatCardService}())}),_defineProperty(_SEPA_GATEWAYS={},WavesApp.defaultAssets.USD,"USD"),_defineProperty(_SEPA_GATEWAYS,WavesApp.defaultAssets.EUR,"EUR"),_defineProperty(_SEPA_GATEWAYS,WavesApp.defaultAssets.TRY,"TRY"),SEPA_GATEWAYS=_SEPA_GATEWAYS,SEPA_COUNTRIES_URL=WavesApp.network.support+"/forums/2-knowledge-base/topics"+"/1304-list-of-accepted-countries-and-documents-for-verification",angular.module("app.utils").factory("coinomatSepaService",function(){return new(function(){function CoinomatSepaService(){_classCallCheck(this,CoinomatSepaService)}return _createClass(CoinomatSepaService,[{key:"getAll",value:function(){return SEPA_GATEWAYS}},{key:"getSepaDetails",value:function(asset,wavesAddress){return CoinomatSepaService._assertAsset(asset.id),Promise.resolve({listOfEligibleCountries:SEPA_COUNTRIES_URL,idNowSiteUrl:"https://idnow.eu",idNowUserLink:"https://go.idnow.de/coinomat/userdata/"+wavesAddress})}},{key:"getSupportMap",value:function(asset){if(SEPA_GATEWAYS[asset.id])return{sepa:!0}}},{key:"getAssetKeyName",value:function(asset){return"coinomatSepa"+SEPA_GATEWAYS[asset.id]}}],[{key:"_assertAsset",value:function(assetId){if(!SEPA_GATEWAYS[assetId])throw new Error("Asset is not supported by Coinomat SEPA")}}]),CoinomatSepaService}())}),function(){var _GATEWAYS,GATEWAYS=(_defineProperty(_GATEWAYS={},WavesApp.defaultAssets.BTC,{waves:"WBTC",gateway:"BTC"}),_defineProperty(_GATEWAYS,WavesApp.defaultAssets.BSV,{waves:"WBSV",gateway:"BSV"}),_defineProperty(_GATEWAYS,WavesApp.defaultAssets.ETH,{waves:"WETH",gateway:"ETH"}),_defineProperty(_GATEWAYS,WavesApp.defaultAssets.LTC,{waves:"WLTC",gateway:"LTC"}),_defineProperty(_GATEWAYS,WavesApp.defaultAssets.ZEC,{waves:"WZEC",gateway:"ZEC"}),_defineProperty(_GATEWAYS,WavesApp.defaultAssets.BCH,{waves:"WBCH",gateway:"BCH"}),_defineProperty(_GATEWAYS,WavesApp.defaultAssets.DASH,{waves:"WDASH",gateway:"DASH"}),_defineProperty(_GATEWAYS,WavesApp.defaultAssets.XMR,{waves:"WXMR",gateway:"XMR"}),_GATEWAYS),PATH_V1=WavesApp.network.coinomat+"/api/v1",PATH_V2=WavesApp.network.coinomat+"/api/v2",ds=require("data-service"),prop=require("ramda").prop,BigNumber=require("@waves/bignumber").BigNumber;angular.module("app.utils").factory("coinomatService",function(){return new(function(){function CoinomatService(){_classCallCheck(this,CoinomatService)}return _createClass(CoinomatService,[{key:"getAll",value:function(){return GATEWAYS}},{key:"getDepositDetails",value:function(asset,wavesAddress){CoinomatService._assertAsset(asset.id);var from=GATEWAYS[asset.id].gateway,to=GATEWAYS[asset.id].waves;return this._loadPaymentDetails(from,to,wavesAddress).then(function(details){return{address:details.tunnel.wallet_from,attachment:details.tunnel.attachment,minimumAmount:new BigNumber(details.tunnel.in_min),maximumAmount:new BigNumber(details.tunnel.in_max),exchangeRate:new BigNumber(details.tunnel.xrate),gatewayFee:new BigNumber(details.tunnel.fee_out)}})}},{key:"getWithdrawDetails",value:function(asset,targetAddress,paymentId){CoinomatService._assertAsset(asset.id);var from=GATEWAYS[asset.id].waves,to=GATEWAYS[asset.id].gateway;return Promise.all([this._loadPaymentDetails(from,to,targetAddress,paymentId),this._loadWithdrawRate(from,to)]).then(function(_ref127){var _ref128=_slicedToArray(_ref127,2),details=_ref128[0],rate=_ref128[1];if(paymentId&&details.tunnel.monero_payment_id!==paymentId)throw new Error("Monero Payment ID is invalid or missing");return{address:details.tunnel.wallet_from,attachment:details.tunnel.attachment,minimumAmount:new BigNumber(rate.in_min),maximumAmount:new BigNumber(rate.in_max),exchangeRate:new BigNumber(rate.xrate),gatewayFee:new BigNumber(rate.fee_out)}})}},{key:"getSupportMap",value:function(asset){if(GATEWAYS[asset.id])return{deposit:!0,withdraw:!0,errorAddressMessage:!0}}},{key:"getAssetKeyName",value:function(asset){return"coinomat"+GATEWAYS[asset.id].gateway}},{key:"hasConfirmation",value:function(address){return ds.fetch(PATH_V2+"/get_confirmation.php?address="+address).then(function(_ref129){var status=_ref129.status,is_confirmed=_ref129.is_confirmed;return!("not found"===status||!is_confirmed)})}},{key:"isVerified",value:function(address){return ds.fetch(PATH_V2+"/get_verification_status.php?address="+address).then(prop("verified"))}},{key:"getCoinomatTimestamp",value:function(){return ds.fetch(PATH_V2+"/get_ts.php").then(prop("ts"))}},{key:"getAddressErrorMessage",value:function(){return"Invalid wallet_to"}},{key:"setCoinomatTermsAccepted",value:function(signature,timestamp,status){var confirmed=status?1:0;return ds.signature.getSignatureApi().getPublicKey().then(function(publicKey){var params={signature:signature,public_key:publicKey,ts:timestamp,is_confirmed:confirmed};return ds.fetch(PATH_V2+"/set_confirmation.php?"+function(params){return Object.keys(params).reduce(function(acc,item){return acc+(acc?"&":"")+item+"="+params[item]},"")}(params),{method:"POST"}).then(function(response){if("error"===response.status)return Promise.reject("Error!")})})}},{key:"_loadPaymentDetails",value:function(from,to,recipientAddress,paymentId){return $.get(PATH_V1+"/create_tunnel.php",_extends({currency_from:from,currency_to:to,wallet_to:recipientAddress},paymentId?{monero_payment_id:paymentId}:{})).then(function(res){return CoinomatService._assertResponse(res,"ok"),$.get(PATH_V1+"/get_tunnel.php",{xt_id:res.tunnel_id,k1:res.k1,k2:res.k2,history:0,lang:"ru_RU"})}).then(function(res){return CoinomatService._assertResponse(res,"tunnel"),res})}},{key:"_loadWithdrawRate",value:function(from,to){return $.get(PATH_V1+"/get_xrate.php",{f:from,t:to,lang:"ru_RU"})}}],[{key:"_assertResponse",value:function(response,fieldName){if(!response[fieldName])throw new Error(response.error)}},{key:"_assertAsset",value:function(assetId){if(!GATEWAYS[assetId])throw new Error("Asset is not supported by Coinomat")}}]),CoinomatService}())})}(),function(){var factory=function(coinomatService,coinomatCardService,coinomatSepaService,wavesGatewayService,configService){return new(function(){function GatewayService(){_classCallCheck(this,GatewayService),this.gateways=[coinomatService,coinomatCardService,coinomatSepaService,wavesGatewayService]}return _createClass(GatewayService,[{key:"getCryptocurrencies",value:function(){return _extends({},coinomatService.getAll(),wavesGatewayService.getAll())}},{key:"getPurchasableWithCards",value:function(){return coinomatCardService.getAll()}},{key:"getFiats",value:function(){return coinomatSepaService.getAll()}},{key:"getDepositDetails",value:function(asset,wavesAddress){var gateway=this._findGatewayFor(asset,"deposit");return gateway?gateway.getDepositDetails(asset,wavesAddress):null}},{key:"getWithdrawDetails",value:function(asset,targetAddress,paymentId){var gateway=this._findGatewayFor(asset,"withdraw");return this.canUseGateway(asset)?gateway.getWithdrawDetails(asset,targetAddress,paymentId):Promise.reject({code:1001,message:"Gateway is blocked"})}},{key:"canUseGateway",value:function(asset){return!configService.get("PERMISSIONS.CANT_TRANSFER_GATEWAY").includes(asset.id)}},{key:"getCardFiatWithLimits",value:function(crypto,wavesAddress,fiatList){return this._findGatewayFor(crypto,"card").getFiatWithLimits(crypto,wavesAddress,fiatList)}},{key:"getCardApproximateCryptoAmount",value:function(crypto,fiat,recipientAddress,fiatAmount){var gateway=this._findGatewayFor(crypto,"card");return gateway?gateway.getApproximateCryptoAmount(crypto,fiat,recipientAddress,fiatAmount):Promise.resolve(0)}},{key:"getCardBuyLink",value:function(crypto,fiat,recipientAddress,fiatAmount){var gateway=this._findGatewayFor(crypto,"card");return gateway?gateway.getCardBuyLink(crypto,fiat,recipientAddress,fiatAmount):""}},{key:"getSepaDetails",value:function(asset,wavesAddress){var gateway=this._findGatewayFor(asset,"sepa");return gateway?gateway.getSepaDetails(asset,wavesAddress):null}},{key:"hasSupportOf",value:function(asset,type){return!!this._findGatewayFor(asset,type)}},{key:"getAssetKeyName",value:function(asset,type){return this._findGatewayFor(asset,type).getAssetKeyName(asset)}},{key:"getAddressErrorMessage",value:function(asset,address,type){return this._findGatewayFor(asset,type).getAddressErrorMessage(address)}},{key:"getWrongAddressMessage",value:function(asset,address,type){var gateway=this._findGatewayFor(asset,type);return gateway?gateway.getWrongAddressMessage(address,asset):null}},{key:"hasConfirmation",value:function(address){return coinomatService.hasConfirmation(address)}},{key:"getDefaultCardFiatList",value:function(){var _FIAT_CODES,FIAT_CODES=(_defineProperty(_FIAT_CODES={},WavesApp.defaultAssets.USD,"USD"),_defineProperty(_FIAT_CODES,WavesApp.defaultAssets.EUR,"EURO"),_FIAT_CODES);return[{name:"USD",assetId:WavesApp.defaultAssets.USD,fiatCode:FIAT_CODES[WavesApp.defaultAssets.USD],min:"30",max:"50"},{name:"EUR",assetId:WavesApp.defaultAssets.EUR,fiatCode:FIAT_CODES[WavesApp.defaultAssets.EUR],min:"30",max:"50"}]}},{key:"_findGatewayFor",value:function(asset,type){var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=this.gateways[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var gateway=_step3.value,supportMap=gateway.getSupportMap(asset);if(supportMap&&supportMap[type])return gateway}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}}}]),GatewayService}())};factory.$inject=["coinomatService","coinomatCardService","coinomatSepaService","wavesGatewayService","configService"],angular.module("app.utils").factory("gatewayService",factory)}(),function(){var _GATEWAYS2,GATEWAYS=(_defineProperty(_GATEWAYS2={},WavesApp.defaultAssets.VST,{waves:"WVST",gateway:"VST"}),_defineProperty(_GATEWAYS2,WavesApp.defaultAssets.ERGO,{waves:"WERGO",gateway:"ERGO"}),_defineProperty(_GATEWAYS2,WavesApp.defaultAssets.BNT,{waves:"WBNT",gateway:"BNT"}),_GATEWAYS2),PATH=WavesApp.network.wavesGateway+"/api/v1";angular.module("app.utils").factory("wavesGatewayService",function(){var BigNumber=require("@waves/bignumber").BigNumber;return new(function(){function WavesGatewayService(){_classCallCheck(this,WavesGatewayService)}return _createClass(WavesGatewayService,[{key:"getSupportMap",value:function(asset){if(GATEWAYS[asset.id])return{deposit:!0,withdraw:!0,errorAddressMessage:!0,wrongAddressMessage:!0}}},{key:"getDepositDetails",value:function(asset,wavesAddress){var _this406=this;WavesGatewayService._assertAsset(asset.id);var body=JSON.stringify({userAddress:wavesAddress,assetId:asset.id});return ds.fetch(PATH+"/external/deposit",{method:"POST",body:body}).then(function(details){var _map=[details.minAmount,details.maxAmount,details.fee].map(function(value){return _this406._normalaizeValue(value,-asset.precision)}),_map2=_slicedToArray(_map,3),minAmount=_map2[0],maxAmount=_map2[1],fee=_map2[2];return{address:details.address,minimumAmount:new BigNumber(minAmount),maximumAmount:new BigNumber(maxAmount),gatewayFee:new BigNumber(fee)}})}},{key:"getWithdrawDetails",value:function(asset,targetAddress){var _this407=this;WavesGatewayService._assertAsset(asset.id);var body=JSON.stringify({userAddress:targetAddress,assetId:asset.id});return ds.fetch(PATH+"/external/withdraw",{method:"POST",body:body}).then(function(details){var _map3=[details.minAmount,details.maxAmount,details.fee].map(function(value){return _this407._normalaizeValue(value,-asset.precision)}),_map4=_slicedToArray(_map3,3),minAmount=_map4[0],maxAmount=_map4[1],fee=_map4[2];return{address:details.recipientAddress,minimumAmount:new BigNumber(minAmount),maximumAmount:new BigNumber(maxAmount),gatewayFee:new BigNumber(fee),attachment:details.processId}})}},{key:"getAssetKeyName",value:function(asset){return"wavesGateway"+GATEWAYS[asset.id].gateway}},{key:"getAll",value:function(){return GATEWAYS}},{key:"getAddressErrorMessage",value:function(address){return"can't withdraw to address "+address}},{key:"getWrongAddressMessage",value:function(address){return"wrong address "+address}},{key:"_normalaizeValue",value:function(value,pow){return value*Math.pow(10,pow)}}],[{key:"_assertAsset",value:function(assetId){if(!GATEWAYS[assetId])throw new Error("Asset is not supported by Vostok")}}]),WavesGatewayService}())})}(),function(){var factory=function(storageDataConverter){var _class68,_temp12;return new(_temp12=_class68=function(){function LocalStorage(){_classCallCheck(this,LocalStorage)}return _createClass(LocalStorage,[{key:"read",value:function(key){var data=LocalStorage.getStorage().getItem(key);try{data=JSON.parse(data)}catch(e){return data}return storageDataConverter.parse(data)}},{key:"write",value:function(key,value){var api=LocalStorage.getStorage();try{return api.setItem(key,storageDataConverter.stringify(value)),Promise.resolve(null)}catch(e){return Promise.resolve(e)}}},{key:"clear",value:function(){var api=LocalStorage.getStorage();try{return api.clear(),Promise.resolve(null)}catch(e){return Promise.resolve(e)}}},{key:"onUpdate",value:function(){return null}},{key:"init",value:function(){LocalStorage.getStorage()}},{key:"canIUse",value:function(){try{return getStorageApi().setItem("___test",String(Date.now())),!0}catch(e){return!1}}}],[{key:"getStorage",value:function(){return LocalStorage.storage||(LocalStorage.storage=getStorageApi()),LocalStorage.storage}}]),LocalStorage}(),_class68.storage=null,_temp12)};function getStorageApi(){return localStorage}factory.$inject=["storageDataConverter"],angular.module("app.utils").factory("localStorage",factory)}(),function(){var factory=function(storageDataConverter){var _class69,_temp13;return new(_temp13=_class69=function(){function ObjectStorage(){_classCallCheck(this,ObjectStorage)}return _createClass(ObjectStorage,[{key:"read",value:function(key){var data=ObjectStorage.getStorage()[key];try{data=JSON.parse(data)}catch(e){return data}return storageDataConverter.parse(data)}},{key:"write",value:function(key,value){var api=ObjectStorage.getStorage();try{return api[key]=storageDataConverter.stringify(value),Promise.resolve(null)}catch(e){return Promise.resolve(null)}}},{key:"clear",value:function(){ObjectStorage.storage=Object.create(null)}},{key:"onUpdate",value:function(){return null}},{key:"init",value:function(){ObjectStorage.getStorage()}}],[{key:"getStorage",value:function(){return ObjectStorage.storage||(ObjectStorage.storage=Object.create(null)),ObjectStorage.storage}}]),ObjectStorage}(),_class69.storage=null,_temp13)};factory.$inject=["storageDataConverter"],angular.module("app.utils").factory("objectStorage",factory)}(),angular.module("app.utils").factory("postmessageStorage",function(){var _class70,_temp14;return _temp14=_class70=function(){function PostMessageStorage(){_classCallCheck(this,PostMessageStorage)}return _createClass(PostMessageStorage,[{key:"read",value:function(key){var _this408=this;return this.readyPromise.then(function(){return JSON.parse(_this408._data[key])}).catch(function(){return _this408._data[key]})}},{key:"write",value:function(key,value){var api=PostMessageStorage._getStorage();return this.readyPromise.then(function(){return api.request("updateData",{key:value})})}},{key:"clear",value:function(){var api=PostMessageStorage._getStorage();return this.readyPromise.then(function(){return api.dispatchEvent("clearData")})}},{key:"onUpdate",value:function(cb){PostMessageStorage._getStorage().on("setData",cb)}},{key:"init",value:function(){var _this409=this,api=PostMessageStorage._getStorage();api.once("init",function(){return api.request("getData")}),this.readyPromise=new Promise(function(resolve){api.once("setData",function(data){_this409._data=data,resolve(data)})})}}],[{key:"_getStorage",value:function(){return PostMessageStorage.storage||(PostMessageStorage.storage=function(){var _require85=require("@waves/waves-browser-bus"),WindowAdapter=_require85.WindowAdapter,Bus=_require85.Bus,adapter=new WindowAdapter({win:window,origin:location.origin},{win:window.opener,origin:"*"});return new Bus(adapter)}()),PostMessageStorage.storage}}]),PostMessageStorage}(),_class70.storage=null,new _temp14}),function(){var factory=function(storageDataConverter){var _class71,_temp15;return new(_temp15=_class71=function(){function WebStorage(){_classCallCheck(this,WebStorage)}return _createClass(WebStorage,[{key:"read",value:function(key){return WebStorage._getStorage().readStorage(key).then(function(result){var data=result;try{data=JSON.parse(result)}catch(e){return data}return storageDataConverter.parse(data)})}},{key:"write",value:function(key,value){return WebStorage._getStorage().writeStorage(key,storageDataConverter.stringify(value))}},{key:"clear",value:function(){return WebStorage._getStorage().clearStorage()}},{key:"onUpdate",value:function(){return null}},{key:"init",value:function(){WebStorage._getStorage()}}],[{key:"_getStorage",value:function(){return WebStorage.storage||(WebStorage.storage=_getStorageApi()),WebStorage.storage}}]),WebStorage}(),_class71.storage=null,_temp15)};function _getStorageApi(){return WebStorage}factory.$inject=["storageDataConverter"],angular.module("app.utils").factory("webStorage",factory)}(),angular.module("app.utils").factory("storageDataConverter",function(){var tsUtils=require("ts-utils");return{stringify:function(data){switch(void 0===data?"undefined":_typeof(data)){case"string":return data;case"object":try{return function(data){try{var paths=tsUtils.getPaths(data);return JSON.stringify(paths.reduce(function(result,item){return result[String(item)]=tsUtils.get(data,item),result},Object.create(null)))}catch(e){return JSON.stringify(data)}}(data)}catch(e){return String(data)}default:return String(data)}},parse:function(data){if("object"!==(void 0===data?"undefined":_typeof(data)))return data;var result=null;return tsUtils.each(data,function(value,path){result=result||tsUtils.Path.parse(path).getItemData(0).container,tsUtils.set(result,path,value)}),result}}}),function(){var factory=function(objectStorage,localStorage,webStorage,postmessageStorage){return function(){return WavesApp.isDesktop()?webStorage:WavesApp.isMock?objectStorage:WavesApp.usePostMessageStorage?postmessageStorage:localStorage.canIUse()?localStorage:objectStorage}};factory.$inject=["objectStorage","localStorage","webStorage","postmessageStorage"],angular.module("app.utils").factory("storageSelect",factory)}(),function(){var controller=function(Base,$scope,user,$mdDialog){return new(function(){function AcceptNewTermsCtrl(){_classCallCheck(this,AcceptNewTermsCtrl);var _this410=_possibleConstructorReturn(this,(AcceptNewTermsCtrl.__proto__||Object.getPrototypeOf(AcceptNewTermsCtrl)).call(this,$scope));return _this410.readTermsAndConditions=!1,_this410.privacyPolicy=!1,_this410}return _inherits(AcceptNewTermsCtrl,Base),_createClass(AcceptNewTermsCtrl,[{key:"confirm",value:function(){$mdDialog.hide()}}]),AcceptNewTermsCtrl}())};controller.$inject=["Base","$scope","user","$mdDialog"],angular.module("app.utils").controller("AcceptNewTermsCtrl",controller)}(),function(){var ALIAS_PATTERN=/^[a-z0-9-@_.]*$/,SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,controller=function(Base,$scope,user,waves,notification,utils,balanceWatcher){var analytics=require("@waves/event-sender");return new(function(){function AccountInfoCtrl(){_classCallCheck(this,AccountInfoCtrl);var _this411=_possibleConstructorReturn(this,(AccountInfoCtrl.__proto__||Object.getPrototypeOf(AccountInfoCtrl)).call(this,$scope));_this411.address=user.address,_this411.createAliasStep=0,_this411.aliases=null,_this411.newAlias="",_this411.fee=null,_this411.noMoneyForFee=!0,_this411.invalid=!1,_this411.invalidMinLength=!1,_this411.invalidMaxLength=!1,_this411.invalidPattern=!1,_this411.transactionId="",_this411.signLoader=!1,_this411.signDeviceFail=!1,_this411.invalidExist=!1,_this411._balance=null,_this411.userType=user.userType,_this411.isLedger="ledger"===user.userType,_this411.isKeeper="wavesKeeper"===user.userType,_this411.errorCreateAliasMsg="",_this411.receive(balanceWatcher.change,_this411._updateBalance,_this411),_this411._updateBalance();var feePromise=waves.node.getFee({type:SIGN_TYPE.CREATE_ALIAS});return Promise.all([feePromise,balanceWatcher.ready]).then(function(_ref130){var fee=_slicedToArray(_ref130,1)[0];_this411.fee=fee,_this411.observe(["_balance","fee"],_this411._onChangeBalance),_this411._onChangeBalance(),$scope.$digest()}),_this411.aliases=waves.node.aliases.getAliasList(),_this411.observe(["newAlias"],_this411._validateNewAlias),analytics.send({name:"Account Show",target:"ui"}),_this411}var _ref132;return _inherits(AccountInfoCtrl,Base),_createClass(AccountInfoCtrl,[{key:"getSignableTx",value:function(){var timestamp=ds.utils.normalizeTime(Date.now()),data={alias:this.newAlias,fee:this.fee,timestamp:timestamp};return ds.signature.getSignatureApi().makeSignable({type:10,data:data})}},{key:"createAlias",value:function(){var _this412=this,signable=this.getSignableTx();return signable.getId().then(function(id){_this412.signDeviceFail=!1,_this412.transactionId=id,_this412.signLoader=user.userType&&"seed"!==user.userType,$scope.$digest()}).then(function(){return signable.getDataForApi()}).then(function(preparedTx){return _this412.wasDestroed?Promise.reject():(_this412.signLoader=!1,ds.broadcast(preparedTx).then(function(){analytics.send({name:"Account Alias Create Transaction Success",target:"ui"}),_this412.aliases.push(_this412.newAlias),_this412.newAlias="",_this412.createAliasStep=0,notification.info({ns:"app.utils",title:{literal:"modal.account.notifications.aliasCreated"}}),$scope.$digest()}))},function(){_this412.signDeviceFail=!0,_this412.signLoader=!1,$scope.$digest()}).catch(function(error){analytics.send({name:"Account Alias Create Transaction Error",target:"ui"}),_this412.errorCreateAliasMsg=utils.parseError(error)})}},{key:"onCopyAddress",value:function(){}},{key:"onCopyAlias",value:function(){}},{key:"reset",value:function(){this.newAlias=""}},{key:"_onChangeBalance",value:function(){this.noMoneyForFee=!this.fee||!this._balance||this._balance.getTokens().lt(this.fee.getTokens()),this.invalid=this.invalid||this.noMoneyForFee,$scope.$digest()}},{key:"_updateBalance",value:function(){var _this413=this;balanceWatcher.getBalanceByAssetId(WavesApp.defaultAssets.WAVES).then(function(money){_this413._balance=money,utils.safeApply($scope)})}},{key:"_validateNewAlias",value:(_ref132=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){var invalid;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(this.invalidMinLength=this.newAlias&&this.newAlias.length<4,this.invalidMaxLength=this.newAlias&&30<this.newAlias.length,this.invalidPattern=this.newAlias&&!ALIAS_PATTERN.test(this.newAlias),invalid=this.noMoneyForFee||this.invalidMinLength||this.invalidMaxLength||this.invalidPattern,this.newAlias&&!invalid)return this.pendingAlias=!0,this.invalid=!0,_context3.prev=7,_context3.next=10,ds.api.aliases.getAddressByAlias(this.newAlias);_context3.next=21;break;case 10:this.invalidExist=!0,_context3.next=16;break;case 13:_context3.prev=13,_context3.t0=_context3.catch(7),this.invalidExist=!1;case 16:this.pendingAlias=!1,this.invalid=invalid||this.invalidExist,$scope.$digest(),_context3.next=23;break;case 21:this.invalidExist=!1,this.invalid=invalid;case 23:case"end":return _context3.stop()}},_callee3,this,[[7,13]])})),function(){return _ref132.apply(this,arguments)})}]),AccountInfoCtrl}())};controller.$inject=["Base","$scope","user","waves","notification","utils","balanceWatcher"],angular.module("app.utils").controller("AccountInfoCtrl",controller)}(),function(){var controller=function(Base,$scope,user){return new(function(){function AddressInfoCtrl(){_classCallCheck(this,AddressInfoCtrl);var _this414=_possibleConstructorReturn(this,(AddressInfoCtrl.__proto__||Object.getPrototypeOf(AddressInfoCtrl)).call(this,$scope));return _this414.userName=user.name,_this414.userType=user.userType,_this414.address=user.address,_this414}return _inherits(AddressInfoCtrl,Base),AddressInfoCtrl}())};controller.$inject=["Base","$scope","user"],angular.module("app.utils").controller("AddressInfoCtrl",controller)}(),function(){var controller=function(Base,$scope){var analytics=require("@waves/event-sender");return new(function(){function AnyTxModalCtrl(_ref133){var tx=_ref133.tx,analyticsText=_ref133.analyticsText;_classCallCheck(this,AnyTxModalCtrl);var _this415=_possibleConstructorReturn(this,(AnyTxModalCtrl.__proto__||Object.getPrototypeOf(AnyTxModalCtrl)).call(this,$scope));return _this415.state=null,_this415.signable=null,_this415.step=0,_this415.analyticsText=analyticsText,_this415.state={tx:tx},_this415}return _inherits(AnyTxModalCtrl,Base),_createClass(AnyTxModalCtrl,[{key:"onFillTxForm",value:function(signable){this.analyticsText&&analytics.send({name:this.analyticsText,target:"ui"}),this.signable=signable,this.step++}},{key:"onConfirmBack",value:function(){this.step--}}]),AnyTxModalCtrl}())(this.locals)};controller.$inject=["Base","$scope"],angular.module("app.utils").controller("AnyTxModalCtrl",controller)}(),function(){var controller=function(Base,$scope,user,createPoll,utils,waves){var ds=require("data-service"),BigNumber=require("@waves/bignumber").BigNumber;return new(function(){function AssetInfoCtrl(asset){_classCallCheck(this,AssetInfoCtrl);var _this416=_possibleConstructorReturn(this,(AssetInfoCtrl.__proto__||Object.getPrototypeOf(AssetInfoCtrl)).call(this,$scope));_this416.asset=asset,_this416.wavesId=WavesApp.defaultAssets.WAVES,_this416.isDemo=!user.address,_this416.quantity=_this416.asset.quantity.div(new BigNumber(10).pow(_this416.asset.precision)).toFormat(),_this416.minFee=ds.utils.getTransferFeeList().find(function(money){return money.asset.id===_this416.asset.id});var assetList=user.getSetting("pinnedAssetIdList");_this416.assetList=assetList,_this416.pinned=-1!==assetList.indexOf(asset.id),_this416.circleChartData=null,_this416.totalBalance=null,_this416.transactions=[],_this416.transactionsPending=!0;var _utils$getDataFromOra4=utils.getDataFromOracles(_this416.asset.id),link=_utils$getDataFromOra4.link,email=_utils$getDataFromOra4.email,provider=_utils$getDataFromOra4.provider,description=_utils$getDataFromOra4.description;if(_this416.link=link,_this416.email=email,_this416.provider=provider,_this416.description=description||asset.description,_this416.withScam=null,_this416.spam=[],_this416.tab="info",_this416.chartOptions={items:{available:{color:"#66bf00",radius:66},leased:{color:"#ffebc0",radius:50},inOrders:{color:"#bacaf5",radius:58}},center:27,direction:!0,startFrom:Math.PI/2},!_this416.isDemo){createPoll(_this416,_this416._getCircleGraphData,_this416._setCircleGraphData,15e3),createPoll(_this416,AssetInfoCtrl._getTxList,_this416._setTxList,4e3,{isBalance:!0,$scope:$scope})}return _this416}return _inherits(AssetInfoCtrl,Base),_createClass(AssetInfoCtrl,[{key:"togglePin",value:function(){this.assetList=this.assetList.filter(tsUtils.notContains(this.asset.id)),this.pinned||(this.assetList=this.assetList.concat(this.asset.id)),this.pinned=!this.pinned,user.setSetting("pinnedAssetIdList",this.assetList)}},{key:"_setTxList",value:function(transactions){var _this417=this;this.transactionsPending=!1,this.transactions=transactions.filter(function(tx){var TYPES=waves.node.transactions.TYPES;switch(tx.typeName){case TYPES.SEND:case TYPES.RECEIVE:case TYPES.MASS_RECEIVE:case TYPES.MASS_SEND:case TYPES.CIRCULAR:return tx.amount.asset.id===_this417.asset.id;case TYPES.EXCHANGE_BUY:case TYPES.EXCHANGE_SELL:return tx.amount.asset.id===_this417.asset.id||tx.price.asset.id===_this417.asset.id;case TYPES.LEASE_IN:case TYPES.LEASE_OUT:case TYPES.CANCEL_LEASING:return _this417.asset.id===WavesApp.defaultAssets.WAVES;case TYPES.ISSUE:case TYPES.REISSUE:case TYPES.BURN:return(tx.assetId||tx.amount&&tx.amount.asset.id)===_this417.asset.id;case TYPES.SPONSORSHIP_START:case TYPES.SPONSORSHIP_STOP:return tx.assetId===_this417.asset.id;case TYPES.SPONSORSHIP_FEE:return _this417.asset.id===tx.feeAssetId;default:return!1}})}},{key:"_getCircleGraphData",value:function(){return waves.node.assets.balance(this.asset.id)}},{key:"_setCircleGraphData",value:function(_ref134){var available=_ref134.available,leasedOut=_ref134.leasedOut,inOrders=_ref134.inOrders;this.circleChartData=[{id:"available",value:available},{id:"leased",value:leasedOut},{id:"inOrders",value:inOrders}],this.totalBalance=available.add(leasedOut).add(inOrders),$scope.$digest()}}],[{key:"_getTxList",value:function(){return waves.node.transactions.list(100)}}]),AssetInfoCtrl}())(this.locals)};controller.$inject=["Base","$scope","user","createPoll","utils","waves"],angular.module("app.ui").controller("AssetInfoCtrl",controller)}(),function(){var controller=function(Base,$scope,createPoll,utils,waves,user,balanceWatcher){var entities=require("@waves/data-entities"),SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,analytics=require("@waves/event-sender"),ds=require("data-service");return new(function(){function TokenChangeModalCtrl(_ref135){var money=_ref135.money,txType=_ref135.txType;_classCallCheck(this,TokenChangeModalCtrl);var _this418=_possibleConstructorReturn(this,(TokenChangeModalCtrl.__proto__||Object.getPrototypeOf(TokenChangeModalCtrl)).call(this,$scope));_this418.step=0,_this418.noFee=!1,_this418.txType=txType,_this418.asset=money.asset,_this418.issue=money.asset.reissuable,_this418.maxCoinsCount=WavesApp.maxCoinsCount.sub(money.asset.quantity),_this418.balance=money,_this418.precision=money.asset.precision,_this418.input=null,_this418.quantity=new entities.Money(_this418.asset.quantity,_this418.asset),_this418._waves=null;var description=utils.getDataFromOracles(money.asset).description;_this418.description=description||money.asset.description;var _user$getThemeSetting3=user.getThemeSettings().TokenChangeModalCtrl,_TokenChangeModalCtrl=void 0===_user$getThemeSetting3?{}:_user$getThemeSetting3;_this418.options={grid:{x:!1,y:!1},margin:{top:0,right:0,left:0,bottom:0},series:[{dataset:"values",key:"rate",label:"Rate",color:_TokenChangeModalCtrl.seriesColor||"#5a81ea",type:["line","area"]}],axes:{x:{key:"timestamp",type:"date",ticks:4}}};var type="burn"===_this418.txType?SIGN_TYPE.BURN:SIGN_TYPE.REISSUE;return waves.node.getFee({type:type,assetId:money.asset.id}).then(function(fee){_this418.fee=fee,$scope.$digest()}),createPoll(_this418,_this418._getGraphData,"chartData",15e3),ds.api.assets.get(WavesApp.defaultAssets.WAVES).then(function(asset){_this418.receive(balanceWatcher.change,function(){return _this418._updateWavesBalance(asset)}),_this418._updateWavesBalance(asset)}),_this418.observe(["input","issue"],_this418._createTx),_this418.observe(["_waves","fee"],_this418._changeHasFee),_this418}return _inherits(TokenChangeModalCtrl,Base),_createClass(TokenChangeModalCtrl,[{key:"getSignable",value:function(){var name=this.txType.slice(0,1).toUpperCase()+this.txType.slice(1);return analytics.send({name:name+" Token Continue Click",target:"ui"}),this.signable}},{key:"next",value:function(){this.step++}},{key:"_updateWavesBalance",value:function(asset){this._waves=balanceWatcher.getBalanceByAsset(asset),utils.safeApply($scope)}},{key:"_changeHasFee",value:function(){if(!this._waves||!this.fee)return null;this.noFee=this._waves.lt(this.fee)}},{key:"_createTx",value:function(){var input=this.input,type="burn"===this.txType?SIGN_TYPE.BURN:SIGN_TYPE.REISSUE,quantityField="burn"===this.txType?"amount":"quantity";if(input){var _waves$node$transacti,tx=waves.node.transactions.createTransaction((_defineProperty(_waves$node$transacti={type:type,assetId:input.asset.id,description:input.asset.description,fee:this.fee},quantityField,input),_defineProperty(_waves$node$transacti,"precision",input.asset.precision),_defineProperty(_waves$node$transacti,"reissuable",this.issue),_waves$node$transacti));this.signable=ds.signature.getSignatureApi().makeSignable({type:type,data:tx})}else this.tx=null,this.signable=null}},{key:"_getGraphData",value:function(){var startDate=utils.moment().add().day(-100);return waves.utils.getRateHistory(this.asset.id,user.getSetting("baseAssetId"),startDate).then(function(values){return{values:values}})}}]),TokenChangeModalCtrl}())({money:this.money,txType:this.txType})};controller.$inject=["Base","$scope","createPoll","utils","waves","user","balanceWatcher"],angular.module("app.utils").controller("TokenChangeModalCtrl",controller)}(),function(){var controller=function(Base,$scope,userNameService,user,notification,$mdDialog){return new(function(){function ChangeNameCtrl(){_classCallCheck(this,ChangeNameCtrl);var _this419=_possibleConstructorReturn(this,(ChangeNameCtrl.__proto__||Object.getPrototypeOf(ChangeNameCtrl)).call(this,$scope));return _this419.isUniqueUserName=!0,$scope.user=user,$scope.MAX_USER_NAME_LENGTH=userNameService.MAX_USER_NAME_LENGTH,_this419.userName=userNameService.name,_this419.observe("userName",function(){userNameService.setName(_this419.userName),userNameService.isUniqueName().then(function(data){_this419.isUniqueUserName=data})}),_this419.observe("isUniqueUserName",function(){_this419.setUserName&&_this419.setUserName.userName.$setValidity("user-name-unique",_this419.isUniqueUserName)}),_this419}return _inherits(ChangeNameCtrl,Base),_createClass(ChangeNameCtrl,[{key:"saveUserName",value:function(){this.userName&&this.isUniqueUserName&&(userNameService.save(),notification.info({ns:"app.welcome",title:{literal:"welcome.nameSaved"}}),$mdDialog.cancel())}}]),ChangeNameCtrl}())};controller.$inject=["Base","$scope","userNameService","user","notification","$mdDialog"],angular.module("app.utils").controller("ChangeNameCtrl",controller)}(),function(){var controller=function(){return new function confirmDeleteUserCtrl(locals){_classCallCheck(this,confirmDeleteUserCtrl),this.hasBackup=locals.user.settings.hasBackup,this.isSeed=!locals.user.userType||"seed"===locals.user.userType,this.isLedger="ledger"===locals.user.userType,this.isKeeper="wavesKeeper"===locals.user.userType,this.isPrivateKey="privateKey"===locals.user.userType}(this.locals)};controller.$inject=[],angular.module("app.ui").controller("confirmDeleteUserCtrl",controller)}(),function(){var controller=function(Base,$scope,$mdDialog){return new(function(){function ConfirmOrderCtrl(_ref136){var locals=_ref136.locals;_classCallCheck(this,ConfirmOrderCtrl);var _this420=_possibleConstructorReturn(this,(ConfirmOrderCtrl.__proto__||Object.getPrototypeOf(ConfirmOrderCtrl)).call(this,$scope));return _this420.type=locals.orderType,_this420.orderLimit=locals.orderLimit,_this420.isSell="sell"===_this420.type,_this420}return _inherits(ConfirmOrderCtrl,Base),_createClass(ConfirmOrderCtrl,[{key:"agree",value:function(){$mdDialog.hide()}},{key:"close",value:function(){$mdDialog.cancel()}}]),ConfirmOrderCtrl}())(this)};controller.$inject=["Base","$scope","$mdDialog"],angular.module("app.ui").controller("ConfirmOrderCtrl",controller)}(),function(){var controller=function(Base,$scope,$mdDialog){var analytics=require("@waves/event-sender");return new(function(){function ConfirmTxCtrl(_ref137){var signable=_ref137.signable,analyticsText=_ref137.analyticsText;_classCallCheck(this,ConfirmTxCtrl);var _this421=_possibleConstructorReturn(this,(ConfirmTxCtrl.__proto__||Object.getPrototypeOf(ConfirmTxCtrl)).call(this,$scope));return _this421._resolveOnClose=!1,_this421.signable=signable,analyticsText&&analytics.send({name:analyticsText,target:"ui"}),_this421}return _inherits(ConfirmTxCtrl,Base),_createClass(ConfirmTxCtrl,[{key:"back",value:function(){$mdDialog.cancel()}},{key:"close",value:function(){this._resolveOnClose?$mdDialog.hide():$mdDialog.cancel()}},{key:"onSendTransaction",value:function(){this._resolveOnClose=!0}}]),ConfirmTxCtrl}())(this.locals)};controller.$inject=["Base","$scope","$mdDialog"],angular.module("app.utils").controller("ConfirmTxCtrl",controller)}(),function(){var LOCALIZATION_title={normal:"modal.gatewaySign.title",error:"modal.gatewaySign.error.title"},controller=function(Base,$scope,user,utils,$mdDialog){var isEmpty=function(value){return!value},tsApiValidator=require("ts-api-validator"),SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,ds=require("data-service"),schema=new tsApiValidator.Schema({type:tsApiValidator.ObjectPart,required:!0,content:{referrer:{type:tsApiValidator.StringPart,isEmpty:isEmpty,path:"r",required:!0},name:{type:tsApiValidator.StringPart,isEmpty:isEmpty,path:"n",required:!0},data:{type:tsApiValidator.StringPart,isEmpty:isEmpty,path:"d",required:!0},iconPath:{type:tsApiValidator.StringPart,path:"i",required:!1},successPath:{type:tsApiValidator.StringPart,path:"s",required:!1},debug:{type:tsApiValidator.BooleanPart,required:!1,defaultValue:!1}}});return new(function(){function GatewaySignCtrl(search){_classCallCheck(this,GatewaySignCtrl);var _this422=_possibleConstructorReturn(this,(GatewaySignCtrl.__proto__||Object.getPrototypeOf(GatewaySignCtrl)).call(this,$scope));return _this422.isSeed=!1,_this422.signAdapterError=!1,_this422.signPending=!1,_this422.isDesktop=WavesApp.isDesktop(),_this422.hasError=!1,_this422.imageSrc="",_this422.referrer="",_this422.name="",_this422.successUrl="",_this422.debug=!1,_this422.search=null,_this422.userType=null,_this422.titleLiteral=LOCALIZATION_title.normal,_this422.search=search,_this422.userType=user.userType,_this422.debug=!!search.debug,_this422.isSeed="seed"===user.userType,_this422.observe("hasError",function(value){_this422.titleLiteral=value?LOCALIZATION_title.error:LOCALIZATION_title.normal}),schema.parse(search).then(function(params){var referrer=(_this422.urlParams=params).referrer,name=params.name,iconPath=params.iconPath;return _this422.referrer=referrer,_this422.name=name,_this422._setImageUrl(referrer,iconPath),_this422.createUrl()}).catch(function(e){_this422._sendError(e.message||e),_this422.signPending=!1}).finally(function(){return $scope.$apply()}),_this422}return _inherits(GatewaySignCtrl,Base),_createClass(GatewaySignCtrl,[{key:"sign",value:function(){var _this423=this;this.createUrl().catch(function(e){_this423._sendError(e.message||e),_this423.signPending=!1}).finally(function(){return $scope.$apply()})}},{key:"signAuth",value:function(adapter,data){var _this424=this;this.signPending=!0;var signable=adapter.makeSignable(data);return signable.getId().then(function(id){_this424.id=id,$scope.$apply()}),signable.getSignature()}},{key:"createUrl",value:function(){var _this425=this,_urlParams=this.urlParams,referrer=_urlParams.referrer,data=_urlParams.data,successPath=_urlParams.successPath,host=GatewaySignCtrl._getDomain(referrer),signData={type:SIGN_TYPE.AUTH,data:{prefix:"WavesWalletAuthentication",host:host,data:data}},adapter=ds.signature.getSignatureApi(),sign=this.signAuth(adapter,signData);return Promise.all([sign,adapter.getPublicKey()]).then(function(_ref138){var _ref139=_slicedToArray(_ref138,2),search="?s="+_ref139[0]+"&p="+_ref139[1]+"&a="+user.address,url=referrer+"/"+(successPath||"")+search;_this425.signPending=!1,_this425.signAdapterError=!1,_this425.successUrl=GatewaySignCtrl._normalizeUrl(url),_this425.isSeed||(_this425.send(),$mdDialog.cancel())}).catch(function(e){if(_this425.signPending=!1,_this425.isSeed)return Promise.reject(e);_this425.signAdapterError=!0})}},{key:"send",value:function(){utils.redirect(this.successUrl)}},{key:"_setImageUrl",value:function(referrer,iconPath){var _this426=this;if(!iconPath)return null;var url=function(){try{return new URL(iconPath).href}catch(e){return GatewaySignCtrl._normalizeUrl(referrer+"/"+iconPath)}}();utils.loadImage(url).then(function(){_this426.imageSrc=url,$scope.$digest()})}},{key:"_sendError",value:function(message){this.hasError=!0,this.errorMessage=message}}],[{key:"_getDomain",value:function(referer){var url=new URL(referer);if("https:"!==url.protocol)throw new Error('Protocol must be "https:"');return url.hostname}},{key:"_normalizeUrl",value:function(urlString){var url=new URL(urlString);return url.protocol+"//"+(url.host+"/"+url.pathname+"/"+url.search+url.hash).replace(/\/+/g,"/").replace(/\/$/,"")}}]),GatewaySignCtrl}())(this.search)};controller.$inject=["Base","$scope","user","utils","$mdDialog"],angular.module("app.utils").controller("GatewaySignCtrl",controller)}(),function(){var controller=function(Base,user,$mdDialog){return new(function(){function DexScriptedPair(_ref140){var assets=_ref140.assets;_classCallCheck(this,DexScriptedPair);var _this427=_possibleConstructorReturn(this,(DexScriptedPair.__proto__||Object.getPrototypeOf(DexScriptedPair)).call(this));return _this427.assets=assets,_this427.tradeWithScriptAssets=!1,_this427}return _inherits(DexScriptedPair,Base),_createClass(DexScriptedPair,[{key:"confirm",value:function(){user.setSetting("tradeWithScriptAssets",this.tradeWithScriptAssets),$mdDialog.hide()}}]),DexScriptedPair}())(this.locals)};controller.$inject=["Base","user","$mdDialog"],angular.module("app.utils").controller("DexScriptedPairCtrl",controller)}(),function(){var controller=function(Base,$scope){return new(function(){function LockPairWarningCtrl(_ref141){var amountTicker=_ref141.amountTicker,priceTicker=_ref141.priceTicker;_classCallCheck(this,LockPairWarningCtrl);var _this428=_possibleConstructorReturn(this,(LockPairWarningCtrl.__proto__||Object.getPrototypeOf(LockPairWarningCtrl)).call(this,$scope));return _this428.amountTicker=amountTicker,_this428.priceTicker=priceTicker,_this428}return _inherits(LockPairWarningCtrl,Base),LockPairWarningCtrl}())(this)};controller.$inject=["Base","$scope","$mdDialog"],angular.module("app.ui").controller("LockPairWarningCtrl",controller)}(),function(){var controller=function(Base,$scope,utils,user,storage,$state,$mdDialog){var _require90=require("ramda"),find=_require90.find,propEq=_require90.propEq,uniqBy=_require90.uniqBy,filter=_require90.filter,pipe=_require90.pipe,prop=_require90.prop,isValidAddress=require("@waves/signature-adapter").isValidAddress;return new(function(){function ImportAccountsCtrl(){_classCallCheck(this,ImportAccountsCtrl);var _this429=_possibleConstructorReturn(this,(ImportAccountsCtrl.__proto__||Object.getPrototypeOf(ImportAccountsCtrl)).call(this,$scope));return _this429.pending=!0,_this429.userList=[],_this429.wasImportOld=!1,_this429.checkedHash=Object.create(null),_this429._myUserList=[],user.getFilteredUserList().catch(function(){return[]}).then(function(userList){return _this429._myUserList=userList,_this429.importFromOld()}),_this429}return _inherits(ImportAccountsCtrl,Base),_createClass(ImportAccountsCtrl,[{key:"hasSelected",get:function(){return 0<Object.values(this.checkedHash).filter(Boolean).length}}]),_createClass(ImportAccountsCtrl,[{key:"importAccounts",value:function(){var _this430=this,users=Object.keys(this.checkedHash).filter(function(address){return _this430.checkedHash[address]}).map(function(address){return find(propEq("address",address),_this430.userList)});return user.getFilteredUserList().then(function(list){return storage.save("userList",list.concat(users))}).then(function(){return storage.save("accountImportComplete",!0)}).then(function(){$mdDialog.hide(),$state.go("welcome")})}},{key:"importFromOld",value:function(){return this.wasImportOld=!0,this._import("https://client.wavesplatform.com")}},{key:"_import",value:function(origin){var _this431=this;return utils.importAccountByTab(origin,5e3).catch(function(){return[]}).then(function(list){_this431.pending=!1;var networkByte=WavesApp.network.code.charCodeAt(0),filteredList=list.filter(function(user){return isValidAddress(user.address,networkByte)});_this431._addAccountList(filteredList)})}},{key:"_addAccountList",value:function(list){var _this432=this,myUsersHash=utils.toHash(this._myUserList||[],"address");this.userList=pipe(uniqBy(prop("address")),filter(function(user){return!myUsersHash[user.address]}))(list).reverse(),this.userList.forEach(function(user){_this432.checkedHash[user.address]=!0}),$scope.$apply()}}]),ImportAccountsCtrl}())};controller.$inject=["Base","$scope","utils","user","storage","$state","$mdDialog"],angular.module("app.utils").controller("ImportAccountsCtrl",controller)}(),function(){var $=require("jquery"),controller=function(Base,$scope,$mdDialog){return new(function(){function LoginByDeviceCtrl(callback){_classCallCheck(this,LoginByDeviceCtrl);var _this433=_possibleConstructorReturn(this,(LoginByDeviceCtrl.__proto__||Object.getPrototypeOf(LoginByDeviceCtrl)).call(this,$scope));_this433.deferred=$.Deferred(),_this433.loading=!0,_this433.isLedger=!1,_this433.isKeeper=!1;var _callback=callback(),promise=_callback.promise,type=_callback.type;return _this433.isLedger="ledger"===type,_this433.isKeeper="wavesKeeper"===type,_this433.deferred.promise().then(function(){return _this433.onLoad()}).catch(function(error){return _this433.onError(error)}),promise.then(_this433.deferred.resolve,_this433.deferred.reject),_this433}return _inherits(LoginByDeviceCtrl,Base),_createClass(LoginByDeviceCtrl,[{key:"onClose",value:function(){this.deferred.reject()}},{key:"onLoad",value:function(){$mdDialog.hide(),$scope.$destroy()}},{key:"onError",value:function(e){$mdDialog.cancel(e),$scope.$destroy()}}]),LoginByDeviceCtrl}())(this.locals)};controller.$inject=["Base","$scope","$mdDialog"],angular.module("app.utils").controller("LoginByDeviceCtrl",controller)}(),function(){var controller=function(Base,$scope,user){return new(function(){function PairingWithMobileCtrl(){_classCallCheck(this,PairingWithMobileCtrl);var _this434=_possibleConstructorReturn(this,(PairingWithMobileCtrl.__proto__||Object.getPrototypeOf(PairingWithMobileCtrl)).call(this,$scope));return _this434.exportUrl="",_this434.userType=user.userType,_this434.canShowPairing=!0,ds.signature.getSignatureApi().getSeed().then(function(seed){_this434.exportUrl=seed}).catch(function(){_this434.canShowPairing=!1}).then(function(){$scope.$apply()}),_this434}return _inherits(PairingWithMobileCtrl,Base),PairingWithMobileCtrl}())};controller.$inject=["Base","$scope","user"],angular.module("app.utils").controller("PairingWithMobileCtrl",controller)}();var ds=require("data-service"),R=require("ramda");!function(){var HIDDEN_ASSETS=WavesApp.ALWAYS_PINNED_ASSETS,controller=function(Base,$scope,waves,PromiseControl,$mdDialog,user){var analytics=require("@waves/event-sender");return new(function(){function PinAssetCtrl(){_classCallCheck(this,PinAssetCtrl);var _this435=_possibleConstructorReturn(this,(PinAssetCtrl.__proto__||Object.getPrototypeOf(PinAssetCtrl)).call(this,$scope));return _this435.search="",_this435.withScam=null,_this435.dontShowSpam=null,_this435.pinnedAssetNewList=[],_this435.pinnedAssetIdList=[],_this435.spam=[],_this435.selectedHash={},_this435.syncSettings({pinnedAssetIdList:"pinnedAssetIdList",spam:"wallet.portfolio.spam",withScam:"withScam",dontShowSpam:"dontShowSpam"}),_this435.observe("search",_this435._fillList),_this435.loadPromise=_this435._getAvilableAssets(),_this435._fillList(),$scope.$watch("$ctrl.pinnedAssetNewList",function(){return _this435.checkChecked()},!0),_this435}var _ref143,_ref142;return _inherits(PinAssetCtrl,Base),_createClass(PinAssetCtrl,[{key:"checkChecked",value:function(){var _this436=this;this.selected=0,this.pinnedAssetNewList.forEach(function(asset){asset.pinned?_this436.selectedHash[asset.id]=!0:delete _this436.selectedHash[asset.id]}),this.selected=Object.keys(this.selectedHash).length}},{key:"onSubmit",value:function(){var _this437=this,selectedAssets=Object.keys(this.selectedHash);analytics.send({name:"Wallet Assets Pin",params:{Currency:selectedAssets},target:"ui"}),this.pinnedAssetIdList=R.uniq([].concat(_toConsumableArray(this.pinnedAssetIdList),_toConsumableArray(selectedAssets))),this.spam=this.spam.filter(function(spamId){return!_this437.pinnedAssetIdList.includes(spamId)}),$mdDialog.hide({selected:this.selected.length})}},{key:"_isSpam",value:function(asset){return(this.spam||[]).includes(asset.id)}},{key:"_getAvilableAssets",value:(_ref142=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){var myAssets,defaultAssets,_this438=this;return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,ds.dataManager.getBalances();case 2:return myAssets=_context4.sent,_context4.next=5,waves.node.assets.getAsset(Object.values(WavesApp.defaultAssets));case 5:return defaultAssets=_context4.sent,_context4.abrupt("return",R.uniqBy(R.prop("id"),[].concat(_toConsumableArray(defaultAssets),_toConsumableArray(myAssets.map(function(x){return x.asset})))).map(function(asset){var pinned=_this438.pinnedAssetIdList.includes(asset.id);return _extends({},asset,{pinned:pinned})}));case 7:case"end":return _context4.stop()}},_callee4,this)})),function(){return _ref142.apply(this,arguments)})},{key:"_fillList",value:(_ref143=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){var assetsList,searchList;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.t0=this,_context5.next=3,this.loadPromise;case 3:return _context5.t1=_context5.sent,assetsList=_context5.t0._filterAndSort.call(_context5.t0,_context5.t1),_context5.t2=this,_context5.next=8,this._searchByApi();case 8:_context5.t3=_context5.sent,searchList=_context5.t2._filterAndSort.call(_context5.t2,_context5.t3),this.pinnedAssetNewList=R.uniqBy(R.prop("id"),[].concat(_toConsumableArray(assetsList),_toConsumableArray(searchList))),$scope.$digest();case 12:case"end":return _context5.stop()}},_callee5,this)})),function(){return _ref143.apply(this,arguments)})},{key:"_filterAndSort",value:function(assetsList){var filteredList=[],_iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=assetsList[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var asset=_step4.value;this.pinnedAssetIdList.includes(asset.id)||HIDDEN_ASSETS.includes(asset.id)||(this.withScam||!PinAssetCtrl._isScam(asset)&&!this._isSpam(asset))&&this._isInSearch(asset)&&filteredList.push(asset)}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4.return&&_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}return filteredList}},{key:"_searchByApi",value:function(){return this.search&&this.search.trim().length?(this._searchPromise&&this._searchPromise.drop(),this._searchPromise=new PromiseControl(waves.node.assets.search(this.search.trim())),this._searchPromise.then(function(list){return list},function(){return[]})):[]}},{key:"_isInSearch",value:function(asset){var search=this.search.toUpperCase().trim();return!search||!this.search.length||(asset.id+" "+asset.name+" "+asset.ticker).toUpperCase().includes(search)}}],[{key:"_isScam",value:function(asset){return(user.scam||{})[asset.id]}}]),PinAssetCtrl}())};controller.$inject=["Base","$scope","waves","PromiseControl","$mdDialog","user"],angular.module("app.utils").controller("PinAssetCtrl",controller)}(),function(){var controller=function(Base,$scope,gatewayService,user,waves){return new(function(){function ReceiveCtrl(_ref144){var asset=_ref144.asset;_classCallCheck(this,ReceiveCtrl);var _this439=_possibleConstructorReturn(this,(ReceiveCtrl.__proto__||Object.getPrototypeOf(ReceiveCtrl)).call(this,$scope));return _this439.activeTab="",_this439.tabs={cryptocurrency:!1,invoice:!1,card:!1,bank:!1},_this439.asset=asset,_this439.asset?(_this439.isSingleAsset=!0,_this439.initForSingleAsset()):(_this439.isSingleAsset=!1,_this439.initForAllAssets()),_this439}return _inherits(ReceiveCtrl,Base),_createClass(ReceiveCtrl,[{key:"initForSingleAsset",value:function(){gatewayService.hasSupportOf(this.asset,"deposit")&&this.enableTab("cryptocurrency"),this.enableTab("invoice"),gatewayService.hasSupportOf(this.asset,"card")&&(this.purchasablesByCards=[this.asset],this.enableTab("card")),gatewayService.hasSupportOf(this.asset,"sepa")&&this.enableTab("bank")}},{key:"initForAllAssets",value:function(){var _this440=this,cryptocurrenciesRequests=this.getExtendedAssets(gatewayService.getCryptocurrencies()),cryptocurrenciesRequest=Promise.all(cryptocurrenciesRequests).then(function(results){_this440.cryptocurrencies=results}),invoicesRequest=waves.node.assets.userBalances().then(function(results){_this440.invoicables=results.filter(function(balance){return!user.scam[balance.asset.id]}).map(function(balance){return balance.asset})}),cardsRequests=this.getExtendedAssets(gatewayService.getPurchasableWithCards()),cardsRequest=Promise.all(cardsRequests).then(function(results){_this440.purchasablesByCards=results}),fiatsRequests=this.getExtendedAssets(gatewayService.getFiats()),fiatsRequest=Promise.all(fiatsRequests).then(function(results){_this440.fiats=results});Promise.all([cryptocurrenciesRequest,invoicesRequest,cardsRequest,fiatsRequest]).then(function(){_this440.updateAssetBy(_this440.cryptocurrencies[0].id),_this440.enableTab("cryptocurrency"),_this440.enableTab("invoice"),_this440.enableTab("card"),_this440.enableTab("bank"),_this440.initForSingleAsset()})}},{key:"getExtendedAssets",value:function(assetsIds){return Object.keys(assetsIds).map(waves.node.assets.getAsset)}},{key:"updateAssetBy",value:function(id){this.asset=this.cryptocurrencies.find(function(cryptocurrency){return cryptocurrency.id===id})||this.invoicables.find(function(invoicable){return invoicable.id===id})||this.purchasablesByCards.find(function(purchasableByCards){return purchasableByCards.id===id})||this.fiats.find(function(fiat){return fiat.id===id})}},{key:"enableTab",value:function(name){this.tabs[name]=!0}}]),ReceiveCtrl}())(this.locals)};controller.$inject=["Base","$scope","gatewayService","user","waves"],angular.module("app.utils").controller("ReceiveCtrl",controller)}(),function(){var controller=function(Base,$scope){return new(function(){function ScriptModalCtrl(){_classCallCheck(this,ScriptModalCtrl);var _this441=_possibleConstructorReturn(this,(ScriptModalCtrl.__proto__||Object.getPrototypeOf(ScriptModalCtrl)).call(this,$scope));return _this441.tx=null,_this441.state=Object.create(null),_this441.step=0,_this441.observe("activeTab",_this441._onChangeActiveTab),_this441._onChangeActiveTab(),_this441}return _inherits(ScriptModalCtrl,Base),_createClass(ScriptModalCtrl,[{key:"activeState",get:function(){return this.state[this.activeTab]}}]),_createClass(ScriptModalCtrl,[{key:"onClickBack",value:function(){this.step--}},{key:"nextStep",value:function(signable){this.signable=signable,this.step++}},{key:"_onChangeActiveTab",value:function(){var tab=this.activeTab;this.state[tab]||(this.state[tab]=Object.create(null))}}]),ScriptModalCtrl}())};controller.$inject=["Base","$scope"],angular.module("app.utils").controller("ScriptModalCtrl",controller)}(),function(){var analytics=require("@waves/event-sender"),controller=function(Base,$scope,seedService,user){return new(function(){function SeedBackupModalsCtrl(seed){_classCallCheck(this,SeedBackupModalsCtrl);var _this442=_possibleConstructorReturn(this,(SeedBackupModalsCtrl.__proto__||Object.getPrototypeOf(SeedBackupModalsCtrl)).call(this,$scope));return _this442.titleLiteral="",_this442.step=null,_this442.seed=seed,_this442.seedConfirmWasFilled=!1,_this442.seedIsValid=!1,_this442.observe("step",_this442._onChangeStep),_this442.step=0,_this442.observe("step",function(){2===_this442.step&&analytics.send({name:"Create Save Phrase Success Show",target:"ui"})}),_this442}return _inherits(SeedBackupModalsCtrl,Base),_createClass(SeedBackupModalsCtrl,[{key:"onSeedConfirmFulfilled",value:function(isValid){this.seedIsValid=isValid,this.seedConfirmWasFilled=!0}},{key:"seedOnTouch",value:function(){this.seedConfirmWasFilled=!1}},{key:"clear",value:function(){this.seedIsValid=!1,this.seedConfirmWasFilled=!1,seedService.clear.dispatch()}},{key:"_onChangeStep",value:function(){this.seedIsValid=!1,this.seedConfirmWasFilled=!1,this.titleLiteral="title_"+this.step,2===this.step&&user.setSetting("hasBackup",!0)}}]),SeedBackupModalsCtrl}())(this.seed)};controller.$inject=["Base","$scope","seedService","user"],angular.module("app.utils").controller("SeedBackupModalsCtrl",controller)}(),function(){var SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,controller=function($scope,waves,Base,utils,user,$mdDialog,balanceWatcher){return new(function(){function AssetSendCtrl(options){_classCallCheck(this,AssetSendCtrl);var _this443=_possibleConstructorReturn(this,(AssetSendCtrl.__proto__||Object.getPrototypeOf(AssetSendCtrl)).call(this,$scope));_this443.headerPath="modules/utils/modals/sendAsset/send-header.html",_this443.defaultAssets=WavesApp.defaultAssets,_this443.choosableMoneyList=[],_this443.step=0,_this443.canChooseAsset=!options.assetId||options.canChooseAsset,_this443.moneyHash=null,_this443.state={assetId:options.assetId||WavesApp.defaultAssets.WAVES,mirrorId:user.getSetting("baseAssetId"),outerSendMode:!1,gatewayDetails:null,moneyHash:null,singleSend:utils.liteObject({type:SIGN_TYPE.TRANSFER}),massSend:utils.liteObject({type:SIGN_TYPE.MASS_TRANSFER}),toBankMode:!1},_this443.receive(balanceWatcher.change,_this443._updateBalanceList,_this443),_this443._updateBalanceList(),_this443.txInfo=Object.create(null),_this443.tab=options.mode,_this443.strict=options.amount&&options.recipient&&options.strict,_this443.errorOccured=!1;try{_this443.referrer=new URL(options.referrer).href}catch(e){_this443.referrer=null}if(options.mode||options.recipient||options.amount){_this443.tab="singleSend",_this443.state.singleSend.recipient=options.recipient,_this443.state.singleSend.attachment=options.attachment;var attachment=_this443.outerSendMode&&_this443.gatewayDetails?_this443.gatewayDetails.attachment:options.attachment,attachmentString=attachment?attachment.toString():"",bytesAttachment=utils.stringToBytes(attachmentString);Promise.all([ds.moneyFromTokens(options.amount||"0",_this443.state.assetId),waves.node.getFee({type:SIGN_TYPE.TRANSFER})]).then(function(_ref145){var _ref146=_slicedToArray(_ref145,2),money=_ref146[0],fee=_ref146[1];_this443.state.singleSend.amount=money,_this443.state.singleSend.fee=fee;var tx=waves.node.transactions.createTransaction(_extends({},_this443.state.singleSend,{attachment:bytesAttachment})),signable=ds.signature.getSignatureApi().makeSignable({type:SIGN_TYPE.TRANSFER,data:tx});_this443.strict&&_this443.nextStep(signable)}).catch(function(){_this443.errorOccured=!0,$scope.$digest()})}else _this443.syncSettings({tab:"send.defaultTab"});return _this443.receive(utils.observe(_this443.state,"moneyHash"),_this443._onChangeMoneyHash,_this443),_this443}return _inherits(AssetSendCtrl,Base),_createClass(AssetSendCtrl,[{key:"balance",get:function(){return this.state.moneyHash&&this.state.moneyHash[this.state.assetId]}},{key:"outerSendMode",get:function(){return this.state.outerSendMode}},{key:"gatewayDetails",get:function(){return this.state.gatewayDetails}}]),_createClass(AssetSendCtrl,[{key:"back",value:function(){this.step--}},{key:"nextStep",value:function(signable){this.signable=signable,this.step++}},{key:"onTxSent",value:function(id){this.referrer&&(utils.redirect(this.referrer+"?txId="+id),$mdDialog.hide())}},{key:"_onChangeMoneyHash",value:function(){var hash=this.state.moneyHash,list=Object.values(hash).filter(function(money){return!money.getTokens().eq(0)&&AssetSendCtrl._isNotScam(money)});list.length?(!utils.toHash(list,"asset.id")[this.state.assetId]&&this.canChooseAsset&&(this.state.assetId=list[0].asset.id),this.choosableMoneyList=list):this.choosableMoneyList=[this.state.moneyHash[this.state.assetId]]}},{key:"_updateBalanceList",value:function(){var _this444=this,hash=balanceWatcher.getBalance();[this.state.assetId,this.state.mirrorId].reduce(function(acc,assetId){return acc.then(function(hash){return hash[assetId]?Promise.resolve(hash):balanceWatcher.getBalanceByAssetId(assetId).then(function(money){return hash[assetId]=money,hash})})},Promise.resolve(hash)).then(function(hash){_this444.state.moneyHash=hash,utils.safeApply($scope)})}}],[{key:"_isNotScam",value:function(item){return!user.scam[item.asset.id]}}]),AssetSendCtrl}())(this.locals)};controller.$inject=["$scope","waves","Base","utils","user","$mdDialog","balanceWatcher"],angular.module("app.utils").controller("AssetSendCtrl",controller)}(),function(){var controller=function(Base,$scope){return new(function(){function SetAssetScriptModalCtrl(assetId){_classCallCheck(this,SetAssetScriptModalCtrl);var _this445=_possibleConstructorReturn(this,(SetAssetScriptModalCtrl.__proto__||Object.getPrototypeOf(SetAssetScriptModalCtrl)).call(this,$scope));return _this445.step=0,_this445.state={assetId:assetId},_this445}return _inherits(SetAssetScriptModalCtrl,Base),_createClass(SetAssetScriptModalCtrl,[{key:"onFillTxForm",value:function(signable){this.signable=signable;var _signable$getTxData3=this.signable.getTxData(),assetId=_signable$getTxData3.assetId,script=_signable$getTxData3.script;this.state={assetId:assetId,script:script},this.step++}},{key:"onConfirmBack",value:function(){this.step--}}]),SetAssetScriptModalCtrl}())(this.locals)};controller.$inject=["Base","$scope"],angular.module("app.utils").controller("SetAssetScriptModalCtrl",controller)}(),function(){var ds=require("data-service"),path=require("ramda").path,analytics=require("@waves/event-sender"),controller=function(Base,$scope,waves,user,createPoll,$templateRequest,utils,storage,modalManager){return new(function(){function SettingsCtrl(){_classCallCheck(this,SettingsCtrl);var _this446=_possibleConstructorReturn(this,(SettingsCtrl.__proto__||Object.getPrototypeOf(SettingsCtrl)).call(this,$scope));_this446.oracleWaves="",_this446.tab="general",_this446.address=user.address,_this446.publicKey=user.publicKey,_this446.shownSeed=!1,_this446.shownKey=!1,_this446.node="",_this446.matcher="",_this446.api="",_this446.scamListUrl="",_this446.tokensNameListUrl="",_this446.dontShowSpam=!0,_this446.theme=user.getSetting("theme"),_this446.candle=user.getSetting("candle"),_this446.templatePromise=$templateRequest("modules/utils/modals/settings/loader.html"),_this446.openClientMode=null,_this446.logoutAfterMin=null,_this446.appName=WavesApp.name,_this446.appVersion=WavesApp.version,_this446.supportLink=WavesApp.network.support,_this446.termsAndConditionsLink=WavesApp.network.termsAndConditions,_this446.privacyPolicy=WavesApp.network.privacyPolicy,_this446.supportLinkName=WavesApp.network.support.replace(/^https?:\/\//,""),_this446.blockHeight=0,_this446.assetsOracleTmp="",_this446.oracleWavesData=path(["oracle"],ds.dataManager.getOracleData("oracleWaves")),_this446.oracleError=!1,_this446.oraclePending=!1,_this446.oracleSuccess=!1,analytics.send({name:"Settings General Show",target:"ui"}),_this446.observe("tab",function(){var tabName=_this446.tab.slice(0,1).toUpperCase()+_this446.tab.slice(1);analytics.send({name:"Settings "+tabName+" Show",target:"ui"})}),_this446.isScript=user.hasScript(),_this446.syncSettings({node:"network.node",matcher:"network.matcher",api:"network.api",logoutAfterMin:"logoutAfterMin",scamListUrl:"scamListUrl",tokensNameListUrl:"tokensNameListUrl",dontShowSpam:"dontShowSpam",theme:"theme",candle:"candle",oracleWaves:"oracleWaves"}),_this446.assetsOracleTmp=_this446.oracleWaves,storage.load("openClientMode").then(function(mode){_this446.openClientMode=mode}),_this446.observe("theme",function(){_this446.templatePromise.then(function(template){template=template.replace("{{bgColor}}",user.getThemeSettings().bgColor),_this446.showLoader(template),utils.wait(1e3).then(function(){return user.changeTheme(_this446.theme)})},function(){return user.changeTheme(_this446.theme)})}),_this446.observe("oracleWaves",function(){ds.config.set("oracleWaves",_this446.oracleWaves),_this446.assetsOracleTmp=_this446.oracleWaves}),_this446.observe("assetsOracleTmp",function(){var address=_this446.assetsOracleTmp;_this446.oraclePending=!0,ds.api.data.getOracleData(address).then(function(data){data.oracle&&(_this446.oracleWavesData=data.oracle,ds.config.set("oracleWaves",address),_this446.oracleWaves=_this446.assetsOracleTmp,_this446.oracleError=!1,_this446.oracleSuccess=!0,setTimeout(function(){_this446.oracleSuccess=!1,$scope.$apply()},1500))}).catch(function(){_this446.oracleError=!0}).then(function(){_this446.oraclePending=!1,$scope.$apply()})}),_this446.observe("dontShowSpam",function(){var dontShowSpam=_this446.dontShowSpam;user.setSetting("dontShowSpam",dontShowSpam)}),_this446.observe("scamListUrl",function(){ds.config.setConfig({scamListUrl:_this446.scamListUrl}),waves.node.assets.stopScam()}),_this446.observe("tokensNameListUrl",function(){ds.config.setConfig({tokensNameListUrl:_this446.tokensNameListUrl}),waves.node.assets.tokensNameList()}),_this446.observe(["node","matcher","api"],function(){ds.config.setConfig({node:_this446.node,matcher:_this446.matcher,api:_this446.api})}),_this446.observe("shownSeed",function(){}),_this446.observe("shownKey",function(){}),createPoll(_this446,waves.node.height,function(height){_this446.blockHeight=height,$scope.$digest()},5e3);var catchProcessor=function(method){try{return method().catch(function(){return null})}catch(e){return Promise.resolve(null)}};return Promise.all([catchProcessor(function(){return ds.signature.getSignatureApi().getSeed()}),catchProcessor(function(){return ds.signature.getSignatureApi().getPrivateKey()}),ds.signature.getSignatureApi().getPublicKey()]).then(function(_ref147){var _ref148=_slicedToArray(_ref147,3),seed=_ref148[0],privateKey=_ref148[1],publicKey=_ref148[2];_this446.phrase=seed,_this446.privateKey=privateKey,_this446.publicKey=publicKey,$scope.$digest()}),_this446}return _inherits(SettingsCtrl,Base),_createClass(SettingsCtrl,[{key:"openLinkViaWeb",get:function(){return"web"===this.openClientMode},set:function(value){this.openClientMode=value?"web":null,storage.save("openClientMode",this.openClientMode)}},{key:"advancedMode",get:function(){return user.getSetting("advancedMode")},set:function(mode){analytics.send({name:"Settings Advanced Features "+(mode?"On":"Off"),target:"ui"}),user.setSetting("advancedMode",mode)}}]),_createClass(SettingsCtrl,[{key:"onChangeLanguage",value:function(language){user.setSetting("lng",language)}},{key:"setNetworkDefault",value:function(){this.node=WavesApp.network.node,this.matcher=WavesApp.network.matcher,this.dontShowSpam=!0,this.scamListUrl=WavesApp.network.scamListUrl,this.tokensNameListUrl=WavesApp.network.tokensNameListUrl,this.oracleWaves=WavesApp.oracles.waves,this.api=WavesApp.network.api}},{key:"showPairingWithMobile",value:function(){return modalManager.showPairingWithMobile()}},{key:"showLoader",value:function(template){var loaderEl=document.createElement("div");loaderEl.innerHTML=template,document.body.appendChild(loaderEl),setTimeout(function(){document.body.removeChild(loaderEl)},4100)}},{key:"showScriptModal",value:function(){modalManager.showScriptModal()}}]),SettingsCtrl}())};controller.$inject=["Base","$scope","waves","user","createPoll","$templateRequest","utils","storage","modalManager"],angular.module("app.utils").controller("SettingsCtrl",controller)}(),function(){var SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,$=require("jquery"),controller=function(Base,$scope,$mdDialog,user){return new(function(){function SignByDeviceCtrl(signable){_classCallCheck(this,SignByDeviceCtrl);var _this447=_possibleConstructorReturn(this,(SignByDeviceCtrl.__proto__||Object.getPrototypeOf(SignByDeviceCtrl)).call(this,$scope));return _this447.deferred=$.Deferred(),_this447.mode="",_this447.loading=!0,_this447.isLedger=!1,_this447.isKeeper=!1,_this447.txData=null,_this447.mode=SignByDeviceCtrl.getSignMode(signable.type),signable.getId().then(function(id){_this447.txId=id,$scope.$apply()}),_this447.txData=signable.getTxData(),_this447.txData.price&&(_this447.total=_this447.txData.price.cloneWithTokens(_this447.txData.price.getTokens().mul(_this447.txData.amount.getTokens()))),_this447.isLedger="ledger"===user.userType,_this447.isKeeper="wavesKeeper"===user.userType,_this447.deferred.promise().then(function(signable){_this447.onLoad(signable)}).catch(function(error){_this447.onError(error)}),signable.getSignature().then(function(){_this447.deferred.resolve(signable)}).catch(function(error){_this447.deferred.reject(error)}),_this447}return _inherits(SignByDeviceCtrl,Base),_createClass(SignByDeviceCtrl,[{key:"onClose",value:function(){this.deferred.reject()}},{key:"onLoad",value:function(signable){$mdDialog.hide(signable),$scope.$destroy()}},{key:"onError",value:function(error){$mdDialog.cancel(error),$scope.$destroy()}}],[{key:"getSignMode",value:function(type){switch(type){case SIGN_TYPE.CREATE_ORDER:return"create-order";case SIGN_TYPE.CANCEL_ORDER:return"cancel-order";case SIGN_TYPE.MATCHER_ORDERS:return"sign-matcher";default:throw new Error("Wrong sign type!")}}}]),SignByDeviceCtrl}())(this.signable)};controller.$inject=["Base","$scope","$mdDialog","user"],angular.module("app.ui").controller("SignByDeviceCtrl",controller)}(),function(){var controller=function(Base,$scope,waves,balanceWatcher,utils){var isEmpty=require("ts-utils").isEmpty,SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,Money=require("@waves/data-entities").Money,ds=require("data-service"),analytics=require("@waves/event-sender");return new(function(){function SponsoredModalCtrl(_ref149){var asset=_ref149.asset,isCreateSponsored=_ref149.isCreateSponsored;_classCallCheck(this,SponsoredModalCtrl);var _this448=_possibleConstructorReturn(this,(SponsoredModalCtrl.__proto__||Object.getPrototypeOf(SponsoredModalCtrl)).call(this,$scope));_this448.step=0,_this448.isCreateSponsored=null,_this448.assetId=null,_this448.fee=null,_this448.minSponsoredAssetFee=null,_this448.assetBalance=null,_this448.wavesBalance=null,_this448._tx=null,_this448.asset=null,_this448.assetId=asset.id,_this448.asset=asset,_this448.isCreateSponsored=isCreateSponsored;var _utils$getDataFromOra6=utils.getDataFromOracles(asset.id),isVerified=_utils$getDataFromOra6.isVerified,isGateway=_utils$getDataFromOra6.isGateway,isTokenomica=_utils$getDataFromOra6.isTokenomica,ticker=_utils$getDataFromOra6.ticker,description=_utils$getDataFromOra6.description;if(_this448.isVerified=isVerified,_this448.isGateway=isGateway,_this448.isTokenomica=isTokenomica,_this448.ticker=ticker||asset.ticker,_this448.description=description||asset.description,isEmpty(_this448.assetId))throw new Error("Wrong modal params!");return _this448.receive(balanceWatcher.change,_this448._updateBalances,_this448),_this448._updateBalances(),_this448.observe(["fee","minSponsoredAssetFee"],_this448._createTx),_this448._updateFee(),_this448}return _inherits(SponsoredModalCtrl,Base),_createClass(SponsoredModalCtrl,[{key:"getSignable",value:function(){return this.signable}},{key:"onConfirm",value:function(){analytics.send({name:"Enable Sponsorship Continue Click",target:"ui"}),this.step++}},{key:"onBack",value:function(){this.step--}},{key:"getSponsoredTx",value:function(){return this._tx}},{key:"_createTx",value:function(){if(!this.fee||!this.minSponsoredAssetFee)return this.signable=null;var fee=this.fee,minSponsoredAssetFee=this.minSponsoredAssetFee,type=SIGN_TYPE.SPONSORSHIP,tx=waves.node.transactions.createTransaction({fee:fee,type:type,minSponsoredAssetFee:minSponsoredAssetFee});this.signable=ds.signature.getSignatureApi().makeSignable({type:type,data:tx})}},{key:"_updateBalances",value:function(){var _this449=this;Promise.all([balanceWatcher.getBalanceByAssetId(WavesApp.defaultAssets.WAVES),balanceWatcher.getBalanceByAssetId(this.assetId)]).then(function(_ref150){var _ref151=_slicedToArray(_ref150,2),waves=_ref151[0],asset=_ref151[1];_this449.wavesBalance=waves,_this449.assetBalance=asset,_this449._updateAvailableFee(),utils.safeApply($scope)})}},{key:"_updateFee",value:function(){var _this450=this;return this._getTxForFee().then(function(tx){return waves.node.getFee(tx)}).then(function(fee){_this450.fee=fee,_this450._updateAvailableFee()})}},{key:"_updateAvailableFee",value:function(){this.fee&&this.wavesBalance&&(this.canSendTransaction=this.wavesBalance.gte(this.fee))}},{key:"_getTxForFee",value:function(){return Promise.resolve({type:SIGN_TYPE.SPONSORSHIP,minSponsoredAssetFee:new Money(0,this.asset)})}}]),SponsoredModalCtrl}())(this.locals)};controller.$inject=["Base","$scope","waves","balanceWatcher","utils"],angular.module("app.utils").controller("SponsoredModalCtrl",controller)}(),function(){var controller=function(Base,$scope){return new(function(){function SignDeviceErrorCtrl(_ref152){var locals=_ref152.locals;_classCallCheck(this,SignDeviceErrorCtrl);var _this451=_possibleConstructorReturn(this,(SignDeviceErrorCtrl.__proto__||Object.getPrototypeOf(SignDeviceErrorCtrl)).call(this,$scope));return _this451.mode=locals.error,_this451.userType=locals.userType,_this451.userAddress=locals.address,_this451.isLedger="ledger"===_this451.userType,_this451.isKeeper="wavesKeeper"===_this451.userType,_this451.isPrivateKey="privateKey"===_this451.userType,_this451.loading=!0,_this451}return _inherits(SignDeviceErrorCtrl,Base),SignDeviceErrorCtrl}())(this)};controller.$inject=["Base","$scope","$mdDialog"],angular.module("app.ui").controller("SignDeviceError",controller)}(),function(){var controller=function(Base,$scope,user,utils,waves,i18n){var SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,ds=require("data-service"),analytics=require("@waves/event-sender");return new(function(){function StartLeasingCtrl(){_classCallCheck(this,StartLeasingCtrl);var _this452=_possibleConstructorReturn(this,(StartLeasingCtrl.__proto__||Object.getPrototypeOf(StartLeasingCtrl)).call(this,$scope));return _this452.step=0,_this452.title=i18n.translate("modal.startLease.title","app.utils"),_this452.assetId=WavesApp.defaultAssets.WAVES,_this452.recipient="",_this452.amount=null,_this452.nodeListLink=WavesApp.network.nodeList,waves.node.getFee({type:SIGN_TYPE.LEASE}).then(function(money){_this452.fee=money}),waves.node.assets.balance(_this452.assetId).then(function(balance){_this452.balance=balance.available}),_this452}return _inherits(StartLeasingCtrl,Base),_createClass(StartLeasingCtrl,[{key:"back",value:function(){this.step--}},{key:"sign",value:function(){analytics.send({name:"Leasing Popup Start Click",target:"ui"});var tx=waves.node.transactions.createTransaction({recipient:this.recipient,fee:this.fee,amount:this.amount,type:SIGN_TYPE.LEASE});return ds.signature.getSignatureApi().makeSignable({type:tx.type,data:tx})}},{key:"next",value:function(signable){this.signable=signable,this.step++}}]),StartLeasingCtrl}())};controller.$inject=["Base","$scope","user","utils","waves","i18n","modalManager","$mdDialog"],angular.module("app.ui").controller("StartLeasingCtrl",controller)}(),function(){var controller=function(Base,$scope,user,$mdDialog){return new(function(){function TermsAcceptCtrl(){_classCallCheck(this,TermsAcceptCtrl);var _this453=_possibleConstructorReturn(this,(TermsAcceptCtrl.__proto__||Object.getPrototypeOf(TermsAcceptCtrl)).call(this,$scope));return _this453.securityAndBackup=!1,_this453.readTermsAndConditions=!1,_this453.privacyPolicy=!1,_this453}return _inherits(TermsAcceptCtrl,Base),_createClass(TermsAcceptCtrl,[{key:"confirm",value:function(){$mdDialog.hide()}}]),TermsAcceptCtrl}())};controller.$inject=["Base","$scope","user","$mdDialog"],angular.module("app.utils").controller("TermsAcceptCtrl",controller)}(),function(){var controller=function(Base,$scope,explorerLinks,waves,createPoll){return new(function(){function TransactionInfoCtrl(_ref153){var transactionId=_ref153.transactionId;_classCallCheck(this,TransactionInfoCtrl);var _this454=_possibleConstructorReturn(this,(TransactionInfoCtrl.__proto__||Object.getPrototypeOf(TransactionInfoCtrl)).call(this,$scope));return _this454.timer=null,_this454.id=transactionId,_this454._getData(),_this454}return _inherits(TransactionInfoCtrl,Base),_createClass(TransactionInfoCtrl,[{key:"$onDestroy",value:function(){clearTimeout(this.timer),_get2(TransactionInfoCtrl.prototype.__proto__||Object.getPrototypeOf(TransactionInfoCtrl.prototype),"$onDestroy",this).call(this)}},{key:"_getData",value:function(){var _this455=this;waves.node.transactions.getAlways(this.id).then(function(transaction){return _this455._parseTransaction(transaction)}).catch(function(){return _this455._onError()}).then(function(tx){return _this455._setData(tx)})}},{key:"_parseTransaction",value:function(transaction){return transaction.isUTX?{confirmations:-1,transaction:transaction}:waves.node.height().then(function(height){return{confirmations:height-transaction.height,transaction:transaction}})}},{key:"_onError",value:function(){var _this456=this;clearTimeout(this.timer),this.wasDestroed||(this.timer=setTimeout(function(){return _this456._getData()},2e3))}},{key:"_setData",value:function(tx){if(!this.wasDestroed&&tx){var transaction=tx.transaction,confirmations=tx.confirmations;this.transaction=transaction,this.confirmations=confirmations,this.confirmed=!transaction.isUTX,this.explorerLink=explorerLinks.getTxLink(transaction.id);try{this.signable=ds.signature.getSignatureApi().makeSignable({type:transaction.type,data:transaction}),createPoll(this,this._getHeight,this._setHeight,1e3)}catch(e){this.signable=null}}$scope.$apply()}},{key:"_getHeight",value:function(){var promiseList=[waves.node.height()];return this.confirmed||promiseList.push(waves.node.transactions.getAlways(this.id)),Promise.all(promiseList)}},{key:"_setHeight",value:function(_ref154){var _ref155=_slicedToArray(_ref154,2),height=_ref155[0],tx=_ref155[1];tx?(Object.assign(this.transaction,tx),this.confirmed=!tx.isUTX,this.confirmed?this.confirmations=height-tx.height:this.confirmations=0):this.confirmations=height-this.transaction.height,$scope.$apply()}}]),TransactionInfoCtrl}())(this.locals)};controller.$inject=["Base","$scope","explorerLinks","waves","createPoll"],angular.module("app.utils").controller("TransactionInfoCtrl",controller)}(),function(){var locationHref=location.href,analytics=require("@waves/event-sender"),controller=function(Base,$scope,storage,$element){return new(function(){function TryDesktopCtrl(){_classCallCheck(this,TryDesktopCtrl);var _this457=_possibleConstructorReturn(this,(TryDesktopCtrl.__proto__||Object.getPrototypeOf(TryDesktopCtrl)).call(this,$scope));_this457.save=!1;var url=new URL(locationHref),href=("waves://"+url.pathname+url.search+url.hash).replace("///","//");return $element.find("a").attr("href",href),_this457}return _inherits(TryDesktopCtrl,Base),_createClass(TryDesktopCtrl,[{key:"onOpenLink",value:function(){analytics.send({name:"Onboarding Popup Official Site Click",target:"ui"})}},{key:"tryWeb",value:function(){this._saveChoice("web")}},{key:"tryDesktop",value:function(){this._saveChoice("desktop")}},{key:"_saveChoice",value:function(mode){this.save&&storage.save("openClientMode",mode)}}]),TryDesktopCtrl}())};controller.$inject=["Base","$scope","storage","$element"],angular.module("app.utils").controller("TryDesktopCtrl",controller)}(),function(){var controller=function(Base,$scope){var analytics=require("@waves/event-sender");return new(function(){function TutorialModalsCtrl(){_classCallCheck(this,TutorialModalsCtrl);var _this458=_possibleConstructorReturn(this,(TutorialModalsCtrl.__proto__||Object.getPrototypeOf(TutorialModalsCtrl)).call(this,$scope));return _this458.isDesktop=WavesApp.isDesktop(),_this458.isWeb=WavesApp.isWeb(),analytics.send({name:"Onboarding SEED Popup Show",target:"ui"}),_this458}return _inherits(TutorialModalsCtrl,Base),TutorialModalsCtrl}())};controller.$inject=["Base","$scope"],angular.module("app.utils").controller("TutorialModalsCtrl",controller)}(),angular.module("app.wallet.assets",[]),angular.module("app.wallet.leasing",[]),angular.module("app.wallet.portfolio",[]),angular.module("app.wallet.transactions",[]),function(){var ds=require("data-service"),Money=require("@waves/data-entities").Money,BigNumber=require("@waves/bignumber").BigNumber,currentCreateOrderFactory=require("@waves/signature-adapter").currentCreateOrderFactory,libs=require("@waves/waves-transactions").libs,address=libs.crypto.address,factory=function(utils,decorators,user,PollCache,configService){var _dec18,_dec19,_dec20,_dec21,_class85;return new(_dec18=decorators.cachable(.5),_dec19=decorators.cachable(2),_dec20=decorators.cachable(5),_dec21=decorators.cachable(1),_applyDecoratedDescriptor((_class85=function(){function Matcher(){var _this459=this;_classCallCheck(this,Matcher),this.currentMatcherAddress="",this._orderBookCacheHash=Object.create(null),user.onLogin().then(function(){return _this459._handleLogin()},function(){return _this459._handleLogout()}),this._updateCurrentMatcherAddress()}return _createClass(Matcher,[{key:"getOrders",value:function(options){return this._getOrders(options,user.address)}},{key:"getLastPrice",value:function(pair){return ds.api.matcher.getLastPrice(pair)}},{key:"_scriptInfo",value:function(address){return ds.api.address.getScriptInfo(address)}},{key:"getCreateOrderFee",value:function(order){var _this460=this,config=configService.getFeeConfig();return this.getMinOrderFee().then(function(minFee){var currentFee=currentCreateOrderFactory(config,minFee),matcherAddress=address({publicKey:order.matcherPublicKey},WavesApp.network.code);return Promise.all([_this460._scriptInfo(matcherAddress),ds.api.assets.get("WAVES")]).then(function(_ref156){var _ref157=_slicedToArray(_ref156,2),info=_ref157[0];return{asset:_ref157[1],hasScript:info.extraFee.getTokens().gt(0),currentFee:currentFee}})}).then(function(_ref158){var hasScript=_ref158.hasScript,currentFee=_ref158.currentFee,asset=_ref158.asset,smartAssetIdList=[order.amount.asset,order.price.asset].filter(function(asset){return asset.hasScript}).map(function(asset){return asset.id}),fee=currentFee({assetPair:{amountAsset:order.amount.asset.id,priceAsset:order.price.asset.id},matcherPublicKey:order.matcherPublicKey},hasScript,smartAssetIdList);return new Money(fee,asset)})}},{key:"calculateCustomFeeMap",value:function(order){var smartAssetExtraFee=new BigNumber(configService.getFeeConfig().smart_asset_extra_fee),baseFee=new BigNumber(order.baseFee),hasScript=order.matcherInfo.extraFee.getTokens().gt(0),smartPairAssets=[order.pair.amountAsset,order.pair.priceAsset].filter(function(asset){return asset.hasScript});return order.feeAssets.reduce(function(acc,asset){return acc[asset.id]=baseFee.add(smartAssetExtraFee.mul(function(feeAsset){var feeIsSmartAndNotInPair=feeAsset.hasScript&&smartPairAssets.some(function(asset){return asset.id===feeAsset.id});return smartPairAssets.length+Number(feeIsSmartAndNotInPair)}(asset))).add(smartAssetExtraFee.mul(Number(hasScript))),acc},Object.create(null))}},{key:"getMinOrderFee",value:function(){return Promise.resolve(new BigNumber(3e5))}},{key:"getOrderBook",value:function(asset1,asset2){return this._getOrderBookCache(asset1,asset2).get()}},{key:"getFeeRates",value:function(){return ds.api.matcher.getFeeRates()}},{key:"getSettings",value:function(){return ds.api.matcher.getSettings()}},{key:"getCreateOrderSettings",value:function(pair,matcherPublicKey){var _this461=this;return this.getSettings().then(function(data){var matcherPublicKeyBytes=libs.crypto.base58Decode(matcherPublicKey),matcherAddress=libs.crypto.address({publicKey:matcherPublicKeyBytes},ds.config.get("code"));if(data.orderFee.dynamic)return Promise.all([_this461._scriptInfo(matcherAddress)].concat(_toConsumableArray(Object.keys(data.orderFee.dynamic.rates).map(function(id){return ds.api.assets.get(id)})))).then(function(_ref159){var _ref160=function(arr){return Array.isArray(arr)?arr:Array.from(arr)}(_ref159),matcherInfo=_ref160[0],feeAssets=_ref160.slice(1);if(!feeAssets.length)throw new Error("Fee list is empty");return{basedCustomFee:_this461.calculateCustomFeeMap({pair:pair,matcherInfo:matcherInfo,feeAssets:feeAssets,baseFee:data.orderFee.dynamic.baseFee}),feeMode:"dynamic"}});if(data.orderFee.fixed){var feeValue=data.orderFee.fixed["min-fee"],feeAsset=data.orderFee.fixed.asset;return{fee:new Money(feeValue,feeAsset),feeMode:"fixed"}}throw new Error("Matcher settings are incorrect")}).catch(function(){return _this461.getCreateOrderFee({amount:new Money(0,pair.amountAsset),price:new Money(0,pair.priceAsset),matcherPublicKey:matcherPublicKey}).then(function(fee){return{feeMode:"waves",fee:fee}})})}},{key:"_getOrders",value:function(options,address){return address?ds.api.matcher.getOrders(options).then(ds.processOrdersWithStore):Promise.resolve([])}},{key:"_getOrderBook",value:function(asset1,asset2){return ds.api.matcher.getOrderBook(asset1,asset2).then(function(orderBook){return Matcher._remapOrderBook(orderBook)}).then(function(_ref161){var bids=_ref161.bids,asks=_ref161.asks,pair=_ref161.pair;return{bids:bids,asks:asks,pair:pair,spread:Matcher._getSpread(bids,asks,pair)}})}},{key:"_getOrderBookCache",value:function(asset1,asset2){var _this462=this,hash=this._orderBookCacheHash,id=[asset1,asset2].sort(utils.comparators.asc).join("-");return hash[id]?(clearTimeout(hash[id].timer),hash[id].timer=setTimeout(function(){hash[id].cache.destroy(),delete hash[id]},2e3)):hash[id]={timer:setTimeout(function(){hash[id].cache.destroy(),delete hash[id]},2e3),cache:new PollCache({getData:function(){return _this462._getOrderBook(asset1,asset2)},timeout:1e3})},hash[id].cache}},{key:"_updateCurrentMatcherAddress",value:function(){var _this463=this,networkMatcher=user.getSetting("network.matcher");ds.fetch(networkMatcher).then(function(matcherPublicKey){if(matcherPublicKey){var matcherPublicKeyBytes=libs.crypto.base58Decode(matcherPublicKey),matcherAddress=libs.crypto.address({publicKey:matcherPublicKeyBytes},ds.config.get("code"));_this463.currentMatcherAddress=matcherAddress}})}},{key:"_handleLogin",value:function(){user.changeSetting.on(this._onUserChangeSetting,this),user.logoutSignal.once(this._handleLogout,this)}},{key:"_handleLogout",value:function(){user.changeSetting.off(this._onUserChangeSetting),user.loginSignal.once(this._handleLogin,this)}},{key:"_onUserChangeSetting",value:function(path){"network.matcher"===path&&this._updateCurrentMatcherAddress()}}],[{key:"_remapOrderBook",value:function(_ref162){var bids=_ref162.bids,asks=_ref162.asks,pair=_ref162.pair;return{pair:pair,bids:Matcher._remapBidAsks(bids,pair),asks:Matcher._remapBidAsks(asks,pair)}}},{key:"_remapBidAsks",value:function(list,pair){return(list||[]).map(function(item){var amount=item.amount.getTokens(),price=item.price.getTokens(),total=amount.mul(price);return{amount:amount.toFixed(pair.amountAsset.precision),price:price.toFixed(pair.priceAsset.precision),total:total.toFixed(pair.priceAsset.precision)}})}},{key:"_getSpread",value:function(bids,asks){var lastAsk=_slicedToArray(asks,1)[0],firstBid=_slicedToArray(bids,1)[0],sell=new BigNumber(firstBid&&firstBid.price),buy=new BigNumber(lastAsk&&lastAsk.price),percent=buy.gt(0)?buy.sub(sell).mul(100).div(buy):new BigNumber(0);return firstBid&&lastAsk&&{lastAsk:lastAsk,firstBid:firstBid,buy:buy,sell:sell,percent:percent}||null}}]),Matcher}()).prototype,"getLastPrice",[_dec18],Object.getOwnPropertyDescriptor(_class85.prototype,"getLastPrice"),_class85.prototype),_applyDecoratedDescriptor(_class85.prototype,"_scriptInfo",[_dec19],Object.getOwnPropertyDescriptor(_class85.prototype,"_scriptInfo"),_class85.prototype),_applyDecoratedDescriptor(_class85.prototype,"getFeeRates",[_dec20],Object.getOwnPropertyDescriptor(_class85.prototype,"getFeeRates"),_class85.prototype),_applyDecoratedDescriptor(_class85.prototype,"_getOrders",[_dec21],Object.getOwnPropertyDescriptor(_class85.prototype,"_getOrders"),_class85.prototype),_class85)};factory.$inject=["utils","decorators","user","PollCache","configService"],angular.module("app").factory("matcher",factory)}(),function(){var factory=function(BaseNodeComponent,aliases,transactions,assets,user,utils,decorators){var _dec22,_class87,ds=require("data-service"),Node=(_dec22=decorators.cachable(2),_applyDecoratedDescriptor((_class87=function(){function Node(){_classCallCheck(this,Node);var _this464=_possibleConstructorReturn(this,(Node.__proto__||Object.getPrototypeOf(Node)).call(this));return _this464.aliases=aliases,_this464.assets=assets,_this464.transactions=transactions,_this464}return _inherits(Node,BaseNodeComponent),_createClass(Node,[{key:"scriptInfo",value:function(address){return ds.api.address.getScriptInfo(address)}},{key:"isValidAddress",value:function(address){try{return user.isValidAddress(address)}catch(e){return!1}}},{key:"isValidAddressWithNetworkByte",value:function(address,byte){try{return ds.isValidAddress(address,Node.toByte(byte))}catch(e){return!1}}},{key:"height",value:function(){return ds.fetch(this.node+"/blocks/height").then(function(res){return res.height})}}],[{key:"toByte",value:function(data){return"number"==typeof data?data:data.charCodeAt(0)}}]),Node}()).prototype,"scriptInfo",[_dec22],Object.getOwnPropertyDescriptor(_class87.prototype,"scriptInfo"),_class87.prototype),_class87);return utils.bind(new Node)};factory.$inject=["BaseNodeComponent","aliases","transactions","assets","user","utils","decorators"],angular.module("app").factory("node",factory)}(),function(){var factory=function(){var tsUtils=require("ts-utils");return new(function(){function STService(){_classCallCheck(this,STService),this._hash=Object.create(null),this.draw=new tsUtils.Signal,this.sort=new tsUtils.Signal}return _createClass(STService,[{key:"render",value:function(name){var _this465=this;Object.keys(this._hash).forEach(function(cid){name&&_this465._hash[cid].name!==name||_this465._hash[cid].render()})}},{key:"register",value:function(table){this._hash[table.cid]=table}},{key:"getTableByCid",value:function(cid){return this._hash[cid]}},{key:"unregister",value:function(table){delete this._hash[table.cid]}}]),STService}())};factory.$inject=[],angular.module("app.ui").factory("stService",factory)}(),function(){var controller=function(Base,$scope,gatewayService,user){return new(function(){function ReceiveBank(){_classCallCheck(this,ReceiveBank);var _this466=_possibleConstructorReturn(this,(ReceiveBank.__proto__||Object.getPrototypeOf(ReceiveBank)).call(this));return _this466.pending=!1,_this466.isVerified=!1,_this466.isTermsAccepted=!1,_this466.asset=null,_this466.verifyLink="https://go.idnow.de/coinomat/userdata/"+user.address,_this466.fiats=void 0,_this466.signInProgress=!1,_this466.digiLiraUserLink="https://www.digilira.com/",_this466.listOfEligibleCountries="#",_this466.idNowSiteUrl="#",_this466.idNowUserLink="#",_this466.step=0,_this466.observe("asset",_this466._updateDetails),_this466}return _inherits(ReceiveBank,Base),_createClass(ReceiveBank,[{key:"isLira",get:function(){return this.asset&&this.asset.id===WavesApp.defaultAssets.TRY}}]),_createClass(ReceiveBank,[{key:"nextStep",value:function(){this.step+=1}},{key:"onSignStart",value:function(){this.signInProgress=!0}},{key:"onSignEnd",value:function(){this.signInProgress=!1}},{key:"_updateDetails",value:function(){var _this467=this,sepaDetails=gatewayService.getSepaDetails(this.asset,user.address);sepaDetails&&sepaDetails.then(function(details){_this467.listOfEligibleCountries=details.listOfEligibleCountries,_this467.idNowSiteUrl=details.idNowSiteUrl,_this467.idNowUserLink=details.idNowUserLink,$scope.$apply()})}}]),ReceiveBank}())};controller.$inject=["Base","$scope","gatewayService","user"],angular.module("app.utils").component("wReceiveBank",{controller:controller,bindings:{asset:"<",fiats:"<",isSingleAsset:"<"},templateUrl:"modules/utils/modals/receive/receiveBank/receive-bank.html"})}(),function(){var Money=require("@waves/data-entities").Money,controller=function(Base,$scope,gatewayService,user){return new(function(){function ReceiveCryptocurrency(){_classCallCheck(this,ReceiveCryptocurrency);var _this468=_possibleConstructorReturn(this,(ReceiveCryptocurrency.__proto__||Object.getPrototypeOf(ReceiveCryptocurrency)).call(this));return _this468.asset=null,_this468.gatewayServerError=!1,_this468.gatewayServerPending=!1,_this468.chosenAssetId=null,_this468.minAmount=null,_this468.maxAmount=null,_this468.observe("chosenAssetId",function(_ref163){var id=_ref163.value;return _this468.onAssetChange({id:id})}),_this468.observe("asset",_this468.updateGatewayAddress),_this468}return _inherits(ReceiveCryptocurrency,Base),_createClass(ReceiveCryptocurrency,[{key:"updateGatewayAddress",value:function(){var _this469=this;this.gatewayServerError=!1,this.gatewayServerPending=!0;var depositDetails=gatewayService.getDepositDetails(this.asset,user.address);depositDetails&&(depositDetails.then(function(details){_this469.gatewayAddress=details.address,_this469.minAmount=Money.fromTokens(details.minimumAmount,_this469.asset),_this469.maxAmount=Money.fromTokens(details.maximumAmount,_this469.asset),_this469.gatewayServerPending=!1,$scope.$apply()},function(){_this469.minAmount=Money.fromTokens(.001,_this469.asset),_this469.gatewayAddress=null,_this469.gatewayServerError=!0,_this469.gatewayServerPending=!1,$scope.$apply()}),this.assetKeyName=gatewayService.getAssetKeyName(this.asset,"deposit"),this.isVostok=this.asset.id===WavesApp.defaultAssets.VST)}}]),ReceiveCryptocurrency}())};controller.$inject=["Base","$scope","gatewayService","user"],angular.module("app.utils").component("wReceiveCryptocurrency",{controller:controller,bindings:{asset:"<",cryptocurrencies:"<",isSingleAsset:"<",onAssetChange:"&"},templateUrl:"modules/utils/modals/receive/receiveCryptocurrency/receive-cryptocurrency.html"})}(),function(){var controller=function(Base,$scope,gatewayService,user){var BigNumber=require("@waves/bignumber").BigNumber;return new(function(){function ReceiveCard(){_classCallCheck(this,ReceiveCard);var _this470=_possibleConstructorReturn(this,(ReceiveCard.__proto__||Object.getPrototypeOf(ReceiveCard)).call(this));return _this470.asset=null,_this470.purchasablesByCards=void 0,_this470.step=0,_this470.indacoinLink="#",_this470.cardFiatList=gatewayService.getDefaultCardFiatList(),_this470.approximateAmount=0,_this470.chosenCurrencyIndex=0,_this470.chosenAssetId=null,_this470.cardPayment=null,_this470.showIndacoinRedirectionDescription=!1,_this470.observe("chosenAssetId",function(_ref164){var id=_ref164.value;return _this470.onAssetChange({id:id})}),_this470.observe(["chosenCurrencyIndex","cardPayment"],_this470._updateAmountAndLink),_this470.observe(["asset","purchasablesByCards"],_this470._updateDetails),_this470}return _inherits(ReceiveCard,Base),_createClass(ReceiveCard,[{key:"confirmIndacoin",value:function(){this.showIndacoinRedirectionDescription=!0,this.nextStep()}},{key:"nextStep",value:function(){this.step+=1}},{key:"_updateAmountAndLink",value:function(){if(!this.cardPayment)return null;this._updateApproximateAmount(),this._updateIndacoinLink()}},{key:"_updateDetails",value:function(){var _this471=this;this.asset&&this.purchasablesByCards&&this._isPurchasableByCard(this.asset)&&this._updateCardPayment().then(function(cardPayment){_this471.cardPayment=cardPayment}).then(function(){return _this471._updateCardFiatList()}).then(function(cardFiatList){_this471.cardFiatList=cardFiatList,_this471._updateAmountAndLink(),$scope.$apply()})}},{key:"_updateCardPayment",value:function(){return ds.moneyFromTokens(this.cardFiatList[0].min,this.cardFiatList[0].assetId)}},{key:"_updateCardFiatList",value:function(){return gatewayService.getCardFiatWithLimits(this.asset,user.address,gatewayService.getDefaultCardFiatList())}},{key:"_updateApproximateAmount",value:function(){var _this472=this;this.approximateAmount=new ds.wavesDataEntities.Money(0,this.asset),gatewayService.getCardApproximateCryptoAmount(this.asset,this.cardFiatList[this.chosenCurrencyIndex].fiatCode,user.address,this._tokenizeCardPayment()).then(function(approximateAmount){var coins=new BigNumber(approximateAmount).mul(Math.pow(10,_this472.asset.precision));_this472.approximateAmount=new ds.wavesDataEntities.Money(coins.toFixed(0),_this472.asset),$scope.$apply()})}},{key:"_updateIndacoinLink",value:function(){this.indacoinLink=gatewayService.getCardBuyLink(this.asset,this.cardFiatList[this.chosenCurrencyIndex].fiatCode,user.address,this._tokenizeCardPayment())}},{key:"_isPurchasableByCard",value:function(asset){return this.purchasablesByCards.find(function(purchasable){return purchasable.id===asset.id})}},{key:"_tokenizeCardPayment",value:function(){return this.cardPayment&&this.cardPayment.toTokens()}}]),ReceiveCard}())};controller.$inject=["Base","$scope","gatewayService","user"],angular.module("app.utils").component("wReceiveCard",{controller:controller,bindings:{asset:"<",purchasablesByCards:"<",isSingleAsset:"<",onAssetChange:"&"},templateUrl:"modules/utils/modals/receive/receiveCard/receive-card.html"})}(),function(){var controller=function(Base,waves,user){return new(function(){function ReceiveInvoice(){_classCallCheck(this,ReceiveInvoice);var _this473=_possibleConstructorReturn(this,(ReceiveInvoice.__proto__||Object.getPrototypeOf(ReceiveInvoice)).call(this));return _this473.asset=null,_this473.invoicables=void 0,_this473.addressAndAliases=[user.address].concat(_toConsumableArray(waves.node.aliases.getAliasList())),_this473.chosenAssetId=null,_this473.chosenAlias=null,_this473.invoiceAmount=null,_this473.sendLink="",_this473.observe("chosenAssetId",function(_ref165){var id=_ref165.value;return _this473.onAssetChange({id:id})}),_this473.observe(["asset","chosenAlias","invoiceAmount","invoicables"],_this473._updateSendLink),_this473}return _inherits(ReceiveInvoice,Base),_createClass(ReceiveInvoice,[{key:"_updateSendLink",value:function(){var assetId=this.asset&&this.asset.id;if(assetId&&this.chosenAlias){var invoiceAmount=this.invoiceAmount&&this.invoiceAmount.toTokens()||"0",WAVES_URL=WavesApp.origin;this.sendLink=WAVES_URL+"/#send/"+assetId+"?recipient="+this.chosenAlias+"&amount="+invoiceAmount}else this.sendLink=""}}]),ReceiveInvoice}())};controller.$inject=["Base","waves","user"],angular.module("app.utils").component("wReceiveInvoice",{controller:controller,bindings:{asset:"<",invoicables:"<",isSingleAsset:"<",onAssetChange:"&"},templateUrl:"modules/utils/modals/receive/receiveInvoice/receive-invoice.html"})}(),function(){var controller=function(waves,assetsData,$scope,utils,Base,user,modalManager,createPoll,balanceWatcher){var date=require("ts-utils").date,ds=require("data-service"),analytics=require("@waves/event-sender");return new(function(){function Assets(){_classCallCheck(this,Assets);var _this474=_possibleConstructorReturn(this,(Assets.__proto__||Object.getPrototypeOf(Assets)).call(this,$scope));return _this474.pinnedAssetIdList=null,_this474.pinnedAssetBalances=null,_this474.chartMode=null,_this474.total=null,_this474.interval=null,_this474.intervalCount=null,_this474.data=null,_this474.options=assetsData.getGraphOptions(),_this474.mirrorId=null,_this474.invalid=!0,_this474._startDate=null,_this474.activeChartAssetId=null,_this474.activeChartBalance=null,_this474.chartAssetIdList=null,_this474.chartAssetList=null,_this474.change="0.00",_this474.changePercent="0.00",_this474.advancedMode=!1,_this474.theme="default",_this474.dateToHours=date("hh:mm"),_this474.dateToDates=date("DD/MM"),_this474.options.axes.x.tickFormat=function(date){return"hour"===_this474.chartMode||"day"===_this474.chartMode?_this474.dateToHours(date):_this474.dateToDates(date)},_this474.observe("activeChartAssetId",_this474._onChangeChartAssetId),_this474.syncSettings({activeChartAssetId:"wallet.assets.activeChartAssetId",chartAssetIdList:"wallet.assets.chartAssetIdList",chartMode:"wallet.assets.chartMode",pinnedAssetIdList:"pinnedAssetIdList",advancedMode:"advancedMode",theme:"theme"}),_this474.mirrorId=user.getSetting("baseAssetId"),_this474._onChangeMode(),_this474.updateGraph=createPoll(_this474,_this474._getGraphData,"data",15e3,{$scope:$scope}),_this474.theme=user.getSetting("theme"),_this474._setChartOptions(),ds.api.assets.get(_this474.chartAssetIdList).then(function(assets){_this474.chartAssetList=assets,utils.safeApply($scope)}),balanceWatcher.ready.then(function(){_this474.receive(balanceWatcher.change,_this474._updateBalances,_this474),_this474._updateBalances()}),_this474.observe("chartMode",_this474._onChangeMode),_this474.observe("_startDate",_this474._onChangeInterval),_this474.observe("pinnedAssetIdList",_this474._updateBalances),_this474.observe(["interval","intervalCount","activeChartAssetId"],_this474._onChangeInterval),_this474.observe("theme",_this474._onThemeChange),_this474}return _inherits(Assets,Base),_createClass(Assets,[{key:"openScriptModal",value:function(){return modalManager.showScriptModal()}},{key:"openAnyTxModal",value:function(){return modalManager.showAnyTx(null)}},{key:"abs",value:function(num){return Math.abs(num)}},{key:"onAssetActionClick",value:function(event,asset,action){if(event.preventDefault(),"send"===action)return this.showSend(asset);if("info"===action)return this.showAsset(asset);if("receive"===action)return this.showReceivePopup(asset);throw new Error("Wrong action")}},{key:"unpin",value:function(asset){analytics.send({name:"Wallet Assets Unpin",params:{Currency:asset.id},target:"ui"}),this.pinnedAssetIdList=this.pinnedAssetIdList.filter(function(fAsset){return fAsset!==asset.id})}},{key:"newAssetOnClick",value:function(){modalManager.showPinAsset().then(function(_ref166){_ref166.selected&&$scope.$digest()})}},{key:"showReceivePopup",value:function(asset){return analytics.send({name:"Wallet Assets Receive Click",params:{Currency:asset?asset.id:"All"},target:"ui"}),modalManager.showReceiveModal(asset)}},{key:"showSeedBackupModals",value:function(){return modalManager.showSeedBackupModal()}},{key:"showAsset",value:function(asset){return modalManager.showAssetInfo(asset)}},{key:"showSend",value:function(asset){return analytics.send({name:"Wallet Assets Send Click",params:{Currency:asset?asset.id:"All"},target:"ui"}),modalManager.showSendAsset({assetId:asset&&asset.id||null})}},{key:"showDeposit",value:function(asset){return modalManager.showDepositAsset(user,asset)}},{key:"showSepa",value:function(asset){return modalManager.showSepaAsset(user,asset)}},{key:"onMouse",value:function(chartData){var id=chartData.id,_chartData$point2=chartData.point,xValue=_chartData$point2.xValue,yValue=_chartData$point2.yValue,date=new Date(xValue.toNumber());this.chartEvent=_extends({},chartData,{id:id,price:yValue.toFormat(2),date:Assets._localDate(date,!0),time:this.dateToHours(date)}),utils.safeApply($scope)}},{key:"_onChangeChartAssetId",value:function(_ref167){var _this475=this,value=_ref167.value;waves.node.assets.balance(value).then(function(asset){_this475.activeChartBalance=asset})}},{key:"_updateBalances",value:function(){var _this476=this,hash=utils.toHash(balanceWatcher.getFullBalanceList(),"asset.id");this.pinnedAssetIdList.reduce(function(acc,assetId){return acc.then(function(list){return hash[assetId]?(list.push(hash[assetId]),list):balanceWatcher.getFullBalanceByAssetId(assetId).then(function(balance){return list.push(balance),list})})},Promise.resolve([])).then(function(list){_this476.pinnedAssetBalances=list,utils.safeApply($scope)})}},{key:"_onChangeInterval",value:function(){this.updateGraph.restart()}},{key:"_getGraphData",value:function(){var _this477=this,from=this.activeChartAssetId,to=this.mirrorId,precisionPromise=waves.node.assets.getAsset(this.mirrorId).then(function(_ref168){return _ref168.precision}),valuesPromise=waves.utils.getRateHistory(from,to,this._startDate);return Promise.all([precisionPromise,valuesPromise]).then(function(_ref169){var _ref170=_slicedToArray(_ref169,2),precision=_ref170[0],values=_ref170[1],first=values[0].rate,last=values[values.length-1].rate;return _this477.change=(last-first).toFixed(precision),_this477.changePercent=((last-first)/first*100).toFixed(precision),{rate:values}})}},{key:"_onChangeMode",value:function(){switch(this.chartMode){case"hour":this._startDate=utils.moment().add().hour(-1);break;case"day":this._startDate=utils.moment().add().day(-1);break;case"week":this._startDate=utils.moment().add().day(-7);break;case"month":this._startDate=utils.moment().add().month(-1);break;case"year":this._startDate=utils.moment().add().year(-1);break;default:throw new Error("Wrong chart mode!")}}},{key:"_onThemeChange",value:function(){var _this478=this;utils.wait(1e3).then(function(){return _this478._setChartOptions()})}},{key:"_setChartOptions",value:function(){this.chartOptions={axisX:"timestamp",axisY:"rate",marginBottom:46,hasDates:!0,checkWidth:2e3,heightFactor:.7,view:{rate:this._getViewOptions()}}}},{key:"_getViewOptions",value:function(){switch(this.theme){case"black":return{lineColor:"#5a81ea",fillColor:"#2d2d2d",gradientColor:["#334375","#2d2d2d"],lineWidth:4};default:return{lineColor:"#1f5af6",fillColor:"#fff",gradientColor:["#eaf0fe","#fff"],lineWidth:4}}}}],[{key:"_localDate",value:function(date,argument_1){return 1<arguments.length&&void 0!==argument_1&&argument_1?tsUtils.date("DD.MM.YYYY")(date):tsUtils.date("DD.MM")(date)}}]),Assets}())};controller.$inject=["waves","assetsData","$scope","utils","Base","user","modalManager","createPoll","balanceWatcher"],angular.module("app.wallet.assets").controller("AssetsCtrl",controller)}(),function(){var factory=function(user,decorators){var _dec23,_class93;return new(_dec23=decorators.cachable(2),_applyDecoratedDescriptor((_class93=function(){function AssetsData(){_classCallCheck(this,AssetsData)}return _createClass(AssetsData,[{key:"getGraphOptions",value:function(){return{grid:{x:!1,y:!1},series:[{dataset:"values",key:"rate",label:"Rate",color:"#5a81ea",type:["line","area"]}],axes:{x:{key:"timestamp",type:"date",ticks:4},y:{ticks:4,padding:{max:4}}}}}},{key:"_loadData",value:function(){return ds.fetch("/api/assets-total/balance.json").then(function(r){return r.json()}).then(function(data){return data.map(function(item){return{x:new Date(item.x),y:item.y}})})}}]),AssetsData}()).prototype,"_loadData",[_dec23],Object.getOwnPropertyDescriptor(_class93.prototype,"_loadData"),_class93.prototype),_class93)};factory.$inject=["user","decorators","waves","utils"],angular.module("app.wallet.assets").factory("assetsData",factory)}(),function(){var controller=function(Base,$scope,utils,waves,modalManager,createPoll,balanceWatcher){var pathEq=require("ramda").pathEq;return new(function(){function LeasingCtrl(){_classCallCheck(this,LeasingCtrl);var _this479=_possibleConstructorReturn(this,(LeasingCtrl.__proto__||Object.getPrototypeOf(LeasingCtrl)).call(this,$scope));return _this479._txList=null,_this479.allActiveLeasing=null,_this479.transactions=[],_this479.nodeListLink="",_this479.syncSettings({filter:"wallet.leasing.filter"}),_this479.pending=!0,_this479.chartOptions={items:{available:{color:"#66bf00",radius:80},leased:{color:"#ffebc0",radius:64},leasedIn:{color:"#bacaf5",radius:75}},center:34,direction:!0,startFrom:Math.PI/2},_this479.nodeListLink=WavesApp.network.nodeList,waves.node.transactions.getActiveLeasingTx().then(function(txList){_this479.allActiveLeasing=txList,$scope.$apply()}),createPoll(_this479,_this479._getTransactions,_this479._setTxList,3e3,{isBalance:!0}),_this479.receive(balanceWatcher.change,_this479._updateLeasingData,_this479),_this479.observe(["_txList","allActiveLeasing","filter"],_this479._currentLeasingList),_this479._updateLeasingData(),_this479}return _inherits(LeasingCtrl,Base),_createClass(LeasingCtrl,[{key:"pendingAllLeasing",get:function(){return!this.pending&&null==this.allActiveLeasing}}]),_createClass(LeasingCtrl,[{key:"startLeasing",value:function(){return modalManager.showStartLeasing()}},{key:"_getTransactions",value:function(){return waves.node.transactions.list(500)}},{key:"_updateLeasingData",value:function(){var waves=balanceWatcher.getFullBalanceList().find(pathEq(["asset","id"],"WAVES"));if(!waves)return null;var available=waves.available,leasedOut=waves.leasedOut,leasedIn=waves.leasedIn;this.available=available,this.leased=leasedOut,this.leasedIn=leasedIn,this.total=available.add(leasedOut),this.chartData=[{id:"available",value:available},{id:"leased",value:leasedOut},{id:"leasedIn",value:leasedIn}],utils.safeApply($scope)}},{key:"_setTxList",value:function(txList){var _AVAILABLE_TYPES_HASH,AVAILABLE_TYPES_HASH=(_defineProperty(_AVAILABLE_TYPES_HASH={},waves.node.transactions.TYPES.LEASE_IN,!0),_defineProperty(_AVAILABLE_TYPES_HASH,waves.node.transactions.TYPES.LEASE_OUT,!0),_defineProperty(_AVAILABLE_TYPES_HASH,waves.node.transactions.TYPES.CANCEL_LEASING,!0),_AVAILABLE_TYPES_HASH);this._txList=txList.filter(function(_ref171){var typeName=_ref171.typeName;return AVAILABLE_TYPES_HASH[typeName]}),$scope.$apply()}},{key:"_currentLeasingList",value:function(){var txList=this._txList,allActiveLeasing=this.allActiveLeasing;if(!txList)return null;this.pending=!txList.length&&!allActiveLeasing;var idHash=utils.toHash(txList,"id"),result=txList.slice();(allActiveLeasing||allActiveLeasing.length)&&allActiveLeasing.forEach(function(tx){idHash[tx.id]||result.push(tx)}),this.transactions=result,this._filterLeasingList()}},{key:"_filterLeasingList",value:function(){var filter=this.filter;"active"===filter?this.transactions=this.transactions.filter(function(tx){return"active"===tx.status}):"canceled"===filter&&(this.transactions=this.transactions.filter(function(tx){return"active"!==tx.status||"cancel-leasing"===tx.typeName}))}}]),LeasingCtrl}())};controller.$inject=["Base","$scope","utils","waves","modalManager","createPoll","balanceWatcher"],angular.module("app.wallet.leasing").controller("LeasingCtrl",controller)}(),function(){var get=require("ts-utils").get,_require108=require("ramda"),splitEvery=_require108.splitEvery,flatten=_require108.flatten,searchByNameAndId=function($scope,key,list){var query=$scope[key];return query?list.filter(function(item){var name=get({item:item},"item.asset.name"),id=get({item:item},"item.asset.id");return-1!==String(name).toLowerCase().indexOf(query.toLowerCase())||String(id)===query}):list},ds=require("data-service"),controller=function(Base,$scope,waves,utils,modalManager,user,eventManager,gatewayService,$state,stService,visibleService,balanceWatcher){return new(function(){function PortfolioCtrl(){_classCallCheck(this,PortfolioCtrl);var _this480=_possibleConstructorReturn(this,(PortfolioCtrl.__proto__||Object.getPrototypeOf(PortfolioCtrl)).call(this,$scope));return _this480.mirrorId=user.getSetting("baseAssetId"),_this480.mirror=null,_this480.pinned=[],_this480.address=user.address,_this480.spam=[],_this480.details=null,_this480.balanceList=[],_this480.filter=null,_this480.chartStartDate=utils.moment().add().day(-7),_this480.pending=!0,_this480.dontShowSpam=user.getSetting("dontShowSpam"),waves.node.assets.getAsset(_this480.mirrorId).then(function(mirror){_this480.mirror=mirror,_this480.tableHeaders=[{id:"name",title:{literal:"list.name"},valuePath:"item.asset.name",sort:!0,search:searchByNameAndId,placeholder:"portfolio.filter"},{id:"balance",title:{literal:"list.balance"},valuePath:"item.available",sort:!0},{id:"inOrders",title:{literal:"list.inOrders"},valuePath:"item.inOrders",sort:!0},{id:"mirror",title:{literal:"list.mirror",params:{currency:mirror.displayName}}},{id:"rate",title:{literal:"list.rate",params:{currency:mirror.displayName}}},{id:"change24",title:{literal:"list.change"}},{id:"controls"}],$scope.$digest()}),_this480.syncSettings({pinned:"pinnedAssetIdList",spam:"wallet.portfolio.spam",filter:"wallet.portfolio.filter",dontShowSpam:"dontShowSpam"}),balanceWatcher.ready.then(function(){var onChange=function(){_this480._updateBalances(),visibleService.updateSort()};_this480.receive(balanceWatcher.change,onChange),_this480.receive(utils.observe(user,"scam"),onChange),_this480.observe(["pinned","spam","dontShowSpam"],onChange),_this480._updateBalances()}),balanceWatcher.ready.then(function(){_this480.pending=!1,_this480.observe("details",_this480._onChangeDetails),_this480.observe("filter",_this480._onChangeDetails),utils.safeApply($scope)}),_this480.receive(stService.sort,function(){visibleService.updateSort()}),_this480}return _inherits(PortfolioCtrl,Base),_createClass(PortfolioCtrl,[{key:"showAsset",value:function(asset){modalManager.showAssetInfo(asset)}},{key:"showSend",value:function(asset){return modalManager.showSendAsset({assetId:asset&&asset.id})}},{key:"showReceivePopup",value:function(asset){return modalManager.showReceiveModal(asset)}},{key:"showDeposit",value:function(asset){return modalManager.showDepositAsset(user,asset)}},{key:"showSepa",value:function(asset){return modalManager.showSepaAsset(user,asset)}},{key:"showBurn",value:function(assetId){return modalManager.showBurnModal(assetId)}},{key:"showReissue",value:function(assetId){return modalManager.showReissueModal(assetId)}},{key:"canShowDex",value:function(balance){return balance.isPinned||balance.asset.isMyAsset||balance.asset.id===WavesApp.defaultAssets.WAVES||gatewayService.getPurchasableWithCards()[balance.asset.id]||gatewayService.getCryptocurrencies()[balance.asset.id]||gatewayService.getFiats()[balance.asset.id]}},{key:"openDex",value:function(asset){$state.go("main.dex",this.getSrefParams(asset))}},{key:"getSrefParams",value:function(asset){utils.openDex(asset.id)}},{key:"togglePin",value:function(asset,state){user.togglePinAsset(asset.id,state),this.poll.restart()}},{key:"toggleSpam",value:function(asset,state){user.toggleSpamAsset(asset.id,state),this.poll.restart()}},{key:"isDepositSupported",value:function(asset){var isWaves=asset.id===WavesApp.defaultAssets.WAVES;return gatewayService.hasSupportOf(asset,"deposit")||isWaves}},{key:"isSepaSupported",value:function(asset){return gatewayService.hasSupportOf(asset,"sepa")}},{key:"_onChangeDetails",value:function(){var details=this.details,balanceList=void 0;switch(this.filter){case"active":balanceList=details.active.slice();break;case"pinned":balanceList=details.pinned.slice();break;case"spam":balanceList=details.spam.slice();break;case"my":balanceList=details.my.slice();break;case"verified":balanceList=details.verified.slice();break;default:throw new Error("Wrong filter name!")}this.balanceList=balanceList}},{key:"_addRating",value:function(balanceList){return Promise.all(splitEvery(25,balanceList).map(function(block){return ds.api.rating.getAssetsRating(block.map(function(balanceItem){return balanceItem.asset.id}))})).then(function(list){var listHash=utils.toHash(flatten(list),"assetId");return balanceList.map(function(balanceItem){return balanceItem.rating=listHash[balanceItem.asset.id]?listHash[balanceItem.asset.id].rating:null,balanceItem})}).catch(function(){return balanceList})}},{key:"_updateBalances",value:function(){var _this481=this,balanceList=balanceWatcher.getFullBalanceList();this._addRating(balanceList).then(function(balanceListWithRating){_this481.details=balanceListWithRating.map(function(item){var isPinned=_this481._isPinned(item.asset.id),isSpam=_this481._isSpam(item.asset.id),isOnScamList=user.scam[item.asset.id];return{available:item.available,asset:item.asset,inOrders:item.inOrders,isPinned:isPinned,isSpam:isSpam,isOnScamList:isOnScamList,rating:item.rating||null,minSponsoredAssetFee:item.asset.minSponsoredAssetFee,sponsorBalance:item.asset.sponsorBalance,leasedOut:item.leasedOut}}).reduce(function(acc,item){var oracleData=ds.dataManager.getOraclesAssetData(item.asset.id),spam=item.isOnScamList||item.isSpam;return oracleData&&0<oracleData.status&&acc.verified.push(item),spam?_this481.dontShowSpam||(item.asset.sender===user.address&&acc.my.push(item),acc.spam.push(item),acc.active.push(item)):(item.asset.sender===user.address&&acc.my.push(item),acc.active.push(item)),acc},{spam:[],my:[],active:[],verified:[]}),utils.safeApply($scope)})}},{key:"_isPinned",value:function(assetId){return this.pinned.includes(assetId)}},{key:"_isSpam",value:function(assetId){return this.spam.includes(assetId)}}]),PortfolioCtrl}())};controller.$inject=["Base","$scope","waves","utils","modalManager","user","eventManager","gatewayService","$state","stService","visibleService","balanceWatcher"],angular.module("app.wallet.portfolio").controller("PortfolioCtrl",controller)}(),function(){var controller=function(user,Base,$scope,transactionsCsvGen,waves,createPoll,notification){var analytics=require("@waves/event-sender");return new(function(){function TransactionsCtrl(){_classCallCheck(this,TransactionsCtrl);var _this482=_possibleConstructorReturn(this,(TransactionsCtrl.__proto__||Object.getPrototypeOf(TransactionsCtrl)).call(this,$scope));_this482.transactions=[],_this482.pending=!0,_this482.filter=null,_this482.txList=[],_this482.limit=100,_this482.observe(["filter"],_this482._sendAnalytics),_this482.syncSettings({filter:"wallet.transactions.filter"});var poll=createPoll(_this482,_this482._getTxList,_this482._setTxList,4e3,{isBalance:!0});return _this482.observe(["txList","filter"],_this482._applyTransactionList),_this482.observe("limit",function(){return poll.restart()}),_this482}return _inherits(TransactionsCtrl,Base),_createClass(TransactionsCtrl,[{key:"exportTransactions",value:function(argument_0){var _this483=this,maxTransactions=0<arguments.length&&void 0!==argument_0?argument_0:1e4;analytics.send({name:"Transactions Export Click",target:"ui"});var _ref172,getSeriesTransactions=(_ref172=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(){var transactions,downloadError,_ref173=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},_ref173$allTransactio=_ref173.allTransactions,allTransactions=void 0===_ref173$allTransactio?[]:_ref173$allTransactio,_ref173$after=_ref173.after,after=void 0===_ref173$after?"":_ref173$after;return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return transactions=void 0,downloadError=!1,_context6.prev=2,_context6.next=5,waves.node.transactions.list(1e3,after);case 5:transactions=_context6.sent,_context6.next=16;break;case 8:if(_context6.prev=8,_context6.t0=_context6.catch(2),downloadError=!0,allTransactions.length){_context6.next=14;break}return notification.error({ns:"app.wallet.transactions",title:{literal:"errors.download.title"},body:{literal:"errors.download.body"}}),_context6.abrupt("return",[]);case 14:transactions=[],notification.error({ns:"app.wallet.transactions",title:{literal:"errors.complete.title"},body:{literal:"errors.complete.body"}});case 16:if(user.getSetting("dontShowSpam")&&(transactions=transactions.filter(function(el){return!user.scam[el.assetId]})),allTransactions=allTransactions.concat(transactions),transactions.length<1e3||allTransactions.length>maxTransactions)return _context6.abrupt("return",{allTransactions:allTransactions,downloadError:downloadError});_context6.next=22;break;case 22:return _context6.abrupt("return",getSeriesTransactions({allTransactions:allTransactions,after:transactions[transactions.length-1].id}));case 23:case"end":return _context6.stop()}},_callee6,_this483,[[2,8]])})),function(){return _ref172.apply(this,arguments)}),promiseGetTransactions=getSeriesTransactions();return promiseGetTransactions.then(function(_ref174){var allTransactions=_ref174.allTransactions,downloadError=_ref174.downloadError;allTransactions.length?transactionsCsvGen.generate(allTransactions):downloadError||notification.error({ns:"app.wallet.transactions",title:{literal:"errors.empty.title"},body:{literal:"errors.empty.body"}})}),promiseGetTransactions}},{key:"_getTxList",value:function(){return waves.node.transactions.list(this.limit)}},{key:"_applyTransactionList",value:function(){var filter=this.filter,list=this.txList,availableTypes=filter.split(",").map(function(type){return type.trim()}).reduce(function(result,type){return result[type]=!0,result},Object.create(null));this.transactions="all"===filter?list.slice():list.filter(function(_ref175){var typeName=_ref175.typeName;return availableTypes[typeName]})}},{key:"_sendAnalytics",value:function(){var actionName=void 0;switch(this.filter){case"all":actionName="Transactions All Show";break;case"send,mass-send":actionName="Transactions Sent Show";break;case"receive,mass-receive,sponsorship-fee":actionName="Transactions Received Show";break;case"exchange-buy,exchange-sell":actionName="Transactions Exchanged Show";break;case"lease-in,lease-out,cancel-leasing":actionName="Transactions Leased Show";break;case"issue,reissue,burn,sponsorship-stop,sponsorship-start":actionName="Transactions Issued Show"}analytics.send({name:actionName,target:"ui"})}},{key:"_setTxList",value:function(transactions){this.pending=!1,this.txList=transactions,$scope.$digest()}}]),TransactionsCtrl}())};controller.$inject=["user","Base","$scope","transactionsCsvGen","waves","createPoll","notification"],angular.module("app.wallet.transactions").controller("TransactionsCtrl",controller)}(),function(){var factory=function(i18n,utils){var Papa=require("papaparse"),HEADERS=[{name:"csv.date",id:"timestamp"},{name:"csv.id",id:"id"},{name:"csv.type",id:"typeName"},{name:"csv.transactionType",id:"type"},{name:"csv.price.ticker",id:"priceTicker"},{name:"csv.price.name",id:"priceName"},{name:"csv.price.value",id:"priceValue"},{name:"csv.price.id",id:"priceId"},{name:"csv.amount.ticker",id:"amountTicker"},{name:"csv.amount.name",id:"amountName"},{name:"csv.amount.value",id:"amountValue"},{name:"csv.amount.id",id:"amountId"},{name:"csv.fee.ticker",id:"feeTicker"},{name:"csv.fee.name",id:"feeName"},{name:"csv.fee.value",id:"feeValue"},{name:"csv.fee.id",id:"feeId"},{name:"csv.sender",id:"sender"},{name:"csv.recipient",id:"recipient"},{name:"csv.attachment",id:"attachment"},{name:"csv.height",id:"height"},{name:"csv.alias",id:"alias"},{name:"csv.description",id:"description"},{name:"csv.name",id:"name"},{name:"csv.reissuable.name",id:"reissuable"},{name:"csv.precision",id:"precision"}],NS="app.wallet.transactions";return new(function(){function TransactionsCsvGen(){_classCallCheck(this,TransactionsCsvGen)}return _createClass(TransactionsCsvGen,[{key:"generate",value:function(transactionList){var fields=HEADERS.map(function(item){return i18n.translate(item.name,NS)}),data=transactionList.map(function(tx){return HEADERS.map(function(header){var id=header.id,value=tx[id];try{switch(id){case"timestamp":return value&&utils.moment(value).format("DD.MM.YYYY hh:mm:ss")||value;case"reissuable":return null!=value&&i18n.translate("csv.reissuable."+value,NS)||value;case"priceTicker":return tx.price&&tx.price.asset.ticker||"";case"priceName":return tx.price&&tx.price.asset.name||"";case"priceValue":return tx.price&&tx.price.toFormat()||"";case"priceId":return tx.price&&tx.price.asset.id||"";case"amountTicker":return tx.amount&&tx.amount.asset.ticker||"";case"amountName":return tx.amount&&tx.amount.asset.name||"";case"amountValue":return tx.amount&&tx.amount.toFormat()||"";case"amountId":return tx.amount&&tx.amount.asset.id||"";case"feeTicker":return tx.fee&&tx.fee.asset.ticker||"";case"feeName":return tx.fee&&tx.fee.asset.name||"";case"feeValue":return tx.fee&&tx.fee.toFormat()||"";case"feeId":return tx.fee&&tx.fee.asset.id||"";default:return null==value?"":String(value)}}catch(e){return""}})}),csv=Papa.unparse({fields:fields,data:data});WavesApp.isDesktop()?transfer("download",{fileContent:csv,fileName:"transactions.csv"}):TransactionsCsvGen._download(csv,"transactions.csv")}}],[{key:"_download",value:function(csv,name){if(window.navigator&&"function"==typeof window.navigator.msSaveOrOpenBlob)this._downloadInMsEdge(csv,name);else{var blob=new Blob([csv],{type:"text/csv;charset=utf-8;"}),url=URL.createObjectURL(blob),link=document.createElement("a");link.setAttribute("href",url),link.setAttribute("download",name),link.setAttribute("target","_blank"),link.style.position="absolute",link.style.opacity="0",document.body.appendChild(link),link.click(),requestAnimationFrame(function(){document.body.removeChild(link)})}}},{key:"_downloadInMsEdge",value:function(csv,name){var blob=new Blob([csv],{type:"text/csv"});window.navigator.msSaveOrOpenBlob(blob,name)}}]),TransactionsCsvGen}())};factory.$inject=["i18n","utils"],angular.module("app.wallet.transactions").factory("transactionsCsvGen",factory)}(),function(){var factory=function(BaseNodeComponent){var ds=require("data-service");return new(function(){function Aliases(){return _classCallCheck(this,Aliases),_possibleConstructorReturn(this,(Aliases.__proto__||Object.getPrototypeOf(Aliases)).apply(this,arguments))}return _inherits(Aliases,BaseNodeComponent),_createClass(Aliases,[{key:"getAddress",value:function(alias){return ds.api.aliases.getAddressByAlias(alias).then(function(_ref176){return _ref176.address})}},{key:"getAliasList",value:function(){return ds.dataManager.getLastAliases()}},{key:"validate",value:function(alias){return 4<=alias.length&&alias.length<=WavesApp.maxAliasLength&&alias.split("").every(function(char){return"-.0123456789@_abcdefghijklmnopqrstuvwxyz".includes(char)})}}]),Aliases}())};factory.$inject=["BaseNodeComponent"],angular.module("app").factory("aliases",factory)}(),function(){var Money=require("@waves/data-entities").Money,BigNumber=require("@waves/bignumber").BigNumber,factory=function(BaseNodeComponent,utils,user,decorators,createPoll){var _dec24,_class95,Assets=(_dec24=decorators.cachable(5),_applyDecoratedDescriptor((_class95=function(){function Assets(){_classCallCheck(this,Assets);var _this485=_possibleConstructorReturn(this,(Assets.__proto__||Object.getPrototypeOf(Assets)).call(this));return user.onLogin().then(function(){_this485._handleLogin(),user.loginSignal.on(_this485._handleLogin,_this485),user.getSetting("scamListUrl")?_this485.stopScam():_this485.giveMyScamBack(),user.getSetting("tokensNameListUrl")?_this485.tokensNameList():_this485.giveMyTokensNameBack()}),_this485}return _inherits(Assets,BaseNodeComponent),_createClass(Assets,[{key:"getBalanceByAddress",value:function(address){return ds.api.assets.wavesBalance(address)}},{key:"info",value:function(assetId){return assetId===WavesApp.defaultAssets.WAVES?this.getAsset(assetId):Promise.all([this.getAsset(assetId),ds.fetch(this.node+"/assets/details/"+assetId)]).then(function(_ref177){var _ref178=_slicedToArray(_ref177,2),asset=_ref178[0],assetData=_ref178[1];return Assets._updateAsset(asset,assetData),asset})}},{key:"getAsset",value:function(assetId){return ds.api.assets.get(assetId)}},{key:"balance",value:function(assetId){return this.balanceList([assetId]).then(function(_ref179){return _slicedToArray(_ref179,1)[0]})}},{key:"search",value:function(query){return $.get(WavesApp.network.api+"/assets/search/"+encodeURIComponent(query),function(data){return data.map(function(item){return item.name=WavesApp.remappedAssetNames[item.id]||item.name,item})})}},{key:"balanceList",value:function(assetIdList){var _this486=this;return utils.whenAll([this.userBalances(),this._getEmptyBalanceList(assetIdList)]).then(function(_ref181){var _ref182=_slicedToArray(_ref181,2),balanceList=_ref182[0],emptyBalanceList=_ref182[1],balances=utils.toHash(balanceList,"available.asset.id");return Promise.all(emptyBalanceList.map(function(money){return balances[money.asset.id]?Promise.resolve(balances[money.asset.id]):_this486.info(money.asset.id).then(function(){return{asset:money.asset,regular:money,available:money,inOrders:money,leasedOut:money,leasedIn:money}})}))})}},{key:"userBalances",value:function(){return ds.dataManager.getBalances()}},{key:"giveMyScamBack",value:function(){user.scam=Object.create(null),this._pollScam&&(this._pollScam.destroy(),this._pollScam=null)}},{key:"giveMyTokensNameBack",value:function(){user.tokensName=Object.create(null),this._pollTokensNames&&(this._pollTokensNames.destroy(),this._pollTokensNames=null)}},{key:"stopScam",value:function(){this._pollScam=createPoll(this,this._getScamAssetList,this._setScamAssetList,15e3)}},{key:"tokensNameList",value:function(){this._pollTokensNames=createPoll(this,this._getTokensNameList,function(hash){return user.setTokensNameList(hash)},2e4)}},{key:"_getTokensNameList",value:function(){return ds.fetch(user.getSetting("tokensNameListUrl")+"?"+WavesApp.version+"-"+Date.now()).then(function(text){var papa=require("papaparse"),hash=Object.create(null);return papa.parse(text).data.forEach(function(_ref183){var id=_slicedToArray(_ref183,1)[0];id&&(hash[id]=!0)}),hash}).catch(function(){return Object.create(null)})}},{key:"_handleLogin",value:function(){user.getSetting("scamListUrl")?this.stopScam():this.giveMyScamBack()}},{key:"_getScamAssetList",value:function(){return ds.fetch(user.getSetting("scamListUrl")+"?"+WavesApp.version+"-"+Date.now()).then(function(text){var papa=require("papaparse"),hash=Object.create(null);return papa.parse(text).data.forEach(function(_ref185){var id=_slicedToArray(_ref185,1)[0];id&&(hash[id]=!0)}),hash}).catch(function(){return Object.create(null)})}},{key:"_setScamAssetList",value:function(hash){user.setScam(hash)}},{key:"_getEmptyBalanceList",value:function(idList){return ds.api.assets.get(idList).then(function(list){return list.map(function(asset){return new Money(0,asset)})})}}],[{key:"_updateAsset",value:function(asset,props){asset.reissuable=props.reissuable,asset.quantity=new BigNumber(props.quantity)}}]),Assets}()).prototype,"info",[_dec24],Object.getOwnPropertyDescriptor(_class95.prototype,"info"),_class95.prototype),_class95);return utils.bind(new Assets)};factory.$inject=["BaseNodeComponent","utils","user","decorators","createPoll"],angular.module("app").factory("assets",factory)}(),function(){var factory=function(Base,utils,eventManager,user,configService){var ds=require("data-service"),Money=require("@waves/data-entities").Money,_require112=require("@waves/signature-adapter"),currentFeeFactory=_require112.currentFeeFactory,SIGN_TYPE=_require112.SIGN_TYPE,address=require("@waves/waves-transactions").libs.crypto.address,path=require("ramda").path,BigNumber=require("@waves/bignumber").BigNumber,MULTY_FEE_TRANSACTIONS=_defineProperty({},SIGN_TYPE.TRANSFER,!0);return function(){function BaseNodeComponent(){return _classCallCheck(this,BaseNodeComponent),_possibleConstructorReturn(this,(BaseNodeComponent.__proto__||Object.getPrototypeOf(BaseNodeComponent)).apply(this,arguments))}return _inherits(BaseNodeComponent,Base),_createClass(BaseNodeComponent,[{key:"_feeList",value:function(_ref187){var _this488=this,tx=_ref187.tx,feeConfig=configService.getFeeConfig(),currentFee=currentFeeFactory(feeConfig);return this._fillTransaction(tx).then(function(tx){return Promise.all([_this488._getAssets(tx).then(function(assetList){return assetList.filter(function(asset){return asset.hasScript})}).then(function(assetList){return assetList.map(function(asset){return asset.id})}),ds.signature.getSignatureApi().makeSignable({type:tx.type,data:tx}).getBytes(),ds.api.assets.get("WAVES"),_this488._isSmartAccount(tx)]).then(function(_ref188){var _ref189=_slicedToArray(_ref188,4),smartAssetsIdList=_ref189[0],bytes=_ref189[1],wavesAsset=_ref189[2],hasScript=_ref189[3],bigNumberFee=currentFee(tx,bytes,hasScript,smartAssetsIdList),count=bigNumberFee.div(feeConfig.calculate_fee_rules.default.fee).roundTo(0,BigNumber.ROUND_MODE.ROUND_UP),fee=new Money(bigNumberFee,wavesAsset),feeList=ds.utils.getTransferFeeList().map(function(money){return money.cloneWithTokens(money.getTokens().mul(count))});return MULTY_FEE_TRANSACTIONS[tx.type]?[fee].concat(_toConsumableArray(feeList)):[fee]})})}},{key:"getFee",value:function(tx,fee){return this._feeList({tx:tx}).then(function(list){if(fee){var hash=utils.toHash(list,"asset.id");if(hash[fee.asset.id]&&hash[fee.asset.id].getTokens().lte(fee.getTokens()))return fee;throw new Error("Wrong fee!")}return list[0]})}},{key:"getFeeList",value:function(tx){return this._feeList({tx:tx})}},{key:"_isSmartAccount",value:function(tx){var publicKey=tx.senderPublicKey;if(!publicKey||user.publicKey===publicKey)return Promise.resolve(user.hasScript());var wavesAddress=address({publicKey:publicKey},WavesApp.network.code);return ds.api.address.getScriptInfo(wavesAddress).then(function(data){return data.extraFee.getTokens().gt(0)})}},{key:"_pipeTransaction",value:function(moneyList){return function(transaction){return eventManager.addTx(transaction,moneyList),transaction}}},{key:"_fillTransaction",value:function(tx){switch(tx.type){case SIGN_TYPE.ISSUE:return this._fillIssue(tx);case SIGN_TYPE.TRANSFER:return this._fillTransfer(tx);case SIGN_TYPE.REISSUE:return this._fillReissue(tx);case SIGN_TYPE.BURN:return this._fillBurn(tx);case SIGN_TYPE.LEASE:return this._fillLease(tx);case SIGN_TYPE.CANCEL_LEASING:return this._fillCancelLease(tx);case SIGN_TYPE.CREATE_ALIAS:return this._fillCreateAlias(tx);case SIGN_TYPE.MASS_TRANSFER:return this._fillMassTransfer(tx);case SIGN_TYPE.DATA:return this._fillData(tx);case SIGN_TYPE.SET_SCRIPT:return this._fillSetScript(tx);case SIGN_TYPE.SPONSORSHIP:return this._fillSponsorship(tx);case SIGN_TYPE.SET_ASSET_SCRIPT:return this._fillSetAssetScript(tx);default:throw new Error("Unsupported type "+tx.type+"!")}}},{key:"_getAssets",value:function(tx){return Promise.all([["amount"],["fee"],["assetId"],["transfers",0,"amount"]].map(function(localPath){var value=path(localPath,tx);return value instanceof BigNumber?null:"string"==typeof value?ds.api.assets.get(value).catch(function(){return{id:value,hasScript:!1}}):value instanceof Money?{id:value.asset.id,hasScript:value.asset.hasScript}:null}).filter(Boolean))}},{key:"_fillIssue",value:function(tx){return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,name:tx.name||"name",description:tx.description||"description",reissuable:null==tx.reissue||tx.reissue,quantity:tx.quantity||new BigNumber(1),precision:tx.precision||0,decimals:tx.precision||0,script:tx.script||"",fee:tx.fee||new Money(1,asset)}})}},{key:"_fillTransfer",value:function(tx){return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,recipient:tx.recipient||user.address,amount:tx.amount||new Money(1,asset),fee:tx.fee||new Money(1,asset),attachment:tx.attachment instanceof Uint8Array?Array.from(tx.attachment):String(tx.attachment),senderPublicKey:tx.senderPublicKey||user.publicKey,assetId:tx.assetId||asset.id}})}},{key:"_fillReissue",value:function(tx){return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,assetId:tx.assetId||WavesApp.defaultAssets.BTC,reissuable:tx.reissue||!0,quantity:tx.quantity||new BigNumber(1),fee:tx.fee||new Money(1,asset)}})}},{key:"_fillBurn",value:function(tx){return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,assetId:tx.assetId||WavesApp.defaultAssets.BTC,amount:tx.amount||new BigNumber(1),fee:tx.fee||new Money(1,asset)}})}},{key:"_fillLease",value:function(tx){return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,recipient:tx.recipient||user.address,fee:tx.fee||new Money(1,asset),amount:tx.amount||new Money(1,asset)}})}},{key:"_fillCancelLease",value:function(tx){return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,leaseId:tx.leaseId||WavesApp.defaultAssets.BTC,fee:tx.fee||new Money(1,asset)}})}},{key:"_fillCreateAlias",value:function(tx){return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,alias:tx.alias||"qwerty",fee:tx.fee||new Money(1,asset)}})}},{key:"_fillMassTransfer",value:function(tx){var transfers=tx.transfers&&tx.transfers.length?tx.transfers:null,totalAmount=transfers&&transfers.reduce(function(acc,item){return acc.add(item.amount)},tx.transfers[0].amount.cloneWithTokens(0))||null;return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,transfers:transfers||[{amount:new Money(1,asset),recipient:user.address}],totalAmount:totalAmount||new Money(1,asset),fee:tx.fee||new Money(1,asset),assetId:tx.assetId||asset.id}})}},{key:"_fillData",value:function(tx){return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,data:tx.data||[],fee:tx.fee||new Money(1,asset)}})}},{key:"_fillSetScript",value:function(tx){return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,script:tx.script||"",fee:tx.fee||new Money(1,asset)}})}},{key:"_fillSponsorship",value:function(tx){return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,assetId:tx.assetId||WavesApp.defaultAssets.BTC,minSponsoredAssetFee:tx.minSponsoredAssetFee||new Money(1,asset),fee:tx.fee||new Money(1,asset)}})}},{key:"_fillSetAssetScript",value:function(tx){return ds.api.assets.get("WAVES").then(function(asset){return{type:tx.type,script:tx.script||"base64:AQa3b8tH",assetId:tx.assetId||WavesApp.defaultAssets.BTC,fee:tx.fee||new Money(1,asset)}})}},{key:"matcher",get:function(){return user.getSetting("network.matcher")}},{key:"node",get:function(){return user.getSetting("network.node")}}]),BaseNodeComponent}()};factory.$inject=["Base","utils","eventManager","user","configService"],angular.module("app").factory("BaseNodeComponent",factory)}(),function(){var factory=function(user,utils,aliases,decorators,BaseNodeComponent,matcher){var _dec25,_dec26,_class96,tsUtils=require("ts-utils"),R=require("ramda"),SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,ds=require("data-service"),Money=require("@waves/data-entities").Money,TYPES=WavesApp.TRANSACTION_TYPES.EXTENDED,Transactions=(_dec25=decorators.cachable(120),_dec26=decorators.cachable(1),_applyDecoratedDescriptor((_class96=function(){function Transactions(){_classCallCheck(this,Transactions);var _this489=_possibleConstructorReturn(this,(Transactions.__proto__||Object.getPrototypeOf(Transactions)).call(this));return _this489.TYPES=TYPES,_this489}return _inherits(Transactions,BaseNodeComponent),_createClass(Transactions,[{key:"get",value:function(id){return ds.api.transactions.get(id).then(this._pipeTransaction())}},{key:"getUtx",value:function(id){return ds.api.transactions.getUTX(id).then(this._pipeTransaction())}},{key:"getAlways",value:function(id){var _this490=this;return this.get(id).catch(function(){return _this490.getUtx(id)}).catch(function(){return _this490.get(id)})}},{key:"list",value:function(argument_0,argument_1){var limit=0<arguments.length&&void 0!==argument_0?argument_0:1e3,after=argument_1;return this._list(limit,after,user.address)}},{key:"getActiveLeasingTx",value:function(){return this._getActiveLeasingTx(user.address)}},{key:"listUtx",value:function(){var _this491=this;return ds.api.transactions.listUTX(user.address).then(function(list){return list.map(_this491._pipeTransaction())})}},{key:"listAlways",value:function(){return utils.whenAll([this.listUtx(),this.list()]).then(function(_ref190){var _ref191=_slicedToArray(_ref190,2),utxTxList=_ref191[0],txList=_ref191[1];return utxTxList.concat(txList)})}},{key:"getExchangeTxList",value:function(prams,options){return ds.api.transactions.getExchangeTxList(_extends({matcher:matcher.currentMatcherAddress},prams),options)}},{key:"createTransaction",value:function(txData){var tx=_extends({sender:user.address,timestamp:Date.now()},txData);return tx.type===SIGN_TYPE.MASS_TRANSFER&&(tx.totalAmount=tx.totalAmount||tx.transfers.map(function(_ref192){return _ref192.amount}).reduce(function(result,item){return result.add(item)}),tx.assetId=tx.totalAmount&&tx.totalAmount.asset.id),tx.fee||(tx.fee=Money.fromCoins(0,ds.api.assets.wavesAsset)),this._pipeTransaction(!1)(tx)}},{key:"_getActiveLeasingTx",value:function(address){var _this492=this;return ds.fetch(this.node+"/leasing/active/"+address).then(R.uniqBy(R.prop("id"))).then(R.map(function(item){return _extends({},item,{status:"active"})})).then(function(list){return ds.api.transactions.parseTx(list,!1)}).then(function(list){return list.map(_this492._pipeTransaction())})}},{key:"_list",value:function(limit,after,address){var _this493=this;return ds.api.transactions.list(address,limit,after).then(function(list){return list.map(_this493._pipeTransaction())})}},{key:"_pipeTransaction",value:function(){return function(tx){tx.timestamp=new Date(tx.timestamp),tx.typeName=utils.getTransactionTypeName(tx),tx.templateType=Transactions._getTemplateType(tx),tx.shownAddress=Transactions._getTransactionAddress(tx);var list=aliases.getAliasList();switch(tx.typeName){case TYPES.BURN:case TYPES.REISSUE:tx.name=tx.name||tsUtils.get(tx,"quantity.asset.name")||tsUtils.get(tx,"amount.asset.name");break;case TYPES.ISSUE:tx.quantityStr=tx.quantity.toFormat(tx.precision);break;case TYPES.MASS_SEND:tx.numberOfRecipients=tx.transfers.length,tx.amount=tx.totalAmount;break;case TYPES.MASS_RECEIVE:tx.amount=tx.transfers.filter(function(_ref193){var recipient=_ref193.recipient;return recipient===user.address||-1!==list.indexOf(recipient)}).map(function(_ref194){return _ref194.amount}).reduce(function(acc,val){return acc.add(val)},tx.totalAmount.cloneWithTokens(0))}return tx}}}],[{key:"_getTypeByName",value:function(txTypeName){switch(txTypeName){case WavesApp.TRANSACTION_TYPES.NODE.TRANSFER:return 4;case WavesApp.TRANSACTION_TYPES.NODE.MASS_TRANSFER:return 11;case WavesApp.TRANSACTION_TYPES.NODE.LEASE:return 8;case WavesApp.TRANSACTION_TYPES.NODE.CANCEL_LEASING:return 9;case WavesApp.TRANSACTION_TYPES.NODE.ISSUE:return 3;case WavesApp.TRANSACTION_TYPES.NODE.REISSUE:return 5;case WavesApp.TRANSACTION_TYPES.NODE.BURN:return 6;case WavesApp.TRANSACTION_TYPES.NODE.CREATE_ALIAS:return 10;case WavesApp.TRANSACTION_TYPES.NODE.DATA:return 12;case WavesApp.TRANSACTION_TYPES.NODE.SET_SCRIPT:return 13;case WavesApp.TRANSACTION_TYPES.NODE.SPONSORSHIP:return 14;case WavesApp.TRANSACTION_TYPES.NODE.SCRIPT_INVOCATION:return 16;default:throw new Error("Wrong tx name!")}}},{key:"_getTemplateType",value:function(_ref195){var typeName=_ref195.typeName;switch(typeName){case TYPES.SEND:case TYPES.RECEIVE:case TYPES.MASS_SEND:case TYPES.MASS_RECEIVE:case TYPES.CIRCULAR:return"transfer";case TYPES.ISSUE:case TYPES.REISSUE:case TYPES.BURN:return"tokens";case TYPES.LEASE_IN:case TYPES.LEASE_OUT:return"lease";case TYPES.EXCHANGE_BUY:case TYPES.EXCHANGE_SELL:return"exchange";case TYPES.DATA:return"data";case TYPES.SPONSORSHIP_START:case TYPES.SPONSORSHIP_STOP:return"sponsorship";case TYPES.SPONSORSHIP_FEE:return"sponsorship_fee";case TYPES.SCRIPT_INVOCATION:return"script-invocation";case TYPES.UNKNOWN:return"unknown";default:return typeName}}},{key:"_getTransactionAddress",value:function(_ref196){var typeName=_ref196.typeName,sender=_ref196.sender,recipient=_ref196.recipient;switch(typeName){case TYPES.RECEIVE:case TYPES.MASS_RECEIVE:case TYPES.ISSUE:case TYPES.REISSUE:case TYPES.LEASE_IN:case TYPES.CREATE_ALIAS:case TYPES.SPONSORSHIP_FEE:case TYPES.SCRIPT_INVOCATION:return sender;default:return recipient}}}]),Transactions}()).prototype,"_getActiveLeasingTx",[_dec25],Object.getOwnPropertyDescriptor(_class96.prototype,"_getActiveLeasingTx"),_class96.prototype),_applyDecoratedDescriptor(_class96.prototype,"_list",[_dec26],Object.getOwnPropertyDescriptor(_class96.prototype,"_list"),_class96.prototype),_class96);return utils.bind(new Transactions)};factory.$inject=["user","utils","aliases","decorators","BaseNodeComponent","matcher"],angular.module("app").factory("transactions",factory)}(),function(){var tsUtils=require("ts-utils"),Money=require("@waves/data-entities").Money,controller=function(user){return new(function(){function Burn(){_classCallCheck(this,Burn),this.props=null}return _createClass(Burn,[{key:"$postLink",value:function(){this.assetName=this.getAssetName(tsUtils.get(this.props,"amount.asset")||tsUtils.get(this.props,"quantity.asset")||this.props),this.name=tsUtils.get(this.props,"amount.asset.name")||tsUtils.get(this.props,"quantity.asset.name");var amount=tsUtils.get(this.props,"amount")||tsUtils.get(this.props,"quantity");this.amount=amount instanceof Money?amount.toFormat():amount.div(Math.pow(10,this.props.precision))}},{key:"getAssetName",value:function(asset){try{return user.scam[asset.id]?"":asset.name}catch(e){return""}}}]),Burn}())};controller.$inject=["user"],angular.module("app.ui").component("wBurn",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/burn/burn.html",controller:controller})}(),angular.module("app.ui").component("wCreateAlias",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/create-alias/create-alias.html"}),angular.module("app.ui").component("wCancelLeasing",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/cancel-leasing/cancel-leasing.html"}),function(){var controller=function(waves){var propEq=require("ramda").propEq;return new(function(){function Data(){_classCallCheck(this,Data),this.props=null}return _createClass(Data,[{key:"$postLink",value:function(){var _this494=this;if("data-vote"===this.props.typeName){var assetId=this.props.data.find(propEq("key","assetId")).value;waves.node.assets.getAsset(assetId).then(function(asset){_this494.assetName=asset.displayName})}}}]),Data}())};controller.$inject=["waves"],angular.module("app.ui").component("wData",{bindings:{props:"<"},controller:controller,templateUrl:"modules/ui/directives/transaction/types/data/data.html"})}(),function(){var controller=function(user,utils){return new(function(){function Exchange(){_classCallCheck(this,Exchange),this.props=null}return _createClass(Exchange,[{key:"$postLink",value:function(){this.typeName=this.props.typeName,this.amountAssetName=this.getAssetName(this.props.amount.asset),this.priceAssetName=this.getAssetName(this.props.price.asset),this.isScamAmount=!!user.scam[this.props.amount.asset],this.isScamPrice=!!user.scam[this.props.price.asset],this.amountParams={sign:"exchange-buy"===this.typeName?"+":"â",amount:this.props.amount.toFormat(),name:this.props.amount.asset.name},this.priceParams={sign:"exchange-buy"===this.typeName?"-":"+",amount:utils.getExchangeTotalPrice(this.props.amount,this.props.price),name:this.props.price.asset.name}}},{key:"getAssetName",value:function(asset){try{return user.scam[asset.id]?"":asset.name}catch(e){return""}}}]),Exchange}())};controller.$inject=["user","utils"],angular.module("app.ui").component("wExchangeData",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/exchange/exchange.html",controller:controller})}(),function(){var tsUtils=require("ts-utils"),Money=require("@waves/data-entities").Money,controller=function(user){return new(function(){function Issue(){_classCallCheck(this,Issue),this.props=null}return _createClass(Issue,[{key:"$postLink",value:function(){this.assetName=this.getAssetName(tsUtils.get(this.props,"amount.asset")||tsUtils.get(this.props,"quantity.asset")||this.props),this.name=tsUtils.get(this.props,"amount.asset.name")||tsUtils.get(this.props,"quantity.asset.name");var amount=tsUtils.get(this.props,"amount")||tsUtils.get(this.props,"quantity");this.amount=amount instanceof Money?amount.toFormat():amount.div(Math.pow(10,this.props.precision))}},{key:"getAssetName",value:function(asset){try{return user.scam[asset.id]?"":asset.name}catch(e){return""}}}]),Issue}())};controller.$inject=["user"],angular.module("app.ui").component("wIssue",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/issue/issue.html",controller:controller})}(),angular.module("app.ui").component("wLease",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/lease/lease.html"}),function(){var controller=function(Base,user,baseAssetService,waves,$scope,utils){return new(function(){function MassTransfer(){var _ref197,_temp16,_this495;_classCallCheck(this,MassTransfer);for(var _len22=arguments.length,args=Array(_len22),_key22=0;_key22<_len22;_key22++)args[_key22]=arguments[_key22];return(_temp16=_this495=_possibleConstructorReturn(this,(_ref197=MassTransfer.__proto__||Object.getPrototypeOf(MassTransfer)).call.apply(_ref197,[this].concat(args)))).props=null,_possibleConstructorReturn(_this495,_temp16)}return _inherits(MassTransfer,Base),_createClass(MassTransfer,[{key:"$postLink",value:function(){var _this496=this;this.typeName=this.props.typeName,this.time=this.props.time,this.address=this.props.shownAddress,this.isScam=this.props.isScam,this.receive(utils.observe(this.props,"isScam"),function(){_this496.isScam=_this496.props.isScam,utils.safeApply($scope)});var TYPES=waves.node.transactions.TYPES;switch(this.typeName){case TYPES.SPONSORSHIP_FEE:this.sponsoredFee();break;default:this.transfered()}}},{key:"getAssetName",value:function(asset){try{return user.scam[asset.id]?"":asset.name}catch(e){return""}}},{key:"sponsoredFee",value:function(){this.assetName=this.getAssetName(this.props.fee.asset),this.amountParams={sign:"+",amount:this.props.fee.toFormat(),name:this.props.fee.asset.name}}},{key:"transfered",value:function(){var _this497=this;this.assetName=this.getAssetName(this.props.amount.asset),this.amountParams={amount:this.props.amount.toFormat(),name:this.props.amount.asset.name},this.props.amount&&this.props.amount instanceof ds.wavesDataEntities.Money&&baseAssetService.convertToBaseAsset(this.props.amount).then(function(baseMoney){_this497.mirrorBalanceParams={amount:baseMoney.toFormat(),name:baseMoney.asset.name},$scope.$digest()})}}]),MassTransfer}())};controller.$inject=["Base","user","baseAssetService","waves","$scope","utils"],angular.module("app.ui").component("wMassTransferRow",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/mass-transfer/mass-transfer.html",controller:controller})}(),angular.module("app.ui").component("wScriptInvocation",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/script-invocation/script-invocation.html"}),function(){var tsUtils=require("ts-utils"),Money=require("@waves/data-entities").Money,controller=function(user){return new(function(){function Reissue(){_classCallCheck(this,Reissue),this.props=null}return _createClass(Reissue,[{key:"$postLink",value:function(){this.assetName=this.getAssetName(tsUtils.get(this.props,"amount.asset")||tsUtils.get(this.props,"quantity.asset")||this.props),this.name=tsUtils.get(this.props,"amount.asset.name")||tsUtils.get(this.props,"quantity.asset.name");var amount=tsUtils.get(this.props,"amount")||tsUtils.get(this.props,"quantity");this.amount=amount instanceof Money?amount.toFormat():amount.div(Math.pow(10,this.props.precision))}},{key:"getAssetName",value:function(asset){try{return user.scam[asset.id]?"":asset.name}catch(e){return""}}}]),Reissue}())};controller.$inject=["user"],angular.module("app.ui").component("wReissue",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/reissue/reissue.html",controller:controller})}(),function(){var controller=function(waves){return new(function(){function SetAssetScript(){_classCallCheck(this,SetAssetScript),this.props=null}return _createClass(SetAssetScript,[{key:"$postLink",value:function(){var _this498=this;this.props.assetId&&waves.node.assets.getAsset(this.props.assetId).then(function(asset){_this498.name=asset.name})}}]),SetAssetScript}())};controller.$inject=["waves"],angular.module("app.ui").component("wSetAssetScript",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/set-asset-script/set-asset-script.html",controller:controller})}(),angular.module("app.ui").component("wSetScript",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/set-script/set-script.html"}),function(){var tsUtils=require("ts-utils"),controller=function(user){return new(function(){function Sponsorship(){_classCallCheck(this,Sponsorship),this.props=null}return _createClass(Sponsorship,[{key:"$postLink",value:function(){this.assetName=this.getAssetName(tsUtils.get(this.props,"minSponsoredAssetFee.asset"))}},{key:"getAssetName",value:function(asset){try{return user.scam[asset.id]?"":asset.name}catch(e){return""}}}]),Sponsorship}())};controller.$inject=["user"],angular.module("app.ui").component("wSponsorship",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/sponsorship/sponsorship.html",controller:controller})}(),function(){var controller=function(Base,user,baseAssetService,waves,$scope,utils){return new(function(){function Transfer(){var _ref198,_temp17,_this499;_classCallCheck(this,Transfer);for(var _len23=arguments.length,args=Array(_len23),_key23=0;_key23<_len23;_key23++)args[_key23]=arguments[_key23];return(_temp17=_this499=_possibleConstructorReturn(this,(_ref198=Transfer.__proto__||Object.getPrototypeOf(Transfer)).call.apply(_ref198,[this].concat(args)))).props=Object.create(null),_possibleConstructorReturn(_this499,_temp17)}return _inherits(Transfer,Base),_createClass(Transfer,[{key:"$postLink",value:function(){var _this500=this;this.typeName=this.props.typeName,this.time=this.props.time,this.address=this.props.shownAddress,this.isScam=this.props.isScam,this.receive(utils.observe(this.props,"isScam"),function(){_this500.isScam=_this500.props.isScam,utils.safeApply($scope)});var TYPES=waves.node.transactions.TYPES;switch(this.typeName){case TYPES.SPONSORSHIP_FEE:this.sponsoredFee();break;default:this.transfered()}}},{key:"getAssetName",value:function(asset){try{return user.scam[asset.id]?"":asset.name}catch(e){return""}}},{key:"sponsoredFee",value:function(){this.assetName=this.getAssetName(this.props.fee.asset),this.amountParams={sign:"+",amount:this.props.fee.toFormat(),name:this.props.fee.asset.name}}},{key:"transfered",value:function(){var _this501=this;this.assetName=this.getAssetName(this.props.amount.asset),this.amountParams={amount:this.props.amount.toFormat(),name:this.props.amount.asset.name},this.props.amount&&this.props.amount instanceof ds.wavesDataEntities.Money&&baseAssetService.convertToBaseAsset(this.props.amount).then(function(baseMoney){_this501.mirrorBalanceParams={amount:baseMoney.toFormat(),name:baseMoney.asset.name},$scope.$digest()})}}]),Transfer}())};controller.$inject=["Base","user","baseAssetService","waves","$scope","utils"],angular.module("app.ui").component("wTransferRow",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/transfer/transfer.html",controller:controller})}(),angular.module("app.ui").component("wUnknown",{bindings:{props:"<"},templateUrl:"modules/ui/directives/transaction/types/unknown/unknown.html"}),function(){var controller=function(utils,baseAssetService,$scope){return new(function(){function CancelLeaseHeader(){_classCallCheck(this,CancelLeaseHeader),this.needShowMirror=!1}return _createClass(CancelLeaseHeader,[{key:"$postLink",value:function(){var _this502=this;this.transaction=this.signable.getTxData(),this.typeName=utils.getTransactionTypeName(this.transaction),this.transaction.lease.amount.asset.id!==baseAssetService.getBaseAssetId()&&baseAssetService.convertToBaseAsset(this.transaction.lease.amount).then(function(mirror){_this502.mirrorBalance=mirror,_this502.needShowMirror=_this502.mirrorBalance.getCoins().gt(0),$scope.$apply()})}}]),CancelLeaseHeader}())};controller.$inject=["utils","baseAssetService","$scope"],angular.module("app.ui").component("wCancelLeaseHeader",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/cancel-lease/header.html"})}(),function(){var controller=function($scope){return new(function(){function CancelLeaseInfo(){_classCallCheck(this,CancelLeaseInfo)}return _createClass(CancelLeaseInfo,[{key:"$postLink",value:function(){var _this503=this;this.transaction=this.signable.getTxData(),(this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()).then(function(id){_this503.id=id,$scope.$apply()})}}]),CancelLeaseInfo}())};controller.$inject=["$scope"],angular.module("app.ui").component("wCancelLeaseInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/cancel-lease/info.html"})}(),function(){var controller=function(utils){return new(function(){function BurnHeader(){_classCallCheck(this,BurnHeader)}return _createClass(BurnHeader,[{key:"$postLink",value:function(){this.transaction=this.signable.getTxData(),this.quantity=this.transaction.amount.toFormat(),this.name=this.transaction.amount.asset.name,this.typeName=utils.getTransactionTypeName(this.transaction)}}]),BurnHeader}())};controller.$inject=["utils"],angular.module("app.ui").component("wBurnHeader",{bindings:{signable:"<",isScam:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/burn/burn-header.html"})}(),function(){var Money=require("@waves/data-entities").Money,ds=require("data-service"),controller=function(Base,$scope,waves,balanceWatcher){return new(function(){function BurnInfo(){var _ref199,_temp18,_this504;_classCallCheck(this,BurnInfo);for(var _len24=arguments.length,args=Array(_len24),_key24=0;_key24<_len24;_key24++)args[_key24]=arguments[_key24];return(_temp18=_this504=_possibleConstructorReturn(this,(_ref199=BurnInfo.__proto__||Object.getPrototypeOf(BurnInfo)).call.apply(_ref199,[this].concat(args)))).isConfirm=!1,_this504.id="",_possibleConstructorReturn(_this504,_temp18)}return _inherits(BurnInfo,Base),_createClass(BurnInfo,[{key:"$postLink",value:function(){var _this505=this;this.transaction=this.signable.getTxData();(this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()).then(function(id){return _this505.id=id}).then(function(id){return waves.node.transactions.get(id)}).then(function(){return!1},function(){return!0}).then(function(isConfirm){return _this505.isConfirm=isConfirm}).then(function(){return $scope.$apply()}),this.receive(balanceWatcher.change,this._onChangeBalances,this),this._onChangeBalances()}},{key:"_onChangeBalances",value:function(){var _this506=this,hash=balanceWatcher.getBalance();if(!Object.keys(hash).length)return null;var assetId=this.transaction.assetId;ds.api.assets.get(assetId).then(function(asset){var quantity=new Money(asset.quantity,asset),toReissue=_this506.transaction.amount;_this506.toRemainOnBalance=(hash[assetId]||new Money(0,asset)).sub(toReissue),_this506.totalAfterIssueTokens=quantity.sub(toReissue),$scope.$apply()})}}]),BurnInfo}())};controller.$inject=["Base","$scope","waves","balanceWatcher"],angular.module("app.ui").component("wBurnInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/burn/burn-info.html"})}(),function(){var controller=function($scope){return new(function(){function CreateAliasInfo(){_classCallCheck(this,CreateAliasInfo)}return _createClass(CreateAliasInfo,[{key:"$postLink",value:function(){var _this507=this;this.transaction=this.signable.getTxData(),(this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()).then(function(id){_this507.id=id,$scope.$apply()})}}]),CreateAliasInfo}())};controller.$inject=["$scope"],angular.module("app.ui").component("wCreateAliasInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/create-alias/create-alias-info.html"})}(),function(){var controller=function(utils){return new(function(){function ExchangeHeader(){_classCallCheck(this,ExchangeHeader),this.signPrice="â",this.signAmount="+"}return _createClass(ExchangeHeader,[{key:"$postLink",value:function(){this.transaction=this.signable.getTxData(),this.typeName="create-order",this.totalPrice=utils.getExchangeTotalPrice(this.transaction.amount,this.transaction.price),this.signPrice="exchange-buy"===this.typeName?"â":"+",this.signAmount="exchange-buy"===this.typeName?"+":"â"}}]),ExchangeHeader}())};controller.$inject=["utils","baseAssetService","$scope"],angular.module("app.ui").component("wCreateOrderHeader",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/create-order/createOrderHeader.html"})}(),function(){var controller=function($scope){return new(function(){function CreateOrderInfo(){_classCallCheck(this,CreateOrderInfo)}return _createClass(CreateOrderInfo,[{key:"$postLink",value:function(){var _this508=this;this.order=this.signable.getTxData(),this.signable.getId().then(function(id){_this508.id=id,$scope.$apply()})}}]),CreateOrderInfo}())};controller.$inject=["$scope"],angular.module("app.ui").component("wCreateOrderInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/create-order/createOrder.html"})}(),angular.module("app.ui").component("wDataHeader",{bindings:{signable:"<",voteObject:"<"},templateUrl:"modules/ui/directives/transactionInfo/types/data/data-header.html"}),function(){var controller=function($scope,$element){return new(function(){function DataInfo(){_classCallCheck(this,DataInfo),this.dataVisible=!1,this.allVisible=!1}return _createClass(DataInfo,[{key:"$postLink",value:function(){var _this509=this;this.transaction=this.signable.getTxData(),this.json=JSON.stringify(this.transaction.data,null,"\t"),(this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()).then(function(id){_this509.id=id,$scope.$apply()})}},{key:"toggleAll",value:function(){this.allVisible=!this.allVisible,$element.find(".transaction-details__list").stop().animate({scrollTop:0},300)}},{key:"toggleVisible",value:function(){this.allVisible=!1,this.dataVisible=!this.dataVisible}}]),DataInfo}())};controller.$inject=["$scope","$element"],angular.module("app.ui").component("wDataInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/data/data-info.html"})}(),function(){var controller=function(utils){return new(function(){function ExchangeHeader(){_classCallCheck(this,ExchangeHeader),this.signPrice="â",this.signAmount="+"}return _createClass(ExchangeHeader,[{key:"$postLink",value:function(){this.transaction=this.signable.getTxData(),this.typeName=utils.getTransactionTypeName(this.transaction),this.totalPrice=utils.getExchangeTotalPrice(this.transaction.amount,this.transaction.price),this.signPrice="exchange-buy"===this.typeName?"â":"+",this.signAmount="exchange-buy"===this.typeName?"+":"â"}}]),ExchangeHeader}())};controller.$inject=["utils","baseAssetService","$scope"],angular.module("app.ui").component("wExchangeHeader",{bindings:{signable:"<",isScamAmount:"<",isScamPrice:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/exchange/header.html"})}(),function(){var controller=function(utils){return new(function(){function ExchangeInfo(){_classCallCheck(this,ExchangeInfo)}return _createClass(ExchangeInfo,[{key:"$postLink",value:function(){this.transaction=this.signable.getTxData(),this.id=this.transaction.id,this.fee=utils.getExchangeFee(this.transaction),this.showSellMatcherFee=this.transaction.exchangeType===this.transaction.sellOrder.orderType,this.showBuyMatcherFee=this.transaction.exchangeType===this.transaction.buyOrder.orderType}}]),ExchangeInfo}())};controller.$inject=["utils"],angular.module("app.ui").component("wExchangeInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/exchange/info.html"})}(),function(){var controller=function(){return new(function(){function IssueHeader(){_classCallCheck(this,IssueHeader)}return _createClass(IssueHeader,[{key:"$postLink",value:function(){this._tx=this.signable.getTxData(),this.name=this._tx.name,this.quantity=this._tx.quantity.div(Math.pow(10,this._tx.precision)).toFormat(this._tx.precision)}}]),IssueHeader}())};controller.$inject=[],angular.module("app.ui").component("wIssueHeader",{bindings:{signable:"<",isScam:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/issue/issue-header.html"})}(),function(){var controller=function($scope,$element){return new(function(){function IssueInfo(){_classCallCheck(this,IssueInfo),this.shownScript=!1}return _createClass(IssueInfo,[{key:"$postLink",value:function(){var _this510=this;this.$container=$element.find(".js-script-container"),this.$container.hide(),this.transaction=this.signable.getTxData(),(this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()).then(function(id){_this510.id=id,$scope.$apply()})}},{key:"toggleScript",value:function(){this.shownScript=!this.shownScript,this.$container.stop(!0,!0).slideToggle(100)}}]),IssueInfo}())};controller.$inject=["$scope","$element"],angular.module("app.ui").component("wIssueInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/issue/issue-info.html"})}(),function(){var controller=function(utils,baseAssetService,$scope){return new(function(){function LeaseHeader(){_classCallCheck(this,LeaseHeader),this.needShowMirror=!1}return _createClass(LeaseHeader,[{key:"$postLink",value:function(){var _this511=this;this.transaction=this.signable.getTxData(),this.typeName=utils.getTransactionTypeName(this.transaction),this.transaction.amount.asset.id!==baseAssetService.getBaseAssetId()&&baseAssetService.convertToBaseAsset(this.transaction.amount).then(function(mirror){_this511.mirrorBalance=mirror,_this511.needShowMirror=_this511.mirrorBalance.getCoins().gt(0),$scope.$apply()})}}]),LeaseHeader}())};controller.$inject=["utils","baseAssetService","$scope"],angular.module("app.ui").component("wLeaseHeader",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/lease/lease-header.html"})}(),function(){var controller=function($scope,utils,waves,Base){return new(function(){function LeaseInfo(){var _ref200,_temp19,_this512;_classCallCheck(this,LeaseInfo);for(var _len25=arguments.length,args=Array(_len25),_key25=0;_key25<_len25;_key25++)args[_key25]=arguments[_key25];return(_temp19=_this512=_possibleConstructorReturn(this,(_ref200=LeaseInfo.__proto__||Object.getPrototypeOf(LeaseInfo)).call.apply(_ref200,[this].concat(args)))).isLeaseIn=!1,_this512.isLeaseOut=!1,_this512.address="",_possibleConstructorReturn(_this512,_temp19)}return _inherits(LeaseInfo,Base),_createClass(LeaseInfo,[{key:"$postLink",value:function(){var _this513=this;switch(this.transaction=this.signable.getTxData(),this.isActive="active"===this.transaction.status,utils.getTransactionTypeName(this.transaction)){case WavesApp.TRANSACTION_TYPES.EXTENDED.LEASE_OUT:this.isLeaseOut=!0,this.address=this.transaction.recipient;break;case WavesApp.TRANSACTION_TYPES.EXTENDED.LEASE_IN:this.isLeaseIn=!0,this.address=this.transaction.sender}this._getId().then(function(id){_this513.id=id,_this513.confirmed?_this513._applyConfirmed():_this513.observeOnce("confirmed",_this513._applyConfirmed),$scope.$apply()})}},{key:"_applyConfirmed",value:function(){var _this514=this;waves.node.transactions.getAlways(this.id).then(function(res){_this514.transaction=res,_this514.isActive="active"===_this514.transaction.status,$scope.$apply()})}},{key:"_getId",value:function(){return this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()}}]),LeaseInfo}())};controller.$inject=["$scope","utils","waves","Base"],angular.module("app.ui").component("wLeaseInfo",{bindings:{signable:"<",confirmed:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/lease/lease-info.html"})}(),function(){var controller=function(utils,baseAssetService,$scope){return new(function(){function MassTransferHeader(){_classCallCheck(this,MassTransferHeader),this.needShowMirror=!1}return _createClass(MassTransferHeader,[{key:"$postLink",value:function(){var _this515=this,tx=this.signable.getTxData();this.typeName=utils.getTransactionTypeName(tx),this.amount=tx.amount.toFormat(),this.name=tx.amount.asset.name,tx.amount.asset.id!==baseAssetService.getBaseAssetId()&&baseAssetService.convertToBaseAsset(tx.amount).then(function(mirror){_this515.mirrorBalance=mirror,_this515.needShowMirror=_this515.mirrorBalance.getCoins().gt(0),$scope.$apply()})}}]),MassTransferHeader}())};controller.$inject=["utils","baseAssetService","$scope"],angular.module("app.ui").component("wMassTransferHeader",{bindings:{signable:"<",isScam:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/mass-transfer/header.html"})}(),function(){var controller=function($scope,utils){return new(function(){function MassTransferInfo(){_classCallCheck(this,MassTransferInfo),this.isSend=!1,this.isReceive=!1,this.showAllTX=!1,this.expandList=!1}return _createClass(MassTransferInfo,[{key:"$postLink",value:function(){var _this516=this;switch(this.transaction=this.signable.getTxData(),this.attachment=utils.bytesToSafeString(this.transaction.attachment),utils.getTransactionTypeName(this.transaction)){case WavesApp.TRANSACTION_TYPES.EXTENDED.MASS_SEND:this.isSend=!0;break;case WavesApp.TRANSACTION_TYPES.EXTENDED.MASS_RECEIVE:this.isReceive=!0}(this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()).then(function(id){_this516.id=id,$scope.$apply()})}}]),MassTransferInfo}())};controller.$inject=["$scope","utils"],angular.module("app.ui").component("wMassTransferInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/mass-transfer/info.html"})}(),function(){var controller=function(utils){return new(function(){function ReissueHeader(){_classCallCheck(this,ReissueHeader)}return _createClass(ReissueHeader,[{key:"$postLink",value:function(){this.transaction=this.signable.getTxData(),this.quantity=this.transaction.quantity.toFormat(this.transaction.precision),this.name=this.transaction.quantity.asset.name,this.typeName=utils.getTransactionTypeName(this.transaction)}}]),ReissueHeader}())};controller.$inject=["utils"],angular.module("app.ui").component("wReissueHeader",{bindings:{signable:"<",isScam:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/reissue/reissue-header.html"})}(),function(){var Money=require("@waves/data-entities").Money,ds=require("data-service"),controller=function(Base,$scope,waves,balanceWatcher){return new(function(){function ReissueInfo(){var _ref201,_temp20,_this517;_classCallCheck(this,ReissueInfo);for(var _len26=arguments.length,args=Array(_len26),_key26=0;_key26<_len26;_key26++)args[_key26]=arguments[_key26];return(_temp20=_this517=_possibleConstructorReturn(this,(_ref201=ReissueInfo.__proto__||Object.getPrototypeOf(ReissueInfo)).call.apply(_ref201,[this].concat(args)))).isConfirm=!1,_this517.id="",_possibleConstructorReturn(_this517,_temp20)}return _inherits(ReissueInfo,Base),_createClass(ReissueInfo,[{key:"$postLink",value:function(){var _this518=this;this.transaction=this.signable.getTxData();(this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()).then(function(id){return _this518.id=id}).then(function(id){return waves.node.transactions.get(id)}).then(function(){return!1},function(){return!0}).then(function(isConfirm){return _this518.isConfirm=isConfirm}).then(function(){return $scope.$apply()}),this.receive(balanceWatcher.change,this._onChangeBalances,this),this._onChangeBalances()}},{key:"_onChangeBalances",value:function(){var _this519=this,hash=balanceWatcher.getBalance();if(!Object.keys(hash).length)return null;var assetId=this.transaction.assetId;ds.api.assets.get(assetId).then(function(asset){var quantity=new Money(asset.quantity,asset),toReissue=_this519.transaction.quantity;_this519.toRemainOnBalance=(hash[assetId]||new Money(0,asset)).add(toReissue),_this519.totalAfterIssueTokens=quantity.add(toReissue),$scope.$apply()})}}]),ReissueInfo}())};controller.$inject=["Base","$scope","waves","balanceWatcher"],angular.module("app.ui").component("wReissueInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/reissue/reissue-info.html"})}(),function(){var controller=function($element){return new(function(){function DataInfo(){_classCallCheck(this,DataInfo),this.dataVisible=!1,this.allVisible=!1}return _createClass(DataInfo,[{key:"$postLink",value:function(){var _this520=this;if(this.transaction=this.signable.getTxData(),(this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()).then(function(id){_this520.id=id}),this.json=JSON.stringify(this.transaction.call&&this.transaction.call.args||[],null,4),0<this.transaction.payment.length){var payment=this.transaction.payment[0];this.payment=payment.getTokens().toFormat()+" "+payment.asset.displayName}this.transaction.call&&(this.args=this.transaction.call.args)}},{key:"toggleAll",value:function(){this.allVisible=!this.allVisible,$element.find(".transaction-details__list").stop().animate({scrollTop:0},300)}},{key:"toggleVisible",value:function(){this.allVisible=!1,this.dataVisible=!this.dataVisible}}]),DataInfo}())};controller.$inject=["$element"],angular.module("app.ui").component("wScriptInvocationInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/script-invocation/script-invocation-info.html"})}(),angular.module("app.ui").component("wScriptInvocationHeader",{bindings:{typeName:"<"},templateUrl:"modules/ui/directives/transactionInfo/types/script-invocation/script-invocation-header.html"}),function(){var ds=require("data-service"),controller=function($scope,$element){return new(function(){function SetAssetScriptInfo(){_classCallCheck(this,SetAssetScriptInfo),this.shownScript=!1}return _createClass(SetAssetScriptInfo,[{key:"$postLink",value:function(){var _this521=this;this.transaction=this.signable.getTxData(),this.transaction.script=this.transaction.script||"",this.$container=$element.find(".js-script-container"),this.$container.hide(),ds.api.assets.get(this.transaction.assetId).then(function(asset){_this521.asset=asset,$scope.$apply()}),(this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()).then(function(id){_this521.id=id,$scope.$apply()})}},{key:"toggleScript",value:function(){this.shownScript=!this.shownScript,this.$container.stop(!0,!0).slideToggle(100)}}]),SetAssetScriptInfo}())};controller.$inject=["$scope","$element"],angular.module("app.ui").component("wSetAssetScriptInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/set-asset-script/info.html"})}(),function(){var controller=function(utils){return new(function(){function SetScriptAssetHeader(){_classCallCheck(this,SetScriptAssetHeader)}return _createClass(SetScriptAssetHeader,[{key:"$postLink",value:function(){this.transaction=this.signable.getTxData(),this.typeName=utils.getTransactionTypeName(this.transaction)}}]),SetScriptAssetHeader}())};controller.$inject=["utils"],angular.module("app.ui").component("wSetScriptAssetHeader",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/set-asset-script/header.html"})}(),function(){var controller=function(utils){return new(function(){function SetScriptHeader(){_classCallCheck(this,SetScriptHeader)}return _createClass(SetScriptHeader,[{key:"$postLink",value:function(){this.transaction=this.signable.getTxData(),this.typeName=utils.getTransactionTypeName(this.transaction)}}]),SetScriptHeader}())};controller.$inject=["utils"],angular.module("app.ui").component("wSetScriptHeader",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/set-script/header.html"})}(),function(){var controller=function($scope){return new(function(){function SetScriptInfo(){_classCallCheck(this,SetScriptInfo),this.hasScript=!1}return _createClass(SetScriptInfo,[{key:"$postLink",value:function(){var _this522=this;this.transaction=this.signable.getTxData(),this.hasScript=!!(this.transaction.script||"").replace("base64:",""),this.transaction.script=this.transaction.script||"",(this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()).then(function(id){_this522.id=id,$scope.$apply()})}}]),SetScriptInfo}())};controller.$inject=["$scope"],angular.module("app.ui").component("wSetScriptInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/set-script/info.html"})}(),function(){var controller=function(utils){return new(function(){function SponsorshipHeader(){_classCallCheck(this,SponsorshipHeader)}return _createClass(SponsorshipHeader,[{key:"$postLink",value:function(){this.transaction=this.signable.getTxData(),this.typeName=utils.getTransactionTypeName(this.transaction)}}]),SponsorshipHeader}())};controller.$inject=["utils"],angular.module("app.ui").component("wSponsorshipHeader",{bindings:{signable:"<",isScam:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/sponsorship/header.html"})}(),function(){var controller=function($scope){return new(function(){function SponsorshipInfo(){_classCallCheck(this,SponsorshipInfo)}return _createClass(SponsorshipInfo,[{key:"$postLink",value:function(){var _this523=this;this.transaction=this.signable.getTxData(),(this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()).then(function(id){_this523.id=id,$scope.$apply()})}}]),SponsorshipInfo}())};controller.$inject=["$scope"],angular.module("app.ui").component("wSponsorshipInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/sponsorship/info.html"})}(),function(){var controller=function(utils,baseAssetService,$scope){return new(function(){function TransferHeader(){_classCallCheck(this,TransferHeader),this.needShowMirror=!1,this.isSponsor=!1}return _createClass(TransferHeader,[{key:"$postLink",value:function(){var _this524=this,tx=this.signable.getTxData();this.typeName=utils.getTransactionTypeName(tx),this.isSponsor=this.typeName===WavesApp.TRANSACTION_TYPES.EXTENDED.SPONSORSHIP_FEE,this.amount=this.isSponsor?tx.fee.toFormat():tx.amount.toFormat(),this.name=this.isSponsor?tx.fee.asset.name:tx.amount.asset.name,this.isSponsor||tx.amount.asset.id===baseAssetService.getBaseAssetId()||baseAssetService.convertToBaseAsset(tx.amount).then(function(mirror){_this524.mirrorBalance=mirror,_this524.needShowMirror=_this524.mirrorBalance.getCoins().gt(0),$scope.$apply()})}}]),TransferHeader}())};controller.$inject=["utils","baseAssetService","$scope"],angular.module("app.ui").component("wTransferHeader",{bindings:{signable:"<",isScam:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/transfer/transfer-header.html"})}(),function(){var controller=function($scope,utils){return new(function(){function TransferInfo(){_classCallCheck(this,TransferInfo),this.isReceive=!1,this.isSend=!1,this.isSelf=!1,this.isSponsor=!1,this.attachment=""}return _createClass(TransferInfo,[{key:"$postLink",value:function(){var _this525=this;switch(this.transaction=this.signable.getTxData(),this.attachment=utils.bytesToSafeString(this.transaction.attachment),utils.getTransactionTypeName(this.transaction)){case WavesApp.TRANSACTION_TYPES.EXTENDED.CIRCULAR:this.isSelf=!0;break;case WavesApp.TRANSACTION_TYPES.EXTENDED.SEND:this.isSend=!0;break;case WavesApp.TRANSACTION_TYPES.EXTENDED.RECEIVE:this.isReceive=!0;break;case WavesApp.TRANSACTION_TYPES.EXTENDED.SPONSORSHIP_FEE:this.isSponsor=!0}(this.transaction.id?Promise.resolve(this.transaction.id):this.signable.getId()).then(function(id){_this525.id=id,$scope.$apply()})}}]),TransferInfo}())};controller.$inject=["$scope","utils"],angular.module("app.ui").component("wTransferInfo",{bindings:{signable:"<"},controller:controller,templateUrl:"modules/ui/directives/transactionInfo/types/transfer/transfer-info.html"})}(),function(){var controller=function(Base,readFile,$scope,utils,validateService,waves,user,decorators){var _dec27,_dec28,_dec29,_dec30,_class133,Papa=require("papaparse"),BigNumber=require("@waves/bignumber").BigNumber,analytics=require("@waves/event-sender");return new(_dec27=decorators.async(),_dec28=decorators.async(),_dec29=decorators.async(),_dec30=decorators.cachable(60),_applyDecoratedDescriptor((_class133=function(){function MassSend(){_classCallCheck(this,MassSend);var _this526=_possibleConstructorReturn(this,(MassSend.__proto__||Object.getPrototypeOf(MassSend)).call(this));return _this526.state=null,_this526.maxTransfersCount=100,_this526.onContinue=null,_this526.recipientCsv="",_this526.totalAmount=null,_this526.errors=[],_this526.transfers=[],_this526.view=utils.liteObject({errors:utils.liteObject({showAll:!1})}),_this526.isValidAmounts=!0,_this526.massSend=null,_this526.importError=!1,_this526.hasFee=!1,_this526}return _inherits(MassSend,Base),_createClass(MassSend,[{key:"tx",get:function(){return this.state.massSend}},{key:"validTxCount",get:function(){if(this.tx.transfers.length){var errors=utils.toHash(this.errors,"recipient");return this.tx.transfers.filter(function(data){return!errors[data.recipient]}).length}return 0}}]),_createClass(MassSend,[{key:"$postLink",value:function(){var _this527=this,transfers=this.tx.transfers||[];this.tx.attachment=this.tx.attachment||"";var assetId=this.state.assetId;this.tx.assetId=assetId,transfers.forEach(function(item){item.amount=_this527.state.moneyHash[assetId].cloneWithTokens(item.amount.toTokens())}),this.tx.transfers=transfers,analytics.send({name:"Mass Transfer Click",target:"ui"});var onHasMoneyHash=function(){var changeTransfers=utils.observe(_this527.state.massSend,"transfers"),changeAssetId=utils.observe(_this527.state,"assetId");_this527.receive(changeAssetId,_this527._onChangeAssetId,_this527),_this527.observe(["transfers","errors"],_this527._updateTxList),_this527.observe("totalAmount",_this527._validate),_this527.observe("transfers",_this527._updateTextAreaContent),_this527.observe("recipientCsv",_this527._onChangeCSVText),_this527.receive(changeTransfers,_this527._calculateTotalAmount,_this527),_this527.receive(changeTransfers,_this527._validate,_this527),_this527.receive(changeTransfers,_this527._calculateFee,_this527),_this527.receive(changeAssetId,_this527._calculateFee,_this527),_this527.receive(utils.observe(_this527.state.massSend,"fee"),_this527._currentHasFee,_this527),_this527.transfers=_this527.tx.transfers.slice(),changeTransfers.dispatch()};this.state.moneyHash?onHasMoneyHash():utils.observe(this.state,"moneyHash").once(function(){onHasMoneyHash(),$scope.$digest()})}},{key:"importFile",value:function(data){var _this528=this;if("ok"===data.status)return this.importError=!1,readFile.read(data.file).then(function(content){_this528.massSend.recipientCsv.$touched=!0,_this528._processTextAreaContent(content),$scope.$digest()});this.importError=!0,$scope.$digest(),setTimeout(function(){_this528.importError=!1,$scope.$digest()},3e3)}},{key:"clear",value:function(){this.transfers=[],this.errors=[],this.importError=!1}},{key:"nextStep",value:function(){var tx=waves.node.transactions.createTransaction(this.tx);return ds.signature.getSignatureApi().makeSignable({type:tx.type,data:_extends({},tx,{attachment:utils.stringToBytes(tx.attachment)})})}},{key:"onTxSign",value:function(signable){analytics.send({name:"Mass Transfer Continue Click",target:"ui"}),this.onContinue({signable:signable})}},{key:"_onChangeAssetId",value:function(){var _this529=this,transfers=this.transfers;if(transfers&&transfers.length){var assetId=this.state.assetId;this.clear(),this.tx.assetId=assetId,this.transfers=transfers.map(function(item){return{recipient:item.recipient,amount:_this529.state.moneyHash[assetId].cloneWithTokens(item.amount.toTokens())}})}}},{key:"_currentHasFee",value:function(){if(!this.state||!this.state.massSend||!this.state.massSend.fee)return null;var fee=this.state.massSend.fee,moneyHash=this.state.moneyHash;this.hasFee=moneyHash[fee.asset.id]&&moneyHash[fee.asset.id].gte(fee)}},{key:"_updateTxList",value:function(){var list=this.transfers.slice(),errors=utils.toHash(this.errors,"recipient"),validList=list.filter(function(item){return!errors[item.recipient]}),endIndex=Math.min(validList.length,this.maxTransfersCount),transfers=validList.slice(0,endIndex);MassSend._isNotEqual(this.tx.transfers,transfers)&&(this.tx.transfers=transfers),this.tx.assetId!==this.state.assetId&&(this.tx.assetId=this.state.assetId),this._currentHasFee()}},{key:"_calculateTotalAmount",value:function(){var transfers=this.tx.transfers;if(transfers.length)return this.totalAmount=transfers.map(function(_ref202){var amount=_ref202.amount;return amount.getTokens().gte(0)?amount:amount.cloneWithTokens("0")}).reduce(function(result,item){return result.add(item)}),null;this.totalAmount=this.state.moneyHash[this.state.assetId].cloneWithTokens("0")}},{key:"_calculateFee",value:function(){var _this530=this;waves.node.getFee(this.tx).then(function(fee){_this530.tx.fee=fee,$scope.$digest()})}},{key:"_processTextAreaContent",value:function(content){var _this531=this,data=Papa.parse(content||"").data,recipientHash=MassSend._getRecipientHashByCSVParseResult(data),transfers=[];Object.keys(recipientHash).forEach(function(recipient){var amountNum=recipientHash[recipient].map(function(amount){try{return MassSend._parseAmount(amount)}catch(e){return new BigNumber(0)}}).reduce(function(result,item){return result.add(item)}),amount=_this531.state.moneyHash[_this531.state.assetId].cloneWithTokens(amountNum);transfers.push({recipient:recipient,amount:amount})}),MassSend._isNotEqual(this.transfers,transfers)&&(this.transfers=transfers)}},{key:"_validate",value:function(){this._validateAmounts(),this._validateRecipients()}},{key:"_validateRecipients",value:function(){var _this532=this;Promise.all(this.transfers.map(function(item){return MassSend._isValidRecipient(item.recipient)})).then(function(list){var errors=[];list.forEach(function(response,index){var recipient=_this532.transfers[index].recipient;response.state&&!_this532.transfers[index].amount.getTokens().lte(0)||errors.push({recipient:recipient})}),_this532.errors=errors,$scope.$digest()})}},{key:"_validateAmounts",value:function(){if(!this.totalAmount)return this.isValidAmounts=!0,null;var balance=utils.groupMoney([this.totalAmount,this.tx.fee])[this.state.assetId];this.isValidAmounts=this.state.moneyHash[this.state.assetId].gte(balance)&&this.totalAmount.getTokens().gt("0")}},{key:"_onChangeCSVText",value:function(){var text=this.recipientCsv;this._processTextAreaContent(text),this._updateTextAreaContent(),this._validateRecipients()}},{key:"_updateTextAreaContent",value:function(){var transfers=this.transfers,text=Papa.unparse(transfers.map(function(item){return[item.recipient,item.amount.getTokens().toFixed()]}));text!==this.recipientCsv&&(this.recipientCsv=text,$scope.$digest())}}],[{key:"_getRecipientHashByCSVParseResult",value:function(data){var recipientHash=Object.create(null);return data.forEach(function(item){if(!item.length)return null;var _item$map=item.map(function(text){return text.replace(/\s/g,"").replace(/"/g,"")}),_item$map2=_slicedToArray(_item$map,2),recipient=_item$map2[0],amountString=_item$map2[1];if(!recipient||!amountString)return null;recipientHash[recipient]||(recipientHash[recipient]=[]),recipientHash[recipient].push(amountString)}),recipientHash}},{key:"_isNotEqual",value:function(a,b){return!MassSend._isEqual(a,b)}},{key:"_isEqual",value:function(a,b){return a.length===b.length&&a.every(function(item,i){return item.recipient===b[i].recipient&&item.amount.eq(b[i].amount)})}},{key:"_isValidRecipient",value:function(recipient){return utils.resolve(validateService.wavesAddress(recipient))}},{key:"_parseAmount",value:function(amountString){var data=WavesApp.getLocaleData(),amount=amountString.replace(new RegExp("\\"+data.separators.group,"g"),"").replace(new RegExp("\\"+data.separators.decimal),".").replace(",",".");return/^([0-9]+\.)?[0-9]+$/.test(amount)?new BigNumber(amount):new BigNumber(0)}}]),MassSend}()).prototype,"_calculateFee",[_dec27],Object.getOwnPropertyDescriptor(_class133.prototype,"_calculateFee"),_class133.prototype),_applyDecoratedDescriptor(_class133.prototype,"_validateRecipients",[_dec28],Object.getOwnPropertyDescriptor(_class133.prototype,"_validateRecipients"),_class133.prototype),_applyDecoratedDescriptor(_class133.prototype,"_updateTextAreaContent",[_dec29],Object.getOwnPropertyDescriptor(_class133.prototype,"_updateTextAreaContent"),_class133.prototype),_applyDecoratedDescriptor(_class133,"_isValidRecipient",[_dec30],Object.getOwnPropertyDescriptor(_class133,"_isValidRecipient"),_class133),_class133)};controller.$inject=["Base","readFile","$scope","utils","validateService","waves","user","decorators"],angular.module("app.ui").component("wMassSend",{bindings:{state:"<",onContinue:"&"},templateUrl:"modules/utils/modals/sendAsset/components/massSend/mass-send.html",transclude:!0,controller:controller})}(),function(){var _FIAT_ASSETS,FIAT_ASSETS=(_defineProperty(_FIAT_ASSETS={},WavesApp.defaultAssets.USD,!0),_defineProperty(_FIAT_ASSETS,WavesApp.defaultAssets.EUR,!0),_defineProperty(_FIAT_ASSETS,WavesApp.defaultAssets.TRY,!0),_FIAT_ASSETS),Money=require("@waves/data-entities").Money,BigNumber=require("@waves/bignumber").BigNumber,ds=require("data-service"),SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,analytics=require("@waves/event-sender"),BANK_RECIPIENT=WavesApp.bankRecipient,controller=function(Base,$scope,utils,createPoll,waves,configService,outerBlockchains,user,gatewayService){return new(function(){function SingleSend(){_classCallCheck(this,SingleSend);var _this533=_possibleConstructorReturn(this,(SingleSend.__proto__||Object.getPrototypeOf(SingleSend)).call(this));return _this533.txType=WavesApp.TRANSACTION_TYPES.NODE.TRANSFER,_this533.digiLiraUserLink="https://www.digilira.com/",_this533.onContinue=null,_this533.focus=null,_this533.mirror=null,_this533.noMirror=!1,_this533.hasComission=!0,_this533.feeList=null,_this533.minAmount=null,_this533.maxAmount=null,_this533.state=Object.create(null),_this533.maxGatewayAmount=null,_this533.gatewayDetailsError=!1,_this533.gatewayAddressError=!1,_this533.gatewayWrongAddress=!1,_this533.gatewayError=!1,_this533.termsIsPending=!0,_this533.termsLoadError=!1,_this533.signInProgress=!1,_this533.wavesTx={type:SIGN_TYPE.TRANSFER,amount:null,attachment:"",fee:null,recipient:"",assetId:""},_this533._noCurrentRate=!1,$scope.WavesApp=WavesApp,_this533}return _inherits(SingleSend,Base),_createClass(SingleSend,[{key:"hasSendToBank",get:function(){return FIAT_ASSETS[this.assetId]||!1}},{key:"isLira",get:function(){return this.assetId===WavesApp.defaultAssets.TRY}},{key:"tx",get:function(){return this.state.singleSend}},{key:"assetId",get:function(){return this.state.assetId},set:function(id){this.state.assetId=id}},{key:"mirrorId",get:function(){return this.state.mirrorId}},{key:"moneyHash",get:function(){return this.state.moneyHash}},{key:"feeHash",get:function(){return utils.groupMoney(this.feeList||[])}},{key:"balance",get:function(){return this.moneyHash[this.assetId]}},{key:"outerSendMode",get:function(){return this.state.outerSendMode},set:function(value){this.state.outerSendMode=value}},{key:"paymentId",get:function(){return this.state.paymentId},set:function(value){this.state.paymentId=value}},{key:"gatewayDetails",get:function(){return this.state.gatewayDetails},set:function(value){this.state.gatewayDetails=value}},{key:"isBankPending",get:function(){return this.toBankMode&&this.termsIsPending}},{key:"isBankError",get:function(){return this.toBankMode&&this.termsLoadError}},{key:"isGatewayAccepted",get:function(){return!configService.get("PERMISSIONS.CANT_TRANSFER_GATEWAY").includes(this.balance.asset.id)}},{key:"isBankAccepted",get:function(){return!this.toBankMode||this.isGatewayAccepted}},{key:"isBankPendingOrError",get:function(){return this.isBankError||this.isBankPending}},{key:"hasOuterError",get:function(){return this.outerSendMode&&this.gatewayError||this.isBankError}},{key:"minimumAmount",get:function(){return this.gatewayDetails&&this.gatewayDetails.minimumAmount||this.toBankMode&&new BigNumber(100)}},{key:"maximumAmount",get:function(){return this.maxGatewayAmount||this.toBankMode&&this.balance.cloneWithTokens(5e4)}},{key:"toBankMode",get:function(){return this.state.toBankMode},set:function(value){this.state.toBankMode=value}}]),_createClass(SingleSend,[{key:"$postLink",value:function(){var _this534=this;this.receive(utils.observe(this.tx,"fee"),this._currentHasCommission,this);var onHasMoneyHash=function(){_this534.receive(utils.observe(_this534.state,"toBankMode"),_this534._onChangeBankMode,_this534),_this534.observe("gatewayDetails",_this534._currentHasCommission),_this534.minAmount=_this534.state.moneyHash[_this534.state.assetId].cloneWithTokens("0"),_this534.tx.amount=_this534.tx.amount||_this534.moneyHash[_this534.assetId].cloneWithTokens("0"),_this534._fillMirror(),_this534.receive(utils.observe(_this534.state,"assetId"),_this534._onChangeAssetId,_this534),_this534.receive(utils.observe(_this534.state,"mirrorId"),_this534._onChangeMirrorId,_this534),_this534.receive(utils.observe(_this534.state,"paymentId"),_this534._updateGatewayDetails,_this534),_this534.receive(utils.observe(_this534.tx,"recipient"),_this534._updateGatewayDetails,_this534),_this534.receive(utils.observe(_this534.state,"paymentId"),_this534._updateGatewayPermisson,_this534),_this534.receive(utils.observe(_this534.tx,"recipient"),_this534._updateGatewayPermisson,_this534),_this534.receive(utils.observe(_this534.tx,"amount"),_this534._onChangeAmount,_this534),_this534.observe("gatewayDetails",_this534._updateWavesTxObject),_this534.receive(utils.observe(_this534.tx,"amount"),_this534._updateWavesTxObject,_this534),_this534.receive(utils.observe(_this534.tx,"recipient"),_this534._updateWavesTxObject,_this534),_this534.receive(utils.observe(_this534.tx,"attachment"),_this534._updateWavesTxObject,_this534),_this534.observe("mirror",_this534._onChangeAmountMirror),_this534.observe(["gatewayAddressError","gatewayDetailsError","gatewayWrongAddress"],_this534._updateGatewayError),_this534._currentHasCommission(),_this534._onChangeBaseAssets(),_this534._updateGatewayDetails(),_this534._updateGatewayPermisson()};this.state.moneyHash?onHasMoneyHash():this.receiveOnce(utils.observe(this.state,"moneyHash"),onHasMoneyHash),this.receive(utils.observe(this.state,"moneyHash"),function(){_this534._currentHasCommission(),_this534._onChangeBaseAssets(),_this534._updateGatewayDetails()}),this._onChangeBaseAssets(),this._updateWavesTxObject()}},{key:"onSignCoinomatStart",value:function(){this.signInProgress=!0}},{key:"onSignCoinomatEnd",value:function(){this.signInProgress=!1}},{key:"createTx",value:function(){var toGateway=this.outerSendMode&&this.gatewayDetails,fee=toGateway?this.tx.amount.cloneWithTokens(toGateway.gatewayFee):null,attachmentString=this.tx.attachment?this.tx.attachment.toString():"",tx=waves.node.transactions.createTransaction(_extends({},this.tx,{recipient:toGateway?this.gatewayDetails.address:this.tx.recipient,attachment:utils.stringToBytes(toGateway?this.gatewayDetails.attachment:attachmentString),amount:toGateway?this.tx.amount.add(fee):this.tx.amount}));return ds.signature.getSignatureApi().makeSignable({type:tx.type,data:tx})}},{key:"onSignTx",value:function(signable){analytics.send({name:"Transfer Continue Click",target:"ui"}),this.onContinue({signable:signable})}},{key:"fillMax",value:function(){var _this535=this,amount=null,moneyHash=utils.groupMoney(this.feeList);(amount=moneyHash[this.assetId]?this.balance.sub(moneyHash[this.assetId]):this.balance).getTokens().lt(0)&&(amount=this.moneyHash[this.assetId].cloneWithTokens("0")),waves.utils.getRate(this.assetId,this.mirrorId).then(function(rate){_this535._noCurrentRate=!0,_this535.mirror=amount.convertTo(_this535.moneyHash[_this535.mirrorId].asset,rate),_this535.tx.amount=amount,_this535._noCurrentRate=!1,$scope.$apply()})}},{key:"onBlurMirror",value:function(){this.mirror||this._fillMirror(),this.focus=""}},{key:"onReadQrCode",value:function(url){var _this536=this;if(!url.includes("https://"))return this.tx.recipient=url,$scope.$apply(),null;var routeData=utils.getRouterParams(utils.getUrlForRoute(url));if(!routeData||"SEND_ASSET"!==routeData.name)return null;var result=routeData.data;if(this.tx.recipient=result.recipient,result){var applyAmount=function(){result.amount&&(_this536.tx.amount=_this536.moneyHash[_this536.assetId].cloneWithTokens(result.amount),_this536._fillMirror()),$scope.$apply()};result.assetId=result.asset||result.assetId,result.assetId?waves.node.assets.balance(result.assetId).then(function(_ref203){var available=_ref203.available;if(_this536.moneyHash[available.asset.id]=available,_this536.assetId!==available.asset.id){var myAssetId=_this536.assetId;_this536.assetId=available.asset.id,_this536.canChooseAsset=!0,_this536.choosableMoneyList=[_this536.moneyHash[myAssetId],available]}applyAmount()},applyAmount):applyAmount()}}},{key:"isMoneroNotIntegratedAddress",value:function(){return this.state.assetId===WavesApp.defaultAssets.XMR&&95===this.tx.recipient.length}},{key:"getGatewayDetails",value:function(){this._onChangeAssetId()}},{key:"_updateWavesTxObject",value:function(){var toGateway=this.outerSendMode&&this.gatewayDetails,fee=toGateway?this.tx.amount.cloneWithTokens(toGateway.gatewayFee):null,attachmentString=this.tx.attachment?this.tx.attachment.toString():"",isWavesAddress=user.isValidAddress(this.tx.recipient);this.wavesTx=_extends({},this.wavesTx,{recipient:toGateway?this.gatewayDetails.address:isWavesAddress&&this.tx.recipient||"",attachment:utils.stringToBytes(toGateway?this.gatewayDetails.attachment:attachmentString),amount:toGateway?this.tx.amount.add(fee):this.tx.amount,assetId:this.assetId})}},{key:"_validateForm",value:function(){(this.tx.amount.getTokens().gt(0)||this.tx.recipient)&&(this.send.$setDirty(!0),this.send.$setSubmitted(!0))}},{key:"_onChangeBankMode",value:function(){this.toBankMode&&!this.isLira?(this.tx.recipient=BANK_RECIPIENT,this.termsIsPending=!0):(this.tx.recipient="",this.termsIsPending=!1),this._setMinAmount(),this._updateGatewayPermisson()}},{key:"_setMinAmount",value:function(){if(this.toBankMode&&!this.isLira){var maxCoinomatAmount=this.balance.cloneWithTokens(5e4),minCoinomatAmount=this.balance.cloneWithTokens(100);this.maxAmount=Money.min(maxCoinomatAmount,this.balance),this.minAmount=minCoinomatAmount}else this.minAmount=this.state.moneyHash[this.assetId].cloneWithTokens("0"),this.maxAmount=this.moneyHash[this.assetId];this._validateForm()}},{key:"_onChangeMirrorId",value:function(){if(!this.mirrorId)throw new Error("Has no asset id!");if(this._onChangeBaseAssets(),!this.moneyHash[this.mirrorId])return null;this.mirror=this.moneyHash[this.mirrorId].cloneWithTokens("0"),this._onChangeAmount()}},{key:"_onChangeAssetId",value:function(){if(!this.assetId)throw new Error("Has no asset id!");if(this._onChangeBaseAssets(),!this.moneyHash[this.assetId])return null;this.tx.amount=this.moneyHash[this.assetId].cloneWithTokens("0"),this.mirror=this.moneyHash[this.mirrorId].cloneWithTokens("0"),this._updateGatewayDetails(),this._updateGatewayPermisson()}},{key:"_currentHasCommission",value:function(){var _this537=this;if(!this.moneyHash)return null;var details=this.gatewayDetails,check=function(feeList){var feeHash=utils.groupMoney(feeList),balanceHash=_this537.moneyHash;_this537.hasComission=Object.keys(feeHash).every(function(feeAssetId){var fee=feeHash[feeAssetId];return balanceHash[fee.asset.id]&&balanceHash[fee.asset.id].gte(fee)})};if(details){var gatewayFee=this.balance.cloneWithTokens(details.gatewayFee);this.feeList=[this.tx.fee,gatewayFee],check(this.feeList.concat(this.balance.cloneWithTokens(details.minimumAmount)))}else this.feeList=[this.tx.fee],check(this.feeList)}},{key:"_onChangeBaseAssets",value:function(){var _this538=this;this.assetId===this.mirrorId?this.noMirror=!0:waves.utils.getRate(this.assetId,this.mirrorId).then(function(rate){_this538.noMirror=rate.eq(0)})}},{key:"_onChangeAmount",value:function(){this._noCurrentRate||this.noMirror||"amount"!==this.focus||this._fillMirror()}},{key:"_onChangeAmountMirror",value:function(){this._noCurrentRate||"mirror"!==this.focus||this._fillAmount()}},{key:"_fillMirror",value:function(){var _this539=this;if(!this.tx.amount)return this.mirror=null,setTimeout(function(){return $scope.$digest()},0),null;waves.utils.getRate(this.assetId,this.mirrorId).then(function(rate){_this539.mirror=_this539.tx.amount.convertTo(_this539.moneyHash[_this539.mirrorId].asset,rate),$scope.$digest()})}},{key:"_fillAmount",value:function(){var _this540=this;if(!this.mirror)return this.tx.amount=null,setTimeout(function(){return $scope.$digest()},0),null;waves.utils.getRate(this.mirrorId,this.assetId).then(function(rate){_this540.tx.amount=_this540.mirror.convertTo(_this540.moneyHash[_this540.assetId].asset,rate),$scope.$digest()})}},{key:"_updateGatewayDetails",value:function(){var _this541=this;if(!this.toBankMode||this.isLira){var outerChain=outerBlockchains[this.assetId],isValidWavesAddress=user.isValidAddress(this.tx.recipient);return this.gatewayDetailsError&&(this.outerSendMode=!1,this.gatewayDetailsError=!1),this.gatewayAddressError&&(this.gatewayAddressError=!1),this.gatewayWrongAddress&&(this.gatewayWrongAddress=!1),this.outerSendMode=!isValidWavesAddress&&outerChain&&outerChain.isValidAddress(this.tx.recipient),this.outerSendMode?gatewayService.getWithdrawDetails(this.balance.asset,this.tx.recipient,this.paymentId).then(function(details){var max=BigNumber.min(details.maximumAmount.add(details.gatewayFee),_this541.moneyHash[_this541.assetId].getTokens());_this541.gatewayDetails=details,_this541.minAmount=_this541.moneyHash[_this541.assetId].cloneWithTokens(details.minimumAmount.sub("0.00000001")),_this541.maxAmount=_this541.moneyHash[_this541.assetId].cloneWithTokens(max),_this541.maxGatewayAmount=Money.fromTokens(details.maximumAmount,_this541.balance.asset),$scope.$apply()},function(e){_this541.gatewayDetails=null,e.message===gatewayService.getAddressErrorMessage(_this541.balance.asset,_this541.tx.recipient,"errorAddressMessage")?_this541.gatewayAddressError=!0:e.message===gatewayService.getWrongAddressMessage(_this541.balance.asset,_this541.tx.recipient,"wrongAddressMessage")?_this541.gatewayWrongAddress=!0:_this541.gatewayDetailsError=!0,$scope.$apply()}):(this.minAmount=this.state.moneyHash[this.assetId].cloneWithTokens("0"),this.maxAmount=this.moneyHash[this.assetId],this.gatewayDetails=null,this._validateForm(),Promise.resolve())}this._setMinAmount()}},{key:"_updateGatewayPermisson",value:function(){this.gatewayDetailsError=this.outerSendMode?!this.isGatewayAccepted:this.gatewayDetailsError}},{key:"_updateGatewayError",value:function(){this.gatewayError=this.gatewayAddressError||this.gatewayDetailsError||this.gatewayWrongAddress}}]),SingleSend}())};controller.$inject=["Base","$scope","utils","createPoll","waves","configService","outerBlockchains","user","gatewayService"],angular.module("app.ui").component("wSingleSend",{bindings:{state:"<",onContinue:"&"},templateUrl:"modules/utils/modals/sendAsset/components/singleSend/single-send.html",transclude:!0,controller:controller})}(),function(){var controller=function(Base,utils,createPoll,$scope){return new(function(){function Asset(){_classCallCheck(this,Asset);var _this542=_possibleConstructorReturn(this,(Asset.__proto__||Object.getPrototypeOf(Asset)).call(this,$scope));return _this542.balance=null,_this542.rating=null,_this542}return _inherits(Asset,Base),_createClass(Asset,[{key:"$postLink",value:function(){var _utils$getDataFromOra7=utils.getDataFromOracles(this.balance.asset.id),isVerified=_utils$getDataFromOra7.isVerified,isGateway=_utils$getDataFromOra7.isGateway,isTokenomica=_utils$getDataFromOra7.isTokenomica;this.isVerified=isVerified,this.isGateway=isGateway,this.isTokenomica=isTokenomica,createPoll(this,this._getTokenRating,this._setTokenRating,6e4)}},{key:"isUnpinned",value:function(){return!WavesApp.ALWAYS_PINNED_ASSETS.includes(this.balance.asset.id)}},{key:"_getTokenRating",value:function(){return ds.api.rating.getAssetsRating(this.balance.asset.id).then(function(assetList){return assetList}).catch(function(){return null})}},{key:"_setTokenRating",value:function(assetList){if(!assetList||!assetList[0])return null;this.rating=assetList[0].rating,$scope.$apply()}}]),Asset}())};controller.$inject=["Base","utils","createPoll","$scope"],angular.module("app.wallet.assets").component("wAsset",{bindings:{balance:"<",onClick:"&",onUnpinClick:"&"},templateUrl:"modules/wallet/modules/assets/directives/asset/asset.html",controller:controller})}(),function(){var controller=function(Base,i18n,$attrs,$element){return new(function(){function LeasingBlock(){_classCallCheck(this,LeasingBlock);var _this543=_possibleConstructorReturn(this,(LeasingBlock.__proto__||Object.getPrototypeOf(LeasingBlock)).call(this));return _this543.titleLiteral=$attrs.titleLocale,i18n.translateField(_this543,"titleLiteral","title",i18n.getNs($element)),_this543}return _inherits(LeasingBlock,Base),LeasingBlock}())};controller.$inject=["Base","i18n","$attrs","$element"],angular.module("app.wallet.leasing").component("wLeasingBlock",{bindings:{titleLocale:"@"},templateUrl:"modules/wallet/modules/leasing/directives/leasingBlock/leasingBlock.html",transclude:!0,controller:controller})}(),function(){var Handlebars=require("handlebars"),STATUS_LIST=require("@waves/oracle-data").STATUS_LIST,path=require("ramda").path,SIGN_TYPE=require("@waves/signature-adapter").SIGN_TYPE,analytics=require("@waves/event-sender"),BigNumber=require("@waves/bignumber").BigNumber,SELECTORS={AVAILABLE:"js-balance-available",SPONSORED:"js-sponsored-asset",IN_RESERVED:"js-balance-in-reserved",BASE_ASSET_BALANCE:"js-balance-in-base-asset",EXCHANGE_RATE:"js-exchange-rate",CHANGE_24:"js-change-24",CHART_CONTAINER:"js-chart-container",STARS_CONTAINER:"js-stars-container",BUTTONS:{SEND:"js-button-send",RECEIVE:"js-button-receive",DEX:"js-button-open-in-dex",TOGGLE_SPAM:"js-button-toggle-spam"},ACTION_BUTTONS:{ASSET_INFO:"js-action-button-asset-info",SEND:"js-action-button-send",RECEIVE:"js-action-button-receive",BURN:"js-action-button-burn",REISSUE:"js-action-button-reissue",DEX:"js-action-button-dex",TOGGLE_SPAM:"js-action-button-toggle-spam",SPONSORSHIP_CREATE:"js-action-button-sponsorship_create",SPONSORSHIP_EDIT:"js-action-button-sponsorship_edit",SPONSORSHIP_STOP:"js-action-button-cancel-sponsorship",SET_ASSET_SCRIPT:"js-action-button-set-asset-script"},SUSPICIOUS_LABEL:"js-suspicious-label"},i18next=require("i18next"),ds=require("data-service"),controller=function(Base,$templateRequest,$element,utils,waves,user,modalManager,$state,ChartFactory,RatingStarsFactory,i18n,$scope,gatewayService,createPoll){return new(function(){function PortfolioRow(){_classCallCheck(this,PortfolioRow);var _this544=_possibleConstructorReturn(this,(PortfolioRow.__proto__||Object.getPrototypeOf(PortfolioRow)).call(this));return _this544.ChartFactory=null,_this544.$state=null,_this544.$scope=null,_this544.i18n=null,_this544.modalManager=null,_this544.$node=null,_this544.node=null,_this544.balance=null,_this544.utils=null,_this544.waves=null,_this544.user=null,_this544.canShowDex=null,_this544.gatewayService=null,_this544.createPoll=null,_this544.isSmart=!1,_this544._isMyAsset=!1,_this544.changeLanguageHandler=function(){return _this544._onChangeLanguage()},_this544.ChartFactory=ChartFactory,_this544.$state=$state,_this544.$scope=$scope,_this544.i18n=i18n,_this544.modalManager=modalManager,_this544.$node=$element,_this544.node=$element.get(0),_this544.utils=utils,_this544.waves=waves,_this544.user=user,_this544.gatewayService=gatewayService,_this544.createPoll=createPoll,PortfolioRow.templatePromise||(PortfolioRow.templatePromise=$templateRequest("modules/wallet/modules/portfolio/directives/portfolioRow/row.hbs").then(function(html){return Handlebars.compile(html)})),_this544.chartOptions={axisX:"timestamp",axisY:"rate",view:{rate:{lineColor:"rgba(90, 129, 234)",fillColor:"rgba(90, 129, 234, .3)",lineWidth:1}}},_this544}return _inherits(PortfolioRow,Base),_createClass(PortfolioRow,[{key:"$postLink",value:function(){var _this545=this;this._isWaves=this.balance.asset.id===WavesApp.defaultAssets.WAVES,this._isMyAsset=this.balance.asset.sender===this.user.address,this.canShowDex=this._getCanShowDex();var canStopSponsored=this._getCanStopSponsored();Promise.all([this.waves.node.getFeeList({type:SIGN_TYPE.TRANSFER}),PortfolioRow.templatePromise]).then(function(_ref204){var _ref205=_slicedToArray(_ref204,2),list=_ref205[0],template=_ref205[1],balance=_this545.balance;_this545.isSmart=balance.asset.hasScript;var firstAssetChar=_this545.balance.asset.name.slice(0,1),canPayFee=list.find(function(item){return item.asset.id===_this545.balance.asset.id})&&!_this545._isWaves,_utils$getDataFromOra8=utils.getDataFromOracles(_this545.balance.asset.id),isVerified=_utils$getDataFromOra8.isVerified,isGateway=_utils$getDataFromOra8.isGateway,isTokenomica=_utils$getDataFromOra8.isTokenomica,logo=_utils$getDataFromOra8.logo,isGatewaySoon=_utils$getDataFromOra8.isGatewaySoon;_this545.isVerifiedOrGateway=isVerified||isGateway;var html=template({canSetAssetScript:_this545._isMyAsset&&_this545.isSmart,isSmart:_this545.isSmart,isVerified:isVerified,isGateway:isGateway,isTokenomica:isTokenomica,isGatewaySoon:isGatewaySoon,assetIconPath:logo||_this545.utils.getAssetLogo(_this545.balance.asset.id),firstAssetChar:firstAssetChar,canBurn:!_this545._isWaves,canReissue:_this545._isMyAsset&&_this545.balance.asset.reissuable,charColor:_this545.utils.getAssetLogoBackground(_this545.balance.asset.id),assetName:_this545.balance.asset.name,SELECTORS:_extends({},SELECTORS),canShowDex:_this545.canShowDex,canShowToggleSpam:_this545._canShowToggleSpam(),canSponsored:_this545._isMyAsset,canPayFee:canPayFee,canStopSponsored:canStopSponsored});_this545.node.innerHTML=html,Object.defineProperty(_this545,"balance",{get:function(){return balance},set:function(value){_this545.balance.asset.id===value.asset.id&&_this545.balance.available.getTokens().eq(value.available.getTokens())&&_this545.balance.inOrders.getTokens().eq(value.inOrders.getTokens())&&_this545.balance.isOnScamList===value.isOnScamList||(balance=value,_this545._onUpdateBalance()),_this545._initSponsorShips()}}),_this545._poll=createPoll(_this545,_this545._initSponsorShips,angular.noop,5e3),_this545._onUpdateBalance(),_this545._setHandlers(),_this545.changeLanguageHandler()})}},{key:"$onDestroy",value:function(){_get2(PortfolioRow.prototype.__proto__||Object.getPrototypeOf(PortfolioRow.prototype),"$onDestroy",this).call(this),this.$node.off()}},{key:"_onChangeLanguage",value:function(){var _this546=this,nodeList=this.node.querySelectorAll("[w-i18n-literal]");this._updateBalances(),Array.prototype.forEach.call(nodeList,function(element){element.innerHTML=_this546.i18n.translate(element.getAttribute("w-i18n-literal"),"app.wallet.portfolio")})}},{key:"_getCanStopSponsored",value:function(){var _this547=this;return this._isMyAsset&&ds.utils.getTransferFeeList().find(function(item){return item.asset.id===_this547.balance.asset.id})}},{key:"_getCanShowDex",value:function(){var statusPath=["assets",this.balance.asset.id,"status"];return!utils.isLockedInDex(this.balance.asset.id)&&(this.balance.isPinned||this._isMyAsset||this.balance.asset.isMyAsset||this.balance.asset.id===WavesApp.defaultAssets.WAVES||this.gatewayService.getPurchasableWithCards()[this.balance.asset.id]||this.gatewayService.getCryptocurrencies()[this.balance.asset.id]||this.gatewayService.getFiats()[this.balance.asset.id]||path(statusPath,ds.dataManager.getOracleData("oracleWaves"))===STATUS_LIST.VERIFIED)}},{key:"_onUpdateBalance",value:function(){var _this548=this;this._updateBalances(),this._initSpamState();var balance=this.balance;if(balance.isOnScamList)return this.node.querySelector("."+SELECTORS.CHANGE_24).innerHTML="â",this.node.querySelector("."+SELECTORS.BASE_ASSET_BALANCE).innerHTML="â",this.node.querySelector("."+SELECTORS.EXCHANGE_RATE).innerHTML="â",this.node.querySelector("."+SELECTORS.SUSPICIOUS_LABEL).classList.remove("hidden"),null;var suspiciousSelector=this.node.querySelector("."+SELECTORS.SUSPICIOUS_LABEL);suspiciousSelector&&suspiciousSelector.classList.add("hidden");var baseAssetId=this.user.getSetting("baseAssetId"),change24Node=this.node.querySelector("."+SELECTORS.CHANGE_24);if(baseAssetId===balance.asset.id)change24Node.innerHTML="â",change24Node.classList.remove("minus"),change24Node.classList.remove("plus");else{var baseChange24AssetId=WavesApp.defaultAssets.WAVES===balance.asset.id?baseAssetId:WavesApp.defaultAssets.WAVES;this.waves.utils.getChange(balance.asset.id,baseChange24AssetId).then(function(change24){var change24BN=new BigNumber(change24),isMoreZero=change24BN.gt(0),isLessZero=change24BN.lt(0);change24Node.classList.toggle("minus",isLessZero),change24Node.classList.toggle("plus",isMoreZero),change24Node.innerHTML=change24.toFixed(2)+"%"},function(){change24Node.innerHTML="0.00%"})}if(baseAssetId===balance.asset.id)this.node.querySelector("."+SELECTORS.EXCHANGE_RATE).innerHTML="â",this.node.querySelector("."+SELECTORS.BASE_ASSET_BALANCE).innerHTML="â";else{this.waves.utils.getRate(balance.asset.id,baseAssetId).then(function(rate){var baseAssetBalance=balance.available.getTokens().mul(rate).toFormat(2);_this548.node.querySelector("."+SELECTORS.EXCHANGE_RATE).innerHTML=rate.toFixed(2),_this548.node.querySelector("."+SELECTORS.BASE_ASSET_BALANCE).innerHTML=baseAssetBalance});var startDate=this.utils.moment().add().day(-7);this.waves.utils.getRateHistory(balance.asset.id,baseAssetId,startDate).then(function(values){var chartData={rate:values.map(function(item){return _extends({},item,{rate:Number(item.rate.toFixed())})})};_this548.chart=new _this548.ChartFactory(_this548.$node.find("."+SELECTORS.CHART_CONTAINER),_this548.chartOptions,chartData)}).catch(function(){return null}),"number"==typeof balance.rating&&new RatingStarsFactory({$container:this.$node.find("."+SELECTORS.STARS_CONTAINER),rating:balance.rating,size:"s"})}}},{key:"_initActions",value:function(){var _this549=this,expanded=!1,$wrapper=this.$node.find(".actions__container"),toggleExpanded=function(){expanded=!expanded;var conteiner=_this549.$node.find(".actions__container"),conteinerNode=conteiner.get(0);if(conteiner.toggleClass("expanded",expanded),expanded){$(document).on("mousedown",_handler);var dropDownPosition=conteinerNode.getBoundingClientRect(),bodyPosition=document.body.getBoundingClientRect();conteinerNode.classList.toggle("to-up",dropDownPosition.bottom>bodyPosition.bottom)}else $(document).off("mousedown",_handler),conteinerNode.classList.remove("to-up")},_handler=function(e){0===$(e.target).closest($wrapper).length&&toggleExpanded()};this.$node.find(".actions__click").on("click",function(){toggleExpanded()}),this.$scope.$on("$destroy",function(){$(document).off("mousedown",_handler)})}},{key:"_setHandlers",value:function(){var _this550=this;this._initActions(),this.listenEventEmitter(i18next,"languageChanged",this.changeLanguageHandler),this.$node.on("click","."+SELECTORS.BUTTONS.SEND,function(){analytics.send({name:"Transfer Click",params:{Currency:_this550.balance.asset.id},target:"ui"}),_this550.modalManager.showSendAsset({assetId:_this550.balance.asset.id})}),this.$node.on("click","."+SELECTORS.BUTTONS.DEX,function(){analytics.send({name:"Wallet Portfolio Open in DEX Click",params:{Currency:_this550.balance.asset.id},target:"ui"}),_this550.$state.go("main.dex",_this550._getSrefParams(_this550.balance.asset))}),this.$node.on("click","."+SELECTORS.BUTTONS.RECEIVE,function(){analytics.send({name:"Transfer Click",params:{Currency:_this550.balance.asset.id},target:"ui"}),_this550.modalManager.showReceiveModal(_this550.balance.asset)}),this.$node.on("click","."+SELECTORS.BUTTONS.TOGGLE_SPAM,function(){_this550.user.toggleSpamAsset(_this550.balance.asset.id),_this550._initSpamState()}),this.$node.on("click","."+SELECTORS.ACTION_BUTTONS.ASSET_INFO,function(){_this550.modalManager.showAssetInfo(_this550.balance.asset)}),this.$node.on("click","."+SELECTORS.ACTION_BUTTONS.SEND,function(){analytics.send({name:"Transfer Click",params:{Currency:_this550.balance.asset.id},target:"ui"}),_this550.modalManager.showSendAsset({assetId:_this550.balance.asset.id})}),this.$node.on("click","."+SELECTORS.ACTION_BUTTONS.RECEIVE,function(){analytics.send({name:"Transfer Click",params:{Currency:_this550.balance.asset.id},target:"ui"}),_this550.modalManager.showReceiveModal(_this550.balance.asset)}),this.$node.on("click","."+SELECTORS.ACTION_BUTTONS.BURN,function(){analytics.send({name:"Burn Token Click",params:{Currency:_this550.balance.asset.id},target:"ui"}),_this550.modalManager.showBurnModal(_this550.balance.asset.id)}),this.$node.on("click","."+SELECTORS.ACTION_BUTTONS.REISSUE,function(){analytics.send({name:"Reissue Token Click",params:{Currency:_this550.balance.asset.id},target:"ui"}),_this550.modalManager.showReissueModal(_this550.balance.asset.id)}),this.$node.on("click","."+SELECTORS.ACTION_BUTTONS.DEX,function(){analytics.send({name:"Wallet Portfolio Open in DEX Click",params:{Currency:_this550.balance.asset.id},target:"ui"}),_this550.$state.go("main.dex",_this550._getSrefParams(_this550.balance.asset))}),this.$node.on("click","."+SELECTORS.ACTION_BUTTONS.SPONSORSHIP_CREATE,function(){analytics.send({name:"Enable Sponsorship Click",params:{Currency:_this550.balance.asset.id},target:"ui"}),_this550.modalManager.showSponsorshipModal(_this550.balance.asset.id)}),this.$node.on("click","."+SELECTORS.ACTION_BUTTONS.SET_ASSET_SCRIPT,function(){analytics.send({name:"Update Script Click",params:{Currency:_this550.balance.asset.id},target:"ui"}),_this550.modalManager.showSetAssetScriptModal(_this550.balance.asset.id)}),this.$node.on("click","."+SELECTORS.ACTION_BUTTONS.SPONSORSHIP_EDIT,function(){analytics.send({name:"Change Sponsorship Click",params:{Currency:_this550.balance.asset.id},target:"ui"}),_this550.modalManager.showSponsorshipModal(_this550.balance.asset.id,!0)}),this.$node.on("click","."+SELECTORS.ACTION_BUTTONS.SPONSORSHIP_STOP,function(){analytics.send({name:"Disable Sponsorship Click",params:{Currency:_this550.balance.asset.id},target:"ui"}),_this550.modalManager.showSponsorshipStopModal(_this550.balance.asset.id)}),this.$node.on("click","."+SELECTORS.ACTION_BUTTONS.TOGGLE_SPAM,function(){_this550.user.toggleSpamAsset(_this550.balance.asset.id),_this550._initSpamState()})}},{key:"_initSpamState",value:function(){if(!this._canShowToggleSpam())return null;var isSpam=(this.user.getSetting("wallet.portfolio.spam")||[]).includes(this.balance.asset.id);[this.node.querySelector("."+SELECTORS.BUTTONS.TOGGLE_SPAM),this.node.querySelector("."+SELECTORS.ACTION_BUTTONS.TOGGLE_SPAM)].forEach(function(toggleSpam){toggleSpam&&(toggleSpam.classList.toggle("icon-hide",!isSpam),toggleSpam.classList.toggle("icon-show",isSpam))})}},{key:"_initSponsorShips",value:function(list){var _this551=this,canStopSponsored=!!this._getCanStopSponsored(),canSponsored=!!this._isMyAsset,isSmart=this.isSmart,btnCreate=this.node.querySelector("."+SELECTORS.ACTION_BUTTONS.SPONSORSHIP_CREATE),btnEdit=this.node.querySelector("."+SELECTORS.ACTION_BUTTONS.SPONSORSHIP_EDIT),btnStop=this.node.querySelector("."+SELECTORS.ACTION_BUTTONS.SPONSORSHIP_STOP),icon=this.node.querySelector("."+SELECTORS.SPONSORED+" .asset-logo__marker");btnCreate.classList.toggle("hidden",isSmart||!(canSponsored&&!canStopSponsored)),btnEdit.classList.toggle("hidden",!(canSponsored&&canStopSponsored)),btnStop.classList.toggle("hidden",isSmart||!canStopSponsored),Promise.resolve(list||this.waves.node.getFeeList({type:SIGN_TYPE.TRANSFER})).then(function(list){var canPayFee=list.find(function(item){return item.asset.id===_this551.balance.asset.id})&&!_this551._isWaves;icon.classList.toggle("asset-logo__marker_sponsored",!!canPayFee)})}},{key:"_getSrefParams",value:function(asset){this.utils.openDex(asset.id)}},{key:"_updateBalances",value:function(){var asset=this.balance.asset,available=this.balance.available.getTokens(),inOrders=this.balance.inOrders.getTokens(),leasedOut=this.balance.leasedOut.getTokens(),availableHtml=this.utils.getNiceNumberTemplate(available,asset.precision,!0),inReservedHtml=this.utils.getNiceNumberTemplate(inOrders.add(leasedOut),asset.precision);this.node.querySelector("."+SELECTORS.AVAILABLE).innerHTML=availableHtml,this.node.querySelector("."+SELECTORS.IN_RESERVED).innerHTML=inReservedHtml}},{key:"_canShowToggleSpam",value:function(){return!this._isMyAsset&&(!this.isVerifiedOrGateway&&!this.user.scam[this.balance.asset.id])}}]),PortfolioRow}())($templateRequest,$element,utils,waves,user,modalManager,$state,ChartFactory,RatingStarsFactory,i18n,$scope,gatewayService,createPoll)};controller.$inject=["Base","$templateRequest","$element","utils","waves","user","modalManager","$state","ChartFactory","RatingStarsFactory","i18n","$scope","gatewayService","createPoll"],angular.module("app.wallet.portfolio").component("wPortfolioRow",{controller:controller,bindings:{balance:"<",canShowDex:"<"},scope:!1})}()}();