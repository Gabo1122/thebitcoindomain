"use strict";
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
var utils_1 = require("../utils");
var createMethod = function (_a) {
    var _b = _a.validate, validate = _b === void 0 ? utils_1.T : _b, generateRequest = _a.generateRequest, libOptions = _a.libOptions, addPaginationToArgs = _a.addPaginationToArgs;
    function method() {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        return utils_1.pipeP(validate, generateRequest(libOptions.rootUrl), function (_a) {
            var url = _a.url, options = __rest(_a, ["url"]);
            return libOptions.fetch(url, options);
        }, libOptions.parse, function (rawData) {
            return utils_1.pipeP(libOptions.transform, addPagination({ method: method, args: args, addPaginationToArgs: addPaginationToArgs, rawData: rawData }))(rawData);
        }).apply(void 0, args);
    }
    return method;
};
exports.createMethod = createMethod;
var addPagination = function (_a) {
    var method = _a.method, args = _a.args, addPaginationToArgs = _a.addPaginationToArgs, rawData = _a.rawData;
    return function (data) {
        if (!data || !addPaginationToArgs || !rawData || !rawData.lastCursor) {
            return { data: data };
        }
        return {
            data: data,
            fetchMore: function (count) {
                return method(addPaginationToArgs({ args: args, cursor: rawData.lastCursor, count: count }));
            },
        };
    };
};
